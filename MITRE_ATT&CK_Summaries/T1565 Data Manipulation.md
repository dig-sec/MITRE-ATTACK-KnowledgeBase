# Palantir's Alerting & Detection Strategy (ADS) Framework: Container-based Log Manipulation

## Goal
Detect adversarial attempts to bypass security monitoring using containerized environments to manipulate logs and other data artifacts.

## Categorization
- **MITRE ATT&CK Mapping:** T1565 - Data Manipulation
- **Tactic / Kill Chain Phases:** Impact
- **Platforms:** Linux, macOS, Windows
- [MITRE ATT&CK Reference](https://attack.mitre.org/techniques/T1565)

## Strategy Abstract
This detection strategy aims to identify attempts by adversaries to manipulate log data within containerized environments. It leverages logs from container orchestrators (e.g., Kubernetes) and underlying host systems, analyzing patterns indicative of tampering or suppression.

**Data Sources:**
- Container orchestration system logs (Kubernetes audit logs)
- Host operating system logs (syslog, Windows Event Logs)
- Application-specific logging outputs

**Patterns Analyzed:**
- Unusual deletion or modification timestamps in log files
- Discrepancies between containerized application activities and host-level logs
- Anomalies in audit trails suggesting tampering

## Technical Context
Adversaries may exploit containers to execute malicious activities while minimizing detection. Techniques include altering, deleting, or redirecting log outputs to conceal their actions.

**Real-world Execution:**
- Adversaries can use privileged container access to modify system logs.
- They might deploy scripts within a container to clear logs periodically.
- Use of volume mounts to overwrite host-based logging directories from within the container.

**Adversary Emulation Details:**
1. **Privilege Escalation:** Gain root access in the container environment.
2. **Log Deletion Command:** `rm -rf /var/log/*` executed inside a privileged container.
3. **Log Modification Script:** A cron job to modify timestamp entries in log files.

## Blind Spots and Assumptions
- Assumes that logs are consistently monitored across both host and container layers.
- Detection may be less effective if containers are dynamically re-created or destroyed frequently, as artifacts might not persist long enough for analysis.
- Relies on the assumption that all critical data is logged by either the application or system.

## False Positives
- Legitimate log rotation activities managed by `logrotate` or similar tools might mimic malicious deletions.
- Scheduled administrative tasks or maintenance operations could lead to legitimate modifications in logs, triggering alerts.
- Updates or patches applied to containers may alter log files unexpectedly without malicious intent.

## Priority
**Severity:** High

**Justification:**
Log manipulation can significantly hinder incident response and forensic analysis by concealing critical indicators of compromise. Early detection is crucial for maintaining visibility into adversarial activities within containerized environments.

## Validation (Adversary Emulation)
### Step-by-step Instructions to Emulate in a Test Environment:
1. **Set Up Container Environment:**
   - Deploy a sample application on Kubernetes or Docker.
   - Ensure logging is directed both at the host and container levels.

2. **Privilege Escalation Simulation:**
   - Run a privileged container with access to host file systems (`--privileged` flag in Docker).

3. **Log Manipulation Execution:**
   - Execute `rm -rf /var/log/*` from within the privileged container.
   - Create a script that modifies log timestamps, scheduling it with cron.

4. **Detection Validation:**
   - Monitor alerts generated by the detection strategy upon execution of these commands.
   - Verify if discrepancies are detected between host logs and application logs.

## Response
When an alert indicating possible log manipulation is triggered:
- Immediately isolate affected containers or hosts to prevent further tampering.
- Conduct a thorough review of system and container logs for signs of unauthorized access or privilege escalation.
- Initiate forensic analysis to determine the scope of compromise and gather evidence.
- Strengthen logging policies, ensuring immutable storage for critical logs.

## Additional Resources
Currently, no additional resources are available. However, teams can refer to:
- Kubernetes audit log documentation for configuring comprehensive auditing.
- Best practices guides on securing container environments against privilege escalation attacks.

By implementing this ADS framework, organizations can enhance their detection capabilities for adversarial attempts at log manipulation within containerized ecosystems.