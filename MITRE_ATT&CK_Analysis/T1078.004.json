{
    "id": "T1078.004",
    "name": "Cloud Accounts",
    "description": "Adversaries may obtain and abuse credentials of a cloud account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. Cloud accounts are those created and configured by an organization for use by users, remote support, services, or for administration of resources within a cloud service provider or SaaS application. In some cases, cloud accounts may be federated with traditional identity management system, such as Window Active Directory. (Citation: AWS Identity Federation)(Citation: Google Federating GC)(Citation: Microsoft Deploying AD Federation)\nCompromised credentials for cloud accounts can be used to harvest sensitive data from online storage accounts and databases. Access to cloud accounts can also be abused to gain Initial Access to a network by abusing a [Trusted Relationship](T1199). Similar to [Domain Accounts](T1078.002), compromise of federated cloud accounts may allow adversaries to more easily move laterally within an environment.",
    "platforms": "Azure AD, Office 365, SaaS, IaaS, Google Workspace",
    "kill_chain_phases": "Defense Evasion, Persistence, Privilege Escalation, Initial Access",
    "data_sources": "Logon Session: Logon Session Metadata, User Account: User Account Authentication, Logon Session: Logon Session Creation",
    "detection": "Monitor the activity of cloud accounts to detect abnormal or malicious behavior, such as accessing information outside of the normal function of the account or account usage at atypical hours.",
    "url": "https://attack.mitre.org/techniques/T1078/004",
    "enrichments": {
        "attack_rule_map": [],
        "cycat": {
            "cycat": {
                "cycat_related_uuids": [
                    "e40f4962-b02b-4192-9bfe-245f7ece1f99",
                    "4afac85c-224a-4dd7-b1af-8da40e1c60bd",
                    "49a268a4-72f4-4e38-8a7b-885be690c5b5",
                    "0055ad1f-be85-4798-83cf-a6da17c993b3",
                    "039a7469-0296-4450-84c0-f6966b16dc6d",
                    "5f521e4b-0105-4b72-845b-2198a54487b9",
                    "b4a6d707-9430-4f5f-af68-0337f52d5c42",
                    "5496ff55-42ec-4369-81cb-00f417029e25",
                    "9a60e676-26ac-44c3-814b-0c2a8b977adf",
                    "a0413867-daf3-43dd-9245-734b3a787942",
                    "f9405037-bc97-4eb7-baba-167dad399b83",
                    "28870ae4-6a13-4616-bd1a-235a7fad7458",
                    "1b45b0d1-773f-4f23-aedc-814b759563b1",
                    "09438caa-07b1-4870-8405-1dbafe3dad95",
                    "4f77e1d7-3982-4ee0-8489-abf2d6b75284",
                    "8c944ecb-6970-4541-8496-be554b8e2846",
                    "8ad1600d-e9dc-4251-b0ee-a65268f29add",
                    "0b4b72e3-4c53-4d5b-b198-2c58cfef39a9",
                    "f7b5b004-dece-46e4-a4a5-f6fd0e1c6947",
                    "28eea407-28d7-4e42-b0be-575d5ba60b2c",
                    "c1bd5026-520b-45bd-9a79-82d38cf96c7b",
                    "fa84aaf5-8142-43cd-9ec2-78cfebf878ce",
                    "60f6535a-760f-42a9-be3f-c9a0a025906e",
                    "908655e0-25cf-4ae1-b775-1c8ce9cf43d8",
                    "8dee7a0d-43fd-4b3c-8cd1-605e189d195e",
                    "db6c06c4-bf3b-421c-aa88-15672b88c743",
                    "11c767ae-500b-423b-bae3-b234450736ed",
                    "f8ed0e8f-7438-4b79-85eb-f358ef2fbebd",
                    "340ee172-4b67-4fb4-832f-f961bdc1f3aa",
                    "f232fa7a-025c-4d43-abc7-318e81a73d65",
                    "4d136857-6a1a-432a-82fc-5dd497ee5e7c",
                    "5afa454e-030c-4ab4-9253-a90aa7fcc581"
                ],
                "lookup_results": [
                    {
                        "uuid": "e40f4962-b02b-4192-9bfe-245f7ece1f99",
                        "lookup_data": {
                            "description": "User has indicated they haven't instigated the MFA prompt and could indicate an attacker has the password for the account.",
                            "raw": "author: AlertIQ\ndate: 2022/03/24\ndescription: User has indicated they haven't instigated the MFA prompt and could indicate\n  an attacker has the password for the account.\ndetection:\n  condition: selection\n  selection:\n    AuthenticationRequirement: multiFactorAuthentication\n    Status|contains: MFA Denied\nfalsepositives:\n- Users actually login but miss-click into the Deny button when MFA prompt.\nid: e40f4962-b02b-4192-9bfe-245f7ece1f99\nlevel: medium\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://www.microsoft.com/security/blog/2022/03/22/dev-0537-criminal-actor-targeting-organizations-for-data-exfiltration-and-destruction/\nstatus: test\ntags:\n- attack.initial_access\n- attack.credential_access\n- attack.t1078.004\n- attack.t1110\n- attack.t1621\ntitle: Multifactor Authentication Denied\n",
                            "sigma:id": "e40f4962-b02b-4192-9bfe-245f7ece1f99",
                            "title": "Multifactor Authentication Denied",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4afac85c-224a-4dd7-b1af-8da40e1c60bd",
                        "lookup_data": {
                            "description": "Detects when an account is disabled or blocked for sign in but tried to log in",
                            "raw": "author: Yochana Henderson, '@Yochana-H'\ndate: 2022/06/17\ndescription: Detects when an account is disabled or blocked for sign in but tried\n  to log in\ndetection:\n  condition: selection\n  selection:\n    ResultDescription: Failure\n    ResultType: 50057\nfalsepositives:\n- Account disabled or blocked in error\n- Automation account has been blocked or disabled\nid: 4afac85c-224a-4dd7-b1af-8da40e1c60bd\nlevel: medium\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://docs.microsoft.com/en-gb/azure/active-directory/fundamentals/security-operations-privileged-accounts\nstatus: experimental\ntags:\n- attack.initial_access\n- attack.t1078.004\ntitle: Account Disabled or Blocked for Sign in Attempts\n",
                            "sigma:id": "4afac85c-224a-4dd7-b1af-8da40e1c60bd",
                            "title": "Account Disabled or Blocked for Sign in Attempts",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "49a268a4-72f4-4e38-8a7b-885be690c5b5",
                        "lookup_data": {
                            "description": "Detects when a user is added to a privileged role.",
                            "raw": "author: Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'\ndate: 2022/08/06\ndescription: Detects when a user is added to a privileged role.\ndetection:\n  condition: selection\n  selection:\n    properties.message:\n    - Add eligible member (permanent)\n    - Add eligible member (eligible)\nfalsepositives:\n- Legtimate administrator actions of adding members from a role\nid: 49a268a4-72f4-4e38-8a7b-885be690c5b5\nlevel: high\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-identity-management#azure-ad-roles-assignment\nstatus: experimental\ntags:\n- attack.privilege_escalation\n- attack.defense_evasion\n- attack.t1078.004\ntitle: User Added To Privilege Role\n",
                            "sigma:id": "49a268a4-72f4-4e38-8a7b-885be690c5b5",
                            "title": "User Added To Privilege Role",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "0055ad1f-be85-4798-83cf-a6da17c993b3",
                        "lookup_data": {
                            "description": "Detects when a configuration change is made to an applications URI.\nURIs for domain names that no longer exist (dangling URIs), not using HTTPS, wildcards at the end of the domain, URIs that are no unique to that app, or URIs that point to domains you do not control should be investigated.\n",
                            "raw": "author: Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik'\ndate: 2022/06/02\ndescription: 'Detects when a configuration change is made to an applications URI.\n\n  URIs for domain names that no longer exist (dangling URIs), not using HTTPS, wildcards\n  at the end of the domain, URIs that are no unique to that app, or URIs that point\n  to domains you do not control should be investigated.\n\n  '\ndetection:\n  condition: selection\n  selection:\n    properties.message: Update Application Sucess- Property Name AppAddress\nfalsepositives:\n- When and administrator is making legitimate URI configuration changes to an application.\n  This should be a planned event.\nid: 0055ad1f-be85-4798-83cf-a6da17c993b3\nlevel: high\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-applications#application-configuration-changes\nstatus: experimental\ntags:\n- attack.t1528\n- attack.t1078.004\n- attack.persistence\n- attack.credential_access\n- attack.privilege_escalation\ntitle: Application URI Configuration Changes\n",
                            "sigma:id": "0055ad1f-be85-4798-83cf-a6da17c993b3",
                            "title": "Application URI Configuration Changes",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "039a7469-0296-4450-84c0-f6966b16dc6d",
                        "lookup_data": {
                            "description": "Detects when a PIM elevation is approved or denied. Outside of normal operations should be investigated.",
                            "raw": "author: Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'\ndate: 2022/08/09\ndescription: Detects when a PIM elevation is approved or denied. Outside of normal\n  operations should be investigated.\ndetection:\n  condition: selection\n  selection:\n    properties.message: Request Approved/Denied\nfalsepositives:\n- Actual admin using PIM.\nid: 039a7469-0296-4450-84c0-f6966b16dc6d\nlevel: high\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-identity-management#azure-ad-roles-assignment\nstatus: experimental\ntags:\n- attack.privilege_escalation\n- attack.t1078.004\ntitle: PIM Approvals And Deny Elevation\n",
                            "sigma:id": "039a7469-0296-4450-84c0-f6966b16dc6d",
                            "title": "PIM Approvals And Deny Elevation",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5f521e4b-0105-4b72-845b-2198a54487b9",
                        "lookup_data": {
                            "description": "Detect when users in your Azure AD tenant are authenticating to other Azure AD Tenants.",
                            "raw": "author: MikeDuddington, '@dudders1'\ndate: 2022/06/30\ndescription: Detect when users in your Azure AD tenant are authenticating to other\n  Azure AD Tenants.\ndetection:\n  condition: selection and not filter\n  filter:\n    ResourceTenantId|contains: HomeTenantID\n  selection:\n    HomeTenantId: HomeTenantID\n    Status: Success\nfalsepositives:\n- If this was approved by System Administrator.\nid: 5f521e4b-0105-4b72-845b-2198a54487b9\nlevel: medium\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://docs.microsoft.com/en-gb/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-external-user-sign-ins\nstatus: experimental\ntags:\n- attack.initial_access\n- attack.t1078.004\ntitle: Users Authenticating To Other Azure AD Tenants\n",
                            "sigma:id": "5f521e4b-0105-4b72-845b-2198a54487b9",
                            "title": "Users Authenticating To Other Azure AD Tenants",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "b4a6d707-9430-4f5f-af68-0337f52d5c42",
                        "lookup_data": {
                            "description": "Define a baseline threshold for failed sign-ins due to Conditional Access failures",
                            "raw": "author: Yochana Henderson, '@Yochana-H'\ndate: 2022/06/01\ndescription: Define a baseline threshold for failed sign-ins due to Conditional Access\n  failures\ndetection:\n  condition: selection\n  selection:\n    ResultType: 53003\n    Resultdescription: Blocked by Conditional Access\nfalsepositives:\n- Service Account misconfigured\n- Misconfigured Systems\n- Vulnerability Scanners\nid: b4a6d707-9430-4f5f-af68-0337f52d5c42\nlevel: high\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://docs.microsoft.com/en-gb/azure/active-directory/fundamentals/security-operations-privileged-accounts\nstatus: experimental\ntags:\n- attack.initial_access\n- attack.credential_access\n- attack.t1110\n- attack.t1078.004\ntitle: Sign-in Failure Due to Conditional Access Requirements Not Met\n",
                            "sigma:id": "b4a6d707-9430-4f5f-af68-0337f52d5c42",
                            "title": "Sign-in Failure Due to Conditional Access Requirements Not Met",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5496ff55-42ec-4369-81cb-00f417029e25",
                        "lookup_data": {
                            "description": "Identifies user login with multifactor authentication failures, which might be an indication an attacker has the password for the account but can't pass the MFA challenge.",
                            "raw": "author: AlertIQ\ndate: 2021/10/10\ndescription: Identifies user login with multifactor authentication failures, which\n  might be an indication an attacker has the password for the account but can't pass\n  the MFA challenge.\ndetection:\n  condition: 1 of selection_*\n  selection_500121:\n    ResultDescription|contains: Authentication failed during strong authentication\n      request\n    ResultType: 500121\n  selection_50074:\n    ResultDescription|contains: Strong Auth required\n    ResultType: 50074\nfalsepositives:\n- Unknown\nid: 5496ff55-42ec-4369-81cb-00f417029e25\nlevel: medium\nlogsource:\n  product: azure\n  service: signinlogs\nmodified: 2022/12/18\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts\nstatus: experimental\ntags:\n- attack.initial_access\n- attack.credential_access\n- attack.t1078.004\n- attack.t1110\n- attack.t1621\ntitle: Multifactor Authentication Interrupted\n",
                            "sigma:id": "5496ff55-42ec-4369-81cb-00f417029e25",
                            "title": "Multifactor Authentication Interrupted",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "9a60e676-26ac-44c3-814b-0c2a8b977adf",
                        "lookup_data": {
                            "description": "Detect access has been blocked by Conditional Access policies.\nThe access policy does not allow token issuance which might be sights≈ of unauthorizeed login to valid accounts.\n",
                            "raw": "author: AlertIQ\ndate: 2021/10/10\ndescription: \"Detect access has been blocked by Conditional Access policies.\\nThe\\\n  \\ access policy does not allow token issuance which might be sights\\u2248 of unauthorizeed\\\n  \\ login to valid accounts.\\n\"\ndetection:\n  condition: selection\n  selection:\n    ResultType: 53003\nfalsepositives:\n- Unknown\nid: 9a60e676-26ac-44c3-814b-0c2a8b977adf\nlevel: medium\nlogsource:\n  product: azure\n  service: signinlogs\nmodified: 2022/12/25\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts\nstatus: test\ntags:\n- attack.credential_access\n- attack.initial_access\n- attack.t1110\n- attack.t1078.004\ntitle: User Access Blocked by Azure Conditional Access\n",
                            "sigma:id": "9a60e676-26ac-44c3-814b-0c2a8b977adf",
                            "title": "User Access Blocked by Azure Conditional Access",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "a0413867-daf3-43dd-9245-734b3a787942",
                        "lookup_data": {
                            "description": "Monitor and alert for Bitlocker key retrieval.",
                            "raw": "author: Michael Epping, '@mepples21'\ndate: 2022/06/28\ndescription: Monitor and alert for Bitlocker key retrieval.\ndetection:\n  condition: selection\n  selection:\n    Category: KeyManagement\n    OperationName: Read BitLocker key\nfalsepositives:\n- Unknown\nid: a0413867-daf3-43dd-9245-734b3a787942\nlevel: medium\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-devices#bitlocker-key-retrieval\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1078.004\ntitle: Bitlocker Key Retrieval\n",
                            "sigma:id": "a0413867-daf3-43dd-9245-734b3a787942",
                            "title": "Bitlocker Key Retrieval",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f9405037-bc97-4eb7-baba-167dad399b83",
                        "lookup_data": {
                            "description": "Detects when a user creates action secret for the organization, environment, codespaces or repository.",
                            "raw": "author: Muhammad Faisal\ndate: 2023/01/20\ndescription: Detects when a user creates action secret for the organization, environment,\n  codespaces or repository.\ndetection:\n  condition: selection\n  selection:\n    action:\n    - org.create_actions_secret\n    - environment.create_actions_secret\n    - codespaces.create_an_org_secret\n    - repo.create_actions_secret\nfalsepositives:\n- This detection cloud be noisy depending on the environment. It is recommended to\n  keep a check on the new secrets when created and validate the \"actor\".\nfields:\n- action\n- actor\n- org\n- actor_location.country_code\nid: f9405037-bc97-4eb7-baba-167dad399b83\nlevel: low\nlogsource:\n  definition: 'Requirements: The audit log streaming feature must be enabled to be\n    able to receive such logs. You can enable following the documentation here: https://docs.github.com/en/enterprise-cloud@latest/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise/streaming-the-audit-log-for-your-enterprise#setting-up-audit-log-streaming'\n  product: github\n  service: audit\nreferences:\n- https://docs.github.com/en/organizations/keeping-your-organization-secure/managing-security-settings-for-your-organization/reviewing-the-audit-log-for-your-organization#audit-log-actions\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.privilege_escalation\n- attack.initial_access\n- attack.t1078.004\ntitle: Github New Secret Created\n",
                            "sigma:id": "f9405037-bc97-4eb7-baba-167dad399b83",
                            "title": "Github New Secret Created",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "28870ae4-6a13-4616-bd1a-235a7fad7458",
                        "lookup_data": {
                            "description": "Detect failed authentications from countries you do not operate out of.",
                            "raw": "author: MikeDuddington, '@dudders1'\ndate: 2022/07/28\ndescription: Detect failed authentications from countries you do not operate out of.\ndetection:\n  condition: not selection and not selection1\n  selection:\n    Status: Success\n  selection1:\n    Location|contains: <Countries you DO operate out of e,g GB, use OR for multiple>\nfalsepositives:\n- If this was approved by System Administrator.\nid: 28870ae4-6a13-4616-bd1a-235a7fad7458\nlevel: low\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://docs.microsoft.com/en-gb/azure/active-directory/fundamentals/security-operations-user-accounts\nstatus: experimental\ntags:\n- attack.initial_access\n- attack.credential_access\n- attack.t1078.004\n- attack.t1110\ntitle: Failed Authentications From Countries You Do Not Operate Out Of\n",
                            "sigma:id": "28870ae4-6a13-4616-bd1a-235a7fad7458",
                            "title": "Failed Authentications From Countries You Do Not Operate Out Of",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "1b45b0d1-773f-4f23-aedc-814b759563b1",
                        "lookup_data": {
                            "description": "Detects when a configuration change is made to an applications AppID URI.",
                            "raw": "author: Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik'\ndate: 2022/06/02\ndescription: Detects when a configuration change is made to an applications AppID\n  URI.\ndetection:\n  condition: selection\n  selection:\n    properties.message:\n    - Update Application\n    - Update Service principal\nfalsepositives:\n- When and administrator is making legitimate AppID URI configuration changes to an\n  application. This should be a planned event.\nid: 1b45b0d1-773f-4f23-aedc-814b759563b1\nlevel: high\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-applications#appid-uri-added-modified-or-removed\nstatus: experimental\ntags:\n- attack.persistence\n- attack.credential_access\n- attack.privilege_escalation\n- attack.t1552\n- attack.t1078.004\ntitle: Application AppID Uri Configuration Changes\n",
                            "sigma:id": "1b45b0d1-773f-4f23-aedc-814b759563b1",
                            "title": "Application AppID Uri Configuration Changes",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "09438caa-07b1-4870-8405-1dbafe3dad95",
                        "lookup_data": {
                            "description": "Detects when a user has been elevated to manage all Azure Subscriptions.\nThis change should be investigated immediately if it isn't planned.\nThis setting could allow an attacker access to Azure subscriptions in your environment.\n",
                            "raw": "author: Austin Songer @austinsonger\ndate: 2021/11/26\ndescription: 'Detects when a user has been elevated to manage all Azure Subscriptions.\n\n  This change should be investigated immediately if it isn''t planned.\n\n  This setting could allow an attacker access to Azure subscriptions in your environment.\n\n  '\ndetection:\n  condition: selection\n  selection:\n    operationName: MICROSOFT.AUTHORIZATION/ELEVATEACCESS/ACTION\nfalsepositives:\n- If this was approved by System Administrator.\nid: 09438caa-07b1-4870-8405-1dbafe3dad95\nlevel: high\nlogsource:\n  product: azure\n  service: activitylogs\nmodified: 2022/08/23\nreferences:\n- https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftauthorization\nstatus: experimental\ntags:\n- attack.initial_access\n- attack.t1078.004\ntitle: Azure Subscription Permission Elevation Via ActivityLogs\n",
                            "sigma:id": "09438caa-07b1-4870-8405-1dbafe3dad95",
                            "title": "Azure Subscription Permission Elevation Via ActivityLogs",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4f77e1d7-3982-4ee0-8489-abf2d6b75284",
                        "lookup_data": {
                            "description": "Monitor and alert for sign-ins where the device was non-compliant.",
                            "raw": "author: Michael Epping, '@mepples21'\ndate: 2022/06/28\ndescription: Monitor and alert for sign-ins where the device was non-compliant.\ndetection:\n  condition: selection\n  selection:\n    DeviceDetail.isCompliant: 'false'\nfalsepositives:\n- Unknown\nid: 4f77e1d7-3982-4ee0-8489-abf2d6b75284\nlevel: high\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-devices#non-compliant-device-sign-in\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1078.004\ntitle: Sign-ins from Non-Compliant Devices\n",
                            "sigma:id": "4f77e1d7-3982-4ee0-8489-abf2d6b75284",
                            "title": "Sign-ins from Non-Compliant Devices",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "8c944ecb-6970-4541-8496-be554b8e2846",
                        "lookup_data": {
                            "description": "Detect successful authentications from countries you do not operate out of.",
                            "raw": "author: MikeDuddington, '@dudders1'\ndate: 2022/07/28\ndescription: Detect successful authentications from countries you do not operate out\n  of.\ndetection:\n  condition: selection and not filter\n  filter:\n    Location|contains: <Countries you DO operate out of e,g GB, use OR for multiple>\n  selection:\n    Status: Success\nfalsepositives:\n- If this was approved by System Administrator.\nid: 8c944ecb-6970-4541-8496-be554b8e2846\nlevel: medium\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://docs.microsoft.com/en-gb/azure/active-directory/fundamentals/security-operations-user-accounts\nstatus: experimental\ntags:\n- attack.initial_access\n- attack.credential_access\n- attack.t1078.004\n- attack.t1110\ntitle: Successful Authentications From Countries You Do Not Operate Out Of\n",
                            "sigma:id": "8c944ecb-6970-4541-8496-be554b8e2846",
                            "title": "Successful Authentications From Countries You Do Not Operate Out Of",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "8ad1600d-e9dc-4251-b0ee-a65268f29add",
                        "lookup_data": {
                            "description": "Detects AWS root account usage",
                            "raw": "author: vitaliy0x1\ndate: 2020/01/21\ndescription: Detects AWS root account usage\ndetection:\n  condition: selection_usertype and not selection_eventtype\n  selection_eventtype:\n    eventType: AwsServiceEvent\n  selection_usertype:\n    userIdentity.type: Root\nfalsepositives:\n- AWS Tasks That Require AWS Account Root User Credentials https://docs.aws.amazon.com/general/latest/gr/aws_tasks-that-require-root.html\nid: 8ad1600d-e9dc-4251-b0ee-a65268f29add\nlevel: medium\nlogsource:\n  product: aws\n  service: cloudtrail\nmodified: 2022/10/09\nreferences:\n- https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\nstatus: test\ntags:\n- attack.privilege_escalation\n- attack.t1078.004\ntitle: AWS Root Credentials\n",
                            "sigma:id": "8ad1600d-e9dc-4251-b0ee-a65268f29add",
                            "title": "AWS Root Credentials",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "0b4b72e3-4c53-4d5b-b198-2c58cfef39a9",
                        "lookup_data": {
                            "description": "Detects when a user that doesn't have permissions to invite a guest user attempts to invite one.",
                            "raw": "author: Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'\ndate: 2022/08/10\ndescription: Detects when a user that doesn't have permissions to invite a guest user\n  attempts to invite one.\ndetection:\n  condition: selection\n  selection:\n    Status: failure\n    properties.message: Invite external user\nfalsepositives:\n- A non malicious user is unaware of the proper process\nid: 0b4b72e3-4c53-4d5b-b198-2c58cfef39a9\nlevel: medium\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts#things-to-monitor\nstatus: experimental\ntags:\n- attack.persistence\n- attack.defense_evasion\n- attack.t1078.004\ntitle: Guest User Invited By Non Approved Inviters\n",
                            "sigma:id": "0b4b72e3-4c53-4d5b-b198-2c58cfef39a9",
                            "title": "Guest User Invited By Non Approved Inviters",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f7b5b004-dece-46e4-a4a5-f6fd0e1c6947",
                        "lookup_data": {
                            "description": "Detects when a new admin is created.",
                            "raw": "author: Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H', Tim Shelton\ndate: 2022/08/11\ndescription: Detects when a new admin is created.\ndetection:\n  condition: selection\n  selection:\n    Status: Success\n    properties.message|contains|all:\n    - Add user\n    - Add member to role\nfalsepositives:\n- A legitimate new admin account being created\nid: f7b5b004-dece-46e4-a4a5-f6fd0e1c6947\nlevel: medium\nlogsource:\n  product: azure\n  service: auditlogs\nmodified: 2022/08/16\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts#changes-to-privileged-accounts\nstatus: experimental\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1078.004\ntitle: Privileged Account Creation\n",
                            "sigma:id": "f7b5b004-dece-46e4-a4a5-f6fd0e1c6947",
                            "title": "Privileged Account Creation",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "28eea407-28d7-4e42-b0be-575d5ba60b2c",
                        "lookup_data": {
                            "description": "Detect when users are authenticating without MFA being required.",
                            "raw": "author: MikeDuddington, '@dudders1'\ndate: 2022/07/27\ndescription: Detect when users are authenticating without MFA being required.\ndetection:\n  condition: selection\n  selection:\n    AuthenticationRequirement: singleFactorAuthentication\n    Status: Success\nfalsepositives:\n- If this was approved by System Administrator.\nid: 28eea407-28d7-4e42-b0be-575d5ba60b2c\nlevel: low\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://docs.microsoft.com/en-gb/azure/active-directory/fundamentals/security-operations-user-accounts\nstatus: experimental\ntags:\n- attack.initial_access\n- attack.credential_access\n- attack.t1078.004\n- attack.t1556.006\ntitle: Azure AD Only Single Factor Authentication Required\n",
                            "sigma:id": "28eea407-28d7-4e42-b0be-575d5ba60b2c",
                            "title": "Azure AD Only Single Factor Authentication Required",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "c1bd5026-520b-45bd-9a79-82d38cf96c7b",
                        "lookup_data": {
                            "description": "Operation â€˜Harvestâ€™: A Deep Dive into a Long-term Campaign",
                            "link": "http://www.botvrij.eu/data/feed-osint/c1bd5026-520b-45bd-9a79-82d38cf96c7b.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1633469315",
                            "uuid": "c1bd5026-520b-45bd-9a79-82d38cf96c7b",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "fa84aaf5-8142-43cd-9ec2-78cfebf878ce",
                        "lookup_data": {
                            "description": "Detects when a temporary access pass (TAP) is added to an account. TAPs added to priv accounts should be investigated",
                            "raw": "author: Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'\ndate: 2022/08/10\ndescription: Detects when a temporary access pass (TAP) is added to an account. TAPs\n  added to priv accounts should be investigated\ndetection:\n  condition: selection\n  selection:\n    Status: Admin registered temporary access pass method for user\n    properties.message: Admin registered security info\nfalsepositives:\n- Administrator adding a legitmate temporary access pass\nid: fa84aaf5-8142-43cd-9ec2-78cfebf878ce\nlevel: high\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts#changes-to-privileged-accounts\nstatus: experimental\ntags:\n- attack.persistence\n- attack.t1078.004\ntitle: Temporary Access Pass Added To An Account\n",
                            "sigma:id": "fa84aaf5-8142-43cd-9ec2-78cfebf878ce",
                            "title": "Temporary Access Pass Added To An Account",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "60f6535a-760f-42a9-be3f-c9a0a025906e",
                        "lookup_data": {
                            "description": "Alert on when legecy authentication has been used on an account",
                            "raw": "author: Yochana Henderson, '@Yochana-H'\ndate: 2022/06/17\ndescription: Alert on when legecy authentication has been used on an account\ndetection:\n  condition: selection\n  selection:\n    ActivityDetails: Sign-ins\n    ClientApp:\n    - Other client\n    - IMAP\n    - POP3\n    - MAPI\n    - SMTP\n    - Exchange ActiveSync\n    - Exchange Web Services\n    Username: UPN\nfalsepositives:\n- User has been put in acception group so they can use legacy authentication\nid: 60f6535a-760f-42a9-be3f-c9a0a025906e\nlevel: high\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://docs.microsoft.com/en-gb/azure/active-directory/fundamentals/security-operations-privileged-accounts\nstatus: experimental\ntags:\n- attack.initial_access\n- attack.credential_access\n- attack.t1078.004\n- attack.t1110\ntitle: Use of Legacy Authentication Protocols\n",
                            "sigma:id": "60f6535a-760f-42a9-be3f-c9a0a025906e",
                            "title": "Use of Legacy Authentication Protocols",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "908655e0-25cf-4ae1-b775-1c8ce9cf43d8",
                        "lookup_data": {
                            "description": "Detect failed attempts to sign in to disabled accounts.",
                            "raw": "author: AlertIQ\ndate: 2021/10/10\ndescription: Detect failed attempts to sign in to disabled accounts.\ndetection:\n  condition: selection\n  selection:\n    ResultDescription: User account is disabled. The account has been disabled by\n      an administrator.\n    ResultType: 50057\nfalsepositives:\n- Unknown\nid: 908655e0-25cf-4ae1-b775-1c8ce9cf43d8\nlevel: medium\nlogsource:\n  product: azure\n  service: signinlogs\nmodified: 2022/12/25\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts\nstatus: test\ntags:\n- attack.initial_access\n- attack.t1078.004\ntitle: Login to Disabled Account\n",
                            "sigma:id": "908655e0-25cf-4ae1-b775-1c8ce9cf43d8",
                            "title": "Login to Disabled Account",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "8dee7a0d-43fd-4b3c-8cd1-605e189d195e",
                        "lookup_data": {
                            "description": "Detects the change of user type from \"Guest\" to \"Member\" for potential elevation of privilege.",
                            "raw": "author: MikeDuddington, '@dudders1'\ndate: 2022/06/30\ndescription: Detects the change of user type from \"Guest\" to \"Member\" for potential\n  elevation of privilege.\ndetection:\n  condition: selection\n  selection:\n    Category: UserManagement\n    OperationName: Update user\n    properties.message: '\"displayName\":\"UserType\",\"oldValue\":\"[\\\"Guest\\\"]\",\"newValue\":\"[\\\"Member\\\"]\"'\nfalsepositives:\n- If this was approved by System Administrator.\nid: 8dee7a0d-43fd-4b3c-8cd1-605e189d195e\nlevel: medium\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-gb/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-external-user-sign-ins\nstatus: experimental\ntags:\n- attack.privilege_escalation\n- attack.initial_access\n- attack.t1078.004\ntitle: User State Changed From Guest To Member\n",
                            "sigma:id": "8dee7a0d-43fd-4b3c-8cd1-605e189d195e",
                            "title": "User State Changed From Guest To Member",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "db6c06c4-bf3b-421c-aa88-15672b88c743",
                        "lookup_data": {
                            "description": "Detects when changes are made to PIM roles",
                            "raw": "author: Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'\ndate: 2022/08/09\ndescription: Detects when changes are made to PIM roles\ndetection:\n  condition: selection\n  selection:\n    properties.message: Update role setting in PIM\nfalsepositives:\n- Legit administrative PIM setting configuration changes\nid: db6c06c4-bf3b-421c-aa88-15672b88c743\nlevel: high\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-identity-management#azure-ad-roles-assignment\nstatus: experimental\ntags:\n- attack.privilege_escalation\n- attack.persistence\n- attack.t1078.004\ntitle: Changes To PIM Settings\n",
                            "sigma:id": "db6c06c4-bf3b-421c-aa88-15672b88c743",
                            "title": "Changes To PIM Settings",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "11c767ae-500b-423b-bae3-b234450736ed",
                        "lookup_data": {
                            "description": "Monitor and alert for users added to device admin roles.",
                            "raw": "author: Michael Epping, '@mepples21'\ndate: 2022/06/28\ndescription: Monitor and alert for users added to device admin roles.\ndetection:\n  condition: selection\n  selection:\n    Category: RoleManagement\n    OperationName|contains|all:\n    - Add\n    - member to role\n    TargetResources|contains:\n    - 7698a772-787b-4ac8-901f-60d6b08affd2\n    - 62e90394-69f5-4237-9190-012177145e10\nfalsepositives:\n- Unknown\nid: 11c767ae-500b-423b-bae3-b234450736ed\nlevel: high\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-devices#device-administrator-roles\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.privilege_escalation\n- attack.t1078.004\ntitle: Users Added to Global or Device Admin Roles\n",
                            "sigma:id": "11c767ae-500b-423b-bae3-b234450736ed",
                            "title": "Users Added to Global or Device Admin Roles",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f8ed0e8f-7438-4b79-85eb-f358ef2fbebd",
                        "lookup_data": {
                            "description": "A self-hosted runner is a system that you deploy and manage to execute jobs from GitHub Actions on GitHub.com.\nThis rule detects changes to self-hosted runners configurations in the environment. The self-hosted runner configuration changes once detected,\nit should be validated from GitHub UI becasue the log entry may not provide full context.\n",
                            "raw": "author: Muhammad Faisal\ndate: 2023/01/27\ndescription: 'A self-hosted runner is a system that you deploy and manage to execute\n  jobs from GitHub Actions on GitHub.com.\n\n  This rule detects changes to self-hosted runners configurations in the environment.\n  The self-hosted runner configuration changes once detected,\n\n  it should be validated from GitHub UI becasue the log entry may not provide full\n  context.\n\n  '\ndetection:\n  condition: selection\n  selection:\n    action:\n    - org.remove_self_hosted_runner\n    - org.runner_group_created\n    - org.runner_group_removed\n    - org.runner_group_updated\n    - org.runner_group_runners_added\n    - org.runner_group_runner_removed\n    - org.runner_group_runners_updated\n    - repo.register_self_hosted_runner\n    - repo.remove_self_hosted_runner\nfalsepositives:\n- Allowed self-hosted runners changes in the envrionment.\n- A self-hosted runner is automatically removed from GitHub if it has not connected\n  to GitHub Actions for more than 14 days.\n- An ephemeral self-hosted runner is automatically removed from GitHub if it has not\n  connected to GitHub Actions for more than 1 day.\nfields:\n- action\n- actor\n- org\n- actor_location.country_code\n- transport_protocol_name\n- repository\n- repo\n- repository_public\n- '@timestamp'\nid: f8ed0e8f-7438-4b79-85eb-f358ef2fbebd\nlevel: low\nlogsource:\n  definition: 'Requirements: The audit log streaming feature must be enabled to be\n    able to receive such logs. You can enable following the documentation here: https://docs.github.com/en/enterprise-cloud@latest/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise/streaming-the-audit-log-for-your-enterprise#setting-up-audit-log-streaming'\n  product: github\n  service: audit\nreferences:\n- https://docs.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners#about-self-hosted-runners\n- https://docs.github.com/en/organizations/keeping-your-organization-secure/managing-security-settings-for-your-organization/reviewing-the-audit-log-for-your-organization#search-based-on-operation\nstatus: experimental\ntags:\n- attack.impact\n- attack.discovery\n- attack.collection\n- attack.defense_evasion\n- attack.persistence\n- attack.privilege_escalation\n- attack.initial_access\n- attack.t1526\n- attack.t1213.003\n- attack.t1078.004\ntitle: Github Self Hosted Runner Changes Detected\n",
                            "sigma:id": "f8ed0e8f-7438-4b79-85eb-f358ef2fbebd",
                            "title": "Github Self Hosted Runner Changes Detected",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "340ee172-4b67-4fb4-832f-f961bdc1f3aa",
                        "lookup_data": {
                            "description": "Detect when a user has reset their password in Azure AD",
                            "raw": "author: YochanaHenderson, '@Yochana-H'\ndate: 2022/08/03\ndescription: Detect when a user has reset their password in Azure AD\ndetection:\n  condition: selection and filter\n  filter:\n    ActivityType|contains: Password reset\n    Target|contains: UPN\n  selection:\n    Category: UserManagement\n    Initiatedby: UPN\n    Status: Success\nfalsepositives:\n- If this was approved by System Administrator or confirmed user action.\nid: 340ee172-4b67-4fb4-832f-f961bdc1f3aa\nlevel: medium\nlogsource:\n  product: azure\n  service: auditlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts\nstatus: experimental\ntags:\n- attack.persistence\n- attack.credential_access\n- attack.t1078.004\ntitle: Password Reset By User Account\n",
                            "sigma:id": "340ee172-4b67-4fb4-832f-f961bdc1f3aa",
                            "title": "Password Reset By User Account",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f232fa7a-025c-4d43-abc7-318e81a73d65",
                        "lookup_data": {
                            "mitre-attack-id": "T1078.004",
                            "mitre-cti:description": "Adversaries may obtain and abuse credentials of a cloud account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. Cloud accounts are those created and configured by an organization for use by users, remote support, services, or for administration of resources within a cloud service provider or SaaS application. In some cases, cloud accounts may be federated with traditional identity management system, such as Window Active Directory.(Citation: AWS Identity Federation)(Citation: Google Federating GC)(Citation: Microsoft Deploying AD Federation)\n\nCompromised credentials for cloud accounts can be used to harvest sensitive data from online storage accounts and databases. Access to cloud accounts can also be abused to gain Initial Access to a network by abusing a [Trusted Relationship](https://attack.mitre.org/techniques/T1199). Similar to [Domain Accounts](https://attack.mitre.org/techniques/T1078/002), compromise of federated cloud accounts may allow adversaries to more easily move laterally within an environment.\n\nOnce a cloud account is compromised, an adversary may perform [Account Manipulation](https://attack.mitre.org/techniques/T1098) - for example, by adding [Additional Cloud Roles](https://attack.mitre.org/techniques/T1098/003) - to maintain persistence and potentially escalate their privileges.",
                            "mitre-cti:name": "Cloud Accounts",
                            "mitre-cti:type": "attack-pattern",
                            "raw": "{'x_mitre_platforms': ['Azure AD', 'Office 365', 'SaaS', 'IaaS', 'Google Workspace'], 'x_mitre_domains': ['enterprise-attack'], 'x_mitre_contributors': ['Jon Sternstein, Stern Security'], 'object_marking_refs': ['marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168'], 'type': 'attack-pattern', 'id': 'attack-pattern--f232fa7a-025c-4d43-abc7-318e81a73d65', 'created': '2020-03-13T20:36:57.378Z', 'x_mitre_version': '1.4', 'external_references': [{'source_name': 'mitre-attack', 'external_id': 'T1078.004', 'url': 'https://attack.mitre.org/techniques/T1078/004'}, {'source_name': 'AWS Identity Federation', 'url': 'https://aws.amazon.com/identity/federation/', 'description': 'Amazon. (n.d.). Identity Federation in AWS. Retrieved March 13, 2020.'}, {'source_name': 'Google Federating GC', 'url': 'https://cloud.google.com/solutions/federating-gcp-with-active-directory-introduction', 'description': 'Google. (n.d.). Federating Google Cloud with Active Directory. Retrieved March 13, 2020.'}, {'source_name': 'Microsoft Deploying AD Federation', 'url': 'https://docs.microsoft.com/en-us/windows-server/identity/ad-fs/deployment/how-to-connect-fed-azure-adfs', 'description': 'Microsoft. (n.d.). Deploying Active Directory Federation Services in Azure. Retrieved March 13, 2020.'}], 'x_mitre_deprecated': False, 'revoked': False, 'description': 'Adversaries may obtain and abuse credentials of a cloud account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. Cloud accounts are those created and configured by an organization for use by users, remote support, services, or for administration of resources within a cloud service provider or SaaS application. In some cases, cloud accounts may be federated with traditional identity management system, such as Window Active Directory.(Citation: AWS Identity Federation)(Citation: Google Federating GC)(Citation: Microsoft Deploying AD Federation)\\n\\nCompromised credentials for cloud accounts can be used to harvest sensitive data from online storage accounts and databases. Access to cloud accounts can also be abused to gain Initial Access to a network by abusing a [Trusted Relationship](https://attack.mitre.org/techniques/T1199). Similar to [Domain Accounts](https://attack.mitre.org/techniques/T1078/002), compromise of federated cloud accounts may allow adversaries to more easily move laterally within an environment.\\n\\nOnce a cloud account is compromised, an adversary may perform [Account Manipulation](https://attack.mitre.org/techniques/T1098) - for example, by adding [Additional Cloud Roles](https://attack.mitre.org/techniques/T1098/003) - to maintain persistence and potentially escalate their privileges.', 'modified': '2022-04-19T20:23:33.894Z', 'created_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'name': 'Cloud Accounts', 'x_mitre_detection': 'Monitor the activity of cloud accounts to detect abnormal or malicious behavior, such as accessing information outside of the normal function of the account or account usage at atypical hours.', 'kill_chain_phases': [{'kill_chain_name': 'mitre-attack', 'phase_name': 'defense-evasion'}, {'kill_chain_name': 'mitre-attack', 'phase_name': 'persistence'}, {'kill_chain_name': 'mitre-attack', 'phase_name': 'privilege-escalation'}, {'kill_chain_name': 'mitre-attack', 'phase_name': 'initial-access'}], 'x_mitre_is_subtechnique': True, 'x_mitre_data_sources': ['Logon Session: Logon Session Metadata', 'User Account: User Account Authentication', 'Logon Session: Logon Session Creation'], 'x_mitre_permissions_required': ['User', 'Administrator'], 'x_mitre_attack_spec_version': '2.1.0', 'x_mitre_modified_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5'}",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4d136857-6a1a-432a-82fc-5dd497ee5e7c",
                        "lookup_data": {
                            "description": "Monitor and alert for Sign-ins by unknown devices from non-Trusted locations.",
                            "raw": "author: Michael Epping, '@mepples21'\ndate: 2022/06/28\ndescription: Monitor and alert for Sign-ins by unknown devices from non-Trusted locations.\ndetection:\n  condition: selection\n  selection:\n    AuthenticationRequirement: singleFactorAuthentication\n    DeviceDetail.deviceId: ''\n    NetworkLocationDetails: '[]'\n    ResultType: 0\nfalsepositives:\n- Unknown\nid: 4d136857-6a1a-432a-82fc-5dd497ee5e7c\nlevel: low\nlogsource:\n  product: azure\n  service: signinlogs\nmodified: 2022/10/05\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-devices#non-compliant-device-sign-in\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1078.004\ntitle: Sign-ins by Unknown Devices\n",
                            "sigma:id": "4d136857-6a1a-432a-82fc-5dd497ee5e7c",
                            "title": "Sign-ins by Unknown Devices",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5afa454e-030c-4ab4-9253-a90aa7fcc581",
                        "lookup_data": {
                            "description": "Monitor and alert for device registration or join events where MFA was not performed.",
                            "raw": "author: Michael Epping, '@mepples21'\ndate: 2022/06/28\ndescription: Monitor and alert for device registration or join events where MFA was\n  not performed.\ndetection:\n  condition: selection and not filter_mfa\n  filter_mfa:\n    AuthenticationRequirement: multiFactorAuthentication\n  selection:\n    ResourceDisplayName: Device Registration Service\n    conditionalAccessStatus: success\nfalsepositives:\n- Unknown\nid: 5afa454e-030c-4ab4-9253-a90aa7fcc581\nlevel: medium\nlogsource:\n  product: azure\n  service: signinlogs\nreferences:\n- https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-devices#device-registrations-and-joins-outside-policy\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1078.004\ntitle: Device Registration or Join Without MFA\n",
                            "sigma:id": "5afa454e-030c-4ab4-9253-a90aa7fcc581",
                            "title": "Device Registration or Join Without MFA",
                            "_cycat_type": "Item"
                        }
                    }
                ]
            }
        },
        "atomics": [
            {
                "attack_technique": "T1078.004",
                "display_name": "Valid Accounts: Cloud Accounts",
                "atomic_tests": [
                    {
                        "name": "Creating GCP Service Account and Service Account Key",
                        "auto_generated_guid": "9fdd83fd-bd53-46e5-a716-9dec89c8ae8e",
                        "description": "GCP Service Accounts can be used to gain intial access as well as maintain persistence inside Google Cloud.\n",
                        "supported_platforms": [
                            "google-workspace",
                            "iaas:gcp"
                        ],
                        "input_arguments": {
                            "project-id": {
                                "description": "ID of the project, you want to create service account as well as service account key for",
                                "type": "string",
                                "default": "art-project-1"
                            },
                            "service-account-name": {
                                "description": "Name of the service account",
                                "type": "string",
                                "default": "gcp-art-service-account-1"
                            },
                            "service-account-email": {
                                "description": "Email of the service account",
                                "type": "string",
                                "default": "gcp-art-service-account-1@art-project-1.iam.gserviceaccount.com"
                            },
                            "output-key-file": {
                                "description": "Email of the service account",
                                "type": "string",
                                "default": "gcp-art-service-account-1.json"
                            }
                        },
                        "executor": {
                            "name": "sh",
                            "elevation_required": false,
                            "command": "gcloud config set project #{project-id}\ngcloud iam service-accounts create #{service-account-name}\ngcloud iam service-accounts keys create #{output-key-file} --iam-account=#{service-account-email}\n",
                            "cleanup_command": "gcloud iam service-accounts delete #{service-account-email} --quiet\n"
                        },
                        "dependency_executor_name": "sh",
                        "dependencies": [
                            {
                                "description": "Requires gcloud\n",
                                "prereq_command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;\n",
                                "get_prereq_command": "echo \"Please Install Google Cloud SDK before running this atomic test : https://cloud.google.com/sdk/docs/install\"\n"
                            },
                            {
                                "description": "Check if user is logged in \n",
                                "prereq_command": "gcloud config get-value account\n",
                                "get_prereq_command": "gcloud auth login --no-launch-browser\n"
                            }
                        ]
                    },
                    {
                        "name": "Azure Persistence Automation Runbook Created or Modified",
                        "auto_generated_guid": "348f4d14-4bd3-4f6b-bd8a-61237f78b3ac",
                        "description": "Identifies when an Azure Automation runbook is created or modified. An adversary may create or modify an Azure\nAutomation runbook to execute malicious code and maintain persistence in their target's environment.\n",
                        "supported_platforms": [
                            "iaas:azure"
                        ],
                        "input_arguments": {
                            "resource_group": {
                                "description": "Name of the resource group",
                                "type": "string",
                                "default": "ART-ResourceGroupName-T1078-004"
                            },
                            "runbook_name": {
                                "description": "Name of the runbook name",
                                "type": "string",
                                "default": "ART-RunbookName-T1078-004"
                            },
                            "automation_account_name": {
                                "description": "Name of the automation account name",
                                "type": "string",
                                "default": "ART-AutomationAccountName-T1078-004"
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "Check if terraform is installed.\n",
                                "prereq_command": "terraform version\n",
                                "get_prereq_command": "echo \"Please install terraform via https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli (URL accurate as of Nov. 15, 2024).\"\n"
                            },
                            {
                                "description": "Check if Azure CLI and Azure Powershell are installed.\n\n* Login to Azure CLI with \"az login\", and login to Azure Powershell with \"Connect-AzAccount\". Sessions are not shared.\n* Azure Powershell used in this test as they have better automation performance and error logging than Azure CLI.\n",
                                "prereq_command": "try {if (Get-InstalledModule -Name Az -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
                                "get_prereq_command": "$ProgressPreference = 'SilentlyContinue'; Invoke-WebRequest -Uri https://aka.ms/installazurecliwindowsx64 -OutFile .\\AzureCLI.msi; Start-Process msiexec.exe -Wait -ArgumentList '/I AzureCLI.msi /quiet'; Remove-Item .\\AzureCLI.msi\n"
                            },
                            {
                                "description": "Check if the user is logged into Azure.\n",
                                "prereq_command": "try {if (-not (Get-AzContext)) { exit 1 } else { exit 0 }} catch {exit 1}\n",
                                "get_prereq_command": "echo \"* Configure your Azure account using: Connect-AzAccount\"\n"
                            },
                            {
                                "description": "Create dependency resources using terraform\n\n* If fail to meet prereq, navigate to T1078.004-2 using \"cd $PathToAtomicsFolder/T1078.004/src/T1078.004-2/\"\n* Open the \"terraform.tfvars\" file and fill in the variables with your desired values.\n* Re-run -GetPrereqs\n",
                                "prereq_command": "try {if (Test-Path \"$PathToAtomicsFolder/T1078.004/src/T1078.004-2/terraform.tfstate\" ){ exit 0 } else {exit 1}} catch {exit 1}\n",
                                "get_prereq_command": "echo \"Navigating to: $PathToAtomicsFolder/T1078.004/src/T1078.004-2/\"\ncd \"$PathToAtomicsFolder/T1078.004/src/T1078.004-2/\"\nterraform init\nterraform apply -auto-approve\n"
                            }
                        ],
                        "executor": {
                            "command": "New-AzAutomationRunbook -Name #{runbook_name} -Type PowerShell -ResourceGroupName #{resource_group} -Description 'my-test-runbook' -AutomationAccountName #{automation_account_name}\n",
                            "name": "powershell",
                            "elevation_required": false,
                            "cleanup_command": "Remove-AzAutomationRunbook -AutomationAccountName #{automation_account_name} -Name #{runbook_name} -ResourceGroupName #{resource_group} -Force\nRemove-AzAutomationAccount -ResourceGroupName #{resource_group} -Name #{automation_account_name} -Force\nRemove-AzResourceGroup -Name #{resource_group} -Force\necho \"Cleanup should be completed. Run 'terraform destroy` to ensure remaining resources are also deleted.\"\ncd \"$PathToAtomicsFolder/T1078.004/src/T1078.004-2/\"\nterraform destroy -auto-approve\n"
                        }
                    },
                    {
                        "name": "GCP - Create Custom IAM Role",
                        "auto_generated_guid": "3a159042-69e6-4398-9a69-3308a4841c85",
                        "description": "This atomic will create a new IAM role. The default role permissions are: *IAM Service Account Get*. The idea for this Atomic came from a Rule published by the Elastic team.\n\nIdentifies an Identity and Access Management (IAM) custom role creation in Google Cloud Platform (GCP). \nCustom roles are user-defined, and allow for the bundling of one or more supported permissions to meet specific needs. \nCustom roles will not be updated automatically and could lead to privilege creep if not carefully scrutinized.\n\nThis atomic will create a new IAM role. The default role permissions are: *IAM Service Account Get*\n\nReference: https://github.com/elastic/detection-rules/blob/main/rules/integrations/gcp/initial_access_gcp_iam_custom_role_creation.toml\n",
                        "supported_platforms": [
                            "iaas:gcp"
                        ],
                        "input_arguments": {
                            "project-id": {
                                "description": "ID of the GCP Project you to execute the command against.",
                                "type": "string",
                                "default": "atomic-test-1"
                            },
                            "role-name": {
                                "description": "The name of the role to be created.",
                                "type": "string",
                                "default": "AtomicRedTeamRole"
                            },
                            "role-description": {
                                "description": "The description of the role to be created.",
                                "type": "string",
                                "default": "Atomic Red Team Custom IAM Role"
                            },
                            "roles": {
                                "description": "List of roles to be applied",
                                "type": "string",
                                "default": "iam.serviceAccounts.get"
                            }
                        },
                        "executor": {
                            "name": "sh",
                            "elevation_required": false,
                            "command": "gcloud config set project #{project-id}\ngcloud iam roles create #{role-name} --description=\"#{role-description}\" --permissions=#{roles} --project=#{project-id}\n",
                            "cleanup_command": "gcloud iam roles delete #{role-name} --project=#{project-id}\n"
                        },
                        "dependency_executor_name": "sh",
                        "dependencies": [
                            {
                                "description": "Requires gcloud\n",
                                "prereq_command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;\n",
                                "get_prereq_command": "echo \"Please Install Google Cloud SDK before running this atomic test : https://cloud.google.com/sdk/docs/install\"\n"
                            },
                            {
                                "description": "Check if user is logged in \n",
                                "prereq_command": "gcloud config get-value account\n",
                                "get_prereq_command": "gcloud auth login --no-launch-browser\n"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    "timestamp": "2025-02-28 12:33:52"
}