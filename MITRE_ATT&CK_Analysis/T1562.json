{
    "id": "T1562",
    "name": "Impair Defenses",
    "description": "Adversaries may maliciously modify components of a victim environment in order to hinder or disable defensive mechanisms. This not only involves impairing preventative defenses, such as firewalls and anti-virus, but also detection capabilities that defenders can use to audit activity and identify malicious behavior. This may also span both native defenses as well as supplemental capabilities installed by users and administrators.\nAdversaries could also target event aggregation and analysis mechanisms, or otherwise disrupt these procedures by altering other system components.",
    "platforms": "Windows, Office 365, IaaS, Linux, macOS, Containers, Network",
    "kill_chain_phases": "Defense Evasion",
    "data_sources": "Process: Process Creation, Process: Process Termination, Windows Registry: Windows Registry Key Modification, Windows Registry: Windows Registry Key Deletion, Command: Command Execution, Service: Service Metadata, Sensor Health: Host Status, Script: Script Execution, Firewall: Firewall Disable, Firewall: Firewall Rule Modification, Cloud Service: Cloud Service Modification, Cloud Service: Cloud Service Disable",
    "detection": "Monitor processes and command-line arguments to see if security tools or logging services are killed or stop running. Monitor Registry edits for modifications to services and startup programs that correspond to security tools.  Lack of log events may be suspicious.\nMonitor environment variables and APIs that can be leveraged to disable security measures.",
    "url": "https://attack.mitre.org/techniques/T1562",
    "enrichments": {
        "attack_rule_map": [
            {
                "tech_id": "T1562",
                "atomic_attack_guid": "12e5551c-8d5c-408e-b3e4-63f53b03379f",
                "atomic_attack_name": "Disable journal logging via sed utility",
                "platform": "Linux",
                "splunk_rules": [
                    {
                        "rule_name": "Linux Sudo OR Su Execution",
                        "rule_link": "https://research.splunk.com/endpoint/4b00f134-6d6a-11ec-a90c-acde48001122/"
                    }
                ]
            },
            {
                "tech_id": "T1562",
                "atomic_attack_guid": "c3a377f9-1203-4454-aa35-9d391d34768f",
                "atomic_attack_name": "Disable journal logging via systemctl utility",
                "platform": "Linux",
                "sigma_rules": [
                    {
                        "rule_name": "Disable Or Stop Services",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/linux/process_creation/proc_creation_lnx_services_stop_and_disable.yml",
                        "remote_content": "title: Disable Or Stop Services\nid: de25eeb8-3655-4643-ac3a-b662d3f26b6b\nstatus: test\ndescription: Detects the usage of utilities such as 'systemctl', 'service'...etc to stop or disable tools and services\nreferences:\n    - https://www.trendmicro.com/pl_pl/research/20/i/the-evolution-of-malicious-shell-scripts.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-09-15\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: process_creation\n    product: linux\ndetection:\n    selection:\n        Image|endswith:\n            - '/service'\n            - '/systemctl'\n            - '/chkconfig'\n        CommandLine|contains:\n            - 'stop'\n            - 'disable'\n    condition: selection\nfalsepositives:\n    - Legitimate administration activities\nlevel: medium\n"
                    }
                ],
                "splunk_rules": [
                    {
                        "rule_name": "Linux Sudo OR Su Execution",
                        "rule_link": "https://research.splunk.com/endpoint/4b00f134-6d6a-11ec-a90c-acde48001122/"
                    }
                ]
            },
            {
                "tech_id": "T1562",
                "atomic_attack_guid": "40075d5f-3a70-4c66-9125-f72bee87247d",
                "atomic_attack_name": "Windows Disable LSA Protection",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "LSA PPL Protection Disabled Via Reg.EXE",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_reg_lsa_ppl_protection_disabled.yml",
                        "remote_content": "title: LSA PPL Protection Disabled Via Reg.EXE\nid: 8c0eca51-0f88-4db2-9183-fdfb10c703f9\nstatus: test\ndescription: Detects the usage of the \"reg.exe\" utility to disable PPL protection on the LSA process\nreferences:\n    - https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-03-22\nmodified: 2023-03-26\ntags:\n    - attack.defense-evasion\n    - attack.t1562.010\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - Image|endswith: '\\reg.exe'\n        - OriginalFileName: 'reg.exe'\n    selection_cli:\n        CommandLine|contains: 'SYSTEM\\CurrentControlSet\\Control\\Lsa'\n        CommandLine|contains|all:\n            - ' add '\n            - ' /d 0'\n            - ' /v RunAsPPL '\n    condition: all of selection_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"
                    }
                ]
            }
        ],
        "cycat": {
            "cycat": {
                "cycat_related_uuids": [
                    "0319b483-5973-4932-91ea-5a44c2975b24",
                    "225d8b09-e714-479c-a0e4-55e6f29adf35",
                    "bf4fc428-dcc3-4bbd-99fe-2422aeee2544",
                    "75f7a0e2-7154-4c4d-9eae-5cdb4e0a5c13",
                    "c2c76b77-32be-4d1f-82c9-7e544bdfe0eb",
                    "4d7f1827-1637-4def-8d8a-fd254f9454df",
                    "5b16df71-8615-4f7f-ac9b-6c43c0509e61",
                    "90f342e1-1aaa-4e43-b092-39fda57ed11e",
                    "12f6b752-042d-483e-bf9c-915a6d06ad75",
                    "5eeec9aa-9d88-4ece-9e6f-9d92884ae404",
                    "c9aed93d-4023-40c3-92a4-7e8607cd6cb6",
                    "c1344fa2-323b-4d2e-9176-84b4d4821c88",
                    "41421f44-58f9-455d-838a-c398859841d4",
                    "526cc8bc-1cdc-48ad-8b26-f19bff969cec",
                    "4d7cda18-1b12-4e52-b45c-d28653210df8",
                    "a4c90ea1-2634-4ca0-adbb-35eae169b6fc",
                    "fe513c69-734c-4d4a-8548-ac5f609be82b",
                    "a607e1fe-74bf-4440-a3ec-b059b9103157",
                    "4f281b83-0200-4b34-bf35-d24687ea57c2",
                    "5df8df26-fe0e-4858-94a7-6cf71d9519c9",
                    "3d333250-30e4-4a82-9edc-756c68afc529",
                    "acd74772-5f88-45c7-956b-6a7b36c294d2"
                ],
                "lookup_results": [
                    {
                        "uuid": "0319b483-5973-4932-91ea-5a44c2975b24",
                        "lookup_data": {
                            "description": "Conti Ransomware",
                            "link": "http://www.botvrij.eu/data/feed-osint/0319b483-5973-4932-91ea-5a44c2975b24.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1621181463",
                            "uuid": "0319b483-5973-4932-91ea-5a44c2975b24",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "225d8b09-e714-479c-a0e4-55e6f29adf35",
                        "lookup_data": {
                            "description": "Detects when Events are deleted in Azure Kubernetes. An adversary may delete events in Azure Kubernetes in an attempt to evade detection.",
                            "raw": "author: Austin Songer @austinsonger\ndate: 2021/07/24\ndescription: Detects when Events are deleted in Azure Kubernetes. An adversary may\n  delete events in Azure Kubernetes in an attempt to evade detection.\ndetection:\n  condition: selection\n  selection:\n    operationName: MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE\nfalsepositives:\n- Event deletions may be done by a system or network administrator. Verify whether\n  the username, hostname, and/or resource name should be making changes in your environment.\n  Events deletions from unfamiliar users or hosts should be investigated. If known\n  behavior is causing false positives, it can be exempted from the rule.\nid: 225d8b09-e714-479c-a0e4-55e6f29adf35\nlevel: medium\nlogsource:\n  product: azure\n  service: activitylogs\nmodified: 2022/08/23\nreferences:\n- https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes\n- https://github.com/elastic/detection-rules/blob/da3852b681cf1a33898b1535892eab1f3a76177a/rules/integrations/azure/defense_evasion_kubernetes_events_deleted.toml\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562\n- attack.t1562.001\ntitle: Azure Kubernetes Events Deleted\n",
                            "sigma:id": "225d8b09-e714-479c-a0e4-55e6f29adf35",
                            "title": "Azure Kubernetes Events Deleted",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "bf4fc428-dcc3-4bbd-99fe-2422aeee2544",
                        "lookup_data": {
                            "description": "Potential adversaries stopping ETW providers recording loaded .NET assemblies.",
                            "raw": "author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020/06/05\ndescription: Potential adversaries stopping ETW providers recording loaded .NET assemblies.\ndetection:\n  condition: 1 of selection_*\n  selection_complus:\n    Details:\n    - 0\n    - DWORD (0x00000000)\n    EventType: SetValue\n    TargetObject|endswith:\n    - \\COMPlus_ETWEnabled\n    - \\COMPlus_ETWFlags\n  selection_etw_enabled:\n    Details: DWORD (0x00000000)\n    EventType: SetValue\n    TargetObject|endswith: SOFTWARE\\Microsoft\\.NETFramework\\ETWEnabled\nfalsepositives:\n- Unknown\nid: bf4fc428-dcc3-4bbd-99fe-2422aeee2544\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nmodified: 2022/12/09\nreferences:\n- https://twitter.com/_xpn_/status/1268712093928378368\n- https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr\n- https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables\n- https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38\n- https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39\n- https://github.com/dotnet/runtime/search?p=1&q=COMPlus_&unscoped_q=COMPlus_\n- https://bunnyinside.com/?term=f71e8cb9c76a\n- http://managed670.rssing.com/chan-5590147/all_p1.html\n- https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code\n- https://blog.xpnsec.com/hiding-your-dotnet-complus-etwenabled/\n- https://i.blackhat.com/EU-21/Wednesday/EU-21-Teodorescu-Veni-No-Vidi-No-Vici-Attacks-On-ETW-Blind-EDRs.pdf\nrelated:\n- id: a4c90ea1-2634-4ca0-adbb-35eae169b6fc\n  type: similar\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1112\n- attack.t1562\ntitle: ETW Logging Disabled In .NET Processes - Sysmon Registry\n",
                            "sigma:id": "bf4fc428-dcc3-4bbd-99fe-2422aeee2544",
                            "title": "ETW Logging Disabled In .NET Processes - Sysmon Registry",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "75f7a0e2-7154-4c4d-9eae-5cdb4e0a5c13",
                        "lookup_data": {
                            "description": "Looks for changes to registry to disable any write-protect property for storage devices. This could be a precursor to a ransomware attack and has been an observed technique used by cypherpunk group.",
                            "raw": "author: Sreeman\ndate: 2021/06/11\ndescription: Looks for changes to registry to disable any write-protect property for\n  storage devices. This could be a precursor to a ransomware attack and has been an\n  observed technique used by cypherpunk group.\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains:\n    - storage\n    - storagedevicepolicies\n    CommandLine|contains|all:\n    - reg add\n    - \\system\\currentcontrolset\\control\n    - write protection\n    - '0'\nfalsepositives:\n- Unknown\nid: 75f7a0e2-7154-4c4d-9eae-5cdb4e0a5c13\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/08/05\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562\ntitle: Write Protect For Storage Disabled\n",
                            "sigma:id": "75f7a0e2-7154-4c4d-9eae-5cdb4e0a5c13",
                            "title": "Write Protect For Storage Disabled",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "c2c76b77-32be-4d1f-82c9-7e544bdfe0eb",
                        "lookup_data": {
                            "description": "Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy",
                            "raw": "author: Janantha Marasinghe\ndate: 2022/11/18\ndescription: Detects potential suspicious behaviour using secedit.exe. Such as exporting\n  or modifying the security policy\ndetection:\n  condition: selection_img and (1 of selection_flags_*)\n  selection_flags_configure:\n    CommandLine|contains|all:\n    - /configure\n    - /db\n  selection_flags_discovery:\n    CommandLine|contains|all:\n    - /export\n    - /cfg\n  selection_img:\n  - Image|endswith: \\secedit.exe\n  - OriginalFileName: SeCEdit\nfalsepositives:\n- Legitimate administrative use\nid: c2c76b77-32be-4d1f-82c9-7e544bdfe0eb\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/12/30\nreferences:\n- https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d\n- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/secedit\nstatus: experimental\ntags:\n- attack.discovery\n- attack.persistence\n- attack.defense_evasion\n- attack.credential_access\n- attack.privilege_escalation\n- attack.t1562.002\n- attack.t1547.001\n- attack.t1505.005\n- attack.t1556.002\n- attack.t1562\n- attack.t1574.007\n- attack.t1564.002\n- attack.t1546.008\n- attack.t1546.007\n- attack.t1547.014\n- attack.t1547.010\n- attack.t1547.002\n- attack.t1557\n- attack.t1082\ntitle: Potential Suspicious Activity Using SeCEdit\n",
                            "sigma:id": "c2c76b77-32be-4d1f-82c9-7e544bdfe0eb",
                            "title": "Potential Suspicious Activity Using SeCEdit",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4d7f1827-1637-4def-8d8a-fd254f9454df",
                        "lookup_data": {
                            "description": "Detects application popup reporting a failure of the Sysmon service",
                            "raw": "author: Tim Shelton\ndate: 2022/04/26\ndescription: Detects application popup reporting a failure of the Sysmon service\ndetection:\n  condition: selection\n  selection:\n    Caption: sysmon64.exe - Application Error\n    EventID: 26\n    Provider_Name: Application Popup\nfalsepositives:\n- Unknown\nid: 4d7f1827-1637-4def-8d8a-fd254f9454df\nlevel: high\nlogsource:\n  product: windows\n  service: system\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562\ntitle: Sysmon Crash\n",
                            "sigma:id": "4d7f1827-1637-4def-8d8a-fd254f9454df",
                            "title": "Sysmon Crash",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5b16df71-8615-4f7f-ac9b-6c43c0509e61",
                        "lookup_data": {
                            "description": "Detects when the \"index\" value of a scheduled task is modified from the registry\nWhich effectively hides it from any tooling such as \"schtasks /query\" (Read the referenced link for more information about the effects of this technique)\n",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/26\ndescription: 'Detects when the \"index\" value of a scheduled task is modified from\n  the registry\n\n  Which effectively hides it from any tooling such as \"schtasks /query\" (Read the\n  referenced link for more information about the effects of this technique)\n\n  '\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (0x00000000)\n    EventType: SetValue\n    TargetObject|contains|all:\n    - \\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\\n    - Index\nfalsepositives:\n- Unlikely\nid: 5b16df71-8615-4f7f-ac9b-6c43c0509e61\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- https://blog.qualys.com/vulnerabilities-threat-research/2022/06/20/defending-against-scheduled-task-attacks-in-windows-environments\nrelated:\n- id: acd74772-5f88-45c7-956b-6a7b36c294d2\n  type: similar\n- id: 526cc8bc-1cdc-48ad-8b26-f19bff969cec\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562\ntitle: Hide Schedule Task Via Index Value Tamper\n",
                            "sigma:id": "5b16df71-8615-4f7f-ac9b-6c43c0509e61",
                            "title": "Hide Schedule Task Via Index Value Tamper",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "90f342e1-1aaa-4e43-b092-39fda57ed11e",
                        "lookup_data": {
                            "description": "Detects changes to the \"ExtErrorInformation\" key in order to disable ETW logging for rpcrt4.dll",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/12/09\ndescription: Detects changes to the \"ExtErrorInformation\" key in order to disable\n  ETW logging for rpcrt4.dll\ndetection:\n  condition: selection\n  selection:\n    Details:\n    - DWORD (0x00000000)\n    - DWORD (0x00000002)\n    EventType: SetValue\n    TargetObject|endswith: \\Microsoft\\Windows NT\\Rpc\\ExtErrorInformation\nfalsepositives:\n- Unknown\nid: 90f342e1-1aaa-4e43-b092-39fda57ed11e\nlevel: low\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- http://redplait.blogspot.com/2020/07/whats-wrong-with-etw.html\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1112\n- attack.t1562\ntitle: ETW Logging Disabled For rpcrt4.dll\n",
                            "sigma:id": "90f342e1-1aaa-4e43-b092-39fda57ed11e",
                            "title": "ETW Logging Disabled For rpcrt4.dll",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "12f6b752-042d-483e-bf9c-915a6d06ad75",
                        "lookup_data": {
                            "description": "Detects attempts to disable the Windows Firewall using PowerShell",
                            "raw": "author: Tim Rauch\ndate: 2022/09/14\ndescription: Detects attempts to disable the Windows Firewall using PowerShell\ndetection:\n  condition: all of selection*\n  selection_args:\n    CommandLine|contains|all:\n    - 'Set-NetFirewallProfile '\n    - ' -Enabled '\n    - ' False'\n  selection_name:\n  - Image|endswith:\n    - \\powershell.exe\n    - \\pwsh.exe\n    - \\powershell_ise.exe\n  - OriginalFileName: PowerShell.EXE\n  selection_opt:\n    CommandLine|contains:\n    - ' -All '\n    - Public\n    - Domain\n    - Private\nfalsepositives:\n- Unknown\nid: 12f6b752-042d-483e-bf9c-915a6d06ad75\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/12/30\nreferences:\n- https://www.elastic.co/guide/en/security/current/windows-firewall-disabled-via-powershell.html\nrelated:\n- id: 488b44e7-3781-4a71-888d-c95abfacf44d\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562\ntitle: Windows Firewall Disabled via PowerShell\n",
                            "sigma:id": "12f6b752-042d-483e-bf9c-915a6d06ad75",
                            "title": "Windows Firewall Disabled via PowerShell",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5eeec9aa-9d88-4ece-9e6f-9d92884ae404",
                        "lookup_data": {
                            "description": "Dissecting PlugX to Extract Its Crown Jewels",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5eeec9aa-9d88-4ece-9e6f-9d92884ae404.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1663580963",
                            "uuid": "5eeec9aa-9d88-4ece-9e6f-9d92884ae404",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "c9aed93d-4023-40c3-92a4-7e8607cd6cb6",
                        "lookup_data": {
                            "description": "Scraper: Talos Website",
                            "link": "http://www.botvrij.eu/data/feed-osint/c9aed93d-4023-40c3-92a4-7e8607cd6cb6.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1663009124",
                            "uuid": "c9aed93d-4023-40c3-92a4-7e8607cd6cb6",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "c1344fa2-323b-4d2e-9176-84b4d4821c88",
                        "lookup_data": {
                            "description": "Detects modifications to the Windows Defender configuration settings using PowerShell to add exclusions",
                            "raw": "author: Tim Rauch\ndate: 2022/09/16\ndescription: Detects modifications to the Windows Defender configuration settings\n  using PowerShell to add exclusions\ndetection:\n  condition: all of selection*\n  selection_args_exc:\n    ScriptBlockText|contains:\n    - ' -ExclusionPath '\n    - ' -ExclusionExtension '\n    - ' -ExclusionProcess '\n    - ' -ExclusionIpAddress '\n  selection_args_pref:\n    ScriptBlockText|contains:\n    - 'Add-MpPreference '\n    - 'Set-MpPreference '\nfalsepositives:\n- Unknown\nid: c1344fa2-323b-4d2e-9176-84b4d4821c88\nlevel: medium\nlogsource:\n  category: ps_script\n  definition: 'Requirements: Script Block Logging must be enabled'\n  product: windows\nmodified: 2022/11/26\nreferences:\n- https://www.elastic.co/guide/en/security/current/windows-defender-exclusions-added-via-powershell.html\nrelated:\n- id: 17769c90-230e-488b-a463-e05c08e9d48f\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562\n- attack.execution\n- attack.t1059\ntitle: Windows Defender Exclusions Added - PowerShell\n",
                            "sigma:id": "c1344fa2-323b-4d2e-9176-84b4d4821c88",
                            "title": "Windows Defender Exclusions Added - PowerShell",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "41421f44-58f9-455d-838a-c398859841d4",
                        "lookup_data": {
                            "description": "Detects changes to environment variables related to ETW logging. This could indicate potential adversaries stopping ETW providers recording loaded .NET assemblies.",
                            "raw": "author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020/05/02\ndescription: Detects changes to environment variables related to ETW logging. This\n  could indicate potential adversaries stopping ETW providers recording loaded .NET\n  assemblies.\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains:\n    - COMPlus_ETWEnabled\n    - COMPlus_ETWFlags\nfalsepositives:\n- Unlikely\nid: 41421f44-58f9-455d-838a-c398859841d4\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/12/09\nreferences:\n- https://twitter.com/_xpn_/status/1268712093928378368\n- https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr\n- https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables\n- https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38\n- https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39\n- https://github.com/dotnet/runtime/search?p=1&q=COMPlus_&unscoped_q=COMPlus_\n- https://bunnyinside.com/?term=f71e8cb9c76a\n- http://managed670.rssing.com/chan-5590147/all_p1.html\n- https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code\n- https://i.blackhat.com/EU-21/Wednesday/EU-21-Teodorescu-Veni-No-Vidi-No-Vici-Attacks-On-ETW-Blind-EDRs.pdf\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562\ntitle: ETW Logging Tamper In .NET Processes\n",
                            "sigma:id": "41421f44-58f9-455d-838a-c398859841d4",
                            "title": "ETW Logging Tamper In .NET Processes",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "526cc8bc-1cdc-48ad-8b26-f19bff969cec",
                        "lookup_data": {
                            "description": "Detects when the \"index\" value of a scheduled task is removed or deleted from the registry. Which effectively hides it from any tooling such as \"schtasks /query\"",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/26\ndescription: Detects when the \"index\" value of a scheduled task is removed or deleted\n  from the registry. Which effectively hides it from any tooling such as \"schtasks\n  /query\"\ndetection:\n  condition: selection\n  selection:\n    EventType: DeleteKey\n    TargetObject|contains|all:\n    - \\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\\n    - Index\nfalsepositives:\n- Unknown\nid: 526cc8bc-1cdc-48ad-8b26-f19bff969cec\nlevel: medium\nlogsource:\n  category: registry_delete\n  product: windows\nreferences:\n- https://blog.qualys.com/vulnerabilities-threat-research/2022/06/20/defending-against-scheduled-task-attacks-in-windows-environments\nrelated:\n- id: acd74772-5f88-45c7-956b-6a7b36c294d2\n  type: similar\n- id: 5b16df71-8615-4f7f-ac9b-6c43c0509e61\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562\ntitle: Removal Of Index Value to Hide Schedule Task\n",
                            "sigma:id": "526cc8bc-1cdc-48ad-8b26-f19bff969cec",
                            "title": "Removal Of Index Value to Hide Schedule Task",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4d7cda18-1b12-4e52-b45c-d28653210df8",
                        "lookup_data": {
                            "description": "Detect possible Sysmon driver unload",
                            "raw": "author: Kirill Kiryanov, oscd.community\ndate: 2019/10/23\ndescription: Detect possible Sysmon driver unload\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains|all:\n    - unload\n    - sys\n    Image|endswith: \\fltmc.exe\nfalsepositives:\n- Unknown\nfields:\n- CommandLine\n- Details\nid: 4d7cda18-1b12-4e52-b45c-d28653210df8\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/09\nreferences:\n- https://www.darkoperator.com/blog/2018/10/5/operating-offensively-against-sysmon\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1070\n- attack.t1562\n- attack.t1562.002\ntitle: Sysmon Driver Unload\n",
                            "sigma:id": "4d7cda18-1b12-4e52-b45c-d28653210df8",
                            "title": "Sysmon Driver Unload",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "a4c90ea1-2634-4ca0-adbb-35eae169b6fc",
                        "lookup_data": {
                            "description": "Potential adversaries stopping ETW providers recording loaded .NET assemblies.",
                            "raw": "author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020/06/05\ndescription: Potential adversaries stopping ETW providers recording loaded .NET assemblies.\ndetection:\n  condition: 1 of selection_*\n  selection_complus:\n    EventID: 4657\n    NewValue: 0\n    ObjectName|contains: \\Environment\n    ObjectValueName:\n    - COMPlus_ETWEnabled\n    - COMPlus_ETWFlags\n  selection_etw_enabled:\n    EventID: 4657\n    NewValue: 0\n    ObjectName|endswith: \\SOFTWARE\\Microsoft\\.NETFramework\n    ObjectValueName: ETWEnabled\nfalsepositives:\n- Unknown\nid: a4c90ea1-2634-4ca0-adbb-35eae169b6fc\nlevel: high\nlogsource:\n  product: windows\n  service: security\nmodified: 2022/12/20\nreferences:\n- https://twitter.com/_xpn_/status/1268712093928378368\n- https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr\n- https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables\n- https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38\n- https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39\n- https://github.com/dotnet/runtime/search?p=1&q=COMPlus_&unscoped_q=COMPlus_\n- https://bunnyinside.com/?term=f71e8cb9c76a\n- http://managed670.rssing.com/chan-5590147/all_p1.html\n- https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code\n- https://i.blackhat.com/EU-21/Wednesday/EU-21-Teodorescu-Veni-No-Vidi-No-Vici-Attacks-On-ETW-Blind-EDRs.pdf\nrelated:\n- id: bf4fc428-dcc3-4bbd-99fe-2422aeee2544\n  type: similar\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1112\n- attack.t1562\ntitle: ETW Logging Disabled In .NET Processes - Registry\n",
                            "sigma:id": "a4c90ea1-2634-4ca0-adbb-35eae169b6fc",
                            "title": "ETW Logging Disabled In .NET Processes - Registry",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "fe513c69-734c-4d4a-8548-ac5f609be82b",
                        "lookup_data": {
                            "description": "Detects  when a firewall rule is modified or deleted in Google Cloud Platform (GCP).",
                            "raw": "author: Austin Songer @austinsonger\ndate: 2021/08/13\ndescription: Detects  when a firewall rule is modified or deleted in Google Cloud\n  Platform (GCP).\ndetection:\n  condition: selection\n  selection:\n    gcp.audit.method_name:\n    - v*.Compute.Firewalls.Delete\n    - v*.Compute.Firewalls.Patch\n    - v*.Compute.Firewalls.Update\n    - v*.Compute.Firewalls.Insert\nfalsepositives:\n- Firewall rules being modified or deleted may be performed by a system administrator.\n  Verify that the firewall configuration change was expected.\n- Exceptions can be added to this rule to filter expected behavior.\nid: fe513c69-734c-4d4a-8548-ac5f609be82b\nlevel: medium\nlogsource:\n  product: gcp\n  service: gcp.audit\nmodified: 2022/10/09\nreferences:\n- https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging\n- https://developers.google.com/resources/api-libraries/documentation/compute/v1/java/latest/com/google/api/services/compute/Compute.Firewalls.html\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562\ntitle: Google Cloud Firewall Modified or Deleted\n",
                            "sigma:id": "fe513c69-734c-4d4a-8548-ac5f609be82b",
                            "title": "Google Cloud Firewall Modified or Deleted",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "a607e1fe-74bf-4440-a3ec-b059b9103157",
                        "lookup_data": {
                            "description": "Detects the modification of the findings on SecurityHub.",
                            "raw": "author: Sittikorn S\ndate: 2021/06/28\ndescription: Detects the modification of the findings on SecurityHub.\ndetection:\n  condition: selection\n  selection:\n    eventName:\n    - BatchUpdateFindings\n    - DeleteInsight\n    - UpdateFindings\n    - UpdateInsight\n    eventSource: securityhub.amazonaws.com\nfalsepositives:\n- System or Network administrator behaviors\n- DEV, UAT, SAT environment. You should apply this rule with PROD environment only.\nfields:\n- sourceIPAddress\n- userIdentity.arn\nid: a607e1fe-74bf-4440-a3ec-b059b9103157\nlevel: high\nlogsource:\n  product: aws\n  service: cloudtrail\nreferences:\n- https://docs.aws.amazon.com/cli/latest/reference/securityhub/\nstatus: stable\ntags:\n- attack.defense_evasion\n- attack.t1562\ntitle: AWS SecurityHub Findings Evasion\n",
                            "sigma:id": "a607e1fe-74bf-4440-a3ec-b059b9103157",
                            "title": "AWS SecurityHub Findings Evasion",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4f281b83-0200-4b34-bf35-d24687ea57c2",
                        "lookup_data": {
                            "description": "Detects changes to the \"TracingDisabled\" key in order to disable ETW logging for services.exe (SCM)",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/12/09\ndescription: Detects changes to the \"TracingDisabled\" key in order to disable ETW\n  logging for services.exe (SCM)\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (0x00000001)\n    EventType: SetValue\n    TargetObject|endswith: Software\\Microsoft\\Windows NT\\CurrentVersion\\Tracing\\SCM\\Regular\\TracingDisabled\nfalsepositives:\n- Unknown\nid: 4f281b83-0200-4b34-bf35-d24687ea57c2\nlevel: low\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- http://redplait.blogspot.com/2020/07/whats-wrong-with-etw.html\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1112\n- attack.t1562\ntitle: ETW Logging Disabled For SCM\n",
                            "sigma:id": "4f281b83-0200-4b34-bf35-d24687ea57c2",
                            "title": "ETW Logging Disabled For SCM",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5df8df26-fe0e-4858-94a7-6cf71d9519c9",
                        "lookup_data": {
                            "description": "UEFI threats moving to the ESP: Introducing ESPecter bootkit",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5df8df26-fe0e-4858-94a7-6cf71d9519c9.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1637336858",
                            "uuid": "5df8df26-fe0e-4858-94a7-6cf71d9519c9",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "3d333250-30e4-4a82-9edc-756c68afc529",
                        "lookup_data": {
                            "mitre-attack-id": "T1562",
                            "mitre-cti:description": "Adversaries may maliciously modify components of a victim environment in order to hinder or disable defensive mechanisms. This not only involves impairing preventative defenses, such as firewalls and anti-virus, but also detection capabilities that defenders can use to audit activity and identify malicious behavior. This may also span both native defenses as well as supplemental capabilities installed by users and administrators.\n\nAdversaries could also target event aggregation and analysis mechanisms, or otherwise disrupt these procedures by altering other system components.",
                            "mitre-cti:name": "Impair Defenses",
                            "mitre-cti:type": "attack-pattern",
                            "raw": "{'modified': '2022-10-19T16:32:56.502Z', 'name': 'Impair Defenses', 'description': 'Adversaries may maliciously modify components of a victim environment in order to hinder or disable defensive mechanisms. This not only involves impairing preventative defenses, such as firewalls and anti-virus, but also detection capabilities that defenders can use to audit activity and identify malicious behavior. This may also span both native defenses as well as supplemental capabilities installed by users and administrators.\\n\\nAdversaries could also target event aggregation and analysis mechanisms, or otherwise disrupt these procedures by altering other system components.', 'kill_chain_phases': [{'kill_chain_name': 'mitre-attack', 'phase_name': 'defense-evasion'}], 'x_mitre_detection': 'Monitor processes and command-line arguments to see if security tools or logging services are killed or stop running. Monitor Registry edits for modifications to services and startup programs that correspond to security tools.  Lack of log events may be suspicious.\\n\\nMonitor environment variables and APIs that can be leveraged to disable security measures.', 'x_mitre_platforms': ['Windows', 'Office 365', 'IaaS', 'Linux', 'macOS', 'Containers', 'Network'], 'x_mitre_is_subtechnique': False, 'x_mitre_deprecated': False, 'x_mitre_domains': ['enterprise-attack'], 'x_mitre_version': '1.3', 'x_mitre_data_sources': ['Cloud Service: Cloud Service Modification', 'Firewall: Firewall Rule Modification', 'Process: Process Termination', 'Service: Service Metadata', 'Process: Process Creation', 'Driver: Driver Load', 'Firewall: Firewall Disable', 'Command: Command Execution', 'Cloud Service: Cloud Service Disable', 'Windows Registry: Windows Registry Key Deletion', 'Windows Registry: Windows Registry Key Modification', 'Sensor Health: Host Status', 'Script: Script Execution'], 'x_mitre_defense_bypassed': ['Anti-virus', 'Signature-based detection', 'Host intrusion prevention systems', 'File monitoring', 'Digital Certificate Validation', 'Host forensic analysis', 'Log analysis', 'Firewall'], 'type': 'attack-pattern', 'id': 'attack-pattern--3d333250-30e4-4a82-9edc-756c68afc529', 'created': '2020-02-21T20:22:13.470Z', 'created_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'revoked': False, 'external_references': [{'source_name': 'mitre-attack', 'url': 'https://attack.mitre.org/techniques/T1562', 'external_id': 'T1562'}], 'object_marking_refs': ['marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168'], 'x_mitre_attack_spec_version': '2.1.0', 'x_mitre_modified_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5'}",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "acd74772-5f88-45c7-956b-6a7b36c294d2",
                        "lookup_data": {
                            "description": "Remove SD (Security Descriptor) value in \\Schedule\\TaskCache\\Tree registry hive to hide schedule task. This technique is used by Tarrask malware",
                            "raw": "author: Sittikorn S\ndate: 2022/04/15\ndescription: Remove SD (Security Descriptor) value in \\Schedule\\TaskCache\\Tree registry\n  hive to hide schedule task. This technique is used by Tarrask malware\ndetection:\n  condition: selection\n  selection:\n    EventType: DeleteKey\n    TargetObject|contains|all:\n    - \\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\\n    - SD\nfalsepositives:\n- Unknown\nid: acd74772-5f88-45c7-956b-6a7b36c294d2\nlevel: medium\nlogsource:\n  category: registry_delete\n  definition: key must be added to the sysmon configuration for this rule to work\n  product: windows\nreferences:\n- https://www.microsoft.com/security/blog/2022/04/12/tarrask-malware-uses-scheduled-tasks-for-defense-evasion/\nrelated:\n- id: 5b16df71-8615-4f7f-ac9b-6c43c0509e61\n  type: similar\n- id: 526cc8bc-1cdc-48ad-8b26-f19bff969cec\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562\ntitle: Removal Of SD Value to Hide Schedule Task\n",
                            "sigma:id": "acd74772-5f88-45c7-956b-6a7b36c294d2",
                            "title": "Removal Of SD Value to Hide Schedule Task",
                            "_cycat_type": "Item"
                        }
                    }
                ]
            }
        },
        "atomics": [
            {
                "attack_technique": "T1562",
                "display_name": "Impair Defenses",
                "atomic_tests": [
                    {
                        "name": "Windows Disable LSA Protection",
                        "auto_generated_guid": "40075d5f-3a70-4c66-9125-f72bee87247d",
                        "description": "The following Atomic adds a registry entry to disable LSA Protection.\n\nThe LSA controls and manages user rights information, password hashes and other important bits of information in memory. Attacker tools, such as mimikatz, rely on accessing this content to scrape password hashes or clear-text passwords. Enabling LSA Protection configures Windows to control the information stored in memory in a more secure fashion - specifically, to prevent non-protected processes from accessing that data.\nUpon successful execution, the registry will be modified and RunAsPPL will be set to 0, disabling Lsass protection.\nhttps://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/configuring-additional-lsa-protection#how-to-disable-lsa-protection\nhttps://blog.netwrix.com/2022/01/11/understanding-lsa-protection/\nhttps://thedfirreport.com/2022/03/21/phosphorus-automates-initial-access-using-proxyshell/  \n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\LSA /v RunAsPPL /t REG_DWORD /d 0 /f\n",
                            "cleanup_command": "reg delete HKLM\\SYSTEM\\CurrentControlSet\\Control\\LSA /v RunAsPPL /f >nul 2>&1\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable journal logging via systemctl utility",
                        "auto_generated_guid": "c3a377f9-1203-4454-aa35-9d391d34768f",
                        "description": "The atomic test disables the journal logging using built-in systemctl utility\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "sudo systemctl stop systemd-journald #disables journal logging\n",
                            "cleanup_command": "sudo systemctl start systemd-journald #starts journal service\nsudo systemctl enable systemd-journald #starts journal service automatically at boot time\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable journal logging via sed utility",
                        "auto_generated_guid": "12e5551c-8d5c-408e-b3e4-63f53b03379f",
                        "description": "The atomic test disables the journal logging by searching and replacing the \"Storage\" parameter to \"none\" within the journald.conf file, thus any new journal entries will only be temporarily available in memory and not written to disk\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "sudo sed -i 's/Storage=auto/Storage=none/' /etc/systemd/journald.conf\n",
                            "cleanup_command": "sudo sed -i 's/Storage=none/Storage=auto/' /etc/systemd/journald.conf #re-enables storage of journal data\nsudo systemctl restart systemd-journald #restart the journal service\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    }
                ]
            }
        ]
    },
    "timestamp": "2025-02-28 16:39:51"
}