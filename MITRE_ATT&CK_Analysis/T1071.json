{
    "id": "T1071",
    "name": "Application Layer Protocol",
    "description": "Adversaries may communicate using application layer protocols to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server.\nAdversaries may utilize many different protocols, including those used for web browsing, transferring files, electronic mail, or DNS. For connections that occur internally within an enclave (such as those between a proxy or pivot node and other nodes), commonly used protocols are SMB, SSH, or RDP.",
    "platforms": "Linux, macOS, Windows",
    "kill_chain_phases": "Command and Control",
    "data_sources": "Network Traffic: Network Traffic Flow, Network Traffic: Network Traffic Content",
    "detection": "Analyze network data for uncommon data flows (e.g., a client sending significantly more data than it receives from a server). Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious. Analyze packet contents to detect application layer protocols that do not follow the expected protocol standards regarding syntax, structure, or any other variable adversaries could leverage to conceal data.(Citation: University of Birmingham C2)",
    "url": "https://attack.mitre.org/techniques/T1071",
    "enrichments": {
        "attack_rule_map": [],
        "cycat": {
            "cycat": {
                "cycat_related_uuids": [
                    "4b1c186d-8bf2-4297-9cbc-f8f00192770b",
                    "0319b483-5973-4932-91ea-5a44c2975b24",
                    "5d9b516c-e5f0-4e7c-a958-5d8c0a019371",
                    "8ae51330-899c-4641-8125-e39f2e07da72",
                    "18739897-21b1-41da-8ee4-5b786915a676",
                    "d00a9a72-2c09-4459-ad03-5e0a23351e36",
                    "5d6e7aa3-aca4-46cc-b96a-46ac950d210f",
                    "5c463bd0-63bc-41f1-91dc-622168f8e8cf",
                    "5d9b5933-964c-433c-b84f-4c680a2fe004",
                    "5ba1d01f-27cc-438f-9cbc-4652950d210f",
                    "03552375-cc2c-4883-bbe4-7958d5a980be",
                    "b4163085-4001-46a3-a79a-55d8bbbc7a3a",
                    "f0a8cedc-1d22-4453-9c44-8d9f4ebd5d35",
                    "3db10f25-2527-4b79-8d4b-471eb900ee29",
                    "5d498330-f574-4889-bcc9-c53c950d210f",
                    "5ea0b0dc-45d0-4d5e-bed5-4271950d210f",
                    "eb4ee171-8930-4c15-8917-9af8775417fb",
                    "440a56bf-7873-4439-940a-1c8a671073c2",
                    "1ec4b281-aa65-46a2-bdae-5fd830ed914e",
                    "36222790-0d43-4fe8-86e4-674b27809543",
                    "25adc94b-5b29-44fe-a4a8-c89d17ff3566",
                    "98a96a5a-64a0-4c42-92c5-489da3866cb0",
                    "5ce6aa86-9cd8-4302-9dc9-4a59950d210f",
                    "3ceb2083-a27f-449a-be33-14ec1b7cc973",
                    "2975af79-28c4-4d2f-a951-9095f229df29",
                    "75c505b1-711d-4f68-a357-8c3fe37dbf2d",
                    "44ae5117-9c44-40cf-9c7c-7edad385ca70",
                    "355be19c-ffc9-46d5-8d50-d6a036c675b6",
                    "75bf09fa-1dd7-4d18-9af9-dd9e492562eb",
                    "4153a907-2451-4e4f-a578-c52bb6881432",
                    "b11d75d6-d7c1-11ea-87d0-0242ac130003",
                    "53ba33fd-3a50-4468-a5ef-c583635cfa92",
                    "5cccb246-0da0-4c93-a463-61fe0a016219",
                    "5ced8da1-0960-40bc-b5dc-2fed0a016219"
                ],
                "lookup_results": [
                    {
                        "uuid": "4b1c186d-8bf2-4297-9cbc-f8f00192770b",
                        "lookup_data": {
                            "description": "Prynt Stealer Spotted In the Wild - A New Info Stealer Performing Clipper And Keylogger Activities",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/4b1c186d-8bf2-4297-9cbc-f8f00192770b.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1666601854",
                            "uuid": "4b1c186d-8bf2-4297-9cbc-f8f00192770b",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "0319b483-5973-4932-91ea-5a44c2975b24",
                        "lookup_data": {
                            "description": "Conti Ransomware",
                            "link": "http://www.botvrij.eu/data/feed-osint/0319b483-5973-4932-91ea-5a44c2975b24.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1621181463",
                            "uuid": "0319b483-5973-4932-91ea-5a44c2975b24",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5d9b516c-e5f0-4e7c-a958-5d8c0a019371",
                        "lookup_data": {
                            "description": "Operation Ghost - White Paper",
                            "link": "http://www.botvrij.eu/data/feed-osint/5d9b516c-e5f0-4e7c-a958-5d8c0a019371.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1571855044",
                            "uuid": "5d9b516c-e5f0-4e7c-a958-5d8c0a019371",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "8ae51330-899c-4641-8125-e39f2e07da72",
                        "lookup_data": {
                            "description": "Detects strings used in command execution in DNS TXT Answer",
                            "raw": "author: Markus Neis\ndate: 2018/08/08\ndescription: Detects strings used in command execution in DNS TXT Answer\ndetection:\n  condition: selection\n  selection:\n    answer|contains:\n    - IEX\n    - Invoke-Expression\n    - cmd.exe\n    record_type: TXT\nfalsepositives:\n- Unknown\nid: 8ae51330-899c-4641-8125-e39f2e07da72\nlevel: high\nlogsource:\n  category: dns\nmodified: 2021/11/27\nreferences:\n- https://twitter.com/stvemillertime/status/1024707932447854592\n- https://github.com/samratashok/nishang/blob/414ee1104526d7057f9adaeee196d91ae447283e/Backdoors/DNS_TXT_Pwnage.ps1\nstatus: test\ntags:\n- attack.command_and_control\n- attack.t1071.004\ntitle: DNS TXT Answer with Possible Execution Strings\n",
                            "sigma:id": "8ae51330-899c-4641-8125-e39f2e07da72",
                            "title": "DNS TXT Answer with Possible Execution Strings",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "18739897-21b1-41da-8ee4-5b786915a676",
                        "lookup_data": {
                            "description": "Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.",
                            "raw": "author: Tim Burrell\ndate: 2020/02/07\ndescription: Detects artefacts associated with activity group GALLIUM - Microsoft\n  Threat Intelligence Center indicators released in December 2019.\ndetection:\n  condition: legitimate_executable and not legitimate_process_path\n  legitimate_executable:\n    sha1: e570585edc69f9074cb5e8a790708336bd45ca0f\n  legitimate_process_path:\n    Image|contains:\n    - :\\Program Files(x86)\\\n    - :\\Program Files\\\nfalsepositives:\n- Unknown\nid: 18739897-21b1-41da-8ee4-5b786915a676\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/09\nreferences:\n- https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/\n- https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn800669(v=ws.11)\nrelated:\n- id: 440a56bf-7873-4439-940a-1c8a671073c2\n  type: derived\nstatus: test\ntags:\n- attack.credential_access\n- attack.t1212\n- attack.command_and_control\n- attack.t1071\ntitle: GALLIUM Artefacts\n",
                            "sigma:id": "18739897-21b1-41da-8ee4-5b786915a676",
                            "title": "GALLIUM Artefacts",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "d00a9a72-2c09-4459-ad03-5e0a23351e36",
                        "lookup_data": {
                            "description": "Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies.",
                            "raw": "author: xknow @xknow_infosec\ndate: 2019/03/24\ndescription: Detects the usage of particular AttributeLDAPDisplayNames, which are\n  known for data exchange via LDAP by the tool LDAPFragger and are additionally not\n  commonly used in companies.\ndetection:\n  condition: selection\n  selection:\n    AttributeLDAPDisplayName:\n    - primaryInternationalISDNNumber\n    - otherFacsimileTelephoneNumber\n    - primaryTelexNumber\n    AttributeValue|contains: '*'\n    EventID: 5136\nfalsepositives:\n- Companies, who may use these default LDAP-Attributes for personal information\nid: d00a9a72-2c09-4459-ad03-5e0a23351e36\nlevel: high\nlogsource:\n  definition: The \"Audit Directory Service Changes\" logging policy must be configured\n    in order to receive events. Audit events are generated only for objects with configured\n    system access control lists (SACLs). Audit events are generated only for objects\n    with configured system access control lists (SACLs) and only when accessed in\n    a manner that matches their SACL settings. This policy covers the following events\n    ids - 5136, 5137, 5138, 5139, 5141. Note that the default policy does not cover\n    User objects. For that a custom AuditRule need to be setup (See https://github.com/OTRF/Set-AuditRule)\n  product: windows\n  service: security\nmodified: 2022/10/05\nreferences:\n- https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961\n- https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/\n- https://github.com/fox-it/LDAPFragger\nstatus: test\ntags:\n- attack.t1001.003\n- attack.command_and_control\ntitle: Suspicious LDAP-Attributes Used\n",
                            "sigma:id": "d00a9a72-2c09-4459-ad03-5e0a23351e36",
                            "title": "Suspicious LDAP-Attributes Used",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5d6e7aa3-aca4-46cc-b96a-46ac950d210f",
                        "lookup_data": {
                            "description": "SectorJ04 Groupâ€™s Increased Activity in 2019",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5d6e7aa3-aca4-46cc-b96a-46ac950d210f.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1568039252",
                            "uuid": "5d6e7aa3-aca4-46cc-b96a-46ac950d210f",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5c463bd0-63bc-41f1-91dc-622168f8e8cf",
                        "lookup_data": {
                            "description": "2019-01-21: APT28 Autoit Zebrocy Progression",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5c463bd0-63bc-41f1-91dc-622168f8e8cf.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1621849993",
                            "uuid": "5c463bd0-63bc-41f1-91dc-622168f8e8cf",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5d9b5933-964c-433c-b84f-4c680a2fe004",
                        "lookup_data": {
                            "description": "Emotet in Depth TTP 10-07-19",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5d9b5933-964c-433c-b84f-4c680a2fe004.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1621850615",
                            "uuid": "5d9b5933-964c-433c-b84f-4c680a2fe004",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5ba1d01f-27cc-438f-9cbc-4652950d210f",
                        "lookup_data": {
                            "description": "OSINT (expanded) - Xbash Combines Botnet, Ransomware, Coinmining in Worm that Targets Linux and Windows",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5ba1d01f-27cc-438f-9cbc-4652950d210f.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1537334496",
                            "uuid": "5ba1d01f-27cc-438f-9cbc-4652950d210f",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "03552375-cc2c-4883-bbe4-7958d5a980be",
                        "lookup_data": {
                            "description": "Detects SILENTTRINITY stager use",
                            "raw": "author: Aleksey Potapov, oscd.community\ndate: 2019/10/22\ndescription: Detects SILENTTRINITY stager use\ndetection:\n  condition: selection\n  selection:\n    Description|contains: st2stager\nfalsepositives:\n- Unknown\nid: 03552375-cc2c-4883-bbe4-7958d5a980be\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/09\nreferences:\n- https://github.com/byt3bl33d3r/SILENTTRINITY\nstatus: test\ntags:\n- attack.command_and_control\n- attack.t1071\ntitle: SILENTTRINITY Stager Execution\n",
                            "sigma:id": "03552375-cc2c-4883-bbe4-7958d5a980be",
                            "title": "SILENTTRINITY Stager Execution",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "b4163085-4001-46a3-a79a-55d8bbbc7a3a",
                        "lookup_data": {
                            "description": "High DNS requests amount from host per short period of time",
                            "raw": "author: Daniil Yugoslavskiy, oscd.community\ndate: 2019/10/24\ndescription: High DNS requests amount from host per short period of time\ndetection:\n  condition: selection | count() by src_ip > 1000\n  selection:\n    query: '*'\n  timeframe: 1m\nfalsepositives:\n- Legitimate high DNS requests rate to domain name which should be added to whitelist\nid: b4163085-4001-46a3-a79a-55d8bbbc7a3a\nlevel: medium\nlogsource:\n  category: dns\nmodified: 2022/10/09\nstatus: test\ntags:\n- attack.exfiltration\n- attack.t1048.003\n- attack.command_and_control\n- attack.t1071.004\ntitle: High DNS Requests Rate\n",
                            "sigma:id": "b4163085-4001-46a3-a79a-55d8bbbc7a3a",
                            "title": "High DNS Requests Rate",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f0a8cedc-1d22-4453-9c44-8d9f4ebd5d35",
                        "lookup_data": {
                            "description": "Extremely high rate of TXT record type DNS requests from host per short period of time. Possible result of Do-exfiltration tool execution",
                            "raw": "author: Daniil Yugoslavskiy, oscd.community\ndate: 2019/10/24\ndescription: Extremely high rate of TXT record type DNS requests from host per short\n  period of time. Possible result of Do-exfiltration tool execution\ndetection:\n  condition: selection | count() by src_ip > 50\n  selection:\n    record_type: TXT\n  timeframe: 1m\nfalsepositives:\n- Legitimate high DNS TXT requests rate to domain name which should be added to whitelist\nid: f0a8cedc-1d22-4453-9c44-8d9f4ebd5d35\nlevel: medium\nlogsource:\n  category: dns\nmodified: 2021/11/27\nstatus: test\ntags:\n- attack.exfiltration\n- attack.t1048.003\n- attack.command_and_control\n- attack.t1071.004\ntitle: High TXT Records Requests Rate\n",
                            "sigma:id": "f0a8cedc-1d22-4453-9c44-8d9f4ebd5d35",
                            "title": "High TXT Records Requests Rate",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "3db10f25-2527-4b79-8d4b-471eb900ee29",
                        "lookup_data": {
                            "description": "Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.",
                            "raw": "author: Tim Burrell\ndate: 2020/02/07\ndescription: Detects artefacts associated with activity group GALLIUM - Microsoft\n  Threat Intelligence Center indicators released in December 2019.\ndetection:\n  condition: selection\n  selection:\n    EventID: 257\n    QNAME:\n    - asyspy256.ddns.net\n    - hotkillmail9sddcc.ddns.net\n    - rosaf112.ddns.net\n    - cvdfhjh1231.myftp.biz\n    - sz2016rose.ddns.net\n    - dffwescwer4325.myftp.biz\n    - cvdfhjh1231.ddns.net\nfalsepositives:\n- Unknown\nid: 3db10f25-2527-4b79-8d4b-471eb900ee29\nlevel: high\nlogsource:\n  definition: 'Requirements: Microsoft-Windows-DNS-Server/Analytical ({EB79061A-A566-4698-9119-3ED2807060E7})\n    Event Log must be collected in order to receive the events.'\n  product: windows\n  service: dns-server-analytic\nmodified: 2023/01/02\nreferences:\n- https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/\n- https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn800669(v=ws.11)\nrelated:\n- id: 440a56bf-7873-4439-940a-1c8a671073c2\n  type: derived\nstatus: test\ntags:\n- attack.credential_access\n- attack.command_and_control\n- attack.t1071\ntitle: GALLIUM Artefacts - Builtin\n",
                            "sigma:id": "3db10f25-2527-4b79-8d4b-471eb900ee29",
                            "title": "GALLIUM Artefacts - Builtin",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5d498330-f574-4889-bcc9-c53c950d210f",
                        "lookup_data": {
                            "description": "OSINT - Sharpening the Machete",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5d498330-f574-4889-bcc9-c53c950d210f.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1566552908",
                            "uuid": "5d498330-f574-4889-bcc9-c53c950d210f",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5ea0b0dc-45d0-4d5e-bed5-4271950d210f",
                        "lookup_data": {
                            "description": "Ursnif Campaign f1.pipen.at",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5ea0b0dc-45d0-4d5e-bed5-4271950d210f.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1592743551",
                            "uuid": "5ea0b0dc-45d0-4d5e-bed5-4271950d210f",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "eb4ee171-8930-4c15-8917-9af8775417fb",
                        "lookup_data": {
                            "description": "CERT-FR report extended - sandworm intrusion set campaign targeting Centreon systems",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/eb4ee171-8930-4c15-8917-9af8775417fb.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1613463604",
                            "uuid": "eb4ee171-8930-4c15-8917-9af8775417fb",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "440a56bf-7873-4439-940a-1c8a671073c2",
                        "lookup_data": {
                            "description": "Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.",
                            "raw": "author: Tim Burrell\ndate: 2020/02/07\ndescription: Detects artefacts associated with activity group GALLIUM - Microsoft\n  Threat Intelligence Center indicators released in December 2019.\ndetection:\n  condition: selection\n  selection:\n    sha1:\n    - 53a44c2396d15c3a03723fa5e5db54cafd527635\n    - 9c5e496921e3bc882dc40694f1dcc3746a75db19\n    - aeb573accfd95758550cf30bf04f389a92922844\n    - 79ef78a797403a4ed1a616c68e07fff868a8650a\n    - 4f6f38b4cec35e895d91c052b1f5a83d665c2196\n    - 1e8c2cac2e4ce7cbd33c3858eb2e24531cb8a84d\n    - e841a63e47361a572db9a7334af459ddca11347a\n    - c28f606df28a9bc8df75a4d5e5837fc5522dd34d\n    - 2e94b305d6812a9f96e6781c888e48c7fb157b6b\n    - dd44133716b8a241957b912fa6a02efde3ce3025\n    - 8793bf166cb89eb55f0593404e4e933ab605e803\n    - a39b57032dbb2335499a51e13470a7cd5d86b138\n    - 41cc2b15c662bc001c0eb92f6cc222934f0beeea\n    - d209430d6af54792371174e70e27dd11d3def7a7\n    - 1c6452026c56efd2c94cea7e0f671eb55515edb0\n    - c6b41d3afdcdcaf9f442bbe772f5da871801fd5a\n    - 4923d460e22fbbf165bbbaba168e5a46b8157d9f\n    - f201504bd96e81d0d350c3a8332593ee1c9e09de\n    - ddd2db1127632a2a52943a2fe516a2e7d05d70d2\nfalsepositives:\n- Unknown\nid: 440a56bf-7873-4439-940a-1c8a671073c2\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/09\nreferences:\n- https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/\n- https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn800669(v=ws.11)\nstatus: test\ntags:\n- attack.credential_access\n- attack.t1212\n- attack.command_and_control\n- attack.t1071\ntitle: GALLIUM Sha1 Artefacts\n",
                            "sigma:id": "440a56bf-7873-4439-940a-1c8a671073c2",
                            "title": "GALLIUM Sha1 Artefacts",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "1ec4b281-aa65-46a2-bdae-5fd830ed914e",
                        "lookup_data": {
                            "description": "Normally, DNS logs contain a limited amount of different dns queries for a single domain. This rule detects a high amount of queries for a single domain, which can be an indicator that DNS is used to transfer data.",
                            "raw": "author: Patrick Bareiss\ndate: 2019/04/07\ndescription: Normally, DNS logs contain a limited amount of different dns queries\n  for a single domain. This rule detects a high amount of queries for a single domain,\n  which can be an indicator that DNS is used to transfer data.\ndetection:\n  condition: selection | count(dns_query) by parent_domain > 1000\n  selection:\n    parent_domain: '*'\nfalsepositives:\n- Valid software, which uses dns for transferring data\nid: 1ec4b281-aa65-46a2-bdae-5fd830ed914e\nlevel: high\nlogsource:\n  category: dns\nmodified: 2021/11/27\nreferences:\n- https://zeltser.com/c2-dns-tunneling/\n- https://patrick-bareiss.com/detect-c2-traffic-over-dns-using-sigma/\nstatus: test\ntags:\n- attack.command_and_control\n- attack.t1071.004\n- attack.exfiltration\n- attack.t1048.003\ntitle: Possible DNS Tunneling\n",
                            "sigma:id": "1ec4b281-aa65-46a2-bdae-5fd830ed914e",
                            "title": "Possible DNS Tunneling",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "36222790-0d43-4fe8-86e4-674b27809543",
                        "lookup_data": {
                            "description": "Detecting DNS tunnel activity for Muddywater actor",
                            "raw": "author: '@caliskanfurkan_'\ndate: 2020/06/04\ndescription: Detecting DNS tunnel activity for Muddywater actor\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains: DataExchange.dll\n    Image|endswith:\n    - \\powershell.exe\n    - \\pwsh.exe\n    ParentImage|endswith: \\excel.exe\nfalsepositives:\n- Unknown\nid: 36222790-0d43-4fe8-86e4-674b27809543\nlevel: critical\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/07/14\nreferences:\n- https://www.virustotal.com/gui/file/5ad401c3a568bd87dd13f8a9ddc4e450ece61cd9ce4d1b23f68ce0b1f3c190b7/\n- https://www.vmray.com/analyses/5ad401c3a568/report/overview.html\nstatus: test\ntags:\n- attack.command_and_control\n- attack.t1071.004\ntitle: DNS Tunnel Technique from MuddyWater\n",
                            "sigma:id": "36222790-0d43-4fe8-86e4-674b27809543",
                            "title": "DNS Tunnel Technique from MuddyWater",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "25adc94b-5b29-44fe-a4a8-c89d17ff3566",
                        "lookup_data": {
                            "description": "UNC3524: Eye Spy on Your Email",
                            "link": "http://www.botvrij.eu/data/feed-osint/25adc94b-5b29-44fe-a4a8-c89d17ff3566.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1652459344",
                            "uuid": "25adc94b-5b29-44fe-a4a8-c89d17ff3566",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "98a96a5a-64a0-4c42-92c5-489da3866cb0",
                        "lookup_data": {
                            "description": "Well-known DNS Exfiltration tools execution",
                            "raw": "author: Daniil Yugoslavskiy, oscd.community\ndate: 2019/10/24\ndescription: Well-known DNS Exfiltration tools execution\ndetection:\n  condition: selection\n  selection:\n  - Image|endswith: \\iodine.exe\n  - Image|contains: \\dnscat2\nfalsepositives:\n- \"Legitimate usage of iodine or dnscat2 \\u2014 DNS Exfiltration tools (unlikely)\"\nid: 98a96a5a-64a0-4c42-92c5-489da3866cb0\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2021/11/27\nstatus: test\ntags:\n- attack.exfiltration\n- attack.t1048.001\n- attack.command_and_control\n- attack.t1071.004\n- attack.t1132.001\ntitle: DNS Exfiltration and Tunneling Tools Execution\n",
                            "sigma:id": "98a96a5a-64a0-4c42-92c5-489da3866cb0",
                            "title": "DNS Exfiltration and Tunneling Tools Execution",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5ce6aa86-9cd8-4302-9dc9-4a59950d210f",
                        "lookup_data": {
                            "description": "OSINT - A journey to Zebrocy land",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5ce6aa86-9cd8-4302-9dc9-4a59950d210f.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1563528054",
                            "uuid": "5ce6aa86-9cd8-4302-9dc9-4a59950d210f",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "3ceb2083-a27f-449a-be33-14ec1b7cc973",
                        "lookup_data": {
                            "description": "Detects Silence EmpireDNSAgent as described in the Group-IP report",
                            "raw": "author: Alina Stepchenkova, Group-IB, oscd.community\ndate: 2019/11/01\ndescription: Detects Silence EmpireDNSAgent as described in the Group-IP report\ndetection:\n  condition: empire and dnscat\n  dnscat:\n    ScriptBlockText|contains|all:\n    - set type=$LookupType`nserver\n    - $Command | nslookup 2>&1 | Out-String\n    - New-RandomDNSField\n    - '[Convert]::ToString($SYNOptions, 16)'\n    - $Session.Dead = $True\n    - $Session[\"Driver\"] -eq\n  empire:\n    ScriptBlockText|contains|all:\n    - System.Diagnostics.Process\n    - Stop-Computer\n    - Restart-Computer\n    - Exception in execution\n    - $cmdargs\n    - Close-Dnscat2Tunnel\nfalsepositives:\n- Unknown\nid: 3ceb2083-a27f-449a-be33-14ec1b7cc973\nlevel: critical\nlogsource:\n  definition: 'Requirements: Script Block Logging must be enabled'\n  product: windows\n  service: powershell\nmodified: 2022/10/05\nreferences:\n- https://www.group-ib.com/resources/threat-research/silence_2.0.going_global.pdf\nstatus: test\ntags:\n- attack.execution\n- attack.t1059.001\n- attack.command_and_control\n- attack.t1071.004\n- attack.t1572\n- attack.impact\n- attack.t1529\n- attack.g0091\n- attack.s0363\ntitle: Silence.EDA Detection\n",
                            "sigma:id": "3ceb2083-a27f-449a-be33-14ec1b7cc973",
                            "title": "Silence.EDA Detection",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "2975af79-28c4-4d2f-a951-9095f229df29",
                        "lookup_data": {
                            "description": "Detects suspicious DNS queries known from Cobalt Strike beacons",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2018/05/10\ndescription: Detects suspicious DNS queries known from Cobalt Strike beacons\ndetection:\n  condition: 1 of selection*\n  selection1:\n    query|startswith:\n    - aaa.stage.\n    - post.1\n  selection2:\n    query|contains: .stage.123456.\nfalsepositives:\n- Unknown\nid: 2975af79-28c4-4d2f-a951-9095f229df29\nlevel: critical\nlogsource:\n  category: dns\nmodified: 2022/10/09\nreferences:\n- https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns\n- https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/\nstatus: test\ntags:\n- attack.command_and_control\n- attack.t1071.004\ntitle: Cobalt Strike DNS Beaconing\n",
                            "sigma:id": "2975af79-28c4-4d2f-a951-9095f229df29",
                            "title": "Cobalt Strike DNS Beaconing",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "75c505b1-711d-4f68-a357-8c3fe37dbf2d",
                        "lookup_data": {
                            "description": "Detects SILENTTRINITY stager use",
                            "raw": "author: Aleksey Potapov, oscd.community\ndate: 2019/10/22\ndescription: Detects SILENTTRINITY stager use\ndetection:\n  condition: selection\n  selection:\n    Description|contains: st2stager\nfalsepositives:\n- Unknown\nid: 75c505b1-711d-4f68-a357-8c3fe37dbf2d\nlevel: high\nlogsource:\n  category: image_load\n  product: windows\nmodified: 2022/11/28\nreferences:\n- https://github.com/byt3bl33d3r/SILENTTRINITY\nrelated:\n- id: 03552375-cc2c-4883-bbe4-7958d5a980be\n  type: derived\nstatus: test\ntags:\n- attack.command_and_control\n- attack.t1071\ntitle: SILENTTRINITY Stager Execution - DLL\n",
                            "sigma:id": "75c505b1-711d-4f68-a357-8c3fe37dbf2d",
                            "title": "SILENTTRINITY Stager Execution - DLL",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "44ae5117-9c44-40cf-9c7c-7edad385ca70",
                        "lookup_data": {
                            "description": "Extremely high rate of NULL record type DNS requests from host per short period of time. Possible result of iodine tool execution",
                            "raw": "author: Daniil Yugoslavskiy, oscd.community\ndate: 2019/10/24\ndescription: Extremely high rate of NULL record type DNS requests from host per short\n  period of time. Possible result of iodine tool execution\ndetection:\n  condition: selection | count() by src_ip > 50\n  selection:\n    record_type: 'NULL'\n  timeframe: 1m\nfalsepositives:\n- Legitimate high DNS NULL requests rate to domain name which should be added to whitelist\nid: 44ae5117-9c44-40cf-9c7c-7edad385ca70\nlevel: medium\nlogsource:\n  category: dns\nmodified: 2021/11/27\nstatus: test\ntags:\n- attack.exfiltration\n- attack.t1048.003\n- attack.command_and_control\n- attack.t1071.004\ntitle: High NULL Records Requests Rate\n",
                            "sigma:id": "44ae5117-9c44-40cf-9c7c-7edad385ca70",
                            "title": "High NULL Records Requests Rate",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "355be19c-ffc9-46d5-8d50-d6a036c675b6",
                        "lookup_data": {
                            "mitre-attack-id": "T1071",
                            "mitre-cti:description": "Adversaries may communicate using application layer protocols to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. \n\nAdversaries may utilize many different protocols, including those used for web browsing, transferring files, electronic mail, or DNS. For connections that occur internally within an enclave (such as those between a proxy or pivot node and other nodes), commonly used protocols are SMB, SSH, or RDP. ",
                            "mitre-cti:name": "Application Layer Protocol",
                            "mitre-cti:type": "attack-pattern",
                            "raw": "{'x_mitre_platforms': ['Linux', 'macOS', 'Windows'], 'x_mitre_domains': ['enterprise-attack'], 'object_marking_refs': ['marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168'], 'id': 'attack-pattern--355be19c-ffc9-46d5-8d50-d6a036c675b6', 'type': 'attack-pattern', 'created': '2017-05-31T21:30:56.776Z', 'created_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'external_references': [{'source_name': 'mitre-attack', 'external_id': 'T1071', 'url': 'https://attack.mitre.org/techniques/T1071'}, {'url': 'https://arxiv.org/ftp/arxiv/papers/1408/1408.1136.pdf', 'description': 'Gardiner, J.,  Cova, M., Nagaraja, S. (2014, February). Command & Control Understanding, Denying and Detecting. Retrieved April 20, 2016.', 'source_name': 'University of Birmingham C2'}], 'modified': '2020-10-21T16:35:45.986Z', 'name': 'Application Layer Protocol', 'description': 'Adversaries may communicate using application layer protocols to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. \\n\\nAdversaries may utilize many different protocols, including those used for web browsing, transferring files, electronic mail, or DNS. For connections that occur internally within an enclave (such as those between a proxy or pivot node and other nodes), commonly used protocols are SMB, SSH, or RDP. ', 'kill_chain_phases': [{'kill_chain_name': 'mitre-attack', 'phase_name': 'command-and-control'}], 'x_mitre_detection': 'Analyze network data for uncommon data flows (e.g., a client sending significantly more data than it receives from a server). Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious. Analyze packet contents to detect application layer protocols that do not follow the expected protocol standards regarding syntax, structure, or any other variable adversaries could leverage to conceal data.(Citation: University of Birmingham C2)', 'x_mitre_version': '2.0', 'x_mitre_modified_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'x_mitre_data_sources': ['Network Traffic: Network Traffic Flow', 'Network Traffic: Network Traffic Content'], 'x_mitre_is_subtechnique': False}",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "75bf09fa-1dd7-4d18-9af9-dd9e492562eb",
                        "lookup_data": {
                            "description": "Detects the usage of ADSI (LDAP) operations by tools. This may also detect tools like LDAPFragger.",
                            "raw": "author: xknow @xknow_infosec, Tim Shelton\ndate: 2019/03/24\ndescription: Detects the usage of ADSI (LDAP) operations by tools. This may also detect\n  tools like LDAPFragger.\ndetection:\n  condition: selection and not 1 of filter_*\n  filter_begins:\n    Image|startswith:\n    - C:\\Windows\\ccmsetup\\autoupgrade\\ccmsetup\n    - C:\\Program Files\\SentinelOne\\Sentinel Agent\n  filter_citrix:\n    Image|endswith: :\\Program Files\\Citrix\\Receiver StoreFront\\Services\\DefaultDomainServices\\Citrix.DeliveryServices.DomainServices.ServiceHost.exe\n  filter_domain_controller:\n    Image:\n    - C:\\Windows\\system32\\efsui.exe\n    - C:\\Windows\\system32\\dsac.exe\n  filter_ends:\n    Image|endswith: \\LANDesk\\LDCLient\\ldapwhoami.exe\n  filter_eq:\n    Image:\n    - C:\\windows\\system32\\svchost.exe\n    - C:\\windows\\system32\\dllhost.exe\n    - C:\\windows\\system32\\mmc.exe\n    - C:\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe\n    - C:\\Windows\\CCM\\CcmExec.exe\n    - C:\\Program Files\\Cylance\\Desktop\\CylanceSvc.exe\n    - C:\\Windows\\System32\\wbem\\WmiPrvSE.exe\n  selection:\n    TargetFilename|contains: \\Local\\Microsoft\\Windows\\SchCache\\\n    TargetFilename|endswith: .sch\nfalsepositives:\n- Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity\n  by MMC, Powershell, Windows etc.\nid: 75bf09fa-1dd7-4d18-9af9-dd9e492562eb\nlevel: high\nlogsource:\n  category: file_event\n  product: windows\nmodified: 2023/01/12\nreferences:\n- https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961\n- https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/\n- https://github.com/fox-it/LDAPFragger\nstatus: test\ntags:\n- attack.t1001.003\n- attack.command_and_control\ntitle: Suspicious ADSI-Cache Usage By Unknown Tool\n",
                            "sigma:id": "75bf09fa-1dd7-4d18-9af9-dd9e492562eb",
                            "title": "Suspicious ADSI-Cache Usage By Unknown Tool",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4153a907-2451-4e4f-a578-c52bb6881432",
                        "lookup_data": {
                            "description": "Detects suspicious DNS queries using base64 encoding",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2018/05/10\ndescription: Detects suspicious DNS queries using base64 encoding\ndetection:\n  condition: selection\n  selection:\n    query|contains: ==.\nfalsepositives:\n- Unknown\nid: 4153a907-2451-4e4f-a578-c52bb6881432\nlevel: medium\nlogsource:\n  category: dns\nmodified: 2022/10/09\nreferences:\n- https://github.com/krmaxwell/dns-exfiltration\nstatus: test\ntags:\n- attack.exfiltration\n- attack.t1048.003\n- attack.command_and_control\n- attack.t1071.004\ntitle: Suspicious DNS Query with B64 Encoded String\n",
                            "sigma:id": "4153a907-2451-4e4f-a578-c52bb6881432",
                            "title": "Suspicious DNS Query with B64 Encoded String",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "b11d75d6-d7c1-11ea-87d0-0242ac130003",
                        "lookup_data": {
                            "description": "The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally.",
                            "raw": "author: Cian Heasley\ndate: 2020/08/08\ndescription: The PowerShell implementation of DNSCat2 calls nslookup to craft queries.\n  Counting nslookup processes spawned by PowerShell will show hundreds or thousands\n  of instances if PS DNSCat2 is active locally.\ndetection:\n  condition: selection | count(Image) by ParentImage > 100\n  selection:\n    CommandLine|endswith: \\nslookup.exe\n    Image|endswith: \\nslookup.exe\n    ParentImage|endswith:\n    - \\powershell.exe\n    - \\pwsh.exe\nfalsepositives:\n- Other powershell scripts that call nslookup.exe\nfields:\n- Image\n- CommandLine\n- ParentImage\nid: b11d75d6-d7c1-11ea-87d0-0242ac130003\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/07/14\nreferences:\n- https://github.com/lukebaggett/dnscat2-powershell\n- https://blu3-team.blogspot.com/2019/08/powershell-dns-c2-notes.html\n- https://ragged-lab.blogspot.com/2020/06/it-is-always-dns-powershell-edition.html\nstatus: test\ntags:\n- attack.command_and_control\n- attack.t1071\n- attack.t1071.004\n- attack.t1001.003\n- attack.t1041\ntitle: DNSCat2 Powershell Implementation Detection Via Process Creation\n",
                            "sigma:id": "b11d75d6-d7c1-11ea-87d0-0242ac130003",
                            "title": "DNSCat2 Powershell Implementation Detection Via Process Creation",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "53ba33fd-3a50-4468-a5ef-c583635cfa92",
                        "lookup_data": {
                            "description": "Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018",
                            "raw": "author: Florian Roth (Nextron Systems), Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy,\n  oscd.community\ndate: 2018/03/23\ndescription: Detects Chafer activity attributed to OilRig as reported in Nyotron report\n  in March 2018\ndetection:\n  condition: selection_service\n  selection_service:\n    EventID: 7045\n    Provider_Name: Service Control Manager\n    ServiceName:\n    - SC Scheduled Scan\n    - UpdatMachine\nfalsepositives:\n- Unknown\nid: 53ba33fd-3a50-4468-a5ef-c583635cfa92\nlevel: critical\nlogsource:\n  product: windows\n  service: system\nmodified: 2022/11/27\nreferences:\n- https://nyotron.com/nyotron-discovers-next-generation-oilrig-attacks/\nstatus: experimental\ntags:\n- attack.persistence\n- attack.g0049\n- attack.t1053.005\n- attack.s0111\n- attack.t1543.003\n- attack.defense_evasion\n- attack.t1112\n- attack.command_and_control\n- attack.t1071.004\ntitle: Chafer Activity - System\n",
                            "sigma:id": "53ba33fd-3a50-4468-a5ef-c583635cfa92",
                            "title": "Chafer Activity - System",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5cccb246-0da0-4c93-a463-61fe0a016219",
                        "lookup_data": {
                            "description": "ESET Turla LightNeuron Research",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5cccb246-0da0-4c93-a463-61fe0a016219.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1607525139",
                            "uuid": "5cccb246-0da0-4c93-a463-61fe0a016219",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5ced8da1-0960-40bc-b5dc-2fed0a016219",
                        "lookup_data": {
                            "description": "Turla PowerShell blogpost",
                            "link": "http://www.botvrij.eu/data/feed-osint/5ced8da1-0960-40bc-b5dc-2fed0a016219.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1559232101",
                            "uuid": "5ced8da1-0960-40bc-b5dc-2fed0a016219",
                            "_cycat_type": "Item"
                        }
                    }
                ]
            }
        },
        "atomics": [
            {
                "attack_technique": "T1071",
                "display_name": "Application Layer Protocol",
                "atomic_tests": [
                    {
                        "name": "Telnet C2",
                        "auto_generated_guid": "3b0df731-030c-4768-b492-2a3216d90e53",
                        "description": "An adversary may establish Telnet communication from a compromised endpoint to a command and control (C2) server in order to carry out additional attacks on objectives.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "A command and control (C2) server can be established by running PathToAtomicsFolder\\T1071\\bin\\telnet_server.exe on a specified server with a specified IP that must be reachable by a client (telnet_client.exe)\n",
                                "prereq_command": "$connection = Test-NetConnection -ComputerName #{server_ip} -Port #{server_port}\nif ($connection.TcpTestSucceeded) {exit 0} else {exit 1}\n",
                                "get_prereq_command": "Write-Host \"Setup C2 server manually\"\n"
                            }
                        ],
                        "input_arguments": {
                            "server_ip": {
                                "description": "C2 server IP or URL",
                                "type": "url",
                                "default": "127.0.0.1"
                            },
                            "client_path": {
                                "description": "Client agent path",
                                "type": "path",
                                "default": "PathToAtomicsFolder\\T1071\\bin\\telnet_client.exe"
                            },
                            "server_port": {
                                "description": "C2 server port",
                                "type": "integer",
                                "default": 23
                            }
                        },
                        "executor": {
                            "command": "#{client_path} #{server_ip} --port #{server_port}\n",
                            "name": "powershell"
                        }
                    }
                ]
            }
        ]
    },
    "timestamp": "2025-02-28 12:22:00"
}