{
    "id": "T1218.001",
    "name": "Compiled HTML File",
    "description": "Adversaries may abuse Compiled HTML files (.chm) to conceal malicious code. CHM files are commonly distributed as part of the Microsoft HTML Help system. CHM files are compressed compilations of various content such as HTML documents, images, and scripting/web related programming languages such VBA, JScript, Java, and ActiveX. (Citation: Microsoft HTML Help May 2018) CHM content is displayed using underlying components of the Internet Explorer browser (Citation: Microsoft HTML Help ActiveX) loaded by the HTML Help executable program (hh.exe). (Citation: Microsoft HTML Help Executable Program)\nA custom CHM file containing embedded payloads could be delivered to a victim then triggered by [User Execution](T1204). CHM execution may also bypass application application control on older and/or unpatched systems that do not account for execution of binaries through hh.exe. (Citation: MsitPros CHM Aug 2017) (Citation: Microsoft CVE-2017-8625 Aug 2017)",
    "platforms": "Windows",
    "kill_chain_phases": "Defense Evasion",
    "data_sources": "Process: Process Creation, File: File Creation, Command: Command Execution",
    "detection": "Monitor and analyze the execution and arguments of hh.exe. (Citation: MsitPros CHM Aug 2017) Compare recent invocations of hh.exe with prior history of known good arguments to determine anomalous and potentially adversarial activity (ex: obfuscated and/or malicious commands). Non-standard process execution trees may also indicate suspicious or malicious behavior, such as if hh.exe is the parent process for suspicious processes and activity relating to other adversarial techniques.\nMonitor presence and use of CHM files, especially if they are not typically used within an environment.",
    "url": "https://attack.mitre.org/techniques/T1218/001",
    "enrichments": {
        "attack_rule_map": [
            {
                "tech_id": "T1218.001",
                "atomic_attack_guid": "20cb05e0-1fa5-406d-92c1-84da4ba01813",
                "atomic_attack_name": "Decompile Local CHM File",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "HH.EXE Execution",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hh_chm_execution.yml",
                        "remote_content": "title: HH.EXE Execution\nid: 68c8acb4-1b60-4890-8e82-3ddf7a6dba84\nstatus: test\ndescription: Detects the execution of \"hh.exe\" to open \".chm\" files.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.001/T1218.001.md\n    - https://eqllib.readthedocs.io/en/latest/analytics/b25aa548-7937-11e9-8f5c-d46d6d62a49e.html\n    - https://www.zscaler.com/blogs/security-research/unintentional-leak-glimpse-attack-vectors-apt37\nauthor: E.M. Anhaus (originally from Atomic Blue Detections, Dan Beavin), oscd.community\ndate: 2019-10-24\nmodified: 2023-12-11\ntags:\n    - attack.defense-evasion\n    - attack.t1218.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - OriginalFileName: 'HH.exe'\n        - Image|endswith: '\\hh.exe'\n    selection_cli:\n        CommandLine|contains: '.chm'\n    condition: all of selection_*\nfalsepositives:\n    - False positives are expected with legitimate \".CHM\"\nlevel: low\n"
                    },
                    {
                        "rule_name": "Suspicious HH.EXE Execution",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hh_susp_execution.yml",
                        "remote_content": "title: Suspicious HH.EXE Execution\nid: e8a95b5e-c891-46e2-b33a-93937d3abc31\nstatus: test\ndescription: Detects a suspicious execution of a Microsoft HTML Help (HH.exe)\nreferences:\n    - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/\n    - https://github.com/elastic/protections-artifacts/commit/746086721fd385d9f5c6647cada1788db4aea95f#diff-27939090904026cc396b0b629c8e4314acd6f5dac40a676edbc87f4567b47eb7\n    - https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/\n    - https://www.zscaler.com/blogs/security-research/unintentional-leak-glimpse-attack-vectors-apt37\nauthor: Maxim Pavlunin\ndate: 2020-04-01\nmodified: 2023-04-12\ntags:\n    - attack.defense-evasion\n    - attack.execution\n    - attack.initial-access\n    - attack.t1047\n    - attack.t1059.001\n    - attack.t1059.003\n    - attack.t1059.005\n    - attack.t1059.007\n    - attack.t1218\n    - attack.t1218.001\n    - attack.t1218.010\n    - attack.t1218.011\n    - attack.t1566\n    - attack.t1566.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - OriginalFileName: 'HH.exe'\n        - Image|endswith: '\\hh.exe'\n    selection_paths:\n        CommandLine|contains:\n            - '.application'\n            - '\\AppData\\Local\\Temp\\'\n            - '\\Content.Outlook\\'\n            - '\\Downloads\\'\n            - '\\Users\\Public\\'\n            - '\\Windows\\Temp\\'\n            # - '\\AppData\\Local\\Temp\\Temp?_'\n            # - '\\AppData\\Local\\Temp\\Rar$'\n            # - '\\AppData\\Local\\Temp\\7z'\n            # - '\\AppData\\Local\\Temp\\wz'\n            # - '\\AppData\\Local\\Temp\\peazip-tmp'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"
                    }
                ],
                "splunk_rules": [
                    {
                        "rule_name": "System Processes Run From Unexpected Locations",
                        "rule_link": "https://research.splunk.com/endpoint/a34aae96-ccf8-4aef-952c-3ea21444444d/"
                    },
                    {
                        "rule_name": "Windows System Binary Proxy Execution Compiled HTML File Decompile",
                        "rule_link": "https://research.splunk.com/endpoint/2acf0e19-4149-451c-a3f3-39cd3c77e37d/"
                    }
                ]
            },
            {
                "tech_id": "T1218.001",
                "atomic_attack_guid": "15756147-7470-4a83-87fb-bb5662526247",
                "atomic_attack_name": "Invoke CHM Shortcut Command with ITS and Help Topic",
                "platform": "Windows",
                "splunk_rules": [
                    {
                        "rule_name": "Malicious PowerShell Process - Execution Policy Bypass",
                        "rule_link": "https://research.splunk.com/endpoint/9be56c82-b1cc-4318-87eb-d138afaaca39/"
                    }
                ]
            },
            {
                "tech_id": "T1218.001",
                "atomic_attack_guid": "0f8af516-9818-4172-922b-42986ef1e81d",
                "atomic_attack_name": "Compiled HTML Help Remote Payload",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "HH.EXE Execution",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hh_chm_execution.yml",
                        "remote_content": "title: HH.EXE Execution\nid: 68c8acb4-1b60-4890-8e82-3ddf7a6dba84\nstatus: test\ndescription: Detects the execution of \"hh.exe\" to open \".chm\" files.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.001/T1218.001.md\n    - https://eqllib.readthedocs.io/en/latest/analytics/b25aa548-7937-11e9-8f5c-d46d6d62a49e.html\n    - https://www.zscaler.com/blogs/security-research/unintentional-leak-glimpse-attack-vectors-apt37\nauthor: E.M. Anhaus (originally from Atomic Blue Detections, Dan Beavin), oscd.community\ndate: 2019-10-24\nmodified: 2023-12-11\ntags:\n    - attack.defense-evasion\n    - attack.t1218.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - OriginalFileName: 'HH.exe'\n        - Image|endswith: '\\hh.exe'\n    selection_cli:\n        CommandLine|contains: '.chm'\n    condition: all of selection_*\nfalsepositives:\n    - False positives are expected with legitimate \".CHM\"\nlevel: low\n"
                    },
                    {
                        "rule_name": "Remote CHM File Download/Execution Via HH.EXE",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hh_chm_remote_download_or_execution.yml",
                        "remote_content": "title: Remote CHM File Download/Execution Via HH.EXE\nid: f57c58b3-ee69-4ef5-9041-455bf39aaa89\nstatus: test\ndescription: Detects the usage of \"hh.exe\" to execute/download remotely hosted \".chm\" files.\nreferences:\n    - https://www.splunk.com/en_us/blog/security/follina-for-protocol-handlers.html\n    - https://github.com/redcanaryco/atomic-red-team/blob/1cf4dd51f83dcb0ebe6ade902d6157ad2dbc6ac8/atomics/T1218.001/T1218.001.md\n    - https://www.zscaler.com/blogs/security-research/unintentional-leak-glimpse-attack-vectors-apt37\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-09-29\nmodified: 2024-01-31\ntags:\n    - attack.defense-evasion\n    - attack.t1218.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - OriginalFileName: 'HH.exe'\n        - Image|endswith: '\\hh.exe'\n    selection_cli:\n        CommandLine|contains:\n            - 'http://'\n            - 'https://'\n            - '\\\\\\\\'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"
                    }
                ],
                "splunk_rules": [
                    {
                        "rule_name": "System Processes Run From Unexpected Locations",
                        "rule_link": "https://research.splunk.com/endpoint/a34aae96-ccf8-4aef-952c-3ea21444444d/"
                    },
                    {
                        "rule_name": "Detect HTML Help URL in Command Line",
                        "rule_link": "https://research.splunk.com/endpoint/8c5835b9-39d9-438b-817c-95f14c69a31e/"
                    }
                ]
            },
            {
                "tech_id": "T1218.001",
                "atomic_attack_guid": "5cb87818-0d7c-4469-b7ef-9224107aebe8",
                "atomic_attack_name": "Compiled HTML Help Local Payload",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "HH.EXE Execution",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hh_chm_execution.yml",
                        "remote_content": "title: HH.EXE Execution\nid: 68c8acb4-1b60-4890-8e82-3ddf7a6dba84\nstatus: test\ndescription: Detects the execution of \"hh.exe\" to open \".chm\" files.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.001/T1218.001.md\n    - https://eqllib.readthedocs.io/en/latest/analytics/b25aa548-7937-11e9-8f5c-d46d6d62a49e.html\n    - https://www.zscaler.com/blogs/security-research/unintentional-leak-glimpse-attack-vectors-apt37\nauthor: E.M. Anhaus (originally from Atomic Blue Detections, Dan Beavin), oscd.community\ndate: 2019-10-24\nmodified: 2023-12-11\ntags:\n    - attack.defense-evasion\n    - attack.t1218.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - OriginalFileName: 'HH.exe'\n        - Image|endswith: '\\hh.exe'\n    selection_cli:\n        CommandLine|contains: '.chm'\n    condition: all of selection_*\nfalsepositives:\n    - False positives are expected with legitimate \".CHM\"\nlevel: low\n"
                    }
                ],
                "splunk_rules": [
                    {
                        "rule_name": "System Processes Run From Unexpected Locations",
                        "rule_link": "https://research.splunk.com/endpoint/a34aae96-ccf8-4aef-952c-3ea21444444d/"
                    }
                ]
            }
        ],
        "cycat": {
            "cycat": {
                "cycat_related_uuids": [
                    "f57c58b3-ee69-4ef5-9041-455bf39aaa89",
                    "a6937325-9321-4e2e-bb2b-3ed2d40b2a9d",
                    "468a8cea-2920-4909-a593-0cbe1d96674a",
                    "d4ca7c59-e9e4-42d8-bf57-91a776efcb87",
                    "68c8acb4-1b60-4890-8e82-3ddf7a6dba84",
                    "52cad028-0ff0-4854-8f67-d25dfcbc78b4"
                ],
                "lookup_results": [
                    {
                        "uuid": "f57c58b3-ee69-4ef5-9041-455bf39aaa89",
                        "lookup_data": {
                            "description": "Detects usage of hh.exe to execute/download remotely hosted .chm files.",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/09/29\ndescription: Detects usage of hh.exe to execute/download remotely hosted .chm files.\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains: ' http'\n    Image|endswith: \\hh.exe\nfalsepositives:\n- Unknown\nid: f57c58b3-ee69-4ef5-9041-455bf39aaa89\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://www.splunk.com/en_us/blog/security/follina-for-protocol-handlers.html\n- https://github.com/redcanaryco/atomic-red-team/blob/1cf4dd51f83dcb0ebe6ade902d6157ad2dbc6ac8/atomics/T1218.001/T1218.001.md\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1218.001\ntitle: HH.exe Remote CHM File Execution\n",
                            "sigma:id": "f57c58b3-ee69-4ef5-9041-455bf39aaa89",
                            "title": "HH.exe Remote CHM File Execution",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "a6937325-9321-4e2e-bb2b-3ed2d40b2a9d",
                        "lookup_data": {
                            "mitre-attack-id": "T1218.001",
                            "mitre-cti:description": "Adversaries may abuse Compiled HTML files (.chm) to conceal malicious code. CHM files are commonly distributed as part of the Microsoft HTML Help system. CHM files are compressed compilations of various content such as HTML documents, images, and scripting/web related programming languages such VBA, JScript, Java, and ActiveX. (Citation: Microsoft HTML Help May 2018) CHM content is displayed using underlying components of the Internet Explorer browser (Citation: Microsoft HTML Help ActiveX) loaded by the HTML Help executable program (hh.exe). (Citation: Microsoft HTML Help Executable Program)\n\nA custom CHM file containing embedded payloads could be delivered to a victim then triggered by [User Execution](https://attack.mitre.org/techniques/T1204). CHM execution may also bypass application application control on older and/or unpatched systems that do not account for execution of binaries through hh.exe. (Citation: MsitPros CHM Aug 2017) (Citation: Microsoft CVE-2017-8625 Aug 2017)",
                            "mitre-cti:name": "Compiled HTML File",
                            "mitre-cti:type": "attack-pattern",
                            "raw": "{'x_mitre_platforms': ['Windows'], 'x_mitre_domains': ['enterprise-attack'], 'x_mitre_contributors': ['Rahmat Nurfauzi, @infosecn1nja, PT Xynexis International'], 'object_marking_refs': ['marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168'], 'id': 'attack-pattern--a6937325-9321-4e2e-bb2b-3ed2d40b2a9d', 'type': 'attack-pattern', 'created': '2020-01-23T18:53:54.377Z', 'created_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'external_references': [{'source_name': 'mitre-attack', 'external_id': 'T1218.001', 'url': 'https://attack.mitre.org/techniques/T1218/001'}, {'source_name': 'Microsoft HTML Help May 2018', 'description': 'Microsoft. (2018, May 30). Microsoft HTML Help 1.4. Retrieved October 3, 2018.', 'url': 'https://docs.microsoft.com/previous-versions/windows/desktop/htmlhelp/microsoft-html-help-1-4-sdk'}, {'source_name': 'Microsoft HTML Help ActiveX', 'description': 'Microsoft. (n.d.). HTML Help ActiveX Control Overview. Retrieved October 3, 2018.', 'url': 'https://msdn.microsoft.com/windows/desktop/ms644670'}, {'source_name': 'Microsoft HTML Help Executable Program', 'description': 'Microsoft. (n.d.). About the HTML Help Executable Program. Retrieved October 3, 2018.', 'url': 'https://msdn.microsoft.com/windows/desktop/ms524405'}, {'source_name': 'MsitPros CHM Aug 2017', 'description': 'Moe, O. (2017, August 13). Bypassing Device guard UMCI using CHM â€“ CVE-2017-8625. Retrieved October 3, 2018.', 'url': 'https://msitpros.com/?p=3909'}, {'source_name': 'Microsoft CVE-2017-8625 Aug 2017', 'description': 'Microsoft. (2017, August 8). CVE-2017-8625 - Internet Explorer Security Feature Bypass Vulnerability. Retrieved October 3, 2018.', 'url': 'https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-8625'}], 'modified': '2022-03-11T18:59:36.836Z', 'name': 'Compiled HTML File', 'description': 'Adversaries may abuse Compiled HTML files (.chm) to conceal malicious code. CHM files are commonly distributed as part of the Microsoft HTML Help system. CHM files are compressed compilations of various content such as HTML documents, images, and scripting/web related programming languages such VBA, JScript, Java, and ActiveX. (Citation: Microsoft HTML Help May 2018) CHM content is displayed using underlying components of the Internet Explorer browser (Citation: Microsoft HTML Help ActiveX) loaded by the HTML Help executable program (hh.exe). (Citation: Microsoft HTML Help Executable Program)\\n\\nA custom CHM file containing embedded payloads could be delivered to a victim then triggered by [User Execution](https://attack.mitre.org/techniques/T1204). CHM execution may also bypass application application control on older and/or unpatched systems that do not account for execution of binaries through hh.exe. (Citation: MsitPros CHM Aug 2017) (Citation: Microsoft CVE-2017-8625 Aug 2017)', 'kill_chain_phases': [{'kill_chain_name': 'mitre-attack', 'phase_name': 'defense-evasion'}], 'x_mitre_detection': 'Monitor and analyze the execution and arguments of hh.exe. (Citation: MsitPros CHM Aug 2017) Compare recent invocations of hh.exe with prior history of known good arguments to determine anomalous and potentially adversarial activity (ex: obfuscated and/or malicious commands). Non-standard process execution trees may also indicate suspicious or malicious behavior, such as if hh.exe is the parent process for suspicious processes and activity relating to other adversarial techniques.\\n\\nMonitor presence and use of CHM files, especially if they are not typically used within an environment.', 'x_mitre_is_subtechnique': True, 'x_mitre_version': '2.0', 'x_mitre_modified_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'x_mitre_data_sources': ['File: File Creation', 'Command: Command Execution', 'Process: Process Creation'], 'x_mitre_defense_bypassed': ['Digital Certificate Validation', 'Application control'], 'x_mitre_permissions_required': ['User']}",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "468a8cea-2920-4909-a593-0cbe1d96674a",
                        "lookup_data": {
                            "description": "Detects network connections made by the \"hh.exe\" process, which could indicate the execution/download of remotely hosted .chm files",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/10/05\ndescription: Detects network connections made by the \"hh.exe\" process, which could\n  indicate the execution/download of remotely hosted .chm files\ndetection:\n  condition: selection\n  selection:\n    DestinationPort:\n    - 80\n    - 443\n    - 135\n    - 445\n    Image|endswith: \\hh.exe\n    Initiated: 'true'\nfalsepositives:\n- Unknown\nid: 468a8cea-2920-4909-a593-0cbe1d96674a\nlevel: medium\nlogsource:\n  category: network_connection\n  product: windows\nreferences:\n- https://www.splunk.com/en_us/blog/security/follina-for-protocol-handlers.html\n- https://github.com/redcanaryco/atomic-red-team/blob/1cf4dd51f83dcb0ebe6ade902d6157ad2dbc6ac8/atomics/T1218.001/T1218.001.md\nrelated:\n- id: f57c58b3-ee69-4ef5-9041-455bf39aaa89\n  type: derived\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1218.001\ntitle: HH.EXE Network Connections\n",
                            "sigma:id": "468a8cea-2920-4909-a593-0cbe1d96674a",
                            "title": "HH.EXE Network Connections",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "d4ca7c59-e9e4-42d8-bf57-91a776efcb87",
                        "lookup_data": {
                            "description": "Detects LOLBINs executing from an abnormal drive such as a mounted ISO.",
                            "raw": "author: Christopher Peacock '@securepeacock', SCYTHE '@scythe_io'\ndate: 2022/01/25\ndescription: Detects LOLBINs executing from an abnormal drive such as a mounted ISO.\ndetection:\n  condition: selection and not 1 of filter*\n  filter_currentdirectory:\n  - CurrentDirectory|contains: C:\\\n  - CurrentDirectory: ''\n  filter_null:\n    CurrentDirectory: null\n  selection:\n    Image|endswith:\n    - \\rundll32.exe\n    - \\calc.exe\n    - \\mshta.exe\n    - \\cscript.exe\n    - \\wscript.exe\n    - \\regsvr32.exe\n    - \\installutil.exe\n    - \\cmstp.exe\nfalsepositives:\n- Rare false positives could occur on servers with multiple drives.\nid: d4ca7c59-e9e4-42d8-bf57-91a776efcb87\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2023/01/31\nreferences:\n- https://thedfirreport.com/2021/12/13/diavol-ransomware/\n- https://www.scythe.io/library/threat-emulation-qakbot\nstatus: test\ntags:\n- attack.t1218.001\ntitle: LOLBIN From Abnormal Drive\n",
                            "sigma:id": "d4ca7c59-e9e4-42d8-bf57-91a776efcb87",
                            "title": "LOLBIN From Abnormal Drive",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "68c8acb4-1b60-4890-8e82-3ddf7a6dba84",
                        "lookup_data": {
                            "description": "Identifies usage of hh.exe executing recently modified .chm files.",
                            "raw": "author: E.M. Anhaus (originally from Atomic Blue Detections, Dan Beavin), oscd.community\ndate: 2019/10/24\ndescription: Identifies usage of hh.exe executing recently modified .chm files.\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains: .chm\n    Image|endswith: \\hh.exe\nfalsepositives:\n- Unlikely\nfields:\n- ComputerName\n- User\n- CommandLine\nid: 68c8acb4-1b60-4890-8e82-3ddf7a6dba84\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2021/11/27\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.001/T1218.001.md\n- https://eqllib.readthedocs.io/en/latest/analytics/b25aa548-7937-11e9-8f5c-d46d6d62a49e.html\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1218.001\ntitle: HH.exe Execution\n",
                            "sigma:id": "68c8acb4-1b60-4890-8e82-3ddf7a6dba84",
                            "title": "HH.exe Execution",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "52cad028-0ff0-4854-8f67-d25dfcbc78b4",
                        "lookup_data": {
                            "description": "Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm)",
                            "raw": "author: Maxim Pavlunin\ndate: 2020/04/01\ndescription: Detects a suspicious child process of a Microsoft HTML Help system when\n  executing compiled HTML files (.chm)\ndetection:\n  condition: 1 of selection_*\n  selection_1:\n    Image|endswith:\n    - \\cmd.exe\n    - \\powershell.exe\n    - \\pwsh.exe\n    - \\wscript.exe\n    - \\cscript.exe\n    - \\regsvr32.exe\n    - \\wmic.exe\n    - \\rundll32.exe\n    - \\MSHTA.EXE\n    - \\CertUtil.exe\n    - \\CertReq.exe\n    - \\MSbuild.exe\n    - \\installutil.exe\n    - \\schtasks.exe\n    - \\msiexec.exe\n    ParentImage:\n    - C:\\Windows\\hh.exe\n    - C:\\Windows\\SysWOW64\\hh.exe\n  selection_2:\n    CommandLine|contains:\n    - .application\n    - \\Downloads\\\n    - \\Content.Outlook\\\n    - \\AppData\\Local\\Temp\\\n    Image|endswith:\n    - \\Windows\\hh.exe\n    - \\Windows\\SysWOW64\\hh.exe\nfalsepositives:\n- Unknown\nfields:\n- CommandLine\n- ParentCommandLine\nid: 52cad028-0ff0-4854-8f67-d25dfcbc78b4\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/24\nreferences:\n- https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/\n- https://github.com/elastic/protections-artifacts/commit/746086721fd385d9f5c6647cada1788db4aea95f#diff-27939090904026cc396b0b629c8e4314acd6f5dac40a676edbc87f4567b47eb7\n- https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1218.001\n- attack.t1218.010\n- attack.t1218.011\n- attack.execution\n- attack.t1059.001\n- attack.t1059.003\n- attack.t1059.005\n- attack.t1059.007\n- attack.t1047\n- attack.t1566\n- attack.t1566.001\n- attack.initial_access\n- attack.t1218\ntitle: HTML Help Shell Spawn\n",
                            "sigma:id": "52cad028-0ff0-4854-8f67-d25dfcbc78b4",
                            "title": "HTML Help Shell Spawn",
                            "_cycat_type": "Item"
                        }
                    }
                ]
            }
        },
        "atomics": [
            {
                "attack_technique": "T1218.001",
                "display_name": "Signed Binary Proxy Execution: Compiled HTML File",
                "atomic_tests": [
                    {
                        "name": "Compiled HTML Help Local Payload",
                        "auto_generated_guid": "5cb87818-0d7c-4469-b7ef-9224107aebe8",
                        "description": "Uses hh.exe to execute a local compiled HTML Help payload.\nUpon execution calc.exe will open\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "local_chm_file": {
                                "description": "Local .chm payload",
                                "type": "path",
                                "default": "PathToAtomicsFolder\\T1218.001\\src\\T1218.001.chm"
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "The payload must exist on disk at specified location (#{local_chm_file})\n",
                                "prereq_command": "if (Test-Path \"#{local_chm_file}\") {exit 0} else {exit 1}\n",
                                "get_prereq_command": "New-Item -Type Directory (split-path \"#{local_chm_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.001/src/T1218.001.chm\" -OutFile \"#{local_chm_file}\"\n"
                            }
                        ],
                        "executor": {
                            "command": "hh.exe \"#{local_chm_file}\"\n",
                            "name": "command_prompt"
                        }
                    },
                    {
                        "name": "Compiled HTML Help Remote Payload",
                        "auto_generated_guid": "0f8af516-9818-4172-922b-42986ef1e81d",
                        "description": "Uses hh.exe to execute a remote compiled HTML Help payload.\nUpon execution displays an error saying the file cannot be open\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "remote_chm_file": {
                                "description": "Remote .chm payload",
                                "type": "url",
                                "default": "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1218.001/src/T1218.001.chm"
                            }
                        },
                        "executor": {
                            "command": "hh.exe #{remote_chm_file}\n",
                            "name": "command_prompt"
                        }
                    },
                    {
                        "name": "Invoke CHM with default Shortcut Command Execution",
                        "auto_generated_guid": "29d6f0d7-be63-4482-8827-ea77126c1ef7",
                        "description": "Executes a CHM file with the default Shortcut Command method.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "chm_file_path": {
                                "description": "Default path of CHM",
                                "type": "string",
                                "default": "Test.chm"
                            },
                            "hh_file_path": {
                                "description": "path of modified HH.exe",
                                "type": "path",
                                "default": "$env:windir\\hh.exe"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "The AtomicTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
                                "prereq_command": "$RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
                                "get_prereq_command": "Install-Module -Name AtomicTestHarnesses -Scope CurrentUser -Force\n"
                            }
                        ],
                        "executor": {
                            "command": "Invoke-ATHCompiledHelp -HHFilePath #{hh_file_path} -CHMFilePath #{chm_file_path}",
                            "name": "powershell"
                        }
                    },
                    {
                        "name": "Invoke CHM with InfoTech Storage Protocol Handler",
                        "auto_generated_guid": "b4094750-5fc7-4e8e-af12-b4e36bf5e7f6",
                        "description": "Executes a CHM file with the ITS protocol handler.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "hh_file_path": {
                                "description": "path of modified HH.exe",
                                "type": "path",
                                "default": "$env:windir\\hh.exe"
                            },
                            "infotech_storage_handler": {
                                "description": "Default InfoTech Storage Protocol Handler",
                                "type": "string",
                                "default": "its"
                            },
                            "chm_file_path": {
                                "description": "Default path of CHM",
                                "type": "string",
                                "default": "Test.chm"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "The AtomicTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
                                "prereq_command": "$RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
                                "get_prereq_command": "Install-Module -Name AtomicTestHarnesses -Scope CurrentUser -Force\n"
                            }
                        ],
                        "executor": {
                            "command": "Invoke-ATHCompiledHelp -InfoTechStorageHandler #{infotech_storage_handler} -HHFilePath #{hh_file_path} -CHMFilePath #{chm_file_path}",
                            "name": "powershell"
                        }
                    },
                    {
                        "name": "Invoke CHM Simulate Double click",
                        "auto_generated_guid": "5decef42-92b8-4a93-9eb2-877ddcb9401a",
                        "description": "Executes a CHM file simulating a user double click.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "chm_file_path": {
                                "description": "Default path of CHM",
                                "type": "string",
                                "default": "Test.chm"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "The AtomicTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
                                "prereq_command": "$RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
                                "get_prereq_command": "Install-Module -Name AtomicTestHarnesses -Scope CurrentUser -Force\n"
                            }
                        ],
                        "executor": {
                            "command": "Invoke-ATHCompiledHelp -SimulateUserDoubleClick -CHMFilePath #{chm_file_path}",
                            "name": "powershell"
                        }
                    },
                    {
                        "name": "Invoke CHM with Script Engine and Help Topic",
                        "auto_generated_guid": "4f83adda-f5ec-406d-b318-9773c9ca92e5",
                        "description": "Executes a CHM file with a defined script engine, ITS Protocol Handler, and help topic extension.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "topic_extension": {
                                "description": "Default Help Topic",
                                "type": "string",
                                "default": "html"
                            },
                            "hh_file_path": {
                                "description": "path of modified HH.exe",
                                "type": "path",
                                "default": "$env:windir\\hh.exe"
                            },
                            "infotech_storage_handler": {
                                "description": "Default InfoTech Storage Protocol Handler",
                                "type": "string",
                                "default": "its"
                            },
                            "script_engine": {
                                "description": "Default Script Engine",
                                "type": "string",
                                "default": "JScript"
                            },
                            "chm_file_path": {
                                "description": "Default path of CHM",
                                "type": "string",
                                "default": "Test.chm"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "The AtomicTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
                                "prereq_command": "$RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
                                "get_prereq_command": "Install-Module -Name AtomicTestHarnesses -Scope CurrentUser -Force\n"
                            }
                        ],
                        "executor": {
                            "command": "Invoke-ATHCompiledHelp -ScriptEngine #{script_engine} -InfoTechStorageHandler #{infotech_storage_handler} -TopicExtension #{topic_extension} -HHFilePath #{hh_file_path} -CHMFilePath #{chm_file_path}",
                            "name": "powershell"
                        }
                    },
                    {
                        "name": "Invoke CHM Shortcut Command with ITS and Help Topic",
                        "auto_generated_guid": "15756147-7470-4a83-87fb-bb5662526247",
                        "description": "Executes a CHM file using the Shortcut Command method with a defined ITS Protocol Handler, and help topic extension.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "topic_extension": {
                                "description": "Default Help Topic",
                                "type": "string",
                                "default": "html"
                            },
                            "hh_file_path": {
                                "description": "path of modified HH.exe",
                                "type": "path",
                                "default": "$env:windir\\hh.exe"
                            },
                            "infotech_storage_handler": {
                                "description": "Default InfoTech Storage Protocol Handler",
                                "type": "string",
                                "default": "its"
                            },
                            "chm_file_path": {
                                "description": "Default path of CHM",
                                "type": "string",
                                "default": "Test.chm"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "The AtomicTestHarnesses module must be installed and Invoke-ATHCompiledHelp must be exported in the module.",
                                "prereq_command": "$RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Invoke-ATHCompiledHelp']) {exit 1} else {exit 0}",
                                "get_prereq_command": "Install-Module -Name AtomicTestHarnesses -Scope CurrentUser -Force\n"
                            }
                        ],
                        "executor": {
                            "command": "Invoke-ATHCompiledHelp -ExecuteShortcutCommand -InfoTechStorageHandler #{infotech_storage_handler} -TopicExtension #{topic_extension} -HHFilePath #{hh_file_path} -CHMFilePath #{chm_file_path}",
                            "name": "powershell"
                        }
                    },
                    {
                        "name": "Decompile Local CHM File",
                        "auto_generated_guid": "20cb05e0-1fa5-406d-92c1-84da4ba01813",
                        "description": "Uses hh.exe to decompile a local compiled HTML Help file.\nUpon successful execution the chm file will decompile to disk.\nReference:https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "local_chm_file": {
                                "description": "Local .chm payload",
                                "type": "path",
                                "default": "PathToAtomicsFolder\\T1218.001\\src\\T1218.001.chm"
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "The payload must exist on disk at specified location (#{local_chm_file})\n",
                                "prereq_command": "if (Test-Path \"#{local_chm_file}\") {exit 0} else {exit 1}\n",
                                "get_prereq_command": "New-Item -Type Directory (split-path \"#{local_chm_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.001/src/T1218.001.chm\" -OutFile \"#{local_chm_file}\"\n"
                            }
                        ],
                        "executor": {
                            "command": "hh.exe -decompile %temp% \"#{local_chm_file}\"\n",
                            "cleanup_command": "del %temp%\\T1218.001.html >nul 2>&1\n",
                            "name": "command_prompt"
                        }
                    }
                ]
            }
        ]
    },
    "timestamp": "2025-02-28 14:11:27"
}