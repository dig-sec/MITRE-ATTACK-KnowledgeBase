{
    "id": "T1197",
    "name": "BITS Jobs",
    "description": "Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](T1559.001) (COM).(Citation: Microsoft COM)(Citation: Microsoft BITS) BITS is commonly used by updaters, messengers, and other applications preferred to operate in the background (using available idle bandwidth) without interrupting other networked applications. File transfer tasks are implemented as BITS jobs, which contain a queue of one or more file operations.\nThe interface to create and manage BITS jobs is accessible through [PowerShell](T1059.001) and the [BITSAdmin](S0190) tool.(Citation: Microsoft BITS)(Citation: Microsoft BITSAdmin)\nAdversaries may abuse BITS to download, execute, and even clean up after running malicious code. BITS tasks are self-contained in the BITS job database, without new files or registry modifications, and often permitted by host firewalls.(Citation: CTU BITS Malware June 2016)(Citation: Mondok Windows PiggyBack BITS May 2007)(Citation: Symantec BITS May 2007) BITS enabled execution may also enable persistence by creating long-standing jobs (the default maximum lifetime is 90 days and extendable) or invoking an arbitrary program when a job completes or errors (including after system reboots).(Citation: PaloAlto UBoatRAT Nov 2017)(Citation: CTU BITS Malware June 2016)\nBITS upload functionalities can also be used to perform [Exfiltration Over Alternative Protocol](T1048).(Citation: CTU BITS Malware June 2016)",
    "platforms": "Windows",
    "kill_chain_phases": "Defense Evasion, Persistence",
    "data_sources": "Process: Process Creation, Network Traffic: Network Connection Creation, Service: Service Metadata, Command: Command Execution",
    "detection": "BITS runs as a service and its status can be checked with the Sc query utility (`sc query bits`).(Citation: Microsoft Issues with BITS July 2011) Active BITS tasks can be enumerated using the [BITSAdmin](S0190) tool (`bitsadmin /list /allusers /verbose`).(Citation: Microsoft BITS)\nMonitor usage of the [BITSAdmin](S0190) tool (especially the ‘Transfer’, 'Create', 'AddFile', 'SetNotifyFlags', 'SetNotifyCmdLine', 'SetMinRetryDelay', 'SetCustomHeaders', and 'Resume' command options)(Citation: Microsoft BITS) Admin logs, PowerShell logs, and the Windows Event log for BITS activity.(Citation: Elastic - Hunting for Persistence Part 1) Also consider investigating more detailed information about jobs by parsing the BITS job database.(Citation: CTU BITS Malware June 2016)\nMonitor and analyze network activity generated by BITS. BITS jobs use HTTP(S) and SMB for remote connections and are tethered to the creating user and will only function when that user is logged on (this rule applies even if a user attaches the job to a service account).(Citation: Microsoft BITS)",
    "url": "https://attack.mitre.org/techniques/T1197",
    "enrichments": {
        "attack_rule_map": [
            {
                "tech_id": "T1197",
                "atomic_attack_guid": "afb5e09e-e385-4dee-9a94-6ee60979d114",
                "atomic_attack_name": "Bits download using desktopimgdownldr.exe (cmd)",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Suspicious Desktopimgdownldr Command",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_desktopimgdownldr_susp_execution.yml",
                        "remote_content": "title: Suspicious Desktopimgdownldr Command\nid: bb58aa4a-b80b-415a-a2c0-2f65a4c81009\nstatus: test\ndescription: Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet\nreferences:\n    - https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/\n    - https://twitter.com/SBousseaden/status/1278977301745741825\nauthor: Florian Roth (Nextron Systems)\ndate: 2020-07-03\nmodified: 2021-11-27\ntags:\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection1:\n        CommandLine|contains: ' /lockscreenurl:'\n    selection1_filter:\n        CommandLine|contains:\n            - '.jpg'\n            - '.jpeg'\n            - '.png'\n    selection_reg:\n        CommandLine|contains|all:\n            - 'reg delete'\n            - '\\PersonalizationCSP'\n    condition: ( selection1 and not selection1_filter ) or selection_reg\nfields:\n    - CommandLine\n    - ParentCommandLine\nfalsepositives:\n    - False positives depend on scripts and administrative tools used in the monitored environment\nlevel: high\n"
                    }
                ],
                "splunk_rules": [
                    {
                        "rule_name": "CMD Carry Out String Command Parameter",
                        "rule_link": "https://research.splunk.com/endpoint/54a6ed00-3256-11ec-b031-acde48001122/"
                    }
                ]
            },
            {
                "tech_id": "T1197",
                "atomic_attack_guid": "f63b8bc4-07e5-4112-acba-56f646f3f0bc",
                "atomic_attack_name": "Bitsadmin Download (PowerShell)",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Usage Of Web Request Commands And Cmdlets",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_web_request_cmd_and_cmdlets.yml",
                        "remote_content": "title: Usage Of Web Request Commands And Cmdlets\nid: 9fc51a3c-81b3-4fa7-b35f-7c02cf10fd2d\nrelated:\n    - id: 1139d2e2-84b1-4226-b445-354492eba8ba\n      type: similar\n    - id: f67dbfce-93bc-440d-86ad-a95ae8858c90\n      type: obsolete\n    - id: cd5c8085-4070-4e22-908d-a5b3342deb74\n      type: obsolete\nstatus: test\ndescription: Detects the use of various web request commands with commandline tools and Windows PowerShell cmdlets (including aliases) via CommandLine\nreferences:\n    - https://4sysops.com/archives/use-powershell-to-download-a-file-with-http-https-and-ftp/\n    - https://blog.jourdant.me/post/3-ways-to-download-files-with-powershell\n    - https://learn.microsoft.com/en-us/powershell/module/bitstransfer/add-bitsfile?view=windowsserver2019-ps\nauthor: James Pemberton / @4A616D6573, Endgame, JHasenbusch, oscd.community, Austin Songer @austinsonger\ndate: 2019-10-24\nmodified: 2023-01-10\ntags:\n    - attack.execution\n    - attack.t1059.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection:\n        CommandLine|contains:\n            - '[System.Net.WebRequest]::create'\n            - 'curl '\n            - 'Invoke-RestMethod'\n            - 'Invoke-WebRequest'\n            - 'iwr '\n            - 'Net.WebClient'\n            - 'Resume-BitsTransfer'\n            - 'Start-BitsTransfer'\n            - 'wget '\n            - 'WinHttp.WinHttpRequest'\n    condition: selection\nfalsepositives:\n    - Use of Get-Command and Get-Help modules to reference Invoke-WebRequest and Start-BitsTransfer.\nlevel: medium\n"
                    }
                ],
                "splunk_rules": [
                    {
                        "rule_name": "PowerShell Start-BitsTransfer",
                        "rule_link": "https://research.splunk.com/endpoint/39e2605a-90d8-11eb-899e-acde48001122/"
                    }
                ]
            },
            {
                "tech_id": "T1197",
                "atomic_attack_guid": "3c73d728-75fb-4180-a12f-6712864d7421",
                "atomic_attack_name": "Bitsadmin Download (cmd)",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Suspicious Download From File-Sharing Website Via Bitsadmin",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_bitsadmin_download_file_sharing_domains.yml",
                        "remote_content": "title: Suspicious Download From File-Sharing Website Via Bitsadmin\nid: 8518ed3d-f7c9-4601-a26c-f361a4256a0c\nstatus: experimental\ndescription: Detects usage of bitsadmin downloading a file from a suspicious domain\nreferences:\n    - https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n    - https://isc.sans.edu/diary/22264\n    - https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\n    - https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ransomware-hive-conti-avoslocker\n    - https://www.cisa.gov/uscert/ncas/alerts/aa22-321a\n    - https://www.microsoft.com/en-us/security/blog/2024/01/17/new-ttps-observed-in-mint-sandstorm-campaign-targeting-high-profile-individuals-at-universities-and-research-orgs/\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-06-28\nmodified: 2024-08-22\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.t1197\n    - attack.s0190\n    - attack.t1036.003\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - Image|endswith: '\\bitsadmin.exe'\n        - OriginalFileName: 'bitsadmin.exe'\n    selection_flags:\n        CommandLine|contains:\n            - ' /transfer '\n            - ' /create '\n            - ' /addfile '\n    selection_domain:\n        CommandLine|contains:\n            - '.githubusercontent.com'       # Includes both gists and github repositories / Michael Haag (idea)\n            - 'anonfiles.com'\n            - 'cdn.discordapp.com'\n            - 'ddns.net'\n            - 'dl.dropboxusercontent.com'\n            - 'ghostbin.co'\n            - 'glitch.me'\n            - 'gofile.io'\n            - 'hastebin.com'\n            - 'mediafire.com'\n            - 'mega.nz'\n            - 'onrender.com'\n            - 'pages.dev'\n            - 'paste.ee'\n            - 'pastebin.com'\n            - 'pastebin.pl'\n            - 'pastetext.net'\n            - 'privatlab.com'\n            - 'privatlab.net'\n            - 'send.exploit.in'\n            - 'sendspace.com'\n            - 'storage.googleapis.com'\n            - 'storjshare.io'\n            - 'supabase.co'\n            - 'temp.sh'\n            - 'transfer.sh'\n            - 'trycloudflare.com'\n            - 'ufile.io'\n            - 'w3spaces.com'\n            - 'workers.dev'\n    condition: all of selection_*\nfalsepositives:\n    - Some legitimate apps use this, but limited.\nlevel: high\n"
                    },
                    {
                        "rule_name": "File Download Via Bitsadmin To A Suspicious Target Folder",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_bitsadmin_download_susp_targetfolder.yml",
                        "remote_content": "title: File Download Via Bitsadmin To A Suspicious Target Folder\nid: 2ddef153-167b-4e89-86b6-757a9e65dcac\nstatus: test\ndescription: Detects usage of bitsadmin downloading a file to a suspicious target folder\nreferences:\n    - https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n    - https://isc.sans.edu/diary/22264\n    - https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\n    - https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/\nauthor: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-06-28\nmodified: 2023-05-30\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.t1197\n    - attack.s0190\n    - attack.t1036.003\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - Image|endswith: '\\bitsadmin.exe'\n        - OriginalFileName: 'bitsadmin.exe'\n    selection_flags:\n        CommandLine|contains:\n            - ' /transfer '\n            - ' /create '\n            - ' /addfile '\n    selection_folder:\n        CommandLine|contains:\n            - ':\\Perflogs'\n            - ':\\ProgramData\\'\n            - ':\\Temp\\'\n            - ':\\Users\\Public\\'\n            - ':\\Windows\\'\n            - '\\AppData\\Local\\Temp\\'\n            - '\\AppData\\Roaming\\'\n            - '\\Desktop\\'\n            - '%ProgramData%'\n            - '%public%'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"
                    },
                    {
                        "rule_name": "File Download Via Bitsadmin To An Uncommon Target Folder",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_bitsadmin_download_uncommon_targetfolder.yml",
                        "remote_content": "title: File Download Via Bitsadmin To An Uncommon Target Folder\nid: 6e30c82f-a9f8-4aab-b79c-7c12bce6f248\nstatus: test\ndescription: Detects usage of bitsadmin downloading a file to uncommon target folder\nreferences:\n    - https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n    - https://isc.sans.edu/diary/22264\n    - https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\n    - https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/\nauthor: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-06-28\nmodified: 2023-02-15\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.t1197\n    - attack.s0190\n    - attack.t1036.003\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - Image|endswith: '\\bitsadmin.exe'\n        - OriginalFileName: 'bitsadmin.exe'\n    selection_flags:\n        CommandLine|contains:\n            - ' /transfer '\n            - ' /create '\n            - ' /addfile '\n    selection_folder:\n        CommandLine|contains:\n            - '%AppData%'\n            - '%temp%'\n            - '%tmp%'\n            - '\\AppData\\Local\\'\n            - 'C:\\Windows\\Temp\\'\n    condition: all of selection_*\nfields:\n    - CommandLine\n    - ParentCommandLine\nfalsepositives:\n    - Unknown\nlevel: medium\n"
                    },
                    {
                        "rule_name": "File With Suspicious Extension Downloaded Via Bitsadmin",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_bitsadmin_download_susp_extensions.yml",
                        "remote_content": "title: File With Suspicious Extension Downloaded Via Bitsadmin\nid: 5b80a791-ad9b-4b75-bcc1-ad4e1e89c200\nstatus: test\ndescription: Detects usage of bitsadmin downloading a file with a suspicious extension\nreferences:\n    - https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n    - https://isc.sans.edu/diary/22264\n    - https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\nauthor: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-06-28\nmodified: 2023-05-30\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.t1197\n    - attack.s0190\n    - attack.t1036.003\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_img:\n        - Image|endswith: '\\bitsadmin.exe'\n        - OriginalFileName: 'bitsadmin.exe'\n    selection_flags:\n        CommandLine|contains:\n            - ' /transfer '\n            - ' /create '\n            - ' /addfile '\n    selection_extension:\n        CommandLine|contains:\n            - '.7z'\n            - '.asax'\n            - '.ashx'\n            - '.asmx'\n            - '.asp'\n            - '.aspx'\n            - '.bat'\n            - '.cfm'\n            - '.cgi'\n            - '.chm'\n            - '.cmd'\n            - '.dll'\n            - '.gif'\n            - '.jpeg'\n            - '.jpg'\n            - '.jsp'\n            - '.jspx'\n            - '.log'\n            - '.png'\n            - '.ps1'\n            - '.psm1'\n            - '.rar'\n            - '.scf'\n            - '.sct'\n            - '.txt'\n            - '.vbe'\n            - '.vbs'\n            - '.war'\n            - '.wsf'\n            - '.wsh'\n            - '.xll'\n            - '.zip'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"
                    }
                ],
                "splunk_rules": [
                    {
                        "rule_name": "BITSAdmin Download File",
                        "rule_link": "https://research.splunk.com/endpoint/80630ff4-8e4c-11eb-aab5-acde48001122/"
                    }
                ]
            }
        ],
        "cycat": {
            "cycat": {
                "cycat_related_uuids": [
                    "5d78a50e-ba3c-40b3-a5c1-4fb1950d210f",
                    "90f138c1-f578-4ac3-8c49-eecfd847c8b7",
                    "2ddef153-167b-4e89-86b6-757a9e65dcac",
                    "1ff315dc-2a3a-4b71-8dde-873818d25d39",
                    "99c840f2-2012-46fd-9141-c761987550ef",
                    "b85e5894-9b19-4d86-8c87-a2f3b81f0521",
                    "6e30c82f-a9f8-4aab-b79c-7c12bce6f248",
                    "8ccd35a2-1c7c-468b-b568-ac6cdf80eec3",
                    "6d44fb93-e7d2-475c-9d3d-54c9c1e33427",
                    "d059842b-6b9d-4ed1-b5c3-5b89143c6ede",
                    "9eb68894-7476-4cd6-8752-23b51f5883a7",
                    "d635249d-86b5-4dad-a8c7-d7272b788586",
                    "f67dbfce-93bc-440d-86ad-a95ae8858c90",
                    "8518ed3d-f7c9-4601-a26c-f361a4256a0c",
                    "fe3a2d49-f255-4d10-935c-bda7391108eb",
                    "5b80a791-ad9b-4b75-bcc1-ad4e1e89c200",
                    "5e4886b7-3f14-4ab0-867f-4ea30a0a020f",
                    "cb825b86-3f3b-4686-ba99-44878f5d3173",
                    "c8e87b83-edbb-48d4-9295-4974897525b7",
                    "b9cbbc17-d00d-4e3d-a827-b06d03d2380d",
                    "4bcf0465-4b53-4de4-8c53-fcc5f7d04dfc",
                    "f8a56cb7-a363-44ed-a82f-5926bb44cd05"
                ],
                "lookup_results": [
                    {
                        "uuid": "5d78a50e-ba3c-40b3-a5c1-4fb1950d210f",
                        "lookup_data": {
                            "description": "OSINT - ESET discovered an undocumented backdoor used by the infamous Stealth Falcon group",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5d78a50e-ba3c-40b3-a5c1-4fb1950d210f.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1568193300",
                            "uuid": "5d78a50e-ba3c-40b3-a5c1-4fb1950d210f",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "90f138c1-f578-4ac3-8c49-eecfd847c8b7",
                        "lookup_data": {
                            "description": "Detects a suspicious download using the BITS client from a direct IP. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023/01/11\ndescription: Detects a suspicious download using the BITS client from a direct IP.\n  Adversaries may abuse BITS jobs to persistently execute or clean up after malicious\n  payloads.\ndetection:\n  condition: selection and not 1 of filter_*\n  filter_local_networks:\n    RemoteName|contains:\n    - ://10.\n    - ://192.168.\n    - ://172.16.\n    - ://172.17.\n    - ://172.18.\n    - ://172.19.\n    - ://172.20.\n    - ://172.21.\n    - ://172.22.\n    - ://172.23.\n    - ://172.24.\n    - ://172.25.\n    - ://172.26.\n    - ://172.27.\n    - ://172.28.\n    - ://172.29.\n    - ://172.30.\n    - ://172.31.\n    - ://127.\n    - ://169.254.\n  filter_seven_zip:\n    RemoteName|contains:\n    - https://7-\n    - http://7-\n  selection:\n    EventID: 16403\n    RemoteName|contains:\n    - http://1\n    - http://2\n    - http://3\n    - http://4\n    - http://5\n    - http://6\n    - http://7\n    - http://8\n    - http://9\n    - https://1\n    - https://2\n    - https://3\n    - https://4\n    - https://5\n    - https://6\n    - https://7\n    - https://8\n    - https://9\nfalsepositives:\n- Unknown\nid: 90f138c1-f578-4ac3-8c49-eecfd847c8b7\nlevel: high\nlogsource:\n  product: windows\n  service: bits-client\nreferences:\n- https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n- https://isc.sans.edu/diary/22264\n- https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\n- https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/\nrelated:\n- id: 99c840f2-2012-46fd-9141-c761987550ef\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\ntitle: Suspicious Download with BITS from Direct IP\n",
                            "sigma:id": "90f138c1-f578-4ac3-8c49-eecfd847c8b7",
                            "title": "Suspicious Download with BITS from Direct IP",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "2ddef153-167b-4e89-86b6-757a9e65dcac",
                        "lookup_data": {
                            "description": "Detects usage of bitsadmin downloading a file to a suspicious target folder",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/06/28\ndescription: Detects usage of bitsadmin downloading a file to a suspicious target\n  folder\ndetection:\n  condition: all of selection_*\n  selection_flags:\n    CommandLine|contains:\n    - ' /transfer '\n    - ' /create '\n    - ' /addfile '\n  selection_folder:\n    CommandLine|contains:\n    - C:\\Users\\Public\\\n    - '%public%'\n    - \\Desktop\\\n    - C:\\Temp\n    - C:\\Perflogs\n    - C:\\Windows\\\n  selection_img:\n  - Image|endswith: \\bitsadmin.exe\n  - OriginalFileName: bitsadmin.exe\nfalsepositives:\n- Unknown\nfields:\n- CommandLine\n- ParentCommandLine\nid: 2ddef153-167b-4e89-86b6-757a9e65dcac\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2023/01/31\nreferences:\n- https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n- https://isc.sans.edu/diary/22264\n- https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\n- https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.s0190\n- attack.t1036.003\ntitle: Bitsadmin Download to Suspicious Target Folder\n",
                            "sigma:id": "2ddef153-167b-4e89-86b6-757a9e65dcac",
                            "title": "Bitsadmin Download to Suspicious Target Folder",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "1ff315dc-2a3a-4b71-8dde-873818d25d39",
                        "lookup_data": {
                            "description": "Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.\nWindows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)\n",
                            "raw": "author: frack113\ndate: 2022/03/01\ndescription: 'Adversaries may abuse BITS jobs to persistently execute or clean up\n  after malicious payloads.\n\n  Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous\n  file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)\n\n  '\ndetection:\n  condition: selection\n  selection:\n    EventID: 3\n    processPath|endswith: \\bitsadmin.exe\nfalsepositives:\n- Administrator PowerShell scripts\nid: 1ff315dc-2a3a-4b71-8dde-873818d25d39\nlevel: low\nlogsource:\n  product: windows\n  service: bits-client\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\ntitle: Suspicious Task Added by Bitsadmin\n",
                            "sigma:id": "1ff315dc-2a3a-4b71-8dde-873818d25d39",
                            "title": "Suspicious Task Added by Bitsadmin",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "99c840f2-2012-46fd-9141-c761987550ef",
                        "lookup_data": {
                            "description": "Detects usage of bitsadmin downloading a file using an URL that contains an IP",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/06/28\ndescription: Detects usage of bitsadmin downloading a file using an URL that contains\n  an IP\ndetection:\n  condition: all of selection_* and not filter\n  filter:\n    CommandLine|contains:\n    - https://7-\n    - http://7-\n  selection_extension:\n    CommandLine|contains:\n    - http://1\n    - http://2\n    - http://3\n    - http://4\n    - http://5\n    - http://6\n    - http://7\n    - http://8\n    - http://9\n    - https://1\n    - https://2\n    - https://3\n    - https://4\n    - https://5\n    - https://6\n    - https://7\n    - https://8\n    - https://9\n  selection_flags:\n    CommandLine|contains:\n    - ' /transfer '\n    - ' /create '\n    - ' /addfile '\n  selection_img:\n  - Image|endswith: \\bitsadmin.exe\n  - OriginalFileName: bitsadmin.exe\nfalsepositives:\n- Unknown\nfields:\n- CommandLine\n- ParentCommandLine\nid: 99c840f2-2012-46fd-9141-c761987550ef\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/12/13\nreferences:\n- https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n- https://isc.sans.edu/diary/22264\n- https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\n- https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/\nrelated:\n- id: 90f138c1-f578-4ac3-8c49-eecfd847c8b7\n  type: similar\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.s0190\n- attack.t1036.003\ntitle: Bitsadmin Download File from IP\n",
                            "sigma:id": "99c840f2-2012-46fd-9141-c761987550ef",
                            "title": "Bitsadmin Download File from IP",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "b85e5894-9b19-4d86-8c87-a2f3b81f0521",
                        "lookup_data": {
                            "description": "Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.\nWindows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)\n",
                            "raw": "author: frack113\ndate: 2022/03/01\ndescription: 'Adversaries may abuse BITS jobs to persistently execute or clean up\n  after malicious payloads.\n\n  Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous\n  file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)\n\n  '\ndetection:\n  condition: selection and not filter\n  filter:\n    LocalName|contains: \\AppData\\\n    RemoteName|contains: .com\n  selection:\n    EventID: 16403\n    LocalName|endswith:\n    - .bat\n    - .dll\n    - .exe\n    - .ps1\n    - .vbe\n    - .vbs\nfalsepositives:\n- Administrator PowerShell scripts\nid: b85e5894-9b19-4d86-8c87-a2f3b81f0521\nlevel: medium\nlogsource:\n  product: windows\n  service: bits-client\nmodified: 2023/01/10\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\ntitle: Suspicious Download File Extension with BITS\n",
                            "sigma:id": "b85e5894-9b19-4d86-8c87-a2f3b81f0521",
                            "title": "Suspicious Download File Extension with BITS",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "6e30c82f-a9f8-4aab-b79c-7c12bce6f248",
                        "lookup_data": {
                            "description": "Detects usage of bitsadmin downloading a file to uncommon target folder",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/06/28\ndescription: Detects usage of bitsadmin downloading a file to uncommon target folder\ndetection:\n  condition: all of selection_*\n  selection_flags:\n    CommandLine|contains:\n    - ' /transfer '\n    - ' /create '\n    - ' /addfile '\n  selection_folder:\n    CommandLine|contains:\n    - C:\\Windows\\Temp\\\n    - '%temp%'\n    - '%tmp%'\n    - C:\\ProgramData\\\n    - '%ProgramData%'\n    - \\AppData\\Local\\\n    - '%AppData%'\n  selection_img:\n  - Image|endswith: \\bitsadmin.exe\n  - OriginalFileName: bitsadmin.exe\nfalsepositives:\n- Unknown\nfields:\n- CommandLine\n- ParentCommandLine\nid: 6e30c82f-a9f8-4aab-b79c-7c12bce6f248\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/11/11\nreferences:\n- https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n- https://isc.sans.edu/diary/22264\n- https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\n- https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.s0190\n- attack.t1036.003\ntitle: Bitsadmin Download to Uncommon Target Folder\n",
                            "sigma:id": "6e30c82f-a9f8-4aab-b79c-7c12bce6f248",
                            "title": "Bitsadmin Download to Uncommon Target Folder",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "8ccd35a2-1c7c-468b-b568-ac6cdf80eec3",
                        "lookup_data": {
                            "description": "Detects Bitsadmin connections to IP addresses instead of FQDN names",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/06/10\ndescription: Detects Bitsadmin connections to IP addresses instead of FQDN names\ndetection:\n  condition: selection\n  selection:\n    c-useragent|startswith: Microsoft BITS/\n    cs-host|endswith:\n    - '1'\n    - '2'\n    - '3'\n    - '4'\n    - '5'\n    - '6'\n    - '7'\n    - '8'\n    - '9'\nfalsepositives:\n- Unknown\nid: 8ccd35a2-1c7c-468b-b568-ac6cdf80eec3\nlevel: high\nlogsource:\n  category: proxy\nmodified: 2022/08/24\nstatus: experimental\ntags:\n- attack.command_and_control\n- attack.t1071.001\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.s0190\ntitle: Bitsadmin to Uncommon IP Server Address\n",
                            "sigma:id": "8ccd35a2-1c7c-468b-b568-ac6cdf80eec3",
                            "title": "Bitsadmin to Uncommon IP Server Address",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "6d44fb93-e7d2-475c-9d3d-54c9c1e33427",
                        "lookup_data": {
                            "description": "Detects a suspicious download using the BITS client from a FQDN that is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/06/10\ndescription: Detects a suspicious download using the BITS client from a FQDN that\n  is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up\n  after malicious payloads.\ndetection:\n  condition: selection and not filter\n  filter:\n    RemoteName|contains:\n    - .com\n    - .azureedge.net\n    - .sfx.ms\n    - download.mozilla.org\n  selection:\n    EventID: 16403\nfalsepositives:\n- Other legitimate domains used by software updaters\nid: 6d44fb93-e7d2-475c-9d3d-54c9c1e33427\nlevel: medium\nlogsource:\n  product: windows\n  service: bits-client\nmodified: 2022/11/27\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md\n- https://twitter.com/malmoeb/status/1535142803075960832\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\ntitle: Suspicious Uncommon Download with BITS from Suspicious TLD\n",
                            "sigma:id": "6d44fb93-e7d2-475c-9d3d-54c9c1e33427",
                            "title": "Suspicious Uncommon Download with BITS from Suspicious TLD",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "d059842b-6b9d-4ed1-b5c3-5b89143c6ede",
                        "lookup_data": {
                            "description": "Detects usage of bitsadmin downloading a file",
                            "raw": "author: Michael Haag, FPT.EagleEye\ndate: 2017/03/09\ndescription: Detects usage of bitsadmin downloading a file\ndetection:\n  condition: (selection1 and susp_flag_2 and http_flag) or (selection1 and susp_flag_1)\n    or selection2\n  http_flag:\n    CommandLine|contains: http\n  selection1:\n  - Image|endswith: \\bitsadmin.exe\n  - OriginalFileName: bitsadmin.exe\n  selection2:\n    CommandLine|contains: copy bitsadmin.exe\n  susp_flag_1:\n    CommandLine|contains: ' /transfer '\n  susp_flag_2:\n    CommandLine|contains:\n    - ' /create '\n    - ' /addfile '\nfalsepositives:\n- Some legitimate apps use this, but limited.\nfields:\n- CommandLine\n- ParentCommandLine\nid: d059842b-6b9d-4ed1-b5c3-5b89143c6ede\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/11/11\nreferences:\n- https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n- https://isc.sans.edu/diary/22264\n- https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.s0190\n- attack.t1036.003\ntitle: Bitsadmin Download\n",
                            "sigma:id": "d059842b-6b9d-4ed1-b5c3-5b89143c6ede",
                            "title": "Bitsadmin Download",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "9eb68894-7476-4cd6-8752-23b51f5883a7",
                        "lookup_data": {
                            "description": "Detects Bitsadmin connections to domains with uncommon TLDs",
                            "raw": "author: Florian Roth (Nextron Systems), Tim Shelton\ndate: 2019/03/07\ndescription: Detects Bitsadmin connections to domains with uncommon TLDs\ndetection:\n  condition: selection and not falsepositives\n  falsepositives:\n    r-dns|endswith:\n    - .com\n    - .net\n    - .org\n    - .scdn.co\n    - .sfx.ms\n  selection:\n    c-useragent|startswith: Microsoft BITS/\nfalsepositives:\n- Rare programs that use Bitsadmin and update from regional TLDs e.g. .uk or .ca\nfields:\n- ClientIP\n- c-uri\n- c-useragent\nid: 9eb68894-7476-4cd6-8752-23b51f5883a7\nlevel: high\nlogsource:\n  category: proxy\nmodified: 2022/08/16\nreferences:\n- https://twitter.com/jhencinski/status/1102695118455349248\n- https://isc.sans.edu/forums/diary/Investigating+Microsoft+BITS+Activity/23281/\nstatus: experimental\ntags:\n- attack.command_and_control\n- attack.t1071.001\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.s0190\ntitle: Bitsadmin to Uncommon TLD\n",
                            "sigma:id": "9eb68894-7476-4cd6-8752-23b51f5883a7",
                            "title": "Bitsadmin to Uncommon TLD",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "d635249d-86b5-4dad-a8c7-d7272b788586",
                        "lookup_data": {
                            "description": "Detects a suspicious download using the BITS client from a FQDN that is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/06/28\ndescription: Detects a suspicious download using the BITS client from a FQDN that\n  is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up\n  after malicious payloads.\ndetection:\n  condition: selection\n  selection:\n    EventID: 16403\n    RemoteName|contains:\n    - raw.githubusercontent.com\n    - gist.githubusercontent.com\n    - pastebin.com\n    - cdn.discordapp.com/attachments/\n    - mediafire.com\n    - mega.nz\n    - ddns.net\n    - .paste.ee\n    - .hastebin.com\n    - .ghostbin.co/\n    - ufile.io\n    - storage.googleapis.com\n    - anonfiles.com\n    - send.exploit.in\n    - transfer.sh\n    - privatlab.net\n    - privatlab.com\n    - sendspace.com\n    - pastetext.net\n    - pastebin.pl\n    - paste.ee\nfalsepositives:\n- Unknown\nid: d635249d-86b5-4dad-a8c7-d7272b788586\nlevel: high\nlogsource:\n  product: windows\n  service: bits-client\nmodified: 2023/01/19\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md\n- https://twitter.com/malmoeb/status/1535142803075960832\n- https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ransomware-hive-conti-avoslocker\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\ntitle: Suspicious Download with BITS from Suspicious TLD\n",
                            "sigma:id": "d635249d-86b5-4dad-a8c7-d7272b788586",
                            "title": "Suspicious Download with BITS from Suspicious TLD",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f67dbfce-93bc-440d-86ad-a95ae8858c90",
                        "lookup_data": {
                            "description": "Detect download by BITS jobs via PowerShell",
                            "raw": "author: Endgame, JHasenbusch (ported to sigma for oscd.community)\ndate: 2018/10/30\ndescription: Detect download by BITS jobs via PowerShell\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains: Start-BitsTransfer\n    Image|endswith: \\powershell.exe\nfalsepositives:\n- Unknown\nfields:\n- ComputerName\n- User\n- CommandLine\nid: f67dbfce-93bc-440d-86ad-a95ae8858c90\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2019/11/11\nreferences:\n- https://eqllib.readthedocs.io/en/latest/analytics/ec5180c9-721a-460f-bddc-27539a284273.html\n- https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\ntitle: Suspicious Bitsadmin Job via PowerShell\n",
                            "sigma:id": "f67dbfce-93bc-440d-86ad-a95ae8858c90",
                            "title": "Suspicious Bitsadmin Job via PowerShell",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "8518ed3d-f7c9-4601-a26c-f361a4256a0c",
                        "lookup_data": {
                            "description": "Detects usage of bitsadmin downloading a file from a suspicious domain",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/06/28\ndescription: Detects usage of bitsadmin downloading a file from a suspicious domain\ndetection:\n  condition: all of selection_*\n  selection_domain:\n    CommandLine|contains:\n    - raw.githubusercontent.com\n    - gist.githubusercontent.com\n    - pastebin.com\n    - cdn.discordapp.com/attachments/\n    - mediafire.com\n    - mega.nz\n    - ddns.net\n    - .paste.ee\n    - .hastebin.com\n    - .ghostbin.co/\n    - ufile.io\n    - storage.googleapis.com\n    - anonfiles.com\n    - send.exploit.in\n    - transfer.sh\n    - privatlab.net\n    - privatlab.com\n    - sendspace.com\n    - pastetext.net\n    - pastebin.pl\n    - paste.ee\n  selection_flags:\n    CommandLine|contains:\n    - ' /transfer '\n    - ' /create '\n    - ' /addfile '\n  selection_img:\n  - Image|endswith: \\bitsadmin.exe\n  - OriginalFileName: bitsadmin.exe\nfalsepositives:\n- Some legitimate apps use this, but limited.\nfields:\n- CommandLine\n- ParentCommandLine\nid: 8518ed3d-f7c9-4601-a26c-f361a4256a0c\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2023/01/19\nreferences:\n- https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n- https://isc.sans.edu/diary/22264\n- https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\n- https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ransomware-hive-conti-avoslocker\n- https://www.cisa.gov/uscert/ncas/alerts/aa22-321a\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.s0190\n- attack.t1036.003\ntitle: Bitsadmin Download from Suspicious Domain\n",
                            "sigma:id": "8518ed3d-f7c9-4601-a26c-f361a4256a0c",
                            "title": "Bitsadmin Download from Suspicious Domain",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "fe3a2d49-f255-4d10-935c-bda7391108eb",
                        "lookup_data": {
                            "description": "Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.\nWindows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)\n",
                            "raw": "author: frack113\ndate: 2022/03/01\ndescription: 'Adversaries may abuse BITS jobs to persistently execute or clean up\n  after malicious payloads.\n\n  Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous\n  file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)\n\n  '\ndetection:\n  condition: selection\n  selection:\n    EventID: 3\n    processPath|endswith:\n    - \\powershell.exe\n    - \\pwsh.exe\nfalsepositives:\n- Administrator PowerShell scripts\nid: fe3a2d49-f255-4d10-935c-bda7391108eb\nlevel: low\nlogsource:\n  product: windows\n  service: bits-client\nmodified: 2022/07/14\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\ntitle: Suspicious Task Added by Powershell\n",
                            "sigma:id": "fe3a2d49-f255-4d10-935c-bda7391108eb",
                            "title": "Suspicious Task Added by Powershell",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5b80a791-ad9b-4b75-bcc1-ad4e1e89c200",
                        "lookup_data": {
                            "description": "Detects usage of bitsadmin downloading a file with a suspicious extension",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/06/28\ndescription: Detects usage of bitsadmin downloading a file with a suspicious extension\ndetection:\n  condition: all of selection_*\n  selection_extension:\n    CommandLine|contains:\n    - .asax\n    - .ashx\n    - .asmx\n    - .asp\n    - .aspx\n    - .bat\n    - .cfm\n    - .cgi\n    - .chm\n    - .cmd\n    - .gif\n    - .jpeg\n    - .jpg\n    - .jsp\n    - .jspx\n    - .png\n    - .ps1\n    - .psm1\n    - .scf\n    - .sct\n    - .txt\n    - .vbe\n    - .vbs\n    - .war\n    - .wsf\n    - .wsh\n    - .zip\n    - .rar\n    - .dll\n  selection_flags:\n    CommandLine|contains:\n    - ' /transfer '\n    - ' /create '\n    - ' /addfile '\n  selection_img:\n  - Image|endswith: \\bitsadmin.exe\n  - OriginalFileName: bitsadmin.exe\nfalsepositives:\n- Unknown\nfields:\n- CommandLine\n- ParentCommandLine\nid: 5b80a791-ad9b-4b75-bcc1-ad4e1e89c200\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/11/11\nreferences:\n- https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin\n- https://isc.sans.edu/diary/22264\n- https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.s0190\n- attack.t1036.003\ntitle: Bitsadmin Download File with Suspicious Extension\n",
                            "sigma:id": "5b80a791-ad9b-4b75-bcc1-ad4e1e89c200",
                            "title": "Bitsadmin Download File with Suspicious Extension",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5e4886b7-3f14-4ab0-867f-4ea30a0a020f",
                        "lookup_data": {
                            "description": "IRS Doc Malware",
                            "link": "https://www.circl.lu/doc/misp/feed-osint/5e4886b7-3f14-4ab0-867f-4ea30a0a020f.json",
                            "misp:feed": "https://www.circl.lu/doc/misp/feed-osint",
                            "timestamp": "1621850643",
                            "uuid": "5e4886b7-3f14-4ab0-867f-4ea30a0a020f",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "cb825b86-3f3b-4686-ba99-44878f5d3173",
                        "lookup_data": {
                            "mitre-attack-id": "T1197",
                            "mitre-cti:description": "This type of attack technique cannot be easily mitigated with preventive controls since it is based on the abuse of operating system design features. For example, disabling all BITS functionality will likely have unintended side effects, such as preventing legitimate software patching and updating. Efforts should be focused on preventing adversary tools from running earlier in the chain of activity and on identification of subsequent malicious behavior. (Citation: Mondok Windows PiggyBack BITS May 2007)\n\nModify network and/or host firewall rules, as well as other network controls, to only allow legitimate BITS traffic.\n\nConsider limiting access to the BITS interface to specific users or groups. (Citation: Symantec BITS May 2007)\n\nConsider reducing the default BITS job lifetime in Group Policy or by editing the <code>JobInactivityTimeout</code> and <code>MaxDownloadTime</code> Registry values in <code> HKEY_LOCAL_MACHINE\\Software\\Policies\\Microsoft\\Windows\\BITS</code>. (Citation: Microsoft BITS)",
                            "mitre-cti:name": "BITS Jobs Mitigation",
                            "mitre-cti:type": "course-of-action",
                            "raw": "{'x_mitre_domains': ['enterprise-attack'], 'object_marking_refs': ['marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168'], 'id': 'course-of-action--cb825b86-3f3b-4686-ba99-44878f5d3173', 'type': 'course-of-action', 'created': '2018-10-17T00:14:20.652Z', 'created_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'external_references': [{'source_name': 'mitre-attack', 'url': 'https://attack.mitre.org/mitigations/T1197', 'external_id': 'T1197'}, {'source_name': 'Mondok Windows PiggyBack BITS May 2007', 'description': 'Mondok, M. (2007, May 11). Malware piggybacks on Windows’ Background Intelligent Transfer Service. Retrieved January 12, 2018.', 'url': 'https://arstechnica.com/information-technology/2007/05/malware-piggybacks-on-windows-background-intelligent-transfer-service/'}, {'source_name': 'Symantec BITS May 2007', 'description': 'Florio, E. (2007, May 9). Malware Update with Windows Update. Retrieved January 12, 2018.', 'url': 'https://www.symantec.com/connect/blogs/malware-update-windows-update'}, {'source_name': 'Microsoft BITS', 'description': 'Microsoft. (n.d.). Background Intelligent Transfer Service. Retrieved January 12, 2018.', 'url': 'https://msdn.microsoft.com/library/windows/desktop/bb968799.aspx'}], 'modified': '2019-07-24T14:08:16.317Z', 'name': 'BITS Jobs Mitigation', 'description': 'This type of attack technique cannot be easily mitigated with preventive controls since it is based on the abuse of operating system design features. For example, disabling all BITS functionality will likely have unintended side effects, such as preventing legitimate software patching and updating. Efforts should be focused on preventing adversary tools from running earlier in the chain of activity and on identification of subsequent malicious behavior. (Citation: Mondok Windows PiggyBack BITS May 2007)\\n\\nModify network and/or host firewall rules, as well as other network controls, to only allow legitimate BITS traffic.\\n\\nConsider limiting access to the BITS interface to specific users or groups. (Citation: Symantec BITS May 2007)\\n\\nConsider reducing the default BITS job lifetime in Group Policy or by editing the <code>JobInactivityTimeout</code> and <code>MaxDownloadTime</code> Registry values in <code> HKEY_LOCAL_MACHINE\\\\Software\\\\Policies\\\\Microsoft\\\\Windows\\\\BITS</code>. (Citation: Microsoft BITS)', 'x_mitre_deprecated': True, 'x_mitre_version': '1.0', 'x_mitre_modified_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5'}",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "c8e87b83-edbb-48d4-9295-4974897525b7",
                        "lookup_data": {
                            "mitre-attack-id": "T1197",
                            "mitre-cti:description": "Adversaries may abuse BITS jobs to persistently execute code and perform various background tasks. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001) (COM).(Citation: Microsoft COM)(Citation: Microsoft BITS) BITS is commonly used by updaters, messengers, and other applications preferred to operate in the background (using available idle bandwidth) without interrupting other networked applications. File transfer tasks are implemented as BITS jobs, which contain a queue of one or more file operations.\n\nThe interface to create and manage BITS jobs is accessible through [PowerShell](https://attack.mitre.org/techniques/T1059/001) and the [BITSAdmin](https://attack.mitre.org/software/S0190) tool.(Citation: Microsoft BITS)(Citation: Microsoft BITSAdmin)\n\nAdversaries may abuse BITS to download (e.g. [Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105)), execute, and even clean up after running malicious code (e.g. [Indicator Removal](https://attack.mitre.org/techniques/T1070)). BITS tasks are self-contained in the BITS job database, without new files or registry modifications, and often permitted by host firewalls.(Citation: CTU BITS Malware June 2016)(Citation: Mondok Windows PiggyBack BITS May 2007)(Citation: Symantec BITS May 2007) BITS enabled execution may also enable persistence by creating long-standing jobs (the default maximum lifetime is 90 days and extendable) or invoking an arbitrary program when a job completes or errors (including after system reboots).(Citation: PaloAlto UBoatRAT Nov 2017)(Citation: CTU BITS Malware June 2016)\n\nBITS upload functionalities can also be used to perform [Exfiltration Over Alternative Protocol](https://attack.mitre.org/techniques/T1048).(Citation: CTU BITS Malware June 2016)",
                            "mitre-cti:name": "BITS Jobs",
                            "mitre-cti:type": "attack-pattern",
                            "raw": "{'modified': '2022-09-14T19:21:26.447Z', 'name': 'BITS Jobs', 'description': 'Adversaries may abuse BITS jobs to persistently execute code and perform various background tasks. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001) (COM).(Citation: Microsoft COM)(Citation: Microsoft BITS) BITS is commonly used by updaters, messengers, and other applications preferred to operate in the background (using available idle bandwidth) without interrupting other networked applications. File transfer tasks are implemented as BITS jobs, which contain a queue of one or more file operations.\\n\\nThe interface to create and manage BITS jobs is accessible through [PowerShell](https://attack.mitre.org/techniques/T1059/001) and the [BITSAdmin](https://attack.mitre.org/software/S0190) tool.(Citation: Microsoft BITS)(Citation: Microsoft BITSAdmin)\\n\\nAdversaries may abuse BITS to download (e.g. [Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105)), execute, and even clean up after running malicious code (e.g. [Indicator Removal](https://attack.mitre.org/techniques/T1070)). BITS tasks are self-contained in the BITS job database, without new files or registry modifications, and often permitted by host firewalls.(Citation: CTU BITS Malware June 2016)(Citation: Mondok Windows PiggyBack BITS May 2007)(Citation: Symantec BITS May 2007) BITS enabled execution may also enable persistence by creating long-standing jobs (the default maximum lifetime is 90 days and extendable) or invoking an arbitrary program when a job completes or errors (including after system reboots).(Citation: PaloAlto UBoatRAT Nov 2017)(Citation: CTU BITS Malware June 2016)\\n\\nBITS upload functionalities can also be used to perform [Exfiltration Over Alternative Protocol](https://attack.mitre.org/techniques/T1048).(Citation: CTU BITS Malware June 2016)', 'kill_chain_phases': [{'kill_chain_name': 'mitre-attack', 'phase_name': 'defense-evasion'}, {'kill_chain_name': 'mitre-attack', 'phase_name': 'persistence'}], 'x_mitre_detection': \"BITS runs as a service and its status can be checked with the Sc query utility (<code>sc query bits</code>).(Citation: Microsoft Issues with BITS July 2011) Active BITS tasks can be enumerated using the [BITSAdmin](https://attack.mitre.org/software/S0190) tool (<code>bitsadmin /list /allusers /verbose</code>).(Citation: Microsoft BITS)\\n\\nMonitor usage of the [BITSAdmin](https://attack.mitre.org/software/S0190) tool (especially the ‘Transfer’, 'Create', 'AddFile', 'SetNotifyFlags', 'SetNotifyCmdLine', 'SetMinRetryDelay', 'SetCustomHeaders', and 'Resume' command options)(Citation: Microsoft BITS) Admin logs, PowerShell logs, and the Windows Event log for BITS activity.(Citation: Elastic - Hunting for Persistence Part 1) Also consider investigating more detailed information about jobs by parsing the BITS job database.(Citation: CTU BITS Malware June 2016)\\n\\nMonitor and analyze network activity generated by BITS. BITS jobs use HTTP(S) and SMB for remote connections and are tethered to the creating user and will only function when that user is logged on (this rule applies even if a user attaches the job to a service account).(Citation: Microsoft BITS)\", 'x_mitre_platforms': ['Windows'], 'x_mitre_is_subtechnique': False, 'x_mitre_deprecated': False, 'x_mitre_domains': ['enterprise-attack'], 'x_mitre_version': '1.3', 'x_mitre_contributors': ['Brent Murphy, Elastic', 'David French, Elastic', 'Ricardo Dias', 'Red Canary'], 'x_mitre_data_sources': ['Process: Process Creation', 'Service: Service Metadata', 'Network Traffic: Network Connection Creation', 'Command: Command Execution'], 'x_mitre_defense_bypassed': ['Firewall', 'Host forensic analysis'], 'type': 'attack-pattern', 'id': 'attack-pattern--c8e87b83-edbb-48d4-9295-4974897525b7', 'created': '2018-04-18T17:59:24.739Z', 'created_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'revoked': False, 'external_references': [{'source_name': 'mitre-attack', 'url': 'https://attack.mitre.org/techniques/T1197', 'external_id': 'T1197'}, {'source_name': 'CTU BITS Malware June 2016', 'description': 'Counter Threat Unit Research Team. (2016, June 6). Malware Lingers with BITS. Retrieved January 12, 2018.', 'url': 'https://www.secureworks.com/blog/malware-lingers-with-bits'}, {'source_name': 'Symantec BITS May 2007', 'description': 'Florio, E. (2007, May 9). Malware Update with Windows Update. Retrieved January 12, 2018.', 'url': 'https://www.symantec.com/connect/blogs/malware-update-windows-update'}, {'source_name': 'Elastic - Hunting for Persistence Part 1', 'description': 'French, D., Murphy, B. (2020, March 24). Adversary tradecraft 101: Hunting for persistence using Elastic Security (Part 1). Retrieved December 21, 2020.', 'url': 'https://www.elastic.co/blog/hunting-for-persistence-using-elastic-security-part-1'}, {'source_name': 'PaloAlto UBoatRAT Nov 2017', 'description': 'Hayashi, K. (2017, November 28). UBoatRAT Navigates East Asia. Retrieved January 12, 2018.', 'url': 'https://researchcenter.paloaltonetworks.com/2017/11/unit42-uboatrat-navigates-east-asia/'}, {'source_name': 'Microsoft Issues with BITS July 2011', 'description': 'Microsoft. (2011, July 19). Issues with BITS. Retrieved January 12, 2018.', 'url': 'https://technet.microsoft.com/library/dd939934.aspx'}, {'source_name': 'Microsoft BITS', 'description': 'Microsoft. (n.d.). Background Intelligent Transfer Service. Retrieved January 12, 2018.', 'url': 'https://msdn.microsoft.com/library/windows/desktop/bb968799.aspx'}, {'source_name': 'Microsoft BITSAdmin', 'description': 'Microsoft. (n.d.). BITSAdmin Tool. Retrieved January 12, 2018.', 'url': 'https://msdn.microsoft.com/library/aa362813.aspx'}, {'source_name': 'Microsoft COM', 'description': 'Microsoft. (n.d.). Component Object Model (COM). Retrieved November 22, 2017.', 'url': 'https://msdn.microsoft.com/library/windows/desktop/ms680573.aspx'}, {'source_name': 'Mondok Windows PiggyBack BITS May 2007', 'description': 'Mondok, M. (2007, May 11). Malware piggybacks on Windows’ Background Intelligent Transfer Service. Retrieved January 12, 2018.', 'url': 'https://arstechnica.com/information-technology/2007/05/malware-piggybacks-on-windows-background-intelligent-transfer-service/'}], 'object_marking_refs': ['marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168'], 'x_mitre_attack_spec_version': '2.1.0', 'x_mitre_modified_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5'}",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "b9cbbc17-d00d-4e3d-a827-b06d03d2380d",
                        "lookup_data": {
                            "description": "BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished. When the job runs on the system the command specified in the BITS job will be executed. This can be abused by actors to create a backdoor within the system and for persistence. It will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded",
                            "raw": "author: Sreeman\ndate: 2020/10/29\ndescription: BITS will allow you to schedule a command to execute after a successful\n  download to notify you that the job is finished. When the job runs on the system\n  the command specified in the BITS job will be executed. This can be abused by actors\n  to create a backdoor within the system and for persistence. It will be chained in\n  a BITS job to schedule the download of malware/additional binaries and execute the\n  program after being downloaded\ndetection:\n  condition: 1 of selection_*\n  selection_1:\n    CommandLine|contains:\n    - '%COMSPEC%'\n    - cmd.exe\n    - regsvr32.exe\n    CommandLine|contains|all:\n    - bitsadmin\n    - /SetNotifyCmdLine\n  selection_2:\n    CommandLine|contains:\n    - 'http:'\n    - 'https:'\n    - 'ftp:'\n    - 'ftps:'\n    CommandLine|contains|all:\n    - bitsadmin\n    - /Addfile\nfalsepositives:\n- Unknown\nfields:\n- CommandLine\nid: b9cbbc17-d00d-4e3d-a827-b06d03d2380d\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/03/07\nreferences:\n- https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html\n- http://0xthem.blogspot.com/2014/03/t-emporal-persistence-with-and-schtasks.html\n- https://isc.sans.edu/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Mechanism+-+Part+1/15394\nstatus: test\ntags:\n- attack.defense_evasion\n- attack.t1197\ntitle: Monitoring For Persistence Via BITS\n",
                            "sigma:id": "b9cbbc17-d00d-4e3d-a827-b06d03d2380d",
                            "title": "Monitoring For Persistence Via BITS",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4bcf0465-4b53-4de4-8c53-fcc5f7d04dfc",
                        "lookup_data": {
                            "description": "Unwrapping Ursnifs Gifts - The DFIR Report",
                            "link": "http://www.botvrij.eu/data/feed-osint/4bcf0465-4b53-4de4-8c53-fcc5f7d04dfc.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1674763285",
                            "uuid": "4bcf0465-4b53-4de4-8c53-fcc5f7d04dfc",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "f8a56cb7-a363-44ed-a82f-5926bb44cd05",
                        "lookup_data": {
                            "description": "Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.\nWindows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)\n",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/06/28\ndescription: 'Adversaries may abuse BITS jobs to persistently execute or clean up\n  after malicious payloads.\n\n  Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous\n  file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)\n\n  '\ndetection:\n  condition: selection\n  selection:\n    EventID: 16403\n    LocalName|contains:\n    - C:\\Users\\Public\\\n    - '%public%'\n    - \\Desktop\\\n    - C:\\PerfLogs\\\nfalsepositives:\n- Administrator PowerShell scripts\nid: f8a56cb7-a363-44ed-a82f-5926bb44cd05\nlevel: high\nlogsource:\n  product: windows\n  service: bits-client\nmodified: 2023/01/10\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md\nstatus: experimental\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\ntitle: Download with BITS to Suspicious Folder\n",
                            "sigma:id": "f8a56cb7-a363-44ed-a82f-5926bb44cd05",
                            "title": "Download with BITS to Suspicious Folder",
                            "_cycat_type": "Item"
                        }
                    }
                ]
            }
        },
        "atomics": [
            {
                "attack_technique": "T1197",
                "display_name": "BITS Jobs",
                "atomic_tests": [
                    {
                        "name": "Bitsadmin Download (cmd)",
                        "auto_generated_guid": "3c73d728-75fb-4180-a12f-6712864d7421",
                        "description": "This test simulates an adversary leveraging bitsadmin.exe to download\nand execute a payload\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "remote_file": {
                                "description": "Remote file to download",
                                "type": "url",
                                "default": "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1197/T1197.md"
                            },
                            "local_file": {
                                "description": "Local file path to save downloaded file",
                                "type": "path",
                                "default": "%temp%\\bitsadmin1_flag.ps1"
                            }
                        },
                        "executor": {
                            "command": "bitsadmin.exe /transfer /Download /priority Foreground #{remote_file} #{local_file}\n",
                            "cleanup_command": "del #{local_file} >nul 2>&1\n",
                            "name": "command_prompt"
                        }
                    },
                    {
                        "name": "Bitsadmin Download (PowerShell)",
                        "auto_generated_guid": "f63b8bc4-07e5-4112-acba-56f646f3f0bc",
                        "description": "This test simulates an adversary leveraging bitsadmin.exe to download\nand execute a payload leveraging PowerShell\n\nUpon execution you will find a github markdown file downloaded to the Temp directory\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "remote_file": {
                                "description": "Remote file to download",
                                "type": "url",
                                "default": "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1197/T1197.md"
                            },
                            "local_file": {
                                "description": "Local file path to save downloaded file",
                                "type": "path",
                                "default": "$env:TEMP\\bitsadmin2_flag.ps1"
                            }
                        },
                        "executor": {
                            "command": "Start-BitsTransfer -Priority foreground -Source #{remote_file} -Destination #{local_file}\n",
                            "cleanup_command": "Remove-Item #{local_file} -ErrorAction Ignore\n",
                            "name": "powershell"
                        }
                    },
                    {
                        "name": "Persist, Download, & Execute",
                        "auto_generated_guid": "62a06ec5-5754-47d2-bcfc-123d8314c6ae",
                        "description": "This test simulates an adversary leveraging bitsadmin.exe to schedule a BITS transferand execute a payload in multiple steps.\nNote that in this test, the file executed is not the one downloaded. The downloading of a random file is simply the trigger for getting bitsdamin to run an executable.\nThis has the interesting side effect of causing the executable (e.g. notepad) to run with an Initiating Process of \"svchost.exe\" and an Initiating Process Command Line of \"svchost.exe -k netsvcs -p -s BITS\"\nThis job will remain in the BITS queue until complete or for up to 90 days by default if not removed.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "command_path": {
                                "description": "Path of command to execute",
                                "type": "path",
                                "default": "C:\\Windows\\system32\\notepad.exe"
                            },
                            "bits_job_name": {
                                "description": "Name of BITS job",
                                "type": "string",
                                "default": "AtomicBITS"
                            },
                            "local_file": {
                                "description": "Local file path to save downloaded file",
                                "type": "path",
                                "default": "%temp%\\bitsadmin3_flag.ps1"
                            },
                            "remote_file": {
                                "description": "Remote file to download",
                                "type": "url",
                                "default": "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1197/T1197.md"
                            }
                        },
                        "executor": {
                            "command": "bitsadmin.exe /create #{bits_job_name}\nbitsadmin.exe /addfile #{bits_job_name} #{remote_file} #{local_file}\nbitsadmin.exe /setnotifycmdline #{bits_job_name} #{command_path} NULL\nbitsadmin.exe /resume #{bits_job_name}\nping -n 5 127.0.0.1 >nul 2>&1\nbitsadmin.exe /complete #{bits_job_name}\n",
                            "cleanup_command": "del #{local_file} >nul 2>&1\n",
                            "name": "command_prompt"
                        }
                    },
                    {
                        "name": "Bits download using desktopimgdownldr.exe (cmd)",
                        "auto_generated_guid": "afb5e09e-e385-4dee-9a94-6ee60979d114",
                        "description": "This test simulates using desktopimgdownldr.exe to download a malicious file\ninstead of a desktop or lockscreen background img. The process that actually makes \nthe TCP connection and creates the file on the disk is a svchost process (“-k netsvc -p -s BITS”) \nand not desktopimgdownldr.exe. See https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "remote_file": {
                                "description": "Remote file to download",
                                "type": "url",
                                "default": "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1197/T1197.md"
                            },
                            "download_path": {
                                "description": "Local file path to save downloaded file",
                                "type": "path",
                                "default": "SYSTEMROOT=C:\\Windows\\Temp"
                            },
                            "cleanup_path": {
                                "description": "path to delete file as part of cleanup_command",
                                "type": "path",
                                "default": "C:\\Windows\\Temp\\Personalization\\LockScreenImage"
                            },
                            "cleanup_file": {
                                "description": "file to remove as part of cleanup_command",
                                "type": "string",
                                "default": "*.md"
                            }
                        },
                        "executor": {
                            "command": "set \"#{download_path}\" && cmd /c desktopimgdownldr.exe /lockscreenurl:#{remote_file} /eventName:desktopimgdownldr\n",
                            "cleanup_command": "del #{cleanup_path}\\#{cleanup_file} >nul 2>&1\n",
                            "name": "command_prompt"
                        }
                    }
                ]
            }
        ]
    },
    "timestamp": "2025-02-28 13:49:13"
}