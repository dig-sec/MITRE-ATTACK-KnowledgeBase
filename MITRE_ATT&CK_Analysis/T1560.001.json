{
    "id": "T1560.001",
    "name": "Archive via Utility",
    "description": "An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities. Many utilities exist that can archive data, including 7-Zip(Citation: 7zip Homepage), WinRAR(Citation: WinRAR Homepage), and WinZip(Citation: WinZip Homepage). Most utilities include functionality to encrypt and/or compress data.\nSome 3rd party utilities may be preinstalled, such as `tar` on Linux and macOS or `zip` on Windows systems.",
    "platforms": "Linux, macOS, Windows",
    "kill_chain_phases": "Collection",
    "data_sources": "Process: Process Creation, Command: Command Execution, File: File Creation",
    "detection": "Common utilities that may be present on the system or brought in by an adversary may be detectable through process monitoring and monitoring for command-line arguments for known archival utilities. This may yield a significant number of benign events, depending on how systems in the environment are typically used.\nConsider detecting writing of files with extensions and/or headers associated with compressed or encrypted file types. Detection efforts may focus on follow-on exfiltration activity, where compressed or encrypted files can be detected in transit with a network intrusion detection or data loss prevention system analyzing file headers.(Citation: Wikipedia File Header Signatures)",
    "url": "https://attack.mitre.org/techniques/T1560/001",
    "enrichments": {
        "attack_rule_map": [
            {
                "tech_id": "T1560.001",
                "atomic_attack_guid": "0286eb44-e7ce-41a0-b109-3da516e05a5f",
                "atomic_attack_name": "Data Encrypted with zip and gpg symmetric",
                "platform": "Linux",
                "splunk_rules": [
                    {
                        "rule_name": "Windows Private Keys Discovery",
                        "rule_link": "https://research.splunk.com/endpoint/5c1c2877-06c0-40ee-a1a2-db71f1372b5b/"
                    },
                    {
                        "rule_name": "Windows Password Managers Discovery",
                        "rule_link": "https://research.splunk.com/endpoint/a3b3bc96-1c4f-4eba-8218-027cac739a48/"
                    }
                ]
            },
            {
                "tech_id": "T1560.001",
                "atomic_attack_guid": "d1334303-59cb-4a03-8313-b3e24d02c198",
                "atomic_attack_name": "Compress Data and lock with password for Exfiltration with 7zip",
                "platform": "Windows",
                "splunk_rules": [
                    {
                        "rule_name": "Windows Password Managers Discovery",
                        "rule_link": "https://research.splunk.com/endpoint/a3b3bc96-1c4f-4eba-8218-027cac739a48/"
                    }
                ]
            },
            {
                "tech_id": "T1560.001",
                "atomic_attack_guid": "01df0353-d531-408d-a0c5-3161bf822134",
                "atomic_attack_name": "Compress Data and lock with password for Exfiltration with winzip",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Compress Data and Lock With Password for Exfiltration With WINZIP",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_winzip_password_compression.yml",
                        "remote_content": "title: Compress Data and Lock With Password for Exfiltration With WINZIP\nid: e2e80da2-8c66-4e00-ae3c-2eebd29f6b6d\nstatus: test\ndescription: An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1560.001/T1560.001.md\nauthor: frack113\ndate: 2021-07-27\nmodified: 2022-12-25\ntags:\n    - attack.collection\n    - attack.t1560.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_winzip:\n        CommandLine|contains:\n            - 'winzip.exe'\n            - 'winzip64.exe'\n    selection_password:\n        CommandLine|contains: '-s\"'\n    selection_other:\n        CommandLine|contains:\n            - ' -min '\n            - ' -a '\n    condition: all of selection*\nfalsepositives:\n    - Unknown\nlevel: medium\n"
                    },
                    {
                        "rule_name": "File And SubFolder Enumeration Via Dir Command",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_cmd_dir_execution.yml",
                        "remote_content": "title: File And SubFolder Enumeration Via Dir Command\nid: 7c9340a9-e2ee-4e43-94c5-c54ebbea1006\nstatus: test\ndescription: |\n    Detects usage of the \"dir\" command part of Widows CMD with the \"/S\" command line flag in order to enumerate files in a specified directory and all subdirectories.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1217/T1217.md\nauthor: frack113\ndate: 2021-12-13\nmodified: 2024-04-14\ntags:\n    - attack.discovery\n    - attack.t1217\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_cmd:\n        - Image|endswith: '\\cmd.exe'\n        - OriginalFileName: Cmd.Exe\n    selection_cli:\n        CommandLine|contains|windash: 'dir*-s'\n    condition: all of selection_*\nfalsepositives:\n    - Likely\nlevel: low\n"
                    }
                ]
            },
            {
                "tech_id": "T1560.001",
                "atomic_attack_guid": "8dd61a55-44c6-43cc-af0c-8bdda276860c",
                "atomic_attack_name": "Compress Data and lock with password for Exfiltration with winrar",
                "platform": "Windows",
                "sigma_rules": [
                    {
                        "rule_name": "Rar Usage with Password and Compression Level",
                        "rule_link": "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_rar_compression_with_password.yml",
                        "remote_content": "title: Rar Usage with Password and Compression Level\nid: faa48cae-6b25-4f00-a094-08947fef582f\nstatus: test\ndescription: Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.\nreferences:\n    - https://labs.sentinelone.com/the-anatomy-of-an-apt-attack-and-cobaltstrike-beacons-encoded-configuration/\n    - https://ss64.com/bash/rar.html\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1560.001/T1560.001.md\nauthor: '@ROxPinTeddy'\ndate: 2020-05-12\nmodified: 2022-03-16\ntags:\n    - attack.collection\n    - attack.t1560.001\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_password:\n        CommandLine|contains: ' -hp'\n    selection_other:\n        CommandLine|contains:\n            - ' -m'\n            - ' a '\n    condition: selection_password and selection_other\nfalsepositives:\n    - Legitimate use of Winrar command line version\n    - Other command line tools, that use these flags\nlevel: high\n"
                    }
                ]
            }
        ],
        "cycat": {
            "cycat": {
                "cycat_related_uuids": [
                    "00f90846-cbd1-4fc5-9233-df5c2bf2a662",
                    "0d47e3f6-357f-4534-928c-202631d065fa",
                    "03e2746e-2b31-42f1-ab7a-eb39365b2422",
                    "6f3e2987-db24-4c78-a860-b4f4095a7095",
                    "4ede543c-e098-43d9-a28f-dd784a13132f",
                    "ec570e53-4c76-45a9-804d-dc3f355ff7a7",
                    "5e51acb2-bcbe-435b-99c6-0e3cd5e2aa59",
                    "5b768e71-86f2-4879-b448-81061cbae951",
                    "e2e80da2-8c66-4e00-ae3c-2eebd29f6b6d",
                    "faa48cae-6b25-4f00-a094-08947fef582f",
                    "a3b5e3e9-1b49-4119-8b8e-0344a01f21ee",
                    "27a72a60-7e5e-47b1-9d17-909c9abafdcd",
                    "54dd4ef7-f7b2-418e-a191-5def4fbb0033",
                    "9fbf5927-5261-4284-a71d-f681029ea574",
                    "1ac14d38-3dfc-4635-92c7-e3fd1c5f5bfc"
                ],
                "lookup_results": [
                    {
                        "uuid": "00f90846-cbd1-4fc5-9233-df5c2bf2a662",
                        "lookup_data": {
                            "mitre-attack-id": "T1560.001",
                            "mitre-cti:description": "Adversaries may use utilities to compress and/or encrypt collected data prior to exfiltration. Many utilities include functionalities to compress, encrypt, or otherwise package data into a format that is easier/more secure to transport.\n\nAdversaries may abuse various utilities to compress or encrypt data before exfiltration. Some third party utilities may be preinstalled, such as <code>tar</code> on Linux and macOS or <code>zip</code> on Windows systems. On Windows, <code>diantz</code> or <code> makecab</code> may be used to package collected files into a cabinet (.cab) file. <code>diantz</code> may also be used to download and compress files from remote locations (i.e. [Remote Data Staging](https://attack.mitre.org/techniques/T1074/002)).(Citation: diantz.exe_lolbas) Additionally, <code>xcopy</code> on Windows can copy files and directories with a variety of options.\n\nAdversaries may use also third party utilities, such as 7-Zip, WinRAR, and WinZip, to perform similar activities.(Citation: 7zip Homepage)(Citation: WinRAR Homepage)(Citation: WinZip Homepage)",
                            "mitre-cti:name": "Archive via Utility",
                            "mitre-cti:type": "attack-pattern",
                            "raw": "{'x_mitre_platforms': ['Linux', 'macOS', 'Windows'], 'x_mitre_domains': ['enterprise-attack'], 'x_mitre_contributors': ['Mayan Arora aka Mayan Mohan'], 'object_marking_refs': ['marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168'], 'type': 'attack-pattern', 'id': 'attack-pattern--00f90846-cbd1-4fc5-9233-df5c2bf2a662', 'created': '2020-02-20T21:01:25.428Z', 'x_mitre_version': '1.1', 'external_references': [{'source_name': 'mitre-attack', 'external_id': 'T1560.001', 'url': 'https://attack.mitre.org/techniques/T1560/001'}, {'source_name': 'WinRAR Homepage', 'url': 'https://www.rarlab.com/', 'description': 'A. Roshal. (2020). RARLAB. Retrieved February 20, 2020.'}, {'source_name': 'WinZip Homepage', 'url': 'https://www.winzip.com/win/en/', 'description': 'Corel Corporation. (2020). WinZip. Retrieved February 20, 2020.'}, {'source_name': '7zip Homepage', 'url': 'https://www.7-zip.org/', 'description': 'I. Pavlov. (2019). 7-Zip. Retrieved February 20, 2020.'}, {'source_name': 'diantz.exe_lolbas', 'url': 'https://lolbas-project.github.io/lolbas/Binaries/Diantz/', 'description': 'Living Off The Land Binaries, Scripts and Libraries (LOLBAS). (n.d.). Diantz.exe. Retrieved October 25, 2021.'}, {'source_name': 'Wikipedia File Header Signatures', 'url': 'https://en.wikipedia.org/wiki/List_of_file_signatures', 'description': 'Wikipedia. (2016, March 31). List of file signatures. Retrieved April 22, 2016.'}], 'x_mitre_deprecated': False, 'revoked': False, 'description': 'Adversaries may use utilities to compress and/or encrypt collected data prior to exfiltration. Many utilities include functionalities to compress, encrypt, or otherwise package data into a format that is easier/more secure to transport.\\n\\nAdversaries may abuse various utilities to compress or encrypt data before exfiltration. Some third party utilities may be preinstalled, such as <code>tar</code> on Linux and macOS or <code>zip</code> on Windows systems. On Windows, <code>diantz</code> or <code> makecab</code> may be used to package collected files into a cabinet (.cab) file. <code>diantz</code> may also be used to download and compress files from remote locations (i.e. [Remote Data Staging](https://attack.mitre.org/techniques/T1074/002)).(Citation: diantz.exe_lolbas) Additionally, <code>xcopy</code> on Windows can copy files and directories with a variety of options.\\n\\nAdversaries may use also third party utilities, such as 7-Zip, WinRAR, and WinZip, to perform similar activities.(Citation: 7zip Homepage)(Citation: WinRAR Homepage)(Citation: WinZip Homepage)', 'modified': '2022-04-20T17:17:48.612Z', 'created_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5', 'name': 'Archive via Utility', 'x_mitre_detection': 'Common utilities that may be present on the system or brought in by an adversary may be detectable through process monitoring and monitoring for command-line arguments for known archival utilities. This may yield a significant number of benign events, depending on how systems in the environment are typically used.\\n\\nConsider detecting writing of files with extensions and/or headers associated with compressed or encrypted file types. Detection efforts may focus on follow-on exfiltration activity, where compressed or encrypted files can be detected in transit with a network intrusion detection or data loss prevention system analyzing file headers.(Citation: Wikipedia File Header Signatures)', 'kill_chain_phases': [{'kill_chain_name': 'mitre-attack', 'phase_name': 'collection'}], 'x_mitre_is_subtechnique': True, 'x_mitre_data_sources': ['Command: Command Execution', 'Process: Process Creation', 'File: File Creation'], 'x_mitre_attack_spec_version': '2.1.0', 'x_mitre_modified_by_ref': 'identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5'}",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "0d47e3f6-357f-4534-928c-202631d065fa",
                        "lookup_data": {
                            "description": "This rule detects potential exfiltration by looking for a few compression extensions in the uri and signs of compression in the mime type, file type, and http body",
                            "raw": "author: Greg Howell, OTR (Open Threat Research)\ndate: 2020/04/05\ndescription: This rule detects potential exfiltration by looking for a few compression\n  extensions in the uri and signs of compression in the mime type, file type, and\n  http body\ndetection:\n  condition: selection1 or selection3 or selection4\n  selection1:\n    mime_types|endswith: compressed\n    uri|endswith:\n    - .7z\n    - .zip\n    - .rar\n  selection3:\n    filetype|endswith: compressed\n  selection4:\n    http.bodyMagic|endswith: compressed\n    http.method: PUT\nfalsepositives:\n- Legitimate upload/download of archives\nid: 0d47e3f6-357f-4534-928c-202631d065fa\nlevel: medium\nlogsource:\n  product: zeek\n  service: http\nreferences:\n- https://github.com/OTRF/detection-hackathon-apt29/issues/17\ntags:\n- attack.exfiltration\n- attack.t1560.001\n- attack.t1005\ntitle: Potential Exfiltration of Compressed Files\n",
                            "sigma:id": "0d47e3f6-357f-4534-928c-202631d065fa",
                            "title": "Potential Exfiltration of Compressed Files",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "03e2746e-2b31-42f1-ab7a-eb39365b2422",
                        "lookup_data": {
                            "description": "Detects Judgement Panda activity as described in Global Threat Report 2019 by Crowdstrike",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2019/02/21\ndescription: Detects Judgement Panda activity as described in Global Threat Report\n  2019 by Crowdstrike\ndetection:\n  condition: selection1 or selection2\n  selection1:\n  - CommandLine|endswith: eprod.ldf\n  - CommandLine|contains:\n    - '\\ldifde.exe -f -n '\n    - '\\7za.exe a 1.7z '\n    - \\aaaa\\procdump64.exe\n    - \\aaaa\\netsess.exe\n    - \\aaaa\\7za.exe\n    - copy .\\1.7z \\\n    - copy \\\\client\\c$\\aaaa\\\n  selection2:\n    Image: C:\\Users\\Public\\7za.exe\nfalsepositives:\n- Unknown\nid: 03e2746e-2b31-42f1-ab7a-eb39365b2422\nlevel: critical\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2021/11/27\nreferences:\n- https://www.crowdstrike.com/resources/reports/2019-crowdstrike-global-threat-report/\nstatus: test\ntags:\n- attack.lateral_movement\n- attack.g0010\n- attack.credential_access\n- attack.t1003.001\n- attack.exfiltration\n- attack.t1560.001\ntitle: Judgement Panda Exfil Activity\n",
                            "sigma:id": "03e2746e-2b31-42f1-ab7a-eb39365b2422",
                            "title": "Judgement Panda Exfil Activity",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "6f3e2987-db24-4c78-a860-b4f4095a7095",
                        "lookup_data": {
                            "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.",
                            "raw": "author: Timur Zinniatullin, E.M. Anhaus, oscd.community\ndate: 2019/10/21\ndescription: An adversary may compress data (e.g., sensitive documents) that is collected\n  prior to exfiltration in order to make it portable and minimize the amount of data\n  sent over the network.\ndetection:\n  condition: selection\n  selection:\n    CommandLine|contains: ' a '\n    Image|endswith: \\rar.exe\nfalsepositives:\n- Highly likely if rar is a default archiver in the monitored environment.\nfields:\n- Image\n- CommandLine\n- User\n- LogonGuid\n- Hashes\n- ParentProcessGuid\n- ParentCommandLine\nid: 6f3e2987-db24-4c78-a860-b4f4095a7095\nlevel: low\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2021/11/27\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1560.001/T1560.001.md\n- https://eqllib.readthedocs.io/en/latest/analytics/1ec33c93-3d0b-4a28-8014-dbdaae5c60ae.html\nstatus: test\ntags:\n- attack.collection\n- attack.t1560.001\ntitle: Data Compressed - rar.exe\n",
                            "sigma:id": "6f3e2987-db24-4c78-a860-b4f4095a7095",
                            "title": "Data Compressed - rar.exe",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "4ede543c-e098-43d9-a28f-dd784a13132f",
                        "lookup_data": {
                            "description": "Detects a suspicious winrar execution in a folder which is not the default installation folder",
                            "raw": "author: Florian Roth (Nextron Systems), Tigzy\ndate: 2021/11/17\ndescription: Detects a suspicious winrar execution in a folder which is not the default\n  installation folder\ndetection:\n  condition: selection and not filter\n  filter:\n    Image|contains:\n    - \\WinRAR\n    - C:\\Windows\\Temp\n    - \\UnRAR.exe\n  selection:\n  - Image|endswith:\n    - \\rar.exe\n    - \\winrar.exe\n  - Description: Command line RAR\nfalsepositives:\n- Legitimate use of WinRAR in a folder of a software that bundles WinRAR\nid: 4ede543c-e098-43d9-a28f-dd784a13132f\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/12/25\nreferences:\n- https://twitter.com/cyb3rops/status/1460978167628406785\nstatus: test\ntags:\n- attack.collection\n- attack.t1560.001\ntitle: Winrar Execution in Non-Standard Folder\n",
                            "sigma:id": "4ede543c-e098-43d9-a28f-dd784a13132f",
                            "title": "Winrar Execution in Non-Standard Folder",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "ec570e53-4c76-45a9-804d-dc3f355ff7a7",
                        "lookup_data": {
                            "description": "Detects a suspicious 7zip execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/09/27\ndescription: Detects a suspicious 7zip execution that involves a file with a .dmp\n  extension, which could be a step in a process of dump file exfiltration\ndetection:\n  condition: selection and dumpfile\n  dumpfile:\n    CommandLine|contains: .dmp\n  selection:\n  - Image|endswith:\n    - \\7z.exe\n    - \\7zr.exe\n    - \\7za.exe\n  - Description|contains: 7-Zip\nfalsepositives:\n- Legitimate use of 7-Zip with a command line in which .dmp appears accidentally\nid: ec570e53-4c76-45a9-804d-dc3f355ff7a7\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nreferences:\n- https://thedfirreport.com/2022/09/26/bumblebee-round-two/\nrelated:\n- id: 1ac14d38-3dfc-4635-92c7-e3fd1c5f5bfc\n  type: derived\nstatus: experimental\ntags:\n- attack.collection\n- attack.t1560.001\ntitle: 7Zip Compressing Dump Files\n",
                            "sigma:id": "ec570e53-4c76-45a9-804d-dc3f355ff7a7",
                            "title": "7Zip Compressing Dump Files",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5e51acb2-bcbe-435b-99c6-0e3cd5e2aa59",
                        "lookup_data": {
                            "description": "Various protocols maybe used to put data on the device for exfil or infil",
                            "raw": "author: Austin Clark\ndate: 2019/08/12\ndescription: Various protocols maybe used to put data on the device for exfil or infil\ndetection:\n  condition: keywords\n  keywords:\n  - tftp\n  - rcp\n  - puts\n  - copy\n  - configure replace\n  - archive tar\nfalsepositives:\n- Generally used to copy configs or IOS images\nfields:\n- CmdSet\nid: 5e51acb2-bcbe-435b-99c6-0e3cd5e2aa59\nlevel: low\nlogsource:\n  product: cisco\n  service: aaa\nmodified: 2023/01/04\nstatus: test\ntags:\n- attack.collection\n- attack.lateral_movement\n- attack.command_and_control\n- attack.exfiltration\n- attack.t1074\n- attack.t1105\n- attack.t1560.001\ntitle: Cisco Stage Data\n",
                            "sigma:id": "5e51acb2-bcbe-435b-99c6-0e3cd5e2aa59",
                            "title": "Cisco Stage Data",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "5b768e71-86f2-4879-b448-81061cbae951",
                        "lookup_data": {
                            "description": "Detects suspicious manipulations of default accounts such as 'administrator' and 'guest'. For example 'enable' or 'disable' accounts or change the password...etc",
                            "raw": "author: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022/09/01\ndescription: Detects suspicious manipulations of default accounts such as 'administrator'\n  and 'guest'. For example 'enable' or 'disable' accounts or change the password...etc\ndetection:\n  condition: all of selection_* and not filter\n  filter:\n    CommandLine|contains|all:\n    - guest\n    - /active no\n  selection_img:\n    Image|endswith:\n    - \\net.exe\n    - \\net1.exe\n  selection_user_option:\n    CommandLine|contains: ' user '\n  selection_username:\n    CommandLine|contains:\n    - \" J\\xE4rjestelm\\xE4nvalvoja \"\n    - ' Rendszergazda '\n    - \" \\u0410\\u0434\\u043C\\u0438\\u043D\\u0438\\u0441\\u0442\\u0440\\u0430\\u0442\\u043E\\u0440\\\n      \\ \"\n    - ' Administrateur '\n    - ' Administrador '\n    - \" Administrat\\xF6r \"\n    - ' Administrator '\n    - ' guest '\n    - ' DefaultAccount '\n    - \" \\\"J\\xE4rjestelm\\xE4nvalvoja\\\" \"\n    - ' \"Rendszergazda\" '\n    - \" \\\"\\u0410\\u0434\\u043C\\u0438\\u043D\\u0438\\u0441\\u0442\\u0440\\u0430\\u0442\\u043E\\\n      \\u0440\\\" \"\n    - ' \"Administrateur\" '\n    - ' \"Administrador\" '\n    - \" \\\"Administrat\\xF6r\\\" \"\n    - ' \"Administrator\" '\n    - ' \"guest\" '\n    - ' \"DefaultAccount\" '\n    - \" 'J\\xE4rjestelm\\xE4nvalvoja' \"\n    - ' ''Rendszergazda'' '\n    - \" '\\u0410\\u0434\\u043C\\u0438\\u043D\\u0438\\u0441\\u0442\\u0440\\u0430\\u0442\\u043E\\u0440\\\n      ' \"\n    - ' ''Administrateur'' '\n    - ' ''Administrador'' '\n    - \" 'Administrat\\xF6r' \"\n    - ' ''Administrator'' '\n    - ' ''guest'' '\n    - ' ''DefaultAccount'' '\nfalsepositives:\n- Some fasle positives could occure with the admin or guest account. It depends on\n  the scripts being used by the admins in your env. If you experience a lot of FP\n  you could reduce the level to medium\nid: 5b768e71-86f2-4879-b448-81061cbae951\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/09/09\nreferences:\n- https://www.trellix.com/en-sg/about/newsroom/stories/threat-labs/lockergoga-ransomware-family-used-in-targeted-attacks.html\n- https://redacted.com/blog/bianlian-ransomware-gang-gives-it-a-go/\n- https://www.microsoft.com/security/blog/2022/09/07/profiling-dev-0270-phosphorus-ransomware-operations/\nstatus: experimental\ntags:\n- attack.collection\n- attack.t1560.001\ntitle: Suspicious Manipulation Of Default Accounts\n",
                            "sigma:id": "5b768e71-86f2-4879-b448-81061cbae951",
                            "title": "Suspicious Manipulation Of Default Accounts",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "e2e80da2-8c66-4e00-ae3c-2eebd29f6b6d",
                        "lookup_data": {
                            "description": "An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities",
                            "raw": "author: frack113\ndate: 2021/07/27\ndescription: An adversary may compress or encrypt data that is collected prior to\n  exfiltration using 3rd party utilities\ndetection:\n  condition: all of selection*\n  selection_other:\n    CommandLine|contains:\n    - ' -min '\n    - ' -a '\n  selection_password:\n    CommandLine|contains: -s\"\n  selection_winzip:\n    CommandLine|contains:\n    - winzip.exe\n    - winzip64.exe\nfalsepositives:\n- Unknown\nid: e2e80da2-8c66-4e00-ae3c-2eebd29f6b6d\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/12/25\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1560.001/T1560.001.md\nstatus: test\ntags:\n- attack.collection\n- attack.t1560.001\ntitle: Compress Data and Lock With Password for Exfiltration With WINZIP\n",
                            "sigma:id": "e2e80da2-8c66-4e00-ae3c-2eebd29f6b6d",
                            "title": "Compress Data and Lock With Password for Exfiltration With WINZIP",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "faa48cae-6b25-4f00-a094-08947fef582f",
                        "lookup_data": {
                            "description": "Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.",
                            "raw": "author: '@ROxPinTeddy'\ndate: 2020/05/12\ndescription: Detects the use of rar.exe, on the command line, to create an archive\n  with password protection or with a specific compression level. This is pretty indicative\n  of malicious actions.\ndetection:\n  condition: selection_password and selection_other\n  selection_other:\n    CommandLine|contains:\n    - ' -m'\n    - ' a '\n  selection_password:\n    CommandLine|contains: ' -hp'\nfalsepositives:\n- Legitimate use of Winrar command line version\n- Other command line tools, that use these flags\nid: faa48cae-6b25-4f00-a094-08947fef582f\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/03/16\nreferences:\n- https://labs.sentinelone.com/the-anatomy-of-an-apt-attack-and-cobaltstrike-beacons-encoded-configuration/\n- https://ss64.com/bash/rar.html\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1560.001/T1560.001.md\nstatus: test\ntags:\n- attack.collection\n- attack.t1560.001\ntitle: Rar Usage with Password and Compression Level\n",
                            "sigma:id": "faa48cae-6b25-4f00-a094-08947fef582f",
                            "title": "Rar Usage with Password and Compression Level",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "a3b5e3e9-1b49-4119-8b8e-0344a01f21ee",
                        "lookup_data": {
                            "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.",
                            "raw": "author: Timur Zinniatullin, oscd.community\ndate: 2019/10/21\ndescription: An adversary may compress data (e.g., sensitive documents) that is collected\n  prior to exfiltration in order to make it portable and minimize the amount of data\n  sent over the network.\ndetection:\n  condition: 1 of selection*\n  selection1:\n    a0: zip\n    type: execve\n  selection2:\n    a0: gzip\n    a1: -f\n    type: execve\n  selection3:\n    a0: tar\n    a1|contains: -c\n    type: execve\nfalsepositives:\n- Legitimate use of archiving tools by legitimate user.\nid: a3b5e3e9-1b49-4119-8b8e-0344a01f21ee\nlevel: low\nlogsource:\n  product: linux\n  service: auditd\nmodified: 2021/11/27\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1560.001/T1560.001.md\nstatus: test\ntags:\n- attack.exfiltration\n- attack.t1560.001\ntitle: Data Compressed\n",
                            "sigma:id": "a3b5e3e9-1b49-4119-8b8e-0344a01f21ee",
                            "title": "Data Compressed",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "27a72a60-7e5e-47b1-9d17-909c9abafdcd",
                        "lookup_data": {
                            "description": "Detects suspicious command line arguments of common data compression tools",
                            "raw": "author: Florian Roth (Nextron Systems), Samir Bousseaden\ndate: 2019/10/15\ndescription: Detects suspicious command line arguments of common data compression\n  tools\ndetection:\n  condition: selection and not falsepositive\n  falsepositive:\n    ParentImage|startswith: C:\\Program\n  selection:\n    CommandLine|contains:\n    - ' -p'\n    - ' -ta'\n    - ' -tb'\n    - ' -sdel'\n    - ' -dw'\n    - ' -hp'\n    OriginalFileName:\n    - 7z*.exe\n    - '*rar.exe'\n    - '*Command*Line*RAR*'\nfalsepositives:\n- Unknown\nid: 27a72a60-7e5e-47b1-9d17-909c9abafdcd\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2021/11/27\nreferences:\n- https://twitter.com/SBousseaden/status/1184067445612535811\nstatus: test\ntags:\n- attack.collection\n- attack.t1560.001\ntitle: Suspicious Compression Tool Parameters\n",
                            "sigma:id": "27a72a60-7e5e-47b1-9d17-909c9abafdcd",
                            "title": "Suspicious Compression Tool Parameters",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "54dd4ef7-f7b2-418e-a191-5def4fbb0033",
                        "lookup_data": {
                            "description": "Turla: A Galaxy of Opportunity",
                            "link": "http://www.botvrij.eu/data/feed-osint/54dd4ef7-f7b2-418e-a191-5def4fbb0033.json",
                            "misp:feed": "http://www.botvrij.eu/data/feed-osint",
                            "timestamp": "1673286950",
                            "uuid": "54dd4ef7-f7b2-418e-a191-5def4fbb0033",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "9fbf5927-5261-4284-a71d-f681029ea574",
                        "lookup_data": {
                            "description": "An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities",
                            "raw": "author: frack113\ndate: 2021/07/27\ndescription: An adversary may compress or encrypt data that is collected prior to\n  exfiltration using 3rd party utilities\ndetection:\n  condition: all of selection*\n  selection_7z:\n    CommandLine|contains:\n    - 7z.exe\n    - 7za.exe\n  selection_action:\n    CommandLine|contains:\n    - ' a '\n    - ' u '\n  selection_password:\n    CommandLine|contains: ' -p'\nfalsepositives:\n- Command line parameter combinations that contain all included strings\nfields:\n- CommandLine\n- ParentCommandLine\n- CurrentDirectory\nid: 9fbf5927-5261-4284-a71d-f681029ea574\nlevel: medium\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/12/25\nreferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1560.001/T1560.001.md\nstatus: test\ntags:\n- attack.collection\n- attack.t1560.001\ntitle: Compress Data and Lock With Password for Exfiltration With 7-ZIP\n",
                            "sigma:id": "9fbf5927-5261-4284-a71d-f681029ea574",
                            "title": "Compress Data and Lock With Password for Exfiltration With 7-ZIP",
                            "_cycat_type": "Item"
                        }
                    },
                    {
                        "uuid": "1ac14d38-3dfc-4635-92c7-e3fd1c5f5bfc",
                        "lookup_data": {
                            "description": "Detects a suspicious winrar execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration",
                            "raw": "author: Florian Roth (Nextron Systems)\ndate: 2022/01/04\ndescription: Detects a suspicious winrar execution that involves a file with a .dmp\n  extension, which could be a step in a process of dump file exfiltration\ndetection:\n  condition: selection and dumpfile\n  dumpfile:\n    CommandLine|contains: .dmp\n  selection:\n  - Image|endswith:\n    - \\rar.exe\n    - \\winrar.exe\n  - Description: Command line RAR\nfalsepositives:\n- Legitimate use of WinRAR with a command line in which .dmp appears accidentally\nid: 1ac14d38-3dfc-4635-92c7-e3fd1c5f5bfc\nlevel: high\nlogsource:\n  category: process_creation\n  product: windows\nmodified: 2022/06/17\nreferences:\n- https://www.crowdstrike.com/blog/overwatch-exposes-aquatic-panda-in-possession-of-log-4-shell-exploit-tools/\nstatus: experimental\ntags:\n- attack.collection\n- attack.t1560.001\ntitle: Winrar Compressing Dump Files\n",
                            "sigma:id": "1ac14d38-3dfc-4635-92c7-e3fd1c5f5bfc",
                            "title": "Winrar Compressing Dump Files",
                            "_cycat_type": "Item"
                        }
                    }
                ]
            }
        },
        "atomics": [
            {
                "attack_technique": "T1560.001",
                "display_name": "Archive Collected Data: Archive via Utility",
                "atomic_tests": [
                    {
                        "name": "Compress Data for Exfiltration With Rar",
                        "auto_generated_guid": "02ea31cb-3b4c-4a2d-9bf1-e4e70ebcf5d0",
                        "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration.\nWhen the test completes you should find the txt files from the %USERPROFILE% directory compressed in a file called T1560.001-data.rar in the %USERPROFILE% directory \n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "input_path": {
                                "description": "Path that should be compressed into our output file",
                                "type": "path",
                                "default": "%USERPROFILE%"
                            },
                            "file_extension": {
                                "description": "Extension of files to compress",
                                "type": "string",
                                "default": ".txt"
                            },
                            "output_file": {
                                "description": "Path where resulting compressed data should be placed",
                                "type": "path",
                                "default": "%USERPROFILE%\\T1560.001-data.rar"
                            },
                            "rar_installer": {
                                "description": "Winrar installer",
                                "type": "path",
                                "default": "%TEMP%\\winrar.exe"
                            },
                            "rar_exe": {
                                "description": "The RAR executable from Winrar",
                                "type": "path",
                                "default": "%programfiles%/WinRAR/Rar.exe"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "Rar tool must be installed at specified location (#{rar_exe})\n",
                                "prereq_command": "if not exist \"#{rar_exe}\" (exit /b 1)\n",
                                "get_prereq_command": "echo Downloading Winrar installer\nbitsadmin /transfer myDownloadJob /download /priority normal \"https://www.win-rar.com/fileadmin/winrar-versions/winrar/th/winrar-x64-580.exe\" #{rar_installer}\n#{rar_installer} /S\n"
                            }
                        ],
                        "executor": {
                            "name": "command_prompt",
                            "elevation_required": false,
                            "command": "\"#{rar_exe}\" a -r #{output_file} #{input_path}\\*#{file_extension}\n",
                            "cleanup_command": "del /f /q /s #{output_file} >nul 2>&1\n"
                        }
                    },
                    {
                        "name": "Compress Data and lock with password for Exfiltration with winrar",
                        "auto_generated_guid": "8dd61a55-44c6-43cc-af0c-8bdda276860c",
                        "description": "Note: Requires winrar installation\nrar a -p\"blue\" hello.rar (VARIANT)\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "rar_installer": {
                                "description": "Winrar installer",
                                "type": "path",
                                "default": "%TEMP%\\winrar.exe"
                            },
                            "rar_exe": {
                                "description": "The RAR executable from Winrar",
                                "type": "path",
                                "default": "%programfiles%/WinRAR/Rar.exe"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "Rar tool must be installed at specified location (#{rar_exe})\n",
                                "prereq_command": "if not exist \"#{rar_exe}\" (exit /b 1)\n",
                                "get_prereq_command": "echo Downloading Winrar installer\nbitsadmin /transfer myDownloadJob /download /priority normal \"https://www.win-rar.com/fileadmin/winrar-versions/winrar/th/winrar-x64-580.exe\" #{rar_installer}\n#{rar_installer} /S\n"
                            }
                        ],
                        "executor": {
                            "name": "command_prompt",
                            "elevation_required": false,
                            "command": "mkdir .\\tmp\\victim-files\ncd .\\tmp\\victim-files\necho \"This file will be encrypted\" > .\\encrypted_file.txt\n\"#{rar_exe}\" a -hp\"blue\" hello.rar\ndir\n"
                        }
                    },
                    {
                        "name": "Compress Data and lock with password for Exfiltration with winzip",
                        "auto_generated_guid": "01df0353-d531-408d-a0c5-3161bf822134",
                        "description": "Note: Requires winzip installation\nwzzip sample.zip -s\"blueblue\" *.txt (VARIANT)\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "winzip_exe": {
                                "description": "Path to installed Winzip executable",
                                "type": "path",
                                "default": "%ProgramFiles%\\WinZip\\winzip64.exe"
                            },
                            "winzip_url": {
                                "description": "Path to download Windows Credential Editor zip file",
                                "type": "url",
                                "default": "https://download.winzip.com/gl/nkln/winzip24-home.exe"
                            },
                            "winzip_hash": {
                                "description": "File hash of the Windows Credential Editor zip file",
                                "type": "string",
                                "default": "B59DB592B924E963C21DA8709417AC0504F6158CFCB12FE5536F4A0E0D57D7FB"
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "Winzip must be installed\n",
                                "prereq_command": "cmd /c 'if not exist \"#{winzip_exe}\" (echo 1) else (echo 0)'\n",
                                "get_prereq_command": "IEX(IWR \"https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-WebRequestVerifyHash.ps1\" -UseBasicParsing)\nNew-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nif(Invoke-WebRequestVerifyHash \"#{winzip_url}\" \"PathToAtomicsFolder\\..\\ExternalPayloads\\winzip.exe\" #{winzip_hash}){\n  Write-Host Follow the installation prompts to continue\n  cmd /c \"PathToAtomicsFolder\\..\\ExternalPayloads\\winzip.exe\"\n}\n"
                            }
                        ],
                        "executor": {
                            "name": "command_prompt",
                            "elevation_required": false,
                            "command": "path=%path%;\"C:\\Program Files (x86)\\winzip\"\nmkdir .\\tmp\\victim-files\ncd .\\tmp\\victim-files\necho \"This file will be encrypted\" > .\\encrypted_file.txt\n\"#{winzip_exe}\" -min -a -s\"hello\" archive.zip *\ndir\n"
                        }
                    },
                    {
                        "name": "Compress Data and lock with password for Exfiltration with 7zip",
                        "auto_generated_guid": "d1334303-59cb-4a03-8313-b3e24d02c198",
                        "description": "Note: This test requires 7zip installation\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "7zip_installer": {
                                "description": "7zip installer",
                                "type": "path",
                                "default": "%TEMP%\\7zip.exe"
                            },
                            "7zip_exe": {
                                "description": "Path to installed 7zip executable",
                                "type": "path",
                                "default": "%ProgramFiles%\\7-zip\\7z.exe"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "7zip tool must be installed at specified location (#{7zip_exe})\n",
                                "prereq_command": "if not exist \"#{7zip_exe}\" (exit /b 1)\n",
                                "get_prereq_command": "echo Downloading 7-zip installer\nbitsadmin /transfer myDownloadJob /download /priority normal \"https://www.7-zip.org/a/7z2301-x64.exe\" #{7zip_installer}\n#{7zip_installer} /S\n"
                            }
                        ],
                        "executor": {
                            "name": "command_prompt",
                            "elevation_required": false,
                            "command": "mkdir $PathToAtomicsFolder\\T1560.001\\victim-files\ncd $PathToAtomicsFolder\\T1560.001\\victim-files\necho \"This file will be encrypted\" > .\\encrypted_file.txt\n\"#{7zip_exe}\" u archive.7z *txt -pblue\ndir\n",
                            "cleanup_command": "rmdir /s /Q $PathToAtomicsFolder\\T1560.001\\victim-files >nul 2>&1\n"
                        }
                    },
                    {
                        "name": "Data Compressed - nix - zip",
                        "auto_generated_guid": "c51cec55-28dd-4ad2-9461-1eacbc82c3a0",
                        "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration. This test uses standard zip compression.\n",
                        "supported_platforms": [
                            "linux",
                            "macos"
                        ],
                        "input_arguments": {
                            "input_files": {
                                "description": "Path that should be compressed into our output file, may include wildcards",
                                "type": "path",
                                "default": "/var/log/{w,b}tmp"
                            },
                            "output_file": {
                                "description": "Path that should be output as a zip archive",
                                "type": "path",
                                "default": "$HOME/data.zip"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "Files to zip must exist (#{input_files})\n",
                                "prereq_command": "if [ $(ls #{input_files} | wc -l) > 0 ] && [ -x $(which zip) ] ; then exit 0; else exit 1; fi;\n",
                                "get_prereq_command": "(which yum && yum -y install epel-release zip)||(which apt-get && apt-get install -y zip)\necho Please set input_files argument to include files that exist\n"
                            }
                        ],
                        "executor": {
                            "name": "bash",
                            "elevation_required": true,
                            "command": "zip #{output_file} #{input_files}\n",
                            "cleanup_command": "rm -f #{output_file}\n"
                        }
                    },
                    {
                        "name": "Data Compressed - nix - gzip Single File",
                        "auto_generated_guid": "cde3c2af-3485-49eb-9c1f-0ed60e9cc0af",
                        "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration. This test uses standard gzip compression.\n",
                        "supported_platforms": [
                            "linux",
                            "macos"
                        ],
                        "input_arguments": {
                            "input_file": {
                                "description": "Path that should be compressed",
                                "type": "path",
                                "default": "$HOME/victim-gzip.txt"
                            },
                            "input_content": {
                                "description": "contents of compressed files if file does not already exist. default contains test credit card and social security number",
                                "type": "string",
                                "default": "confidential! SSN: 078-05-1120 - CCN: 4000 1234 5678 9101"
                            }
                        },
                        "executor": {
                            "name": "sh",
                            "elevation_required": false,
                            "command": "test -e #{input_file} && gzip -k #{input_file} || (echo '#{input_content}' >> #{input_file}; gzip -k #{input_file})\n",
                            "cleanup_command": "rm -f #{input_file}.gz\n"
                        }
                    },
                    {
                        "name": "Data Compressed - nix - tar Folder or File",
                        "auto_generated_guid": "7af2b51e-ad1c-498c-aca8-d3290c19535a",
                        "description": "An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration. This test uses standard gzip compression.\n",
                        "supported_platforms": [
                            "linux",
                            "macos"
                        ],
                        "input_arguments": {
                            "input_file_folder": {
                                "description": "Path that should be compressed",
                                "type": "path",
                                "default": "$HOME/$USERNAME"
                            },
                            "output_file": {
                                "description": "File that should be output",
                                "type": "path",
                                "default": "$HOME/data.tar.gz"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "Folder to zip must exist (#{input_file_folder})\n",
                                "prereq_command": "test -e #{input_file_folder}\n",
                                "get_prereq_command": "mkdir -p #{input_file_folder} && touch #{input_file_folder}/file1\n"
                            }
                        ],
                        "executor": {
                            "name": "sh",
                            "elevation_required": false,
                            "command": "tar -cvzf #{output_file} #{input_file_folder}\n",
                            "cleanup_command": "rm -f #{output_file}\n"
                        }
                    },
                    {
                        "name": "Data Encrypted with zip and gpg symmetric",
                        "auto_generated_guid": "0286eb44-e7ce-41a0-b109-3da516e05a5f",
                        "description": "Encrypt data for exiltration\n",
                        "supported_platforms": [
                            "linux",
                            "macos"
                        ],
                        "input_arguments": {
                            "test_folder": {
                                "description": "Path used to store files.",
                                "type": "path",
                                "default": "/tmp/T1560"
                            },
                            "test_file": {
                                "description": "Temp file used to store encrypted data.",
                                "type": "path",
                                "default": "T1560"
                            },
                            "encryption_password": {
                                "description": "Password used to encrypt data.",
                                "type": "string",
                                "default": "InsertPasswordHere"
                            }
                        },
                        "dependency_executor_name": "sh",
                        "dependencies": [
                            {
                                "description": "gpg and zip are required to run the test.",
                                "prereq_command": "if [ ! -x \"$(command -v gpg)\" ] || [ ! -x \"$(command -v zip)\" ]; then exit 1; fi;\n",
                                "get_prereq_command": "(which pkg && pkg install -y gnupg zip)||(which yum && yum -y install epel-release zip gpg)||(which apt-get && apt-get install -y zip gpg)\n"
                            }
                        ],
                        "executor": {
                            "name": "sh",
                            "elevation_required": false,
                            "command": "mkdir -p #{test_folder}\ncd #{test_folder}; touch a b c d e f g\nzip --password \"#{encryption_password}\" #{test_folder}/#{test_file} ./*\necho \"#{encryption_password}\" | gpg --batch --yes --passphrase-fd 0 --output #{test_folder}/#{test_file}.zip.gpg -c #{test_folder}/#{test_file}.zip\nls -l #{test_folder}\n",
                            "cleanup_command": "rm -Rf #{test_folder}\n"
                        }
                    },
                    {
                        "name": "Encrypts collected data with AES-256 and Base64",
                        "auto_generated_guid": "a743e3a6-e8b2-4a30-abe7-ca85d201b5d3",
                        "description": "An adversary may compress all the collected data, encrypt and send them to a C2 server using base64 encoding. \nThis atomic test tries to emulate the behaviour of the FLEXIROOT backdoor to archive the collected data. FLEXIROOT typically utilizes AES encryption and base64 encoding to transfer the encrypted data to the C2 server. \nIn this test, standard zip compression and the OpenSSL library are used to encrypt the compressed data.\nhttps://attack.mitre.org/versions/v7/software/S0267/",
                        "supported_platforms": [
                            "linux",
                            "macos"
                        ],
                        "input_arguments": {
                            "input_folder": {
                                "description": "Path to the folder used to store the test files",
                                "type": "path",
                                "default": "/tmp/t1560"
                            },
                            "input_file": {
                                "description": "Name of the compressed and encrypted files",
                                "type": "string",
                                "default": "t1560_data"
                            },
                            "enc_pass": {
                                "description": "Password used to encrypt the data",
                                "type": "string",
                                "default": "atomic_enc_pass"
                            }
                        },
                        "dependency_executor_name": "bash",
                        "dependencies": [
                            {
                                "description": "The folder and test files must exist",
                                "prereq_command": "if [ ! -d #{input_folder} ]; then exit 1; else exit 0; fi;",
                                "get_prereq_command": "if [ ! -d #{input_folder} ]; then mkdir -p #{input_folder}; cd #{input_folder}; touch {a..z}.data; fi;"
                            }
                        ],
                        "executor": {
                            "command": "zip -r  #{input_folder}/#{input_file}.zip #{input_folder}\nopenssl enc -aes-256-cbc -pass pass:#{enc_pass} -p -in #{input_folder}/#{input_file}.zip -out #{input_folder}/#{input_file}.enc \ncat #{input_folder}/#{input_file}.enc | base64",
                            "cleanup_command": "rm -rf #{input_folder}",
                            "name": "bash",
                            "elevation_required": false
                        }
                    },
                    {
                        "name": "ESXi - Remove Syslog remote IP",
                        "auto_generated_guid": "36c62584-d360-41d6-886f-d194654be7c2",
                        "description": "An adversary may edit the syslog config to remove the loghost in order to prevent or redirect logs being received by SIEM.\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "vm_host": {
                                "description": "Specify the host name of the ESXi Server",
                                "type": "string",
                                "default": "atomic.local"
                            },
                            "plink_file": {
                                "description": "Path to Putty",
                                "type": "path",
                                "default": "PathToAtomicsFolder\\..\\ExternalPayloads\\plink.exe"
                            },
                            "username": {
                                "description": "Username used to log into ESXi",
                                "type": "string",
                                "default": "root"
                            },
                            "password": {
                                "description": "password used to log into ESXI",
                                "type": "string",
                                "default": "n/a"
                            }
                        },
                        "dependency_executor_name": "powershell",
                        "dependencies": [
                            {
                                "description": "The plink executable must be found in the ExternalPayloads folder.\n",
                                "prereq_command": "if (Test-Path \"#{plink_file}\") {exit 0} else {exit 1}\n",
                                "get_prereq_command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe\" -OutFile \"#{plink_file}\"\n"
                            }
                        ],
                        "executor": {
                            "command": "# Extract line with IP address from the syslog configuration output\n#{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m PathToAtomicsFolder\\..\\atomics\\T1560.001\\src\\esxi_get_loghost.txt | findstr /r \"[0-9]*\\.[0-9]*\\.[0-9]*\\.\" > c:\\temp\\loghost.txt\n\n# Replace the IP with \"0\"\n#{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m PathToAtomicsFolder\\..\\atomics\\T1560.001\\src\\esxi_remove_loghost.txt\n\n# Extract the IP from the line extracted from findstr\n$inputFilePath = \"c:\\temp\\loghost.txt\"\n$outputFilePath = \"c:\\temp\\loghost_ip.txt\"\n\n$fileContent = Get-Content -Path $inputFilePath -Raw\n\nif ([string]::IsNullOrWhiteSpace($fileContent)) {\n    Write-Host \"The content is $fileContent\"\n    Write-Host \"The file is empty\"\n} else {\n    # Use a regular expression to extract IP addresses\n    $ipAddresses = [regex]::Matches($fileContent, '(udp|tcp):\\/\\/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.*').Value\n    \n    $output = \"esxcli system syslog config set --loghost=\" + $ipAddresses\n\n    $output | Out-File -FilePath $outputFilePath -Encoding ascii\n    \n    Write-Host \"IP addresses extracted and saved to $outputFilePath\"\n}\n",
                            "cleanup_command": "# Re-add the initially extracted IP\n#{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m c:\\temp\\loghost_ip.txt\n\nrm c:\\temp\\loghost_ip.txt\nrm c:\\temp\\loghost.txt\n",
                            "name": "powershell",
                            "elevation_required": true
                        }
                    },
                    {
                        "name": "Compress a File for Exfiltration using Makecab",
                        "auto_generated_guid": "2a7bc405-9555-4f49-ace2-b2ae2941d629",
                        "description": "An adversary may compress data using Makecab (in-built Windows binary) that is collected prior to exfiltration.\n[reference](https://unit42.paloaltonetworks.com/exchange-server-credential-harvesting/)\n",
                        "supported_platforms": [
                            "windows"
                        ],
                        "input_arguments": {
                            "input_file": {
                                "description": "Path to source file for compression",
                                "type": "path",
                                "default": "C:\\Temp\\sam.hiv"
                            },
                            "output_file": {
                                "description": "Path of the CAB file",
                                "type": "path",
                                "default": "C:\\Temp\\art.zip"
                            }
                        },
                        "dependencies": [
                            {
                                "description": "A sample file for compression must be located at specified location (#{input_file})\n",
                                "prereq_command": "if not exist \"#{input_file}\" (exit /b 1)\n",
                                "get_prereq_command": "fsutil file createnew c:\\Temp\\sam.hiv 10485760\n"
                            }
                        ],
                        "executor": {
                            "name": "command_prompt",
                            "elevation_required": false,
                            "command": "makecab.exe #{input_file} #{output_file}\n",
                            "cleanup_command": "del #{output_file}\n"
                        }
                    }
                ]
            }
        ]
    },
    "timestamp": "2025-02-28 16:34:26"
}